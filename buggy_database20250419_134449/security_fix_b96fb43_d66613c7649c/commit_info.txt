Commit Hash: b96fb439774e1bfb7d027ad324fa48606167cb52
Subject: KVM: nVMX: fixes to nested virt interrupt injection


Security Keywords:
- injection

Full commit message:
KVM: nVMX: fixes to nested virt interrupt injection

There are three issues in nested_vmx_check_exception:

1) it is not taking PFEC_MATCH/PFEC_MASK into account, as reported
by Wanpeng Li;

2) it should rebuild the interruption info and exit qualification fields
from scratch, as reported by Jim Mattson, because the values from the
L2->L0 vmexit may be invalid (e.g. if an emulated instruction causes
a page fault, the EPT misconfig's exit qualification is incorrect).

3) CR2 and DR6 should not be written for exception intercept vmexits
(CR2 only for AMD).

This patch fixes the first two and adds a comment about the last,
outlining the fix.

Cc: Jim Mattson <jmattson@google.com>
Cc: Wanpeng Li <wanpeng.li@hotmail.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

Metadata:
Author: Paolo Bonzini <pbonzini@redhat.com>
Author Date: Thu Jul 27 12:29:32 2017 +0200
Committer: Radim Krčmář <rkrcmar@redhat.com>
Commit Date: Tue Aug 1 22:24:17 2017 +0200

Files Changed: 2
Lines Added: 72
Lines Removed: 25
Total Changes: 97
