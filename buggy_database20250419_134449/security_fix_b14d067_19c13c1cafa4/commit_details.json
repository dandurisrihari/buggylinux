{
  "hash": "b14d067e850c19921cec2200bd8d179edf6a1aa6",
  "hash_short": "b14d067e",
  "subject": "xfs: quiet notify_failure EOPNOTSUPP cases",
  "body": "Patch series \"mm, xfs, dax: Fixes for memory_failure() handling\".\n\nI failed to run the memory error injection section of the ndctl test suite\non linux-next prior to the merge window and as a result some bugs were\nmissed.  While the new enabling targeted reflink enabled XFS filesystems\nthe bugs cropped up in the surrounding cases of DAX error injection on\next4-fsdax and device-dax.\n\nOne new assumption / clarification in this set is the notion that if a\nfilesystem's ->notify_failure() handler returns -EOPNOTSUPP, then it must\nbe the case that the fsdax usage of page->index and page->mapping are\nvalid.  I am fairly certain this is true for xfs_dax_notify_failure(), but\nwould appreciate another set of eyes.\n\n\nThis patch (of 4):\n\nXFS always registers dax_holder_operations regardless of whether the\nfilesystem is capable of handling the notifications.  The expectation is\nthat if the notify_failure handler cannot run then there are no scenarios\nwhere it needs to run.  In other words the expected semantic is that\npage->index and page->mapping are valid for memory_failure() when the\nconditions that cause -EOPNOTSUPP in xfs_dax_notify_failure() are present.\n\nA fallback to the generic memory_failure() path is expected so do not warn\nwhen that happens.\n\nLink: https://lkml.kernel.org/r/166153426798.2758201.15108211981034512993.stgit@dwillia2-xfh.jf.intel.com\nLink: https://lkml.kernel.org/r/166153427440.2758201.6709480562966161512.stgit@dwillia2-xfh.jf.intel.com\nFixes: 6f643c57d57c (\"xfs: implement ->notify_failure() for XFS\")\nSigned-off-by: Dan Williams <dan.j.williams@intel.com>\nReviewed-by: Christoph Hellwig <hch@lst.de>\nCc: Shiyang Ruan <ruansy.fnst@fujitsu.com>\nCc: Darrick J. Wong <djwong@kernel.org>\nCc: Al Viro <viro@zeniv.linux.org.uk>\nCc: Dave Chinner <david@fromorbit.com>\nCc: Goldwyn Rodrigues <rgoldwyn@suse.de>\nCc: Jane Chu <jane.chu@oracle.com>\nCc: Matthew Wilcox <willy@infradead.org>\nCc: Miaohe Lin <linmiaohe@huawei.com>\nCc: Naoya Horiguchi <naoya.horiguchi@nec.com>\nCc: Ritesh Harjani <riteshh@linux.ibm.com>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>",
  "full_message": "xfs: quiet notify_failure EOPNOTSUPP cases\n\nPatch series \"mm, xfs, dax: Fixes for memory_failure() handling\".\n\nI failed to run the memory error injection section of the ndctl test suite\non linux-next prior to the merge window and as a result some bugs were\nmissed.  While the new enabling targeted reflink enabled XFS filesystems\nthe bugs cropped up in the surrounding cases of DAX error injection on\next4-fsdax and device-dax.\n\nOne new assumption / clarification in this set is the notion that if a\nfilesystem's ->notify_failure() handler returns -EOPNOTSUPP, then it must\nbe the case that the fsdax usage of page->index and page->mapping are\nvalid.  I am fairly certain this is true for xfs_dax_notify_failure(), but\nwould appreciate another set of eyes.\n\n\nThis patch (of 4):\n\nXFS always registers dax_holder_operations regardless of whether the\nfilesystem is capable of handling the notifications.  The expectation is\nthat if the notify_failure handler cannot run then there are no scenarios\nwhere it needs to run.  In other words the expected semantic is that\npage->index and page->mapping are valid for memory_failure() when the\nconditions that cause -EOPNOTSUPP in xfs_dax_notify_failure() are present.\n\nA fallback to the generic memory_failure() path is expected so do not warn\nwhen that happens.\n\nLink: https://lkml.kernel.org/r/166153426798.2758201.15108211981034512993.stgit@dwillia2-xfh.jf.intel.com\nLink: https://lkml.kernel.org/r/166153427440.2758201.6709480562966161512.stgit@dwillia2-xfh.jf.intel.com\nFixes: 6f643c57d57c (\"xfs: implement ->notify_failure() for XFS\")\nSigned-off-by: Dan Williams <dan.j.williams@intel.com>\nReviewed-by: Christoph Hellwig <hch@lst.de>\nCc: Shiyang Ruan <ruansy.fnst@fujitsu.com>\nCc: Darrick J. Wong <djwong@kernel.org>\nCc: Al Viro <viro@zeniv.linux.org.uk>\nCc: Dave Chinner <david@fromorbit.com>\nCc: Goldwyn Rodrigues <rgoldwyn@suse.de>\nCc: Jane Chu <jane.chu@oracle.com>\nCc: Matthew Wilcox <willy@infradead.org>\nCc: Miaohe Lin <linmiaohe@huawei.com>\nCc: Naoya Horiguchi <naoya.horiguchi@nec.com>\nCc: Ritesh Harjani <riteshh@linux.ibm.com>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>",
  "author_name": "Dan Williams",
  "author_email": "dan.j.williams@intel.com",
  "author_date": "Fri Aug 26 10:17:54 2022 -0700",
  "author_date_iso": "2022-08-26T10:17:54-07:00",
  "committer_name": "Andrew Morton",
  "committer_email": "akpm@linux-foundation.org",
  "committer_date": "Sun Sep 11 16:22:29 2022 -0700",
  "committer_date_iso": "2022-09-11T16:22:29-07:00",
  "files_changed": [
    "fs/xfs/xfs_notify_failure.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "fs/xfs/xfs_notify_failure.c",
      "insertions": 2,
      "deletions": 2
    }
  ],
  "total_insertions": 2,
  "total_deletions": 2,
  "total_changes": 4,
  "parents": [
    "3d36424b3b5850bd92f3e89b953a430d7cfc88ef"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "fs/xfs/xfs_notify_failure.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}