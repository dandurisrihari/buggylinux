Commit Hash: 65f8ea4cd57dbd46ea13b41dc8bac03176b04233
Subject: ext4: check if directory block is within i_size

CVE Identifiers:
- CVE-2022-1184

Full commit message:
ext4: check if directory block is within i_size

Currently ext4 directory handling code implicitly assumes that the
directory blocks are always within the i_size. In fact ext4_append()
will attempt to allocate next directory block based solely on i_size and
the i_size is then appropriately increased after a successful
allocation.

However, for this to work it requires i_size to be correct. If, for any
reason, the directory inode i_size is corrupted in a way that the
directory tree refers to a valid directory block past i_size, we could
end up corrupting parts of the directory tree structure by overwriting
already used directory blocks when modifying the directory.

Fix it by catching the corruption early in __ext4_read_dirblock().

Addresses Red-Hat-Bugzilla: #2070205
CVE: CVE-2022-1184
Signed-off-by: Lukas Czerner <lczerner@redhat.com>
Cc: stable@vger.kernel.org
Reviewed-by: Andreas Dilger <adilger@dilger.ca>
Link: https://lore.kernel.org/r/20220704142721.157985-1-lczerner@redhat.com
Signed-off-by: Theodore Ts'o <tytso@mit.edu>

Metadata:
Author: Lukas Czerner <lczerner@redhat.com>
Author Date: Mon Jul 4 16:27:20 2022 +0200
Committer: Theodore Ts'o <tytso@mit.edu>
Commit Date: Tue Aug 2 23:56:17 2022 -0400

Files Changed: 1
Lines Added: 7
Lines Removed: 0
Total Changes: 7
