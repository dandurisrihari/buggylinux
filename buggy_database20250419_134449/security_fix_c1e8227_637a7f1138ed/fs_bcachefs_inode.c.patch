commit c1e822754cc7f28b98c6897d62e8b47b4001e422
Merge: f009e946c155 a069f014797f
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Thu Oct 24 12:38:59 2024 -0700

    Merge tag 'bcachefs-2024-10-22' of https://github.com/koverstreet/bcachefs
    
    Pull bcachefs fixes from Kent Overstreet:
     "Lots of hotfixes:
    
       - transaction restart injection has been shaking out a few things
    
       - fix a data corruption in the buffered write path on -ENOSPC, found
         by xfstests generic/299
    
       - Some small show_options fixes
    
       - Repair mismatches in inode hash type, seed: different snapshot
         versions of an inode must have the same hash/type seed, used for
         directory entries and xattrs. We were checking the hash seed, but
         not the type, and a user contributed a filesystem where the hash
         type on one inode had somehow been flipped; these fixes allow his
         filesystem to repair.
    
         Additionally, the hash type flip made some directory entries
         invisible, which were then recreated by userspace; so the hash
         check code now checks for duplicate non dangling dirents, and
         renames one of them if necessary.
    
       - Don't use wait_event_interruptible() in recovery: this fixes some
         filesystems failing to mount with -ERESTARTSYS
    
       - Workaround for kvmalloc not supporting > INT_MAX allocations,
         causing an -ENOMEM when allocating the sorted array of journal
         keys: this allows a 75 TB filesystem to mount
    
       - Make sure bch_inode_unpacked.bi_snapshot is set in the old inode
         compat path: this alllows Marcin's filesystem (in use since before
         6.7) to repair and mount"
    
    * tag 'bcachefs-2024-10-22' of https://github.com/koverstreet/bcachefs: (26 commits)
      bcachefs: Set bch_inode_unpacked.bi_snapshot in old inode path
      bcachefs: Mark more errors as AUTOFIX
      bcachefs: Workaround for kvmalloc() not supporting > INT_MAX allocations
      bcachefs: Don't use wait_event_interruptible() in recovery
      bcachefs: Fix __bch2_fsck_err() warning
      bcachefs: fsck: Improve hash_check_key()
      bcachefs: bch2_hash_set_or_get_in_snapshot()
      bcachefs: Repair mismatches in inode hash seed, type
      bcachefs: Add hash seed, type to inode_to_text()
      bcachefs: INODE_STR_HASH() for bch_inode_unpacked
      bcachefs: Run in-kernel offline fsck without ratelimit errors
      bcachefs: skip mount option handle for empty string.
      bcachefs: fix incorrect show_options results
      bcachefs: Fix data corruption on -ENOSPC in buffered write path
      bcachefs: bch2_folio_reservation_get_partial() is now better behaved
      bcachefs: fix disk reservation accounting in bch2_folio_reservation_get()
      bcachefS: ec: fix data type on stripe deletion
      bcachefs: Don't use commit_do() unnecessarily
      bcachefs: handle restarts in bch2_bucket_io_time_reset()
      bcachefs: fix restart handling in __bch2_resume_logged_op_finsert()
      ...