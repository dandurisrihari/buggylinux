{
  "hash": "fa4983862e506d395acc1b8d14dbebf63acc2e82",
  "hash_short": "fa498386",
  "subject": "nfsd: add LOCALIO support",
  "body": "Add server support for bypassing NFS for localhost reads, writes, and\ncommits. This is only useful when both the client and server are\nrunning on the same host.\n\nIf nfsd_open_local_fh() fails then the NFS client will both retry and\nfallback to normal network-based read, write and commit operations if\nlocalio is no longer supported.\n\nCare is taken to ensure the same NFS security mechanisms are used\n(authentication, etc) regardless of whether localio or regular NFS\naccess is used.  The auth_domain established as part of the traditional\nNFS client access to the NFS server is also used for localio.  Store\nauth_domain for localio in nfsd_uuid_t and transfer it to the client\nif it is local to the server.\n\nRelative to containers, localio gives the client access to the network\nnamespace the server has.  This is required to allow the client to\naccess the server's per-namespace nfsd_net struct.\n\nThis commit also introduces the use of NFSD's percpu_ref to interlock\nnfsd_destroy_serv and nfsd_open_local_fh, to ensure nn->nfsd_serv is\nnot destroyed while in use by nfsd_open_local_fh and other LOCALIO\nclient code.\n\nCONFIG_NFS_LOCALIO enables NFS server support for LOCALIO.\n\nSigned-off-by: Weston Andros Adamson <dros@primarydata.com>\nSigned-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>\nCo-developed-by: Mike Snitzer <snitzer@kernel.org>\nSigned-off-by: Mike Snitzer <snitzer@kernel.org>\nCo-developed-by: NeilBrown <neilb@suse.de>\nSigned-off-by: NeilBrown <neilb@suse.de>\nReviewed-by: Jeff Layton <jlayton@kernel.org>\nAcked-by: Chuck Lever <chuck.lever@oracle.com>\nSigned-off-by: Anna Schumaker <anna.schumaker@oracle.com>",
  "full_message": "nfsd: add LOCALIO support\n\nAdd server support for bypassing NFS for localhost reads, writes, and\ncommits. This is only useful when both the client and server are\nrunning on the same host.\n\nIf nfsd_open_local_fh() fails then the NFS client will both retry and\nfallback to normal network-based read, write and commit operations if\nlocalio is no longer supported.\n\nCare is taken to ensure the same NFS security mechanisms are used\n(authentication, etc) regardless of whether localio or regular NFS\naccess is used.  The auth_domain established as part of the traditional\nNFS client access to the NFS server is also used for localio.  Store\nauth_domain for localio in nfsd_uuid_t and transfer it to the client\nif it is local to the server.\n\nRelative to containers, localio gives the client access to the network\nnamespace the server has.  This is required to allow the client to\naccess the server's per-namespace nfsd_net struct.\n\nThis commit also introduces the use of NFSD's percpu_ref to interlock\nnfsd_destroy_serv and nfsd_open_local_fh, to ensure nn->nfsd_serv is\nnot destroyed while in use by nfsd_open_local_fh and other LOCALIO\nclient code.\n\nCONFIG_NFS_LOCALIO enables NFS server support for LOCALIO.\n\nSigned-off-by: Weston Andros Adamson <dros@primarydata.com>\nSigned-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>\nCo-developed-by: Mike Snitzer <snitzer@kernel.org>\nSigned-off-by: Mike Snitzer <snitzer@kernel.org>\nCo-developed-by: NeilBrown <neilb@suse.de>\nSigned-off-by: NeilBrown <neilb@suse.de>\nReviewed-by: Jeff Layton <jlayton@kernel.org>\nAcked-by: Chuck Lever <chuck.lever@oracle.com>\nSigned-off-by: Anna Schumaker <anna.schumaker@oracle.com>",
  "author_name": "Weston Andros Adamson",
  "author_email": "dros@primarydata.com",
  "author_date": "Thu Sep 5 15:09:50 2024 -0400",
  "author_date_iso": "2024-09-05T15:09:50-04:00",
  "committer_name": "Anna Schumaker",
  "committer_email": "anna.schumaker@oracle.com",
  "committer_date": "Mon Sep 23 15:03:30 2024 -0400",
  "committer_date_iso": "2024-09-23T15:03:30-04:00",
  "files_changed": [
    "fs/nfsd/Makefile",
    "fs/nfsd/filecache.c",
    "fs/nfsd/localio.c",
    "fs/nfsd/netns.h",
    "fs/nfsd/nfsctl.c",
    "fs/nfsd/trace.h",
    "fs/nfsd/vfs.h",
    "include/linux/nfslocalio.h"
  ],
  "files_changed_count": 8,
  "stats": [
    {
      "file": "fs/nfsd/Makefile",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "fs/nfsd/filecache.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "fs/nfsd/localio.c",
      "insertions": 92,
      "deletions": 0
    },
    {
      "file": "fs/nfsd/netns.h",
      "insertions": 4,
      "deletions": 0
    },
    {
      "file": "fs/nfsd/nfsctl.c",
      "insertions": 24,
      "deletions": 1
    },
    {
      "file": "fs/nfsd/trace.h",
      "insertions": 2,
      "deletions": 1
    },
    {
      "file": "fs/nfsd/vfs.h",
      "insertions": 2,
      "deletions": 0
    },
    {
      "file": "include/linux/nfslocalio.h",
      "insertions": 8,
      "deletions": 0
    }
  ],
  "total_insertions": 134,
  "total_deletions": 3,
  "total_changes": 137,
  "parents": [
    "a61e147e6be6e763d9c6dec8061d2893c0bb3423"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "authentication"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "fs/nfsd/localio.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "fs/nfsd/Makefile",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "fs/nfsd/netns.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "fs/nfsd/filecache.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "fs/nfsd/trace.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "fs/nfsd/vfs.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "fs/nfsd/nfsctl.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/linux/nfslocalio.h",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}