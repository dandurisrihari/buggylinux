{
  "hash": "c0b98ac1cc104f48763cdb27b1e9ac25fd81fc90",
  "hash_short": "c0b98ac1",
  "subject": "ipv6: sr: block BH in seg6_output_core() and seg6_input_core()",
  "body": "As explained in commit 1378817486d6 (\"tipc: block BH\nbefore using dst_cache\"), net/core/dst_cache.c\nhelpers need to be called with BH disabled.\n\nDisabling preemption in seg6_output_core() is not good enough,\nbecause seg6_output_core() is called from process context,\nlwtunnel_output() only uses rcu_read_lock().\n\nWe might be interrupted by a softirq, re-enter seg6_output_core()\nand corrupt dst_cache data structures.\n\nFix the race by using local_bh_disable() instead of\npreempt_disable().\n\nApply a similar change in seg6_input_core().\n\nFixes: fa79581ea66c (\"ipv6: sr: fix several BUGs when preemption is enabled\")\nFixes: 6c8702c60b88 (\"ipv6: sr: add support for SRH encapsulation and injection with lwtunnels\")\nSigned-off-by: Eric Dumazet <edumazet@google.com>\nCc: David Lebrun <dlebrun@google.com>\nAcked-by: Paolo Abeni <pabeni@redhat.com>\nLink: https://lore.kernel.org/r/20240531132636.2637995-4-edumazet@google.com\nSigned-off-by: Jakub Kicinski <kuba@kernel.org>",
  "full_message": "ipv6: sr: block BH in seg6_output_core() and seg6_input_core()\n\nAs explained in commit 1378817486d6 (\"tipc: block BH\nbefore using dst_cache\"), net/core/dst_cache.c\nhelpers need to be called with BH disabled.\n\nDisabling preemption in seg6_output_core() is not good enough,\nbecause seg6_output_core() is called from process context,\nlwtunnel_output() only uses rcu_read_lock().\n\nWe might be interrupted by a softirq, re-enter seg6_output_core()\nand corrupt dst_cache data structures.\n\nFix the race by using local_bh_disable() instead of\npreempt_disable().\n\nApply a similar change in seg6_input_core().\n\nFixes: fa79581ea66c (\"ipv6: sr: fix several BUGs when preemption is enabled\")\nFixes: 6c8702c60b88 (\"ipv6: sr: add support for SRH encapsulation and injection with lwtunnels\")\nSigned-off-by: Eric Dumazet <edumazet@google.com>\nCc: David Lebrun <dlebrun@google.com>\nAcked-by: Paolo Abeni <pabeni@redhat.com>\nLink: https://lore.kernel.org/r/20240531132636.2637995-4-edumazet@google.com\nSigned-off-by: Jakub Kicinski <kuba@kernel.org>",
  "author_name": "Eric Dumazet",
  "author_email": "edumazet@google.com",
  "author_date": "Fri May 31 13:26:34 2024 +0000",
  "author_date_iso": "2024-05-31T13:26:34+00:00",
  "committer_name": "Jakub Kicinski",
  "committer_email": "kuba@kernel.org",
  "committer_date": "Mon Jun 3 18:50:08 2024 -0700",
  "committer_date_iso": "2024-06-03T18:50:08-07:00",
  "files_changed": [
    "net/ipv6/seg6_iptunnel.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "net/ipv6/seg6_iptunnel.c",
      "insertions": 6,
      "deletions": 8
    }
  ],
  "total_insertions": 6,
  "total_deletions": 8,
  "total_changes": 14,
  "parents": [
    "db0090c6eb12c31246438b7fe2a8f1b833e7a653"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "net/ipv6/seg6_iptunnel.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}