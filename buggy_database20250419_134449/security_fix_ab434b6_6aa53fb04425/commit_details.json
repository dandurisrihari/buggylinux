{
  "hash": "ab434b60ab07f8c44246b6fb0cddee436687a09a",
  "hash_short": "ab434b60",
  "subject": "ceph: initialize client debugfs outside of monc->mutex",
  "body": "Initializing debufs under monc->mutex introduces a lock dependency for\nsb->s_type->i_mutex_key, which (combined with several other dependencies)\nleads to an annoying lockdep warning.  There's no particular reason to do\nthe debugfs setup under this lock, so move it out.\n\nIt used to be the case that our first monmap could come from the OSD; that\nis no longer the case with recent servers, so we will reliably set up the\nclient entry during the initial authentication.\n\nWe don't have to worry about racing with debugfs teardown by\nceph_debugfs_client_cleanup() because ceph_destroy_client() calls\nceph_msgr_flush() first, which will wait for the message dispatch work\nto complete (and the debugfs init to complete).\n\nFixes: #1940\nSigned-off-by: Sage Weil <sage@newdream.net>",
  "full_message": "ceph: initialize client debugfs outside of monc->mutex\n\nInitializing debufs under monc->mutex introduces a lock dependency for\nsb->s_type->i_mutex_key, which (combined with several other dependencies)\nleads to an annoying lockdep warning.  There's no particular reason to do\nthe debugfs setup under this lock, so move it out.\n\nIt used to be the case that our first monmap could come from the OSD; that\nis no longer the case with recent servers, so we will reliably set up the\nclient entry during the initial authentication.\n\nWe don't have to worry about racing with debugfs teardown by\nceph_debugfs_client_cleanup() because ceph_destroy_client() calls\nceph_msgr_flush() first, which will wait for the message dispatch work\nto complete (and the debugfs init to complete).\n\nFixes: #1940\nSigned-off-by: Sage Weil <sage@newdream.net>",
  "author_name": "Sage Weil",
  "author_email": "sage@newdream.net",
  "author_date": "Fri Jan 13 22:22:03 2012 -0800",
  "author_date_iso": "2012-01-13T22:22:03-08:00",
  "committer_name": "Sage Weil",
  "committer_email": "sage@newdream.net",
  "committer_date": "Thu Feb 2 12:49:01 2012 -0800",
  "committer_date_iso": "2012-02-02T12:49:01-08:00",
  "files_changed": [
    "net/ceph/ceph_common.c",
    "net/ceph/mon_client.c"
  ],
  "files_changed_count": 2,
  "stats": [
    {
      "file": "net/ceph/ceph_common.c",
      "insertions": 0,
      "deletions": 2
    },
    {
      "file": "net/ceph/mon_client.c",
      "insertions": 12,
      "deletions": 1
    }
  ],
  "total_insertions": 12,
  "total_deletions": 3,
  "total_changes": 15,
  "parents": [
    "114fc47492e23d93653e4a16664833e98d62a563"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v3.10",
    "v3.10-rc1",
    "v3.10-rc2",
    "v3.10-rc3",
    "v3.10-rc4",
    "v3.10-rc5",
    "v3.10-rc6",
    "v3.10-rc7",
    "v3.11",
    "v3.11-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "authentication"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "net/ceph/ceph_common.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "net/ceph/mon_client.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}