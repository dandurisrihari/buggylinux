{
  "hash": "dd0bb688eaa241b5655d396d45366cba9225aed9",
  "hash_short": "dd0bb688",
  "subject": "bpf: add a bpf_override_function helper",
  "body": "Error injection is sloppy and very ad-hoc.  BPF could fill this niche\nperfectly with it's kprobe functionality.  We could make sure errors are\nonly triggered in specific call chains that we care about with very\nspecific situations.  Accomplish this with the bpf_override_funciton\nhelper.  This will modify the probe'd callers return value to the\nspecified value and set the PC to an override function that simply\nreturns, bypassing the originally probed function.  This gives us a nice\nclean way to implement systematic error injection for all of our code\npaths.\n\nAcked-by: Alexei Starovoitov <ast@kernel.org>\nSigned-off-by: Josef Bacik <jbacik@fb.com>\nAcked-by: Daniel Borkmann <daniel@iogearbox.net>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
  "full_message": "bpf: add a bpf_override_function helper\n\nError injection is sloppy and very ad-hoc.  BPF could fill this niche\nperfectly with it's kprobe functionality.  We could make sure errors are\nonly triggered in specific call chains that we care about with very\nspecific situations.  Accomplish this with the bpf_override_funciton\nhelper.  This will modify the probe'd callers return value to the\nspecified value and set the PC to an override function that simply\nreturns, bypassing the originally probed function.  This gives us a nice\nclean way to implement systematic error injection for all of our code\npaths.\n\nAcked-by: Alexei Starovoitov <ast@kernel.org>\nSigned-off-by: Josef Bacik <jbacik@fb.com>\nAcked-by: Daniel Borkmann <daniel@iogearbox.net>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
  "author_name": "Josef Bacik",
  "author_email": "jbacik@fb.com",
  "author_date": "Tue Nov 7 15:28:42 2017 -0500",
  "author_date_iso": "2017-11-07T15:28:42-05:00",
  "committer_name": "David S. Miller",
  "committer_email": "davem@davemloft.net",
  "committer_date": "Sat Nov 11 12:18:05 2017 +0900",
  "committer_date_iso": "2017-11-11T12:18:05+09:00",
  "files_changed": [
    "arch/Kconfig",
    "arch/x86/Kconfig",
    "arch/x86/include/asm/kprobes.h",
    "arch/x86/include/asm/ptrace.h",
    "arch/x86/kernel/kprobes/ftrace.c",
    "include/linux/filter.h",
    "include/linux/trace_events.h",
    "include/uapi/linux/bpf.h",
    "kernel/bpf/core.c",
    "kernel/bpf/verifier.c",
    "kernel/events/core.c",
    "kernel/trace/Kconfig",
    "kernel/trace/bpf_trace.c",
    "kernel/trace/trace_kprobe.c",
    "kernel/trace/trace_probe.h"
  ],
  "files_changed_count": 15,
  "stats": [
    {
      "file": "arch/Kconfig",
      "insertions": 3,
      "deletions": 0
    },
    {
      "file": "arch/x86/Kconfig",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/x86/include/asm/kprobes.h",
      "insertions": 4,
      "deletions": 0
    },
    {
      "file": "arch/x86/include/asm/ptrace.h",
      "insertions": 5,
      "deletions": 0
    },
    {
      "file": "arch/x86/kernel/kprobes/ftrace.c",
      "insertions": 14,
      "deletions": 0
    },
    {
      "file": "include/linux/filter.h",
      "insertions": 2,
      "deletions": 1
    },
    {
      "file": "include/linux/trace_events.h",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "include/uapi/linux/bpf.h",
      "insertions": 6,
      "deletions": 1
    },
    {
      "file": "kernel/bpf/core.c",
      "insertions": 3,
      "deletions": 0
    },
    {
      "file": "kernel/bpf/verifier.c",
      "insertions": 2,
      "deletions": 0
    },
    {
      "file": "kernel/events/core.c",
      "insertions": 7,
      "deletions": 0
    },
    {
      "file": "kernel/trace/Kconfig",
      "insertions": 11,
      "deletions": 0
    },
    {
      "file": "kernel/trace/bpf_trace.c",
      "insertions": 35,
      "deletions": 0
    },
    {
      "file": "kernel/trace/trace_kprobe.c",
      "insertions": 33,
      "deletions": 7
    },
    {
      "file": "kernel/trace/trace_probe.h",
      "insertions": 6,
      "deletions": 0
    }
  ],
  "total_insertions": 133,
  "total_deletions": 9,
  "total_changes": 142,
  "parents": [
    "54985120a1c461b74f9510e5d730971f2a2383b1"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.15",
    "v4.15-rc1",
    "v4.15-rc2",
    "v4.15-rc3",
    "v4.15-rc4",
    "v4.15-rc5",
    "v4.15-rc6",
    "v4.15-rc7",
    "v4.15-rc8",
    "v4.15-rc9"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "include/linux/filter.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/Kconfig",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/linux/trace_events.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/include/asm/ptrace.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/uapi/linux/bpf.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/include/asm/kprobes.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kernel/kprobes/ftrace.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/Kconfig",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "kernel/bpf/core.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "kernel/bpf/verifier.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "kernel/trace/trace_probe.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "kernel/trace/bpf_trace.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "kernel/trace/Kconfig",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "kernel/trace/trace_kprobe.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "kernel/events/core.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}