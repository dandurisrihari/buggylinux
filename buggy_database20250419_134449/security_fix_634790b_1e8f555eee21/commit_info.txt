Commit Hash: 634790b82759c98ee57c80966d859083fa2fcd8c
Subject: KVM: s390: migration / injection of prog irq ilc


Security Keywords:
- injection

Full commit message:
KVM: s390: migration / injection of prog irq ilc

We have to migrate the program irq ilc and someday we will have to
specify the ilc without KVM trying to autodetect the value.

Let's reuse one of the spare fields in our program irq that should
always be set to 0 by user space. Because we also want to make use
of 0 ilcs ("not available"), we need a validity indicator.

If no valid ilc is given, we try to autodetect the ilc via the current
icptcode and icptstatus + parameter and store the valid ilc in the
irq structure.

This has a nice effect: QEMU's making use of KVM_S390_IRQ /
KVM_S390_SET_IRQ_STATE / KVM_S390_GET_IRQ_STATE for migration will
directly migrate the ilc without any changes.

Please note that we use bit 0 as validity and bit 1,2 for the ilc, so
by applying the ilc mask we directly get the ilen which is usually what
we work with.

Reviewed-by: Christian Borntraeger <borntraeger@de.ibm.com>
Signed-off-by: David Hildenbrand <dahi@linux.vnet.ibm.com>
Signed-off-by: Christian Borntraeger <borntraeger@de.ibm.com>

Metadata:
Author: David Hildenbrand <dahi@linux.vnet.ibm.com>
Author Date: Wed Nov 4 16:33:33 2015 +0100
Committer: Christian Borntraeger <borntraeger@de.ibm.com>
Commit Date: Wed Feb 10 13:12:50 2016 +0100

Files Changed: 2
Lines Added: 17
Lines Removed: 2
Total Changes: 19
