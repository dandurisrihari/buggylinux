{
  "hash": "2e53b877dc1258d4ac3de98f496bb88ec3bf5e25",
  "hash_short": "2e53b877",
  "subject": "lkdtm: Add CFI_BACKWARD to test ROP mitigations",
  "body": "In order to test various backward-edge control flow integrity methods,\nadd a test that manipulates the return address on the stack. Currently\nonly arm64 Pointer Authentication and Shadow Call Stack is supported.\n\n $ echo CFI_BACKWARD | cat >/sys/kernel/debug/provoke-crash/DIRECT\n\nUnder SCS, successful test of the mitigation is reported as:\n\n lkdtm: Performing direct entry CFI_BACKWARD\n lkdtm: Attempting unchecked stack return address redirection ...\n lkdtm: ok: redirected stack return address.\n lkdtm: Attempting checked stack return address redirection ...\n lkdtm: ok: control flow unchanged.\n\nUnder PAC, successful test of the mitigation is reported by the PAC\nexception handler:\n\n lkdtm: Performing direct entry CFI_BACKWARD\n lkdtm: Attempting unchecked stack return address redirection ...\n lkdtm: ok: redirected stack return address.\n lkdtm: Attempting checked stack return address redirection ...\n Unable to handle kernel paging request at virtual address bfffffc0088d0514\n Mem abort info:\n   ESR = 0x86000004\n   EC = 0x21: IABT (current EL), IL = 32 bits\n   SET = 0, FnV = 0\n   EA = 0, S1PTW = 0\n   FSC = 0x04: level 0 translation fault\n [bfffffc0088d0514] address between user and kernel address ranges\n ...\n\nIf the CONFIGs are missing (or the mitigation isn't working), failure\nis reported as:\n\n lkdtm: Performing direct entry CFI_BACKWARD\n lkdtm: Attempting unchecked stack return address redirection ...\n lkdtm: ok: redirected stack return address.\n lkdtm: Attempting checked stack return address redirection ...\n lkdtm: FAIL: stack return address was redirected!\n lkdtm: This is probably expected, since this kernel was built *without* CONFIG_ARM64_PTR_AUTH_KERNEL=y nor CONFIG_SHADOW_CALL_STACK=y\n\nCo-developed-by: Dan Li <ashimida@linux.alibaba.com>\nSigned-off-by: Dan Li <ashimida@linux.alibaba.com>\nCc: Arnd Bergmann <arnd@arndb.de>\nCc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>\nSigned-off-by: Kees Cook <keescook@chromium.org>\nLink: https://lore.kernel.org/lkml/20220416001103.1524653-1-keescook@chromium.org",
  "full_message": "lkdtm: Add CFI_BACKWARD to test ROP mitigations\n\nIn order to test various backward-edge control flow integrity methods,\nadd a test that manipulates the return address on the stack. Currently\nonly arm64 Pointer Authentication and Shadow Call Stack is supported.\n\n $ echo CFI_BACKWARD | cat >/sys/kernel/debug/provoke-crash/DIRECT\n\nUnder SCS, successful test of the mitigation is reported as:\n\n lkdtm: Performing direct entry CFI_BACKWARD\n lkdtm: Attempting unchecked stack return address redirection ...\n lkdtm: ok: redirected stack return address.\n lkdtm: Attempting checked stack return address redirection ...\n lkdtm: ok: control flow unchanged.\n\nUnder PAC, successful test of the mitigation is reported by the PAC\nexception handler:\n\n lkdtm: Performing direct entry CFI_BACKWARD\n lkdtm: Attempting unchecked stack return address redirection ...\n lkdtm: ok: redirected stack return address.\n lkdtm: Attempting checked stack return address redirection ...\n Unable to handle kernel paging request at virtual address bfffffc0088d0514\n Mem abort info:\n   ESR = 0x86000004\n   EC = 0x21: IABT (current EL), IL = 32 bits\n   SET = 0, FnV = 0\n   EA = 0, S1PTW = 0\n   FSC = 0x04: level 0 translation fault\n [bfffffc0088d0514] address between user and kernel address ranges\n ...\n\nIf the CONFIGs are missing (or the mitigation isn't working), failure\nis reported as:\n\n lkdtm: Performing direct entry CFI_BACKWARD\n lkdtm: Attempting unchecked stack return address redirection ...\n lkdtm: ok: redirected stack return address.\n lkdtm: Attempting checked stack return address redirection ...\n lkdtm: FAIL: stack return address was redirected!\n lkdtm: This is probably expected, since this kernel was built *without* CONFIG_ARM64_PTR_AUTH_KERNEL=y nor CONFIG_SHADOW_CALL_STACK=y\n\nCo-developed-by: Dan Li <ashimida@linux.alibaba.com>\nSigned-off-by: Dan Li <ashimida@linux.alibaba.com>\nCc: Arnd Bergmann <arnd@arndb.de>\nCc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>\nSigned-off-by: Kees Cook <keescook@chromium.org>\nLink: https://lore.kernel.org/lkml/20220416001103.1524653-1-keescook@chromium.org",
  "author_name": "Kees Cook",
  "author_email": "keescook@chromium.org",
  "author_date": "Fri Mar 11 12:00:42 2022 -0800",
  "author_date_iso": "2022-03-11T12:00:42-08:00",
  "committer_name": "Kees Cook",
  "committer_email": "keescook@chromium.org",
  "committer_date": "Sat Apr 16 13:57:23 2022 -0700",
  "committer_date_iso": "2022-04-16T13:57:23-07:00",
  "files_changed": [
    "drivers/misc/lkdtm/cfi.c",
    "tools/testing/selftests/lkdtm/tests.txt"
  ],
  "files_changed_count": 2,
  "stats": [
    {
      "file": "drivers/misc/lkdtm/cfi.c",
      "insertions": 134,
      "deletions": 0
    },
    {
      "file": "tools/testing/selftests/lkdtm/tests.txt",
      "insertions": 1,
      "deletions": 0
    }
  ],
  "total_insertions": 135,
  "total_deletions": 0,
  "total_changes": 135,
  "parents": [
    "73f62e60d80c2d74491933ca49006b9e70563738"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "Authentication"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/misc/lkdtm/cfi.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "tools/testing/selftests/lkdtm/tests.txt",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}