diff --cc fs/xfs/xfs_error.c
index 822e6a0e9d1a,713341d246d1..ae082808cfed
--- a/fs/xfs/xfs_error.c
+++ b/fs/xfs/xfs_error.c
@@@ -277,9 -307,11 +307,11 @@@ xfs_errortag_test
  	if (!mp->m_errortag)
  		return false;
  
- 	ASSERT(error_tag < XFS_ERRTAG_MAX);
+ 	if (!xfs_errortag_valid(error_tag))
+ 		return false;
+ 
  	randfactor = mp->m_errortag[error_tag];
 -	if (!randfactor || prandom_u32_max(randfactor))
 +	if (!randfactor || get_random_u32_below(randfactor))
  		return false;
  
  	xfs_warn_ratelimited(mp,
diff --cc fs/xfs/xfs_iomap.c
index d9401d0300ad,43f447199c08..669c1bc5c3a7
--- a/fs/xfs/xfs_iomap.c
+++ b/fs/xfs/xfs_iomap.c
@@@ -1215,8 -1251,9 +1251,9 @@@ xfs_read_iomap_begin
  		return error;
  	error = xfs_bmapi_read(ip, offset_fsb, end_fsb - offset_fsb, &imap,
  			       &nimaps, 0);
 -	if (!error && (flags & IOMAP_REPORT))
 +	if (!error && ((flags & IOMAP_REPORT) || IS_DAX(inode)))
  		error = xfs_reflink_trim_around_shared(ip, &imap, &shared);
+ 	seq = xfs_iomap_inode_sequence(ip, shared ? IOMAP_F_SHARED : 0);
  	xfs_iunlock(ip, lockmode);
  
  	if (error)