commit 13241a5ee367dfa929268a0ac484323a37ea7290
Author: Kees Cook <kees@kernel.org>
Date:   Fri Oct 6 13:17:28 2023 -0700

    mtd: rawnand: Annotate struct mtk_nfc_nand_chip with __counted_by
    
    Prepare for the coming implementation by GCC and Clang of the __counted_by
    attribute. Flexible array members annotated with __counted_by can have
    their accesses bounds-checked at run-time via CONFIG_UBSAN_BOUNDS (for
    array indexing) and CONFIG_FORTIFY_SOURCE (for strcpy/memcpy-family
    functions).
    
    As found with Coccinelle[1], add __counted_by for struct
    mtk_nfc_nand_chip.
    
    Cc: Miquel Raynal <miquel.raynal@bootlin.com>
    Cc: Richard Weinberger <richard@nod.at>
    Cc: Vignesh Raghavendra <vigneshr@ti.com>
    Cc: Matthias Brugger <matthias.bgg@gmail.com>
    Cc: AngeloGioacchino Del Regno <angelogioacchino.delregno@collabora.com>
    Cc: "Gustavo A. R. Silva" <gustavoars@kernel.org>
    Cc: Heiko Stuebner <heiko@sntech.de>
    Cc: Martin Blumenstingl <martin.blumenstingl@googlemail.com>
    Cc: Thierry Reding <treding@nvidia.com>
    Cc: Roger Quadros <rogerq@kernel.org>
    Cc: "Uwe Kleine-KÃ¶nig" <u.kleine-koenig@pengutronix.de>
    Cc: Cai Huoqing <cai.huoqing@linux.dev>
    Cc: Chuanhong Guo <gch981213@gmail.com>
    Cc: Rob Herring <robh@kernel.org>
    Cc: Li Zetao <lizetao1@huawei.com>
    Cc: linux-mtd@lists.infradead.org
    Cc: linux-arm-kernel@lists.infradead.org
    Cc: linux-mediatek@lists.infradead.org
    Cc: linux-hardening@vger.kernel.org
    Link: https://github.com/kees/kernel-tools/blob/trunk/coccinelle/examples/counted_by.cocci [1]
    Signed-off-by: Kees Cook <keescook@chromium.org>
    Reviewed-by: Gustavo A. R. Silva <gustavoars@kernel.org>
    Signed-off-by: Miquel Raynal <miquel.raynal@bootlin.com>
    Link: https://lore.kernel.org/linux-mtd/20231006201728.work.750-kees@kernel.org

diff --git a/drivers/mtd/nand/raw/mtk_nand.c b/drivers/mtd/nand/raw/mtk_nand.c
index 29c8bddde67f..60198e33d2d5 100644
--- a/drivers/mtd/nand/raw/mtk_nand.c
+++ b/drivers/mtd/nand/raw/mtk_nand.c
@@ -130,7 +130,7 @@ struct mtk_nfc_nand_chip {
 	u32 spare_per_sector;
 
 	int nsels;
-	u8 sels[];
+	u8 sels[] __counted_by(nsels);
 	/* nothing after this field */
 };