Commit Hash: b8c75e4a1b325ea0a9433fa8834be97b5836b946
Subject: media: dvb-core: Fix kernel WARNING for blocking operation in wait_event*()

CVE Identifiers:
- CVE-2023-31084
- CVE-2023-31084

Full commit message:
media: dvb-core: Fix kernel WARNING for blocking operation in wait_event*()

Using a semaphore in the wait_event*() condition is no good idea.
It hits a kernel WARN_ON() at prepare_to_wait_event() like:
  do not call blocking ops when !TASK_RUNNING; state=1 set at
  prepare_to_wait_event+0x6d/0x690

For avoiding the potential deadlock, rewrite to an open-coded loop
instead.  Unlike the loop in wait_event*(), this uses wait_woken()
after the condition check, hence the task state stays consistent.

CVE-2023-31084 was assigned to this bug.

Link: https://lore.kernel.org/r/CA+UBctCu7fXn4q41O_3=id1+OdyQ85tZY1x+TkT-6OVBL6KAUw@mail.gmail.com/

Link: https://lore.kernel.org/linux-media/20230512151800.1874-1-tiwai@suse.de
Reported-by: Yu Hao <yhao016@ucr.edu>
Closes: https://nvd.nist.gov/vuln/detail/CVE-2023-31084
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Mauro Carvalho Chehab <mchehab@kernel.org>

Metadata:
Author: Takashi Iwai <tiwai@suse.de>
Author Date: Fri May 12 16:18:00 2023 +0100
Committer: Mauro Carvalho Chehab <mchehab@kernel.org>
Commit Date: Sun May 14 07:33:31 2023 +0100

Files Changed: 1
Lines Added: 12
Lines Removed: 4
Total Changes: 16
