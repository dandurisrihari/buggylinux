Commit Hash: 8fc153cda9c9e6aed2a4a7235970dd6c6cb6e954
Subject: arm64: KVM: Fix AArch64 guest userspace exception injection


Security Keywords:
- injection

Full commit message:
arm64: KVM: Fix AArch64 guest userspace exception injection

At the moment, our fault injection is pretty limited. We always
generate a SYNC exception into EL1, as if the fault was actually
from EL1h, no matter how it was generated.

This is obviously wrong, as EL0 can generate faults of its own
(not to mention the pretty-much unused EL1t mode).

This patch fixes it by implementing section D1.10.2 of the ARMv8 ARM,
and in particular table D1-7 ("Vector offsets from vector table base
address"), which describes which vector to use depending on the source
exception level and type (synchronous, IRQ, FIQ or SError).

Reviewed-by: Christoffer Dall <christoffer.dall@linaro.org>
Tested-by: Shannon Zhao <shannon.zhao@linaro.org>
Signed-off-by: Marc Zyngier <marc.zyngier@arm.com>

Metadata:
Author: Marc Zyngier <marc.zyngier@arm.com>
Author Date: Wed Jan 6 18:29:19 2016 +0000
Committer: Marc Zyngier <marc.zyngier@arm.com>
Commit Date: Sun Jan 24 21:55:57 2016 +0000

Files Changed: 1
Lines Added: 35
Lines Removed: 3
Total Changes: 38
