Commit Hash: c12e56ef6951f4fce1afe9ef6aab9243ea9a9b04
Subject: RDMA/nes: Don't allow userspace QPs to use STag zero


Security Keywords:
- privilege escalation

Full commit message:
RDMA/nes: Don't allow userspace QPs to use STag zero

STag zero is a special STag that allows consumers to access any bus
address without registering memory.  The nes driver unfortunately
allows STag zero to be used even with QPs created by unprivileged
userspace consumers, which means that any process with direct verbs
access to the nes device can read and write any memory accessible to
the underlying PCI device (usually any memory in the system).  Such
access is usually given for cluster software such as MPI to use, so
this is a local privilege escalation bug on most systems running this
driver.

The driver was using STag zero to receive the last streaming mode
data; to allow STag zero to be disabled for unprivileged QPs, the
driver now registers a special MR for this data.

Cc: <stable@kernel.org>
Signed-off-by: Faisal Latif <faisal.latif@intel.com>
Signed-off-by: Roland Dreier <rolandd@cisco.com>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

Metadata:
Author: Faisal Latif <faisal.latif@intel.com>
Author Date: Thu Mar 12 14:34:59 2009 -0700
Committer: Linus Torvalds <torvalds@linux-foundation.org>
Commit Date: Thu Mar 12 16:21:41 2009 -0700

Files Changed: 3
Lines Added: 37
Lines Removed: 5
Total Changes: 42
