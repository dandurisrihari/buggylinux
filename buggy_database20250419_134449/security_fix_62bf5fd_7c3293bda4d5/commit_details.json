{
  "hash": "62bf5fde5e14640a2a732be9f6a661a488025eae",
  "hash_short": "62bf5fde",
  "subject": "net: dsa: tag_ocelot: single out PTP-related transmit tag processing",
  "body": "There is one place where we cannot avoid accessing driver data, and that\nis 2-step PTP TX timestamping, since the switch wants us to provide a\ntimestamp request ID through the injection header, which naturally must\ncome from a sequence number kept by the driver (it is generated by the\n.port_txtstamp method prior to the tagger's xmit).\n\nHowever, since other drivers like dsa_loop do not claim PTP support\nanyway, the DSA_SKB_CB(skb)->clone will always be NULL anyway, so if we\nmove all PTP-related dereferences of struct ocelot and struct ocelot_port\ninto a separate function, we can effectively ensure that this is dead\ncode when the ocelot tagger is attached to non-ocelot switches, and the\nstateful portion of the tagger is more self-contained.\n\nSigned-off-by: Vladimir Oltean <vladimir.oltean@nxp.com>\nReviewed-by: Florian Fainelli <f.fainelli@gmail.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
  "full_message": "net: dsa: tag_ocelot: single out PTP-related transmit tag processing\n\nThere is one place where we cannot avoid accessing driver data, and that\nis 2-step PTP TX timestamping, since the switch wants us to provide a\ntimestamp request ID through the injection header, which naturally must\ncome from a sequence number kept by the driver (it is generated by the\n.port_txtstamp method prior to the tagger's xmit).\n\nHowever, since other drivers like dsa_loop do not claim PTP support\nanyway, the DSA_SKB_CB(skb)->clone will always be NULL anyway, so if we\nmove all PTP-related dereferences of struct ocelot and struct ocelot_port\ninto a separate function, we can effectively ensure that this is dead\ncode when the ocelot tagger is attached to non-ocelot switches, and the\nstateful portion of the tagger is more self-contained.\n\nSigned-off-by: Vladimir Oltean <vladimir.oltean@nxp.com>\nReviewed-by: Florian Fainelli <f.fainelli@gmail.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
  "author_name": "Vladimir Oltean",
  "author_email": "vladimir.oltean@nxp.com",
  "author_date": "Sun Feb 14 00:37:57 2021 +0200",
  "author_date_iso": "2021-02-14T00:37:57+02:00",
  "committer_name": "David S. Miller",
  "committer_email": "davem@davemloft.net",
  "committer_date": "Sun Feb 14 17:31:44 2021 -0800",
  "committer_date_iso": "2021-02-14T17:31:44-08:00",
  "files_changed": [
    "net/dsa/tag_ocelot.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "net/dsa/tag_ocelot.c",
      "insertions": 21,
      "deletions": 11
    }
  ],
  "total_insertions": 21,
  "total_deletions": 11,
  "total_changes": 32,
  "parents": [
    "40d3f295b5feda409784e569550057b5fbc2a295"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "net/dsa/tag_ocelot.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}