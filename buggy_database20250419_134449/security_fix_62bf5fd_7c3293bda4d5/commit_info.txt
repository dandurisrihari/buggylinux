Commit Hash: 62bf5fde5e14640a2a732be9f6a661a488025eae
Subject: net: dsa: tag_ocelot: single out PTP-related transmit tag processing


Security Keywords:
- injection

Full commit message:
net: dsa: tag_ocelot: single out PTP-related transmit tag processing

There is one place where we cannot avoid accessing driver data, and that
is 2-step PTP TX timestamping, since the switch wants us to provide a
timestamp request ID through the injection header, which naturally must
come from a sequence number kept by the driver (it is generated by the
.port_txtstamp method prior to the tagger's xmit).

However, since other drivers like dsa_loop do not claim PTP support
anyway, the DSA_SKB_CB(skb)->clone will always be NULL anyway, so if we
move all PTP-related dereferences of struct ocelot and struct ocelot_port
into a separate function, we can effectively ensure that this is dead
code when the ocelot tagger is attached to non-ocelot switches, and the
stateful portion of the tagger is more self-contained.

Signed-off-by: Vladimir Oltean <vladimir.oltean@nxp.com>
Reviewed-by: Florian Fainelli <f.fainelli@gmail.com>
Signed-off-by: David S. Miller <davem@davemloft.net>

Metadata:
Author: Vladimir Oltean <vladimir.oltean@nxp.com>
Author Date: Sun Feb 14 00:37:57 2021 +0200
Committer: David S. Miller <davem@davemloft.net>
Commit Date: Sun Feb 14 17:31:44 2021 -0800

Files Changed: 1
Lines Added: 21
Lines Removed: 11
Total Changes: 32
