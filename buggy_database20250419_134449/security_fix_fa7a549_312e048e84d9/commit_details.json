{
  "hash": "fa7a549d321a4189677b0cea86e58d9db7977f7b",
  "hash_short": "fa7a549d",
  "subject": "KVM: x86: accept userspace interrupt only if no event is injected",
  "body": "Once an exception has been injected, any side effects related to\nthe exception (such as setting CR2 or DR6) have been taked place.\nTherefore, once KVM sets the VM-entry interruption information\nfield or the AMD EVENTINJ field, the next VM-entry must deliver that\nexception.\n\nPending interrupts are processed after injected exceptions, so\nin theory it would not be a problem to use KVM_INTERRUPT when\nan injected exception is present.  However, DOSEMU is using\nrun->ready_for_interrupt_injection to detect interrupt windows\nand then using KVM_SET_SREGS/KVM_SET_REGS to inject the\ninterrupt manually.  For this to work, the interrupt window\nmust be delayed after the completion of the previous event\ninjection.\n\nCc: stable@vger.kernel.org\nReported-by: Stas Sergeev <stsp2@yandex.ru>\nTested-by: Stas Sergeev <stsp2@yandex.ru>\nFixes: 71cc849b7093 (\"KVM: x86: Fix split-irqchip vs interrupt injection window request\")\nReviewed-by: Sean Christopherson <seanjc@google.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "full_message": "KVM: x86: accept userspace interrupt only if no event is injected\n\nOnce an exception has been injected, any side effects related to\nthe exception (such as setting CR2 or DR6) have been taked place.\nTherefore, once KVM sets the VM-entry interruption information\nfield or the AMD EVENTINJ field, the next VM-entry must deliver that\nexception.\n\nPending interrupts are processed after injected exceptions, so\nin theory it would not be a problem to use KVM_INTERRUPT when\nan injected exception is present.  However, DOSEMU is using\nrun->ready_for_interrupt_injection to detect interrupt windows\nand then using KVM_SET_SREGS/KVM_SET_REGS to inject the\ninterrupt manually.  For this to work, the interrupt window\nmust be delayed after the completion of the previous event\ninjection.\n\nCc: stable@vger.kernel.org\nReported-by: Stas Sergeev <stsp2@yandex.ru>\nTested-by: Stas Sergeev <stsp2@yandex.ru>\nFixes: 71cc849b7093 (\"KVM: x86: Fix split-irqchip vs interrupt injection window request\")\nReviewed-by: Sean Christopherson <seanjc@google.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "author_name": "Paolo Bonzini",
  "author_email": "pbonzini@redhat.com",
  "author_date": "Wed Jul 14 17:37:49 2021 -0400",
  "author_date_iso": "2021-07-14T17:37:49-04:00",
  "committer_name": "Paolo Bonzini",
  "committer_email": "pbonzini@redhat.com",
  "committer_date": "Fri Jul 30 07:53:02 2021 -0400",
  "committer_date_iso": "2021-07-30T07:53:02-04:00",
  "files_changed": [
    "arch/x86/kvm/x86.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "arch/x86/kvm/x86.c",
      "insertions": 11,
      "deletions": 2
    }
  ],
  "total_insertions": 11,
  "total_deletions": 2,
  "total_changes": 13,
  "parents": [
    "8750f9bbda115f3f79bfe43be85551ee5e12b6ff"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "inject"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/x86/kvm/x86.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}