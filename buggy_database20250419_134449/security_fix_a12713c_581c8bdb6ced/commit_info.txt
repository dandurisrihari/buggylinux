Commit Hash: a12713c25b36cbbc1a3204b2a49a72f7bc8a8847
Subject: KVM: SVM: don't NMI singlestep over event injection


Security Keywords:
- injection

Full commit message:
KVM: SVM: don't NMI singlestep over event injection

Singlestepping is enabled by setting the TF flag and care must be
taken to not let the guest see (and reuse at an inconvenient time)
the modified rflag value. One such case is event injection, as part
of which flags are pushed on the stack and restored later on iret.

This commit disables singlestepping when we're about to inject an
event and forces an immediate exit for us to re-evaluate the NMI
related state.

Suggested-by: Paolo Bonzini <pbonzini@redhat.com>
Signed-off-by: Ladi Prosek <lprosek@redhat.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

Metadata:
Author: Ladi Prosek <lprosek@redhat.com>
Author Date: Wed Jun 21 09:07:00 2017 +0200
Committer: Paolo Bonzini <pbonzini@redhat.com>
Commit Date: Tue Jun 27 16:35:25 2017 +0200

Files Changed: 1
Lines Added: 16
Lines Removed: 0
Total Changes: 16
