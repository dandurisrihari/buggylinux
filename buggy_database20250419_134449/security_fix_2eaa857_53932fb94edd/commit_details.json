{
  "hash": "2eaa857534b4860dc337496e35f72f50614383b3",
  "hash_short": "2eaa8575",
  "subject": "Merge branch 'net-tls-fix-scatter-gather-list-issues'",
  "body": "Jakub Kicinski says:\n\n====================\nnet: tls: fix scatter-gather list issues\n\nThis series kicked of by a syzbot report fixes three issues around\nscatter gather handling in the TLS code. First patch fixes a use-\n-after-free situation which may occur if record was freed on error.\nThis could have already happened in BPF paths, and patch 2 now makes\nthe same condition occur in non-BPF code.\n\nPatch 2 fixes the problem spotted by syzbot. If encryption failed\nwe have to clean the end markings from scatter gather list. As\nsuggested by John the patch frees the record entirely and caller\nmay retry copying data from user space buffer again.\n\nThird patch fixes a bug in the TLS 1.3 code spotted while working\non patch 2. TLS 1.3 may effectively overflow the SG list which\nleads to the BUG() in sg_page() being triggered.\n\nPatch 4 adds a test case which triggers this bug reliably.\n\nNext two patches are small cleanups of dead code and code which\nmakes dangerous assumptions.\n\nLast but not least two minor improvements to the sockmap tests.\n\nTested:\n - bpf/test_sockmap\n - net/tls\n - syzbot repro (which used error injection, hence no direct\n   selftest is added to preserve it).\n====================\n\nSigned-off-by: David S. Miller <davem@davemloft.net>",
  "full_message": "Merge branch 'net-tls-fix-scatter-gather-list-issues'\n\nJakub Kicinski says:\n\n====================\nnet: tls: fix scatter-gather list issues\n\nThis series kicked of by a syzbot report fixes three issues around\nscatter gather handling in the TLS code. First patch fixes a use-\n-after-free situation which may occur if record was freed on error.\nThis could have already happened in BPF paths, and patch 2 now makes\nthe same condition occur in non-BPF code.\n\nPatch 2 fixes the problem spotted by syzbot. If encryption failed\nwe have to clean the end markings from scatter gather list. As\nsuggested by John the patch frees the record entirely and caller\nmay retry copying data from user space buffer again.\n\nThird patch fixes a bug in the TLS 1.3 code spotted while working\non patch 2. TLS 1.3 may effectively overflow the SG list which\nleads to the BUG() in sg_page() being triggered.\n\nPatch 4 adds a test case which triggers this bug reliably.\n\nNext two patches are small cleanups of dead code and code which\nmakes dangerous assumptions.\n\nLast but not least two minor improvements to the sockmap tests.\n\nTested:\n - bpf/test_sockmap\n - net/tls\n - syzbot repro (which used error injection, hence no direct\n   selftest is added to preserve it).\n====================\n\nSigned-off-by: David S. Miller <davem@davemloft.net>",
  "author_name": "David S. Miller",
  "author_email": "davem@davemloft.net",
  "author_date": "Thu Nov 28 22:40:30 2019 -0800",
  "author_date_iso": "2019-11-28T22:40:30-08:00",
  "committer_name": "David S. Miller",
  "committer_email": "davem@davemloft.net",
  "committer_date": "Thu Nov 28 22:40:30 2019 -0800",
  "committer_date_iso": "2019-11-28T22:40:30-08:00",
  "files_changed": [],
  "files_changed_count": 0,
  "stats": [
    {
      "file": "include/linux/skmsg.h",
      "insertions": 14,
      "deletions": 14
    },
    {
      "file": "include/net/tls.h",
      "insertions": 1,
      "deletions": 2
    },
    {
      "file": "net/core/filter.c",
      "insertions": 4,
      "deletions": 4
    },
    {
      "file": "net/core/skmsg.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "net/ipv4/tcp_bpf.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "net/tls/tls_main.c",
      "insertions": 2,
      "deletions": 11
    },
    {
      "file": "net/tls/tls_sw.c",
      "insertions": 19,
      "deletions": 13
    },
    {
      "file": "tools/testing/selftests/bpf/test_sockmap.c",
      "insertions": 28,
      "deletions": 19
    },
    {
      "file": "tools/testing/selftests/bpf/xdping.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "tools/testing/selftests/net/tls.c",
      "insertions": 60,
      "deletions": 0
    }
  ],
  "total_insertions": 131,
  "total_deletions": 66,
  "total_changes": 197,
  "parents": [
    "81b6b96475ac7a4ebfceae9f16fb3758327adbfe",
    "e5dc9dd3258098bf8b5ceb75fc3433b41eff618a"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v5.5",
    "v5.5-rc1",
    "v5.5-rc2",
    "v5.5-rc3",
    "v5.5-rc4",
    "v5.5-rc5",
    "v5.5-rc6",
    "v5.5-rc7",
    "v5.6",
    "v5.6-rc1"
  ],
  "is_merge": true,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": []
}