{
  "hash": "d7c5cb0105ddeff56694f4c6222ee7221824bad3",
  "hash_short": "d7c5cb01",
  "subject": "KVM: s390: exploit GISA and AIV for emulated interrupts",
  "body": "The adapter interruption virtualization (AIV) facility is an\noptional facility that comes with functionality expected to increase\nthe performance of adapter interrupt handling for both emulated and\npassed-through adapter interrupts. With AIV, adapter interrupts can be\ndelivered to the guest without exiting SIE.\n\nThis patch provides some preparations for using AIV for emulated adapter\ninterrupts (including virtio) if it's available. When using AIV, the\ninterrupts are delivered at the so called GISA by setting the bit\ncorresponding to its Interruption Subclass (ISC) in the Interruption\nPending Mask (IPM) instead of inserting a node into the floating interrupt\nlist.\n\nTo keep the change reasonably small, the handling of this new state is\ndeferred in get_all_floating_irqs and handle_tpi. This patch concentrates\non the code handling enqueuement of emulated adapter interrupts, and their\ndelivery to the guest.\n\nNote that care is still required for adapter interrupts using AIV,\nbecause there is no guarantee that AIV is going to deliver the adapter\ninterrupts pending at the GISA (consider all vcpus idle). When delivering\nGISA adapter interrupts by the host (usual mechanism) special attention\nis required to honor interrupt priorities.\n\nEmpirical results show that the time window between making an interrupt\npending at the GISA and doing kvm_s390_deliver_pending_interrupts is\nsufficient for a guest with at least moderate cpu activity to get adapter\ninterrupts delivered within the SIE, and potentially save some SIE exits\n(if not other deliverable interrupts).\n\nThe code will be activated with a follow-up patch.\n\nSigned-off-by: Michael Mueller <mimu@linux.vnet.ibm.com>\nAcked-by: Christian Borntraeger <borntraeger@de.ibm.com>\nReviewed-by: David Hildenbrand <david@redhat.com>\nReviewed-by: Cornelia Huck <cohuck@redhat.com>\nSigned-off-by: Christian Borntraeger <borntraeger@de.ibm.com>",
  "full_message": "KVM: s390: exploit GISA and AIV for emulated interrupts\n\nThe adapter interruption virtualization (AIV) facility is an\noptional facility that comes with functionality expected to increase\nthe performance of adapter interrupt handling for both emulated and\npassed-through adapter interrupts. With AIV, adapter interrupts can be\ndelivered to the guest without exiting SIE.\n\nThis patch provides some preparations for using AIV for emulated adapter\ninterrupts (including virtio) if it's available. When using AIV, the\ninterrupts are delivered at the so called GISA by setting the bit\ncorresponding to its Interruption Subclass (ISC) in the Interruption\nPending Mask (IPM) instead of inserting a node into the floating interrupt\nlist.\n\nTo keep the change reasonably small, the handling of this new state is\ndeferred in get_all_floating_irqs and handle_tpi. This patch concentrates\non the code handling enqueuement of emulated adapter interrupts, and their\ndelivery to the guest.\n\nNote that care is still required for adapter interrupts using AIV,\nbecause there is no guarantee that AIV is going to deliver the adapter\ninterrupts pending at the GISA (consider all vcpus idle). When delivering\nGISA adapter interrupts by the host (usual mechanism) special attention\nis required to honor interrupt priorities.\n\nEmpirical results show that the time window between making an interrupt\npending at the GISA and doing kvm_s390_deliver_pending_interrupts is\nsufficient for a guest with at least moderate cpu activity to get adapter\ninterrupts delivered within the SIE, and potentially save some SIE exits\n(if not other deliverable interrupts).\n\nThe code will be activated with a follow-up patch.\n\nSigned-off-by: Michael Mueller <mimu@linux.vnet.ibm.com>\nAcked-by: Christian Borntraeger <borntraeger@de.ibm.com>\nReviewed-by: David Hildenbrand <david@redhat.com>\nReviewed-by: Cornelia Huck <cohuck@redhat.com>\nSigned-off-by: Christian Borntraeger <borntraeger@de.ibm.com>",
  "author_name": "Michael Mueller",
  "author_email": "mimu@linux.vnet.ibm.com",
  "author_date": "Mon Jun 12 14:15:19 2017 +0200",
  "author_date_iso": "2017-06-12T14:15:19+02:00",
  "committer_name": "Christian Borntraeger",
  "committer_email": "borntraeger@de.ibm.com",
  "committer_date": "Fri Jan 26 11:11:39 2018 +0100",
  "committer_date_iso": "2018-01-26T11:11:39+01:00",
  "files_changed": [
    "arch/s390/include/asm/kvm_host.h",
    "arch/s390/kvm/interrupt.c",
    "arch/s390/kvm/kvm-s390.c",
    "arch/s390/kvm/kvm-s390.h"
  ],
  "files_changed_count": 4,
  "stats": [
    {
      "file": "arch/s390/include/asm/kvm_host.h",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/s390/kvm/interrupt.c",
      "insertions": 75,
      "deletions": 18
    },
    {
      "file": "arch/s390/kvm/kvm-s390.c",
      "insertions": 8,
      "deletions": 0
    },
    {
      "file": "arch/s390/kvm/kvm-s390.h",
      "insertions": 3,
      "deletions": 0
    }
  ],
  "total_insertions": 87,
  "total_deletions": 18,
  "total_changes": 105,
  "parents": [
    "72b523a30d9b9c7f749c3209e13de983aeb919c1"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.16",
    "v4.16-rc1",
    "v4.16-rc2",
    "v4.16-rc3",
    "v4.16-rc4",
    "v4.16-rc5",
    "v4.16-rc6",
    "v4.16-rc7",
    "v4.17",
    "v4.17-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "exploit"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/s390/include/asm/kvm_host.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/s390/kvm/interrupt.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/s390/kvm/kvm-s390.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/s390/kvm/kvm-s390.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}