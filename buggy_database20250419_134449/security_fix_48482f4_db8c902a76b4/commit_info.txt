Commit Hash: 48482f4dd3432e5e62873bf0f2e254cfb8ce2ac2
Subject: selftests/powerpc: Better reporting in spectre_v2


Security Keywords:
- vulnerability

Full commit message:
selftests/powerpc: Better reporting in spectre_v2

In commit f3054ffd71b5 ("selftests/powerpc: Return skip code for
spectre_v2"), the spectre_v2 selftest is updated to be aware of cases
where the vulnerability status reported in sysfs is incorrect, skipping
the test instead.

This happens because qemu can misrepresent the mitigation status of the
host to the guest. If the count cache is disabled in the host, and this
is correctly reported to the guest, then the guest won't apply
mitigations. If the guest is then migrated to a new host where
mitigations are necessary, it is now vulnerable because it has not
applied mitigations.

Update the selftest to report when we see excessive misses, indicative of
the count cache being disabled. If software flushing is enabled, also
warn that these flushes are just wasting performance.

Signed-off-by: Russell Currey <ruscur@russell.cc>
[mpe: Rebase and update change log appropriately]
Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: https://lore.kernel.org/r/20210608064809.199116-1-ruscur@russell.cc

Metadata:
Author: Russell Currey <ruscur@russell.cc>
Author Date: Tue Jun 8 16:48:09 2021 +1000
Committer: Michael Ellerman <mpe@ellerman.id.au>
Commit Date: Sun May 22 15:58:28 2022 +1000

Files Changed: 1
Lines Added: 15
Lines Removed: 9
Total Changes: 24
