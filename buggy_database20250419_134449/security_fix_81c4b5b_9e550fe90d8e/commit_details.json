{
  "hash": "81c4b5bf30de01a0f6b43ccaa1d220f4a0a5d99c",
  "hash_short": "81c4b5bf",
  "subject": "PCI: hotplug: Constify hotplug_slot_ops",
  "body": "Hotplug drivers cannot declare their hotplug_slot_ops const, making them\nattractive targets for attackers, because upon registration of a hotplug\nslot, __pci_hp_initialize() writes to the \"owner\" and \"mod_name\" members\nin that struct.\n\nFix by moving these members to struct hotplug_slot and constify every\ndriver's hotplug_slot_ops except for pciehp.\n\npciehp constructs its hotplug_slot_ops at runtime based on the PCIe\nport's capabilities, hence cannot declare them const.  It can be\nconverted to __write_rarely once that's mainlined:\nhttp://www.openwall.com/lists/kernel-hardening/2016/11/16/3\n\nSigned-off-by: Lukas Wunner <lukas@wunner.de>\nSigned-off-by: Bjorn Helgaas <bhelgaas@google.com>\nReviewed-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>\nAcked-by: Tyrel Datwyler <tyreld@linux.vnet.ibm.com>  # drivers/pci/hotplug/rpa*\nAcked-by: Andy Shevchenko <andy.shevchenko@gmail.com> # drivers/platform/x86\nCc: Len Brown <lenb@kernel.org>\nCc: Scott Murray <scott@spiteful.org>\nCc: Benjamin Herrenschmidt <benh@kernel.crashing.org>\nCc: Paul Mackerras <paulus@samba.org>\nCc: Michael Ellerman <mpe@ellerman.id.au>\nCc: Oliver OHalloran <oliveroh@au1.ibm.com>\nCc: Gavin Shan <gwshan@linux.vnet.ibm.com>\nCc: Sebastian Ott <sebott@linux.vnet.ibm.com>\nCc: Gerald Schaefer <gerald.schaefer@de.ibm.com>\nCc: Corentin Chary <corentin.chary@gmail.com>\nCc: Darren Hart <dvhart@infradead.org>",
  "full_message": "PCI: hotplug: Constify hotplug_slot_ops\n\nHotplug drivers cannot declare their hotplug_slot_ops const, making them\nattractive targets for attackers, because upon registration of a hotplug\nslot, __pci_hp_initialize() writes to the \"owner\" and \"mod_name\" members\nin that struct.\n\nFix by moving these members to struct hotplug_slot and constify every\ndriver's hotplug_slot_ops except for pciehp.\n\npciehp constructs its hotplug_slot_ops at runtime based on the PCIe\nport's capabilities, hence cannot declare them const.  It can be\nconverted to __write_rarely once that's mainlined:\nhttp://www.openwall.com/lists/kernel-hardening/2016/11/16/3\n\nSigned-off-by: Lukas Wunner <lukas@wunner.de>\nSigned-off-by: Bjorn Helgaas <bhelgaas@google.com>\nReviewed-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>\nAcked-by: Tyrel Datwyler <tyreld@linux.vnet.ibm.com>  # drivers/pci/hotplug/rpa*\nAcked-by: Andy Shevchenko <andy.shevchenko@gmail.com> # drivers/platform/x86\nCc: Len Brown <lenb@kernel.org>\nCc: Scott Murray <scott@spiteful.org>\nCc: Benjamin Herrenschmidt <benh@kernel.crashing.org>\nCc: Paul Mackerras <paulus@samba.org>\nCc: Michael Ellerman <mpe@ellerman.id.au>\nCc: Oliver OHalloran <oliveroh@au1.ibm.com>\nCc: Gavin Shan <gwshan@linux.vnet.ibm.com>\nCc: Sebastian Ott <sebott@linux.vnet.ibm.com>\nCc: Gerald Schaefer <gerald.schaefer@de.ibm.com>\nCc: Corentin Chary <corentin.chary@gmail.com>\nCc: Darren Hart <dvhart@infradead.org>",
  "author_name": "Lukas Wunner",
  "author_email": "lukas@wunner.de",
  "author_date": "Sat Sep 8 09:59:01 2018 +0200",
  "author_date_iso": "2018-09-08T09:59:01+02:00",
  "committer_name": "Bjorn Helgaas",
  "committer_email": "bhelgaas@google.com",
  "committer_date": "Tue Sep 18 17:52:15 2018 -0500",
  "committer_date_iso": "2018-09-18T17:52:15-05:00",
  "files_changed": [
    "drivers/pci/hotplug/acpiphp_core.c",
    "drivers/pci/hotplug/cpci_hotplug_core.c",
    "drivers/pci/hotplug/cpqphp_core.c",
    "drivers/pci/hotplug/ibmphp.h",
    "drivers/pci/hotplug/ibmphp_core.c",
    "drivers/pci/hotplug/pci_hotplug_core.c",
    "drivers/pci/hotplug/pnv_php.c",
    "drivers/pci/hotplug/rpaphp.h",
    "drivers/pci/hotplug/rpaphp_core.c",
    "drivers/pci/hotplug/s390_pci_hpc.c",
    "drivers/pci/hotplug/sgi_hotplug.c",
    "drivers/pci/hotplug/shpchp_core.c",
    "drivers/pci/pci.c",
    "drivers/pci/slot.c",
    "drivers/platform/x86/asus-wmi.c",
    "drivers/platform/x86/eeepc-laptop.c",
    "include/linux/pci_hotplug.h"
  ],
  "files_changed_count": 17,
  "stats": [
    {
      "file": "drivers/pci/hotplug/acpiphp_core.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/pci/hotplug/cpci_hotplug_core.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/pci/hotplug/cpqphp_core.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/pci/hotplug/ibmphp.h",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/pci/hotplug/ibmphp_core.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/pci/hotplug/pci_hotplug_core.c",
      "insertions": 14,
      "deletions": 13
    },
    {
      "file": "drivers/pci/hotplug/pnv_php.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/pci/hotplug/rpaphp.h",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/pci/hotplug/rpaphp_core.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/pci/hotplug/s390_pci_hpc.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/pci/hotplug/sgi_hotplug.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/pci/hotplug/shpchp_core.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/pci/pci.c",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "drivers/pci/slot.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/platform/x86/asus-wmi.c",
      "insertions": 1,
      "deletions": 2
    },
    {
      "file": "drivers/platform/x86/eeepc-laptop.c",
      "insertions": 1,
      "deletions": 2
    },
    {
      "file": "include/linux/pci_hotplug.h",
      "insertions": 5,
      "deletions": 5
    }
  ],
  "total_insertions": 35,
  "total_deletions": 36,
  "total_changes": 71,
  "parents": [
    "d758714235e7abb7984468370c912ca2f4dc4e57"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.20",
    "v4.20-rc1",
    "v4.20-rc2",
    "v4.20-rc3",
    "v4.20-rc4",
    "v4.20-rc5",
    "v4.20-rc6",
    "v4.20-rc7",
    "v5.0",
    "v5.0-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "hardening"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/pci/hotplug/acpiphp_core.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/pci/hotplug/ibmphp_core.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/pci/hotplug/ibmphp.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/pci/hotplug/cpqphp_core.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/pci/hotplug/pci_hotplug_core.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/pci/hotplug/rpaphp.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/pci/hotplug/pnv_php.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/pci/hotplug/cpci_hotplug_core.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/pci/hotplug/sgi_hotplug.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/pci/hotplug/s390_pci_hpc.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/pci/hotplug/rpaphp_core.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/pci/slot.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/pci/pci.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/pci/hotplug/shpchp_core.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/platform/x86/asus-wmi.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/platform/x86/eeepc-laptop.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/linux/pci_hotplug.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}