{
  "hash": "cd23e77e6568abfac6354dd3f69d5b154e60e342",
  "hash_short": "cd23e77e",
  "subject": "Merge branch 'net_sched-make-qlen_notify-idempotent'",
  "body": "Cong Wang says:\n\n====================\nnet_sched: make ->qlen_notify() idempotent\n\nGerrard reported a vulnerability exists in fq_codel where manipulating\nthe MTU can cause codel_dequeue() to drop all packets. The parent qdisc's\nsch->q.qlen is only updated via ->qlen_notify() if the fq_codel queue\nremains non-empty after the drops. This discrepancy in qlen between\nfq_codel and its parent can lead to a use-after-free condition.\n\nLet's fix this by making all existing ->qlen_notify() idempotent so that\nthe sch->q.qlen check will be no longer necessary.\n\nPatch 1~5 make all existing ->qlen_notify() idempotent to prepare for\npatch 6 which removes the sch->q.qlen check. They are followed by 5\nselftests for each type of Qdisc's we touch here.\n\nAll existing and new Qdisc selftests pass after this patchset.\n\nFixes: 4b549a2ef4be (\"fq_codel: Fair Queue Codel AQM\")\nFixes: 76e3cc126bb2 (\"codel: Controlled Delay AQM\")\nAcked-by: Jamal Hadi Salim <jhs@mojatatu.com>\n====================\n\nLink: https://patch.msgid.link/20250403211033.166059-1-xiyou.wangcong@gmail.com\nSigned-off-by: Paolo Abeni <pabeni@redhat.com>",
  "full_message": "Merge branch 'net_sched-make-qlen_notify-idempotent'\n\nCong Wang says:\n\n====================\nnet_sched: make ->qlen_notify() idempotent\n\nGerrard reported a vulnerability exists in fq_codel where manipulating\nthe MTU can cause codel_dequeue() to drop all packets. The parent qdisc's\nsch->q.qlen is only updated via ->qlen_notify() if the fq_codel queue\nremains non-empty after the drops. This discrepancy in qlen between\nfq_codel and its parent can lead to a use-after-free condition.\n\nLet's fix this by making all existing ->qlen_notify() idempotent so that\nthe sch->q.qlen check will be no longer necessary.\n\nPatch 1~5 make all existing ->qlen_notify() idempotent to prepare for\npatch 6 which removes the sch->q.qlen check. They are followed by 5\nselftests for each type of Qdisc's we touch here.\n\nAll existing and new Qdisc selftests pass after this patchset.\n\nFixes: 4b549a2ef4be (\"fq_codel: Fair Queue Codel AQM\")\nFixes: 76e3cc126bb2 (\"codel: Controlled Delay AQM\")\nAcked-by: Jamal Hadi Salim <jhs@mojatatu.com>\n====================\n\nLink: https://patch.msgid.link/20250403211033.166059-1-xiyou.wangcong@gmail.com\nSigned-off-by: Paolo Abeni <pabeni@redhat.com>",
  "author_name": "Paolo Abeni",
  "author_email": "pabeni@redhat.com",
  "author_date": "Tue Apr 8 10:58:16 2025 +0200",
  "author_date_iso": "2025-04-08T10:58:16+02:00",
  "committer_name": "Paolo Abeni",
  "committer_email": "pabeni@redhat.com",
  "committer_date": "Tue Apr 8 10:58:16 2025 +0200",
  "committer_date_iso": "2025-04-08T10:58:16+02:00",
  "files_changed": [],
  "files_changed_count": 0,
  "stats": [
    {
      "file": "net/sched/sch_codel.c",
      "insertions": 1,
      "deletions": 4
    },
    {
      "file": "net/sched/sch_drr.c",
      "insertions": 4,
      "deletions": 3
    },
    {
      "file": "net/sched/sch_ets.c",
      "insertions": 4,
      "deletions": 4
    },
    {
      "file": "net/sched/sch_fq_codel.c",
      "insertions": 2,
      "deletions": 4
    },
    {
      "file": "net/sched/sch_hfsc.c",
      "insertions": 6,
      "deletions": 2
    },
    {
      "file": "net/sched/sch_htb.c",
      "insertions": 2,
      "deletions": 0
    },
    {
      "file": "net/sched/sch_qfq.c",
      "insertions": 5,
      "deletions": 2
    },
    {
      "file": "tools/testing/selftests/tc-testing/tc-tests/infra/qdiscs.json",
      "insertions": 155,
      "deletions": 0
    }
  ],
  "total_insertions": 179,
  "total_deletions": 19,
  "total_changes": 198,
  "parents": [
    "69ae94725f4fc9e75219d2d69022029c5b24bc9a",
    "ce94507f5fe04eb7fe1eecfe32a2b29233341ff0"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": true,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "vulnerability"
    ]
  },
  "fix_type": "security",
  "file_results": []
}