commit 9c9025ea003a03f967affd690f39b4ef3452c0f5
Author: Sean Christopherson <seanjc@google.com>
Date:   Tue Jan 9 17:27:00 2024 -0800

    KVM: x86: Plumb "force_immediate_exit" into kvm_entry() tracepoint
    
    Annotate the kvm_entry() tracepoint with "immediate exit" when KVM is
    forcing a VM-Exit immediately after VM-Enter, e.g. when KVM wants to
    inject an event but needs to first complete some other operation.
    Knowing that KVM is (or isn't) forcing an exit is useful information when
    debugging issues related to event injection.
    
    Suggested-by: Maxim Levitsky <mlevitsk@redhat.com>
    Link: https://lore.kernel.org/r/20240110012705.506918-2-seanjc@google.com
    Signed-off-by: Sean Christopherson <seanjc@google.com>

diff --git a/arch/x86/kvm/svm/svm.c b/arch/x86/kvm/svm/svm.c
index dda91f7cd71b..ab8ad8d0e818 100644
--- a/arch/x86/kvm/svm/svm.c
+++ b/arch/x86/kvm/svm/svm.c
@@ -4112,12 +4112,13 @@ static noinstr void svm_vcpu_enter_exit(struct kvm_vcpu *vcpu, bool spec_ctrl_in
 	guest_state_exit_irqoff();
 }
 
-static __no_kcsan fastpath_t svm_vcpu_run(struct kvm_vcpu *vcpu)
+static __no_kcsan fastpath_t svm_vcpu_run(struct kvm_vcpu *vcpu,
+					  bool force_immediate_exit)
 {
 	struct vcpu_svm *svm = to_svm(vcpu);
 	bool spec_ctrl_intercepted = msr_write_intercepted(vcpu, MSR_IA32_SPEC_CTRL);
 
-	trace_kvm_entry(vcpu);
+	trace_kvm_entry(vcpu, force_immediate_exit);
 
 	svm->vmcb->save.rax = vcpu->arch.regs[VCPU_REGS_RAX];
 	svm->vmcb->save.rsp = vcpu->arch.regs[VCPU_REGS_RSP];