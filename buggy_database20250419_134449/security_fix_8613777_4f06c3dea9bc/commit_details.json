{
  "hash": "861377730aa9db4cbaa0f3bd3f4d295c152732c4",
  "hash_short": "86137773",
  "subject": "KVM: SVM: Provide support for SEV-ES vCPU loading",
  "body": "An SEV-ES vCPU requires additional VMCB vCPU load/put requirements. SEV-ES\nhardware will restore certain registers on VMEXIT, but not save them on\nVMRUN (see Table B-3 and Table B-4 of the AMD64 APM Volume 2), so make the\nfollowing changes:\n\nGeneral vCPU load changes:\n  - During vCPU loading, perform a VMSAVE to the per-CPU SVM save area and\n    save the current values of XCR0, XSS and PKRU to the per-CPU SVM save\n    area as these registers will be restored on VMEXIT.\n\nGeneral vCPU put changes:\n  - Do not attempt to restore registers that SEV-ES hardware has already\n    restored on VMEXIT.\n\nSigned-off-by: Tom Lendacky <thomas.lendacky@amd.com>\nMessage-Id: <019390e9cb5e93cd73014fa5a040c17d42588733.1607620209.git.thomas.lendacky@amd.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "full_message": "KVM: SVM: Provide support for SEV-ES vCPU loading\n\nAn SEV-ES vCPU requires additional VMCB vCPU load/put requirements. SEV-ES\nhardware will restore certain registers on VMEXIT, but not save them on\nVMRUN (see Table B-3 and Table B-4 of the AMD64 APM Volume 2), so make the\nfollowing changes:\n\nGeneral vCPU load changes:\n  - During vCPU loading, perform a VMSAVE to the per-CPU SVM save area and\n    save the current values of XCR0, XSS and PKRU to the per-CPU SVM save\n    area as these registers will be restored on VMEXIT.\n\nGeneral vCPU put changes:\n  - Do not attempt to restore registers that SEV-ES hardware has already\n    restored on VMEXIT.\n\nSigned-off-by: Tom Lendacky <thomas.lendacky@amd.com>\nMessage-Id: <019390e9cb5e93cd73014fa5a040c17d42588733.1607620209.git.thomas.lendacky@amd.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "author_name": "Tom Lendacky",
  "author_email": "thomas.lendacky@amd.com",
  "author_date": "Thu Dec 10 11:10:07 2020 -0600",
  "author_date_iso": "2020-12-10T11:10:07-06:00",
  "committer_name": "Paolo Bonzini",
  "committer_email": "pbonzini@redhat.com",
  "committer_date": "Tue Dec 15 05:20:59 2020 -0500",
  "committer_date_iso": "2020-12-15T05:20:59-05:00",
  "files_changed": [
    "arch/x86/include/asm/svm.h",
    "arch/x86/kvm/svm/sev.c",
    "arch/x86/kvm/svm/svm.c",
    "arch/x86/kvm/svm/svm.h",
    "arch/x86/kvm/x86.c",
    "arch/x86/kvm/x86.h"
  ],
  "files_changed_count": 6,
  "stats": [
    {
      "file": "arch/x86/include/asm/svm.h",
      "insertions": 7,
      "deletions": 3
    },
    {
      "file": "arch/x86/kvm/svm/sev.c",
      "insertions": 54,
      "deletions": 0
    },
    {
      "file": "arch/x86/kvm/svm/svm.c",
      "insertions": 23,
      "deletions": 13
    },
    {
      "file": "arch/x86/kvm/svm/svm.h",
      "insertions": 16,
      "deletions": 6
    },
    {
      "file": "arch/x86/kvm/x86.c",
      "insertions": 2,
      "deletions": 1
    },
    {
      "file": "arch/x86/kvm/x86.h",
      "insertions": 1,
      "deletions": 0
    }
  ],
  "total_insertions": 103,
  "total_deletions": 23,
  "total_changes": 126,
  "parents": [
    "376c6d285017419e35c7177bc60abe7915fb7497"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "XSS"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/x86/kvm/svm/svm.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kvm/svm/sev.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kvm/svm/svm.h",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kvm/x86.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/include/asm/svm.h",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kvm/x86.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}