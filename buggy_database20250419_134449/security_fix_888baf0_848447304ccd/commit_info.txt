Commit Hash: 888baf069f49529f33c0b1dfb0fc4811dc0ca1d2
Subject: scsi: cxlflash: Add kref to context


Security Keywords:
- injection

Full commit message:
scsi: cxlflash: Add kref to context

Currently, context user references are tracked via the list of LUNs that
have attached to the context. While convenient, this is not intuitive
without a deep study of the code and is inconsistent with the existing
reference tracking patterns within the kernel. This design choice can
lead to future bug injection.

To improve code comprehension and better protect against future bugs,
add explicit reference counting to contexts and migrate the context
removal code to the kref release handler.

Inspired-by: Al Viro <viro@zeniv.linux.org.uk>
Signed-off-by: Matthew R. Ochs <mrochs@linux.vnet.ibm.com>
Acked-by: Manoj N. Kumar <manoj@linux.vnet.ibm.com>
Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>

Metadata:
Author: Matthew R. Ochs <mrochs@linux.vnet.ibm.com>
Author Date: Tue Aug 9 18:39:42 2016 -0500
Committer: Martin K. Petersen <martin.petersen@oracle.com>
Commit Date: Thu Aug 18 22:41:36 2016 -0400

Files Changed: 2
Lines Added: 53
Lines Removed: 35
Total Changes: 88
