Commit Hash: 5f5fa7ea89dc82d34ed458f4d7a8634e8e9eefce
Subject: rcu: Don't use negative nesting depth in __rcu_read_unlock()


Security Keywords:
- vulnerability

Full commit message:
rcu: Don't use negative nesting depth in __rcu_read_unlock()

Now that RCU flavors have been consolidated, an RCU-preempt
rcu_read_unlock() in an interrupt or softirq handler cannot possibly
end the RCU read-side critical section.  Consider the old vulnerability
involving rcu_read_unlock() being invoked within such a handler that
interrupted an __rcu_read_unlock_special(), in which a wakeup might be
invoked with a scheduler lock held.  Because rcu_read_unlock_special()
no longer does wakeups in such situations, it is no longer necessary
for __rcu_read_unlock() to set the nesting level negative.

This commit therefore removes this recursion-protection code from
__rcu_read_unlock().

[ paulmck: Let rcu_exp_handler() continue to call rcu_report_exp_rdp(). ]
[ paulmck: Adjust other checks given no more negative nesting. ]
Signed-off-by: Lai Jiangshan <laijs@linux.alibaba.com>
Signed-off-by: Paul E. McKenney <paulmck@kernel.org>

Metadata:
Author: Lai Jiangshan <laijs@linux.alibaba.com>
Author Date: Sat Feb 15 15:23:26 2020 -0800
Committer: Paul E. McKenney <paulmck@kernel.org>
Commit Date: Mon Apr 27 11:03:50 2020 -0700

Files Changed: 2
Lines Added: 12
Lines Removed: 41
Total Changes: 53
