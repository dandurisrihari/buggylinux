Commit Hash: 0242737dc4eb9f6e9a5ea594b3f93efa0b12f28d
Subject: perf/smmuv3: Enable HiSilicon Erratum 162001900 quirk for HIP08/09


Security Keywords:
- hardening

Full commit message:
perf/smmuv3: Enable HiSilicon Erratum 162001900 quirk for HIP08/09

Some HiSilicon SMMU PMCG suffers the erratum 162001900 that the PMU
disable control sometimes fail to disable the counters. This will lead
to error or inaccurate data since before we enable the counters the
counter's still counting for the event used in last perf session.

This patch tries to fix this by hardening the global disable process.
Before disable the PMU, writing an invalid event type (0xffff) to
focibly stop the counters. Correspondingly restore each events on
pmu::pmu_enable().

Signed-off-by: Yicong Yang <yangyicong@hisilicon.com>
Link: https://lore.kernel.org/r/20230814124012.58013-1-yangyicong@huawei.com
Signed-off-by: Will Deacon <will@kernel.org>

Metadata:
Author: Yicong Yang <yangyicong@hisilicon.com>
Author Date: Mon Aug 14 20:40:12 2023 +0800
Committer: Will Deacon <will@kernel.org>
Commit Date: Tue Aug 15 12:50:53 2023 +0100

Files Changed: 4
Lines Added: 53
Lines Removed: 2
Total Changes: 55
