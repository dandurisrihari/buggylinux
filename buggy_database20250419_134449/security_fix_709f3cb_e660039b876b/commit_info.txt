Commit Hash: 709f3cbd652e50e96a9d9c62a300313b636e3f6f
Subject: ACPI: APEI: EINJ: Refactor available_error_type_show()


Security Keywords:
- injection

Full commit message:
ACPI: APEI: EINJ: Refactor available_error_type_show()

OSPM can discover the error injection capabilities of the platform by
executing GET_ERROR_TYPE error injection action.[1] The action returns
a DWORD representing a bitmap of platform supported error injections.[2]

The available_error_type_show() function determines the bits set within
this DWORD and provides a verbose output, from einj_error_type_string
array, through /sys/kernel/debug/apei/einj/available_error_type file.

The function however, assumes one to one correspondence between an error's
position in the bitmap and its array entry offset. Consequently, some
errors like Vendor Defined Error Type fail this assumption and will
incorrectly be shown as not supported, even if their corresponding bit is
set in the bitmap and they have an entry in the array.

Navigate around the issue by converting einj_error_type_string into an
array of structures with a predetermined mask for all error types
corresponding to their bit position in the DWORD returned by GET_ERROR_TYPE
action. The same breaks the aforementioned assumption resulting in all
supported error types by a platform being outputted through the above
available_error_type file.

[1] ACPI specification 6.5, Table 18.25
[2] ACPI specification 6.5, Table 18.30

Suggested-by: Alexey Kardashevskiy <alexey.kardashevskiy@amd.com>
Signed-off-by: Avadhut Naik <Avadhut.Naik@amd.com>
Reviewed-by: Borislav Petkov (AMD) <bp@alien8.de>
Reviewed-by: Tony Luck <tony.luck@intel.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

Metadata:
Author: Avadhut Naik <Avadhut.Naik@amd.com>
Author Date: Thu Nov 16 16:47:22 2023 -0600
Committer: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
Commit Date: Tue Nov 21 21:10:44 2023 +0100

Files Changed: 1
Lines Added: 24
Lines Removed: 23
Total Changes: 47
