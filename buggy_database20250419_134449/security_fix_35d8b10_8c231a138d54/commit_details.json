{
  "hash": "35d8b10a25884050bb3b0149b62c3818ec59f77c",
  "hash_short": "35d8b10a",
  "subject": "xprtrdma: Fix cwnd update ordering",
  "body": "After a reconnect, the reply handler is opening the cwnd (and thus\nenabling more RPC Calls to be sent) /before/ rpcrdma_post_recvs()\ncan post enough Receive WRs to receive their replies. This causes an\nRNR and the new connection is lost immediately.\n\nThe race is most clearly exposed when KASAN and disconnect injection\nare enabled. This slows down rpcrdma_rep_create() enough to allow\nthe send side to post a bunch of RPC Calls before the Receive\ncompletion handler can invoke ib_post_recv().\n\nFixes: 2ae50ad68cd7 (\"xprtrdma: Close window between waking RPC senders and posting Receives\")\nSigned-off-by: Chuck Lever <chuck.lever@oracle.com>\nSigned-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>",
  "full_message": "xprtrdma: Fix cwnd update ordering\n\nAfter a reconnect, the reply handler is opening the cwnd (and thus\nenabling more RPC Calls to be sent) /before/ rpcrdma_post_recvs()\ncan post enough Receive WRs to receive their replies. This causes an\nRNR and the new connection is lost immediately.\n\nThe race is most clearly exposed when KASAN and disconnect injection\nare enabled. This slows down rpcrdma_rep_create() enough to allow\nthe send side to post a bunch of RPC Calls before the Receive\ncompletion handler can invoke ib_post_recv().\n\nFixes: 2ae50ad68cd7 (\"xprtrdma: Close window between waking RPC senders and posting Receives\")\nSigned-off-by: Chuck Lever <chuck.lever@oracle.com>\nSigned-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>",
  "author_name": "Chuck Lever",
  "author_email": "chuck.lever@oracle.com",
  "author_date": "Mon Apr 19 14:02:41 2021 -0400",
  "author_date_iso": "2021-04-19T14:02:41-04:00",
  "committer_name": "Trond Myklebust",
  "committer_email": "trond.myklebust@hammerspace.com",
  "committer_date": "Mon Apr 26 09:24:05 2021 -0400",
  "committer_date_iso": "2021-04-26T09:24:05-04:00",
  "files_changed": [
    "net/sunrpc/xprtrdma/rpc_rdma.c",
    "net/sunrpc/xprtrdma/verbs.c",
    "net/sunrpc/xprtrdma/xprt_rdma.h"
  ],
  "files_changed_count": 3,
  "stats": [
    {
      "file": "net/sunrpc/xprtrdma/rpc_rdma.c",
      "insertions": 2,
      "deletions": 1
    },
    {
      "file": "net/sunrpc/xprtrdma/verbs.c",
      "insertions": 5,
      "deletions": 5
    },
    {
      "file": "net/sunrpc/xprtrdma/xprt_rdma.h",
      "insertions": 1,
      "deletions": 1
    }
  ],
  "total_insertions": 8,
  "total_deletions": 7,
  "total_changes": 15,
  "parents": [
    "9e3ca33b62d4878f6ae39776abb6deebb37db597"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "net/sunrpc/xprtrdma/rpc_rdma.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "net/sunrpc/xprtrdma/verbs.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "net/sunrpc/xprtrdma/xprt_rdma.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}