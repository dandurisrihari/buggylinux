{
  "hash": "79741dd35713ff4f6fd0eafd59fa94e8a4ba922d",
  "hash_short": "79741dd3",
  "subject": "[PATCH] idle cputime accounting",
  "body": "The cpu time spent by the idle process actually doing something is\ncurrently accounted as idle time. This is plain wrong, the architectures\nthat support VIRT_CPU_ACCOUNTING=y can do better: distinguish between the\ntime spent doing nothing and the time spent by idle doing work. The first\nis accounted with account_idle_time and the second with account_system_time.\nThe architectures that use the account_xxx_time interface directly and not\nthe account_xxx_ticks interface now need to do the check for the idle\nprocess in their arch code. In particular to improve the system vs true\nidle time accounting the arch code needs to measure the true idle time\ninstead of just testing for the idle process.\nTo improve the tick based accounting as well we would need an architecture\nprimitive that can tell us if the pt_regs of the interrupted context\npoints to the magic instruction that halts the cpu.\n\nIn addition idle time is no more added to the stime of the idle process.\nThis field now contains the system time of the idle process as it should\nbe. On systems without VIRT_CPU_ACCOUNTING this will always be zero as\nevery tick that occurs while idle is running will be accounted as idle\ntime.\n\nThis patch contains the necessary common code changes to be able to\ndistinguish idle system time and true idle time. The architectures with\nsupport for VIRT_CPU_ACCOUNTING need some changes to exploit this.\n\nSigned-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>",
  "full_message": "[PATCH] idle cputime accounting\n\nThe cpu time spent by the idle process actually doing something is\ncurrently accounted as idle time. This is plain wrong, the architectures\nthat support VIRT_CPU_ACCOUNTING=y can do better: distinguish between the\ntime spent doing nothing and the time spent by idle doing work. The first\nis accounted with account_idle_time and the second with account_system_time.\nThe architectures that use the account_xxx_time interface directly and not\nthe account_xxx_ticks interface now need to do the check for the idle\nprocess in their arch code. In particular to improve the system vs true\nidle time accounting the arch code needs to measure the true idle time\ninstead of just testing for the idle process.\nTo improve the tick based accounting as well we would need an architecture\nprimitive that can tell us if the pt_regs of the interrupted context\npoints to the magic instruction that halts the cpu.\n\nIn addition idle time is no more added to the stime of the idle process.\nThis field now contains the system time of the idle process as it should\nbe. On systems without VIRT_CPU_ACCOUNTING this will always be zero as\nevery tick that occurs while idle is running will be accounted as idle\ntime.\n\nThis patch contains the necessary common code changes to be able to\ndistinguish idle system time and true idle time. The architectures with\nsupport for VIRT_CPU_ACCOUNTING need some changes to exploit this.\n\nSigned-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>",
  "author_name": "Martin Schwidefsky",
  "author_email": "schwidefsky@de.ibm.com",
  "author_date": "Wed Dec 31 15:11:38 2008 +0100",
  "author_date_iso": "2008-12-31T15:11:38+01:00",
  "committer_name": "Martin Schwidefsky",
  "committer_email": "schwidefsky@de.ibm.com",
  "committer_date": "Wed Dec 31 15:11:46 2008 +0100",
  "committer_date_iso": "2008-12-31T15:11:46+01:00",
  "files_changed": [
    "arch/ia64/kernel/time.c",
    "arch/powerpc/kernel/process.c",
    "arch/powerpc/kernel/time.c",
    "arch/s390/kernel/vtime.c",
    "arch/x86/xen/time.c",
    "include/linux/kernel_stat.h",
    "include/linux/sched.h",
    "kernel/sched.c",
    "kernel/time/tick-sched.c",
    "kernel/timer.c"
  ],
  "files_changed_count": 10,
  "stats": [
    {
      "file": "arch/ia64/kernel/time.c",
      "insertions": 8,
      "deletions": 2
    },
    {
      "file": "arch/powerpc/kernel/process.c",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/powerpc/kernel/time.c",
      "insertions": 10,
      "deletions": 3
    },
    {
      "file": "arch/s390/kernel/vtime.c",
      "insertions": 16,
      "deletions": 4
    },
    {
      "file": "arch/x86/xen/time.c",
      "insertions": 4,
      "deletions": 6
    },
    {
      "file": "include/linux/kernel_stat.h",
      "insertions": 6,
      "deletions": 1
    },
    {
      "file": "include/linux/sched.h",
      "insertions": 0,
      "deletions": 1
    },
    {
      "file": "kernel/sched.c",
      "insertions": 63,
      "deletions": 17
    },
    {
      "file": "kernel/time/tick-sched.c",
      "insertions": 6,
      "deletions": 7
    },
    {
      "file": "kernel/timer.c",
      "insertions": 0,
      "deletions": 13
    }
  ],
  "total_insertions": 114,
  "total_deletions": 54,
  "total_changes": 168,
  "parents": [
    "457533a7d3402d1d91fbc125c8bd1bd16dcd3cd4"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v2.6.29",
    "v2.6.29-rc1",
    "v2.6.29-rc2",
    "v2.6.29-rc3",
    "v2.6.29-rc4",
    "v2.6.29-rc5",
    "v2.6.29-rc6",
    "v2.6.29-rc7",
    "v2.6.29-rc8",
    "v2.6.30"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "exploit"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/ia64/kernel/time.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/s390/kernel/vtime.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/xen/time.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/powerpc/kernel/process.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/linux/sched.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/powerpc/kernel/time.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/linux/kernel_stat.h",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "kernel/time/tick-sched.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "kernel/sched.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "kernel/timer.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}