{
  "hash": "495000a38634e640e2fd02f7e4f1512ccc92d770",
  "hash_short": "495000a3",
  "subject": "ALSA: core: Remove debugfs at disconnection",
  "body": "The card-specific debugfs entries are removed at the last stage of\ncard free phase, and it's performed after synchronization of the\ncloses of all opened fds.  This works fine for most cases, but it can\nbe potentially problematic for a hotplug device like USB-audio.  Due\nto the nature of snd_card_free_when_closed(), the card free isn't\ncalled immediately after the driver removal for a hotplug device, but\nit's left until the last fd is closed.  It implies that the card\ndebugfs entries also remain.  Meanwhile, when a new device is inserted\nbefore the last close and the very same card slot is assigned, the\ndriver tries to create the card debugfs root again on the very same\npath.  This conflicts with the remaining entry, and results in the\nkernel warning such as:\n  debugfs: Directory 'card0' with parent 'sound' already present!\nwith the missing debugfs entry afterwards.\n\nFor avoiding such conflicts, remove debugfs entries at the device\ndisconnection phase instead.  The jack kctl debugfs entries get\nremoved in snd_jack_dev_disconnect() instead of each kctl\nprivate_free.\n\nFixes: 2d670ea2bd53 (\"ALSA: jack: implement software jack injection via debugfs\")\nLink: https://lore.kernel.org/r/20240524151256.32521-1-tiwai@suse.de\nSigned-off-by: Takashi Iwai <tiwai@suse.de>",
  "full_message": "ALSA: core: Remove debugfs at disconnection\n\nThe card-specific debugfs entries are removed at the last stage of\ncard free phase, and it's performed after synchronization of the\ncloses of all opened fds.  This works fine for most cases, but it can\nbe potentially problematic for a hotplug device like USB-audio.  Due\nto the nature of snd_card_free_when_closed(), the card free isn't\ncalled immediately after the driver removal for a hotplug device, but\nit's left until the last fd is closed.  It implies that the card\ndebugfs entries also remain.  Meanwhile, when a new device is inserted\nbefore the last close and the very same card slot is assigned, the\ndriver tries to create the card debugfs root again on the very same\npath.  This conflicts with the remaining entry, and results in the\nkernel warning such as:\n  debugfs: Directory 'card0' with parent 'sound' already present!\nwith the missing debugfs entry afterwards.\n\nFor avoiding such conflicts, remove debugfs entries at the device\ndisconnection phase instead.  The jack kctl debugfs entries get\nremoved in snd_jack_dev_disconnect() instead of each kctl\nprivate_free.\n\nFixes: 2d670ea2bd53 (\"ALSA: jack: implement software jack injection via debugfs\")\nLink: https://lore.kernel.org/r/20240524151256.32521-1-tiwai@suse.de\nSigned-off-by: Takashi Iwai <tiwai@suse.de>",
  "author_name": "Takashi Iwai",
  "author_email": "tiwai@suse.de",
  "author_date": "Fri May 24 17:11:46 2024 +0200",
  "author_date_iso": "2024-05-24T17:11:46+02:00",
  "committer_name": "Takashi Iwai",
  "committer_email": "tiwai@suse.de",
  "committer_date": "Mon May 27 09:28:21 2024 +0200",
  "committer_date_iso": "2024-05-27T09:28:21+02:00",
  "files_changed": [
    "sound/core/init.c",
    "sound/core/jack.c"
  ],
  "files_changed_count": 2,
  "stats": [
    {
      "file": "sound/core/init.c",
      "insertions": 5,
      "deletions": 4
    },
    {
      "file": "sound/core/jack.c",
      "insertions": 14,
      "deletions": 7
    }
  ],
  "total_insertions": 19,
  "total_deletions": 11,
  "total_changes": 30,
  "parents": [
    "1613e604df0cd359cf2a7fbd9be7a0bcfacfabd0"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "sound/core/init.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "sound/core/jack.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}