Commit Hash: 34459512ffa7236c849466e3bd604801389734e1
Subject: mac80211: fix TKIP replay vulnerability


Security Keywords:
- vulnerability

Full commit message:
mac80211: fix TKIP replay vulnerability

Unlike CCMP, the presence or absence of the QoS
field doesn't change the encryption, only the
TID is used. When no QoS field is present, zero
is used as the TID value. This means that it is
possible for an attacker to take a QoS packet
with TID 0 and replay it as a non-QoS packet.

Unfortunately, mac80211 uses different IVs for
checking the validity of the packet's TKIP IV
when it checks TID 0 and when it checks non-QoS
packets. This means it is vulnerable to this
replay attack.

To fix this, use the same replay counter for
TID 0 and non-QoS packets by overriding the
rx->queue value to 0 if it is 16 (non-QoS).

This is a minimal fix for now. I caused this
issue in

commit 1411f9b531f0a910cd1c85a337737c1e6ffbae6a
Author: Johannes Berg <johannes@sipsolutions.net>
Date:   Thu Jul 10 10:11:02 2008 +0200

    mac80211: fix RX sequence number check

while fixing a sequence number issue (there,
a separate counter needs to be used).

Cc: stable@kernel.org
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: John W. Linville <linville@tuxdriver.com>

Metadata:
Author: Johannes Berg <johannes.berg@intel.com>
Author Date: Thu Jul 7 18:24:54 2011 +0200
Committer: John W. Linville <linville@tuxdriver.com>
Commit Date: Thu Jul 7 13:06:09 2011 -0400

Files Changed: 1
Lines Added: 13
Lines Removed: 3
Total Changes: 16
