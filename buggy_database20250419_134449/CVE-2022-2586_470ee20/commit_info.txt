Commit Hash: 470ee20e069a6d05ae549f7d0ef2bdbcee6a81b2
Subject: netfilter: nf_tables: do not allow SET_ID to refer to another table

CVE Identifiers:
- CVE-2022-2586

Full commit message:
netfilter: nf_tables: do not allow SET_ID to refer to another table

When doing lookups for sets on the same batch by using its ID, a set from a
different table can be used.

Then, when the table is removed, a reference to the set may be kept after
the set is freed, leading to a potential use-after-free.

When looking for sets by ID, use the table that was used for the lookup by
name, and only return sets belonging to that same table.

This fixes CVE-2022-2586, also reported as ZDI-CAN-17470.

Reported-by: Team Orca of Sea Security (@seasecresponse)
Fixes: 958bee14d071 ("netfilter: nf_tables: use new transaction infrastructure to handle sets")
Signed-off-by: Thadeu Lima de Souza Cascardo <cascardo@canonical.com>
Cc: <stable@vger.kernel.org>
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>

Metadata:
Author: Thadeu Lima de Souza Cascardo <cascardo@canonical.com>
Author Date: Tue Aug 9 14:01:46 2022 -0300
Committer: Pablo Neira Ayuso <pablo@netfilter.org>
Commit Date: Tue Aug 9 19:38:17 2022 +0200

Files Changed: 1
Lines Added: 3
Lines Removed: 1
Total Changes: 4
