{
  "hash": "1085b8276bb4239daa7008f0dcd5c973e4bd690f",
  "hash_short": "1085b827",
  "subject": "tpm: Add the rest of the session HMAC API",
  "body": "The final pieces of the HMAC API are for manipulating the session area\nof the command.  To add an authentication HMAC session\ntpm_buf_append_hmac_session() is called where tpm2_append_auth() would\ngo. If a non empty password is passed in, this is correctly added to\nthe HMAC to prove knowledge of it without revealing it.  Note that if\nthe session is only used to encrypt or decrypt parameters (no\nauthentication) then tpm_buf_append_hmac_session_opt() must be used\ninstead.  This functions identically to tpm_buf_append_hmac_session()\nwhen TPM_BUS_SECURITY is enabled, but differently when it isn't,\nbecause effectively nothing is appended to the session area.\n\nNext the parameters should be filled in for the command and finally\ntpm_buf_fill_hmac_session() is called immediately prior to transmitting\nthe command which computes the correct HMAC and places it in the\ncommand at the session location in the tpm buffer\n\nFinally, after tpm_transmit_cmd() is called,\ntpm_buf_check_hmac_response() is called to check that the returned\nHMAC matched and collect the new state for the next use of the\nsession, if any.\n\nThe features of the session are controlled by the session attributes\nset in tpm_buf_append_hmac_session().  If TPM2_SA_CONTINUE_SESSION is\nnot specified, the session will be flushed and the tpm2_auth structure\nfreed in tpm_buf_check_hmac_response(); otherwise the session may be\nused again.  Parameter encryption is specified by or'ing the flag\nTPM2_SA_DECRYPT and response encryption by or'ing the flag\nTPM2_SA_ENCRYPT.  the various encryptions will be taken care of by\ntpm_buf_fill_hmac_session() and tpm_buf_check_hmac_response()\nrespectively.\n\nSigned-off-by: James Bottomley <James.Bottomley@HansenPartnership.com>\nReviewed-by: Ard Biesheuvel <ard.biesheuvel@linaro.org> # crypto API parts\nReviewed-by: Jarkko Sakkinen <jarkko@kernel.org>\nTested-by: Jarkko Sakkinen <jarkko@kernel.org>\nSigned-off-by: Jarkko Sakkinen <jarkko@kernel.org>",
  "full_message": "tpm: Add the rest of the session HMAC API\n\nThe final pieces of the HMAC API are for manipulating the session area\nof the command.  To add an authentication HMAC session\ntpm_buf_append_hmac_session() is called where tpm2_append_auth() would\ngo. If a non empty password is passed in, this is correctly added to\nthe HMAC to prove knowledge of it without revealing it.  Note that if\nthe session is only used to encrypt or decrypt parameters (no\nauthentication) then tpm_buf_append_hmac_session_opt() must be used\ninstead.  This functions identically to tpm_buf_append_hmac_session()\nwhen TPM_BUS_SECURITY is enabled, but differently when it isn't,\nbecause effectively nothing is appended to the session area.\n\nNext the parameters should be filled in for the command and finally\ntpm_buf_fill_hmac_session() is called immediately prior to transmitting\nthe command which computes the correct HMAC and places it in the\ncommand at the session location in the tpm buffer\n\nFinally, after tpm_transmit_cmd() is called,\ntpm_buf_check_hmac_response() is called to check that the returned\nHMAC matched and collect the new state for the next use of the\nsession, if any.\n\nThe features of the session are controlled by the session attributes\nset in tpm_buf_append_hmac_session().  If TPM2_SA_CONTINUE_SESSION is\nnot specified, the session will be flushed and the tpm2_auth structure\nfreed in tpm_buf_check_hmac_response(); otherwise the session may be\nused again.  Parameter encryption is specified by or'ing the flag\nTPM2_SA_DECRYPT and response encryption by or'ing the flag\nTPM2_SA_ENCRYPT.  the various encryptions will be taken care of by\ntpm_buf_fill_hmac_session() and tpm_buf_check_hmac_response()\nrespectively.\n\nSigned-off-by: James Bottomley <James.Bottomley@HansenPartnership.com>\nReviewed-by: Ard Biesheuvel <ard.biesheuvel@linaro.org> # crypto API parts\nReviewed-by: Jarkko Sakkinen <jarkko@kernel.org>\nTested-by: Jarkko Sakkinen <jarkko@kernel.org>\nSigned-off-by: Jarkko Sakkinen <jarkko@kernel.org>",
  "author_name": "James Bottomley",
  "author_email": "James.Bottomley@HansenPartnership.com",
  "author_date": "Mon Apr 29 16:28:05 2024 -0400",
  "author_date_iso": "2024-04-29T16:28:05-04:00",
  "committer_name": "Jarkko Sakkinen",
  "committer_email": "jarkko@kernel.org",
  "committer_date": "Thu May 9 22:30:51 2024 +0300",
  "committer_date_iso": "2024-05-09T22:30:51+03:00",
  "files_changed": [
    "drivers/char/tpm/tpm2-sessions.c",
    "include/linux/tpm.h"
  ],
  "files_changed_count": 2,
  "stats": [
    {
      "file": "drivers/char/tpm/tpm2-sessions.c",
      "insertions": 400,
      "deletions": 0
    },
    {
      "file": "include/linux/tpm.h",
      "insertions": 69,
      "deletions": 0
    }
  ],
  "total_insertions": 469,
  "total_deletions": 0,
  "total_changes": 469,
  "parents": [
    "d0a25bb961e6e5650083a4f15768e3075f7d8db7"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "authentication"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/char/tpm/tpm2-sessions.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/linux/tpm.h",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}