{
  "hash": "f9317f77a6e06d15604a079a9d35a2f500c60c08",
  "hash_short": "f9317f77",
  "subject": "hugetlb: clean up potential spectre issue warnings",
  "body": "Recently introduced code allows numa nodes to be specified on the kernel\ncommand line for hugetlb allocations or CMA reservations.  The node\nvalues are user specified and used as indicies into arrays.  This\ngenerated the following smatch warnings:\n\n  mm/hugetlb.c:4170 hugepages_setup() warn: potential spectre issue 'default_hugepages_in_node' [w]\n  mm/hugetlb.c:4172 hugepages_setup() warn: potential spectre issue 'parsed_hstate->max_huge_pages_node' [w]\n  mm/hugetlb.c:6898 cmdline_parse_hugetlb_cma() warn: potential spectre issue 'hugetlb_cma_size_in_node' [w] (local cap)\n\nClean up by using array_index_nospec to sanitize array indicies.\n\nThe routine cmdline_parse_hugetlb_cma has the same overflow/truncation\nissue addressed in [1].  That is also fixed with this change.\n\n[1] https://lore.kernel.org/linux-mm/20220209134018.8242-1-liuyuntao10@huawei.com/\n\nAs Michal pointed out, this is unlikely to be exploitable because it is\n__init code.  But the patch suppresses the warnings.\n\n[mike.kravetz@oracle.com: v2]\n  Link: https://lkml.kernel.org/r/20220218212946.35441-1-mike.kravetz@oracle.com\n\nLink: https://lkml.kernel.org/r/20220217234218.192885-1-mike.kravetz@oracle.com\nSigned-off-by: Mike Kravetz <mike.kravetz@oracle.com>\nCc: Baolin Wang <baolin.wang@linux.alibaba.com>\nCc: Zhenguo Yao <yaozhenguo1@gmail.com>\nCc: Liu Yuntao <liuyuntao10@huawei.com>\nCc: Dan Carpenter <dan.carpenter@oracle.com>\nCc: Michal Hocko <mhocko@suse.com>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
  "full_message": "hugetlb: clean up potential spectre issue warnings\n\nRecently introduced code allows numa nodes to be specified on the kernel\ncommand line for hugetlb allocations or CMA reservations.  The node\nvalues are user specified and used as indicies into arrays.  This\ngenerated the following smatch warnings:\n\n  mm/hugetlb.c:4170 hugepages_setup() warn: potential spectre issue 'default_hugepages_in_node' [w]\n  mm/hugetlb.c:4172 hugepages_setup() warn: potential spectre issue 'parsed_hstate->max_huge_pages_node' [w]\n  mm/hugetlb.c:6898 cmdline_parse_hugetlb_cma() warn: potential spectre issue 'hugetlb_cma_size_in_node' [w] (local cap)\n\nClean up by using array_index_nospec to sanitize array indicies.\n\nThe routine cmdline_parse_hugetlb_cma has the same overflow/truncation\nissue addressed in [1].  That is also fixed with this change.\n\n[1] https://lore.kernel.org/linux-mm/20220209134018.8242-1-liuyuntao10@huawei.com/\n\nAs Michal pointed out, this is unlikely to be exploitable because it is\n__init code.  But the patch suppresses the warnings.\n\n[mike.kravetz@oracle.com: v2]\n  Link: https://lkml.kernel.org/r/20220218212946.35441-1-mike.kravetz@oracle.com\n\nLink: https://lkml.kernel.org/r/20220217234218.192885-1-mike.kravetz@oracle.com\nSigned-off-by: Mike Kravetz <mike.kravetz@oracle.com>\nCc: Baolin Wang <baolin.wang@linux.alibaba.com>\nCc: Zhenguo Yao <yaozhenguo1@gmail.com>\nCc: Liu Yuntao <liuyuntao10@huawei.com>\nCc: Dan Carpenter <dan.carpenter@oracle.com>\nCc: Michal Hocko <mhocko@suse.com>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
  "author_name": "Mike Kravetz",
  "author_email": "mike.kravetz@oracle.com",
  "author_date": "Tue Mar 22 14:45:20 2022 -0700",
  "author_date_iso": "2022-03-22T14:45:20-07:00",
  "committer_name": "Linus Torvalds",
  "committer_email": "torvalds@linux-foundation.org",
  "committer_date": "Tue Mar 22 15:57:08 2022 -0700",
  "committer_date_iso": "2022-03-22T15:57:08-07:00",
  "files_changed": [
    "mm/hugetlb.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "mm/hugetlb.c",
      "insertions": 4,
      "deletions": 3
    }
  ],
  "total_insertions": 4,
  "total_deletions": 3,
  "total_changes": 7,
  "parents": [
    "07431506e8d752ff21c3d5fba0927fe8be4ed18f"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "sanitize"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "mm/hugetlb.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}