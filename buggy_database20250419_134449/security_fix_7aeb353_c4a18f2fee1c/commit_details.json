{
  "hash": "7aeb353802611a8e655e019f09a370ff682af1a6",
  "hash_short": "7aeb3538",
  "subject": "pinctrl: aspeed: Fix GPIO requests on pass-through banks",
  "body": "Commit 6726fbff19bf (\"pinctrl: aspeed: Fix GPI only function problem.\")\nfixes access to GPIO banks T and U on the AST2600. Both banks contain\ninput-only pins and the GPIO pin function is named GPITx and GPIUx\nrespectively. Unfortunately the fix had a negative impact on GPIO banks\nD and E for the AST2400 and AST2500 where the GPIO pass-through\nfunctions take similar \"GPI\"-style names. The net effect on the older\nSoCs was that when the GPIO subsystem requested a pin in banks D or E be\nmuxed for GPIO, they were instead muxed for pass-through mode.\nMistakenly muxing pass-through mode e.g. breaks booting the host on\nIBM's Witherspoon (AC922) platform where GPIOE0 is used for FSI.\n\nFurther exploit the names in the provided expression structure to\ndifferentiate pass-through from pin-specific GPIO modes.\n\nThis follow-up fix gives the expected behaviour for the following tests:\n\nWitherspoon BMC (AST2500):\n\n1. Power-on the Witherspoon host\n2. Request GPIOD1 be muxed via /sys/class/gpio/export\n3. Request GPIOE1 be muxed via /sys/class/gpio/export\n4. Request the balls for GPIOs E2 and E3 be muxed as GPIO pass-through\n   (\"GPIE2\" mode) via a pinctrl hog in the devicetree\n\nRainier BMC (AST2600):\n\n5. Request GPIT0 be muxed via /sys/class/gpio/export\n6. Request GPIU0 be muxed via /sys/class/gpio/export\n\nTogether the tests demonstrate that all three pieces of functionality\n(general GPIOs via 1, 2 and 3, input-only GPIOs via 5 and 6, pass-through\nmode via 4) operate as desired across old and new SoCs.\n\nFixes: 9b92f5c51e9a (\"pinctrl: aspeed: Fix GPI only function problem.\")\nSigned-off-by: Andrew Jeffery <andrew@aj.id.au>\nTested-by: Joel Stanley <joel@jms.id.au>\nReviewed-by: Joel Stanley <joel@jms.id.au>\nCc: Billy Tsai <billy_tsai@aspeedtech.com>\nCc: Joel Stanley <joel@jms.id.au>\nLink: https://lore.kernel.org/r/20201126063337.489927-1-andrew@aj.id.au\nSigned-off-by: Linus Walleij <linus.walleij@linaro.org>",
  "full_message": "pinctrl: aspeed: Fix GPIO requests on pass-through banks\n\nCommit 6726fbff19bf (\"pinctrl: aspeed: Fix GPI only function problem.\")\nfixes access to GPIO banks T and U on the AST2600. Both banks contain\ninput-only pins and the GPIO pin function is named GPITx and GPIUx\nrespectively. Unfortunately the fix had a negative impact on GPIO banks\nD and E for the AST2400 and AST2500 where the GPIO pass-through\nfunctions take similar \"GPI\"-style names. The net effect on the older\nSoCs was that when the GPIO subsystem requested a pin in banks D or E be\nmuxed for GPIO, they were instead muxed for pass-through mode.\nMistakenly muxing pass-through mode e.g. breaks booting the host on\nIBM's Witherspoon (AC922) platform where GPIOE0 is used for FSI.\n\nFurther exploit the names in the provided expression structure to\ndifferentiate pass-through from pin-specific GPIO modes.\n\nThis follow-up fix gives the expected behaviour for the following tests:\n\nWitherspoon BMC (AST2500):\n\n1. Power-on the Witherspoon host\n2. Request GPIOD1 be muxed via /sys/class/gpio/export\n3. Request GPIOE1 be muxed via /sys/class/gpio/export\n4. Request the balls for GPIOs E2 and E3 be muxed as GPIO pass-through\n   (\"GPIE2\" mode) via a pinctrl hog in the devicetree\n\nRainier BMC (AST2600):\n\n5. Request GPIT0 be muxed via /sys/class/gpio/export\n6. Request GPIU0 be muxed via /sys/class/gpio/export\n\nTogether the tests demonstrate that all three pieces of functionality\n(general GPIOs via 1, 2 and 3, input-only GPIOs via 5 and 6, pass-through\nmode via 4) operate as desired across old and new SoCs.\n\nFixes: 9b92f5c51e9a (\"pinctrl: aspeed: Fix GPI only function problem.\")\nSigned-off-by: Andrew Jeffery <andrew@aj.id.au>\nTested-by: Joel Stanley <joel@jms.id.au>\nReviewed-by: Joel Stanley <joel@jms.id.au>\nCc: Billy Tsai <billy_tsai@aspeedtech.com>\nCc: Joel Stanley <joel@jms.id.au>\nLink: https://lore.kernel.org/r/20201126063337.489927-1-andrew@aj.id.au\nSigned-off-by: Linus Walleij <linus.walleij@linaro.org>",
  "author_name": "Andrew Jeffery",
  "author_email": "andrew@aj.id.au",
  "author_date": "Thu Nov 26 17:03:37 2020 +1030",
  "author_date_iso": "2020-11-26T17:03:37+10:30",
  "committer_name": "Linus Walleij",
  "committer_email": "linus.walleij@linaro.org",
  "committer_date": "Tue Dec 8 09:23:51 2020 +0100",
  "committer_date_iso": "2020-12-08T09:23:51+01:00",
  "files_changed": [
    "drivers/pinctrl/aspeed/pinctrl-aspeed.c",
    "drivers/pinctrl/aspeed/pinmux-aspeed.h"
  ],
  "files_changed_count": 2,
  "stats": [
    {
      "file": "drivers/pinctrl/aspeed/pinctrl-aspeed.c",
      "insertions": 68,
      "deletions": 6
    },
    {
      "file": "drivers/pinctrl/aspeed/pinmux-aspeed.h",
      "insertions": 4,
      "deletions": 3
    }
  ],
  "total_insertions": 72,
  "total_deletions": 9,
  "total_changes": 81,
  "parents": [
    "47a0001436352c9853d72bf2071e85b316d688a2"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "exploit"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/pinctrl/aspeed/pinctrl-aspeed.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/pinctrl/aspeed/pinmux-aspeed.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}