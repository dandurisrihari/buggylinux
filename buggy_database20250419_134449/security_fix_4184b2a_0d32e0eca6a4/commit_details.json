{
  "hash": "4184b2a79a7612a9272ce20d639934584a1f3786",
  "hash_short": "4184b2a7",
  "subject": "net: sctp: fix memory leak in auth key management",
  "body": "A very minimal and simple user space application allocating an SCTP\nsocket, setting SCTP_AUTH_KEY setsockopt(2) on it and then closing\nthe socket again will leak the memory containing the authentication\nkey from user space:\n\nunreferenced object 0xffff8800837047c0 (size 16):\n  comm \"a.out\", pid 2789, jiffies 4296954322 (age 192.258s)\n  hex dump (first 16 bytes):\n    01 00 00 00 04 00 00 00 00 00 00 00 00 00 00 00  ................\n  backtrace:\n    [<ffffffff816d7e8e>] kmemleak_alloc+0x4e/0xb0\n    [<ffffffff811c88d8>] __kmalloc+0xe8/0x270\n    [<ffffffffa0870c23>] sctp_auth_create_key+0x23/0x50 [sctp]\n    [<ffffffffa08718b1>] sctp_auth_set_key+0xa1/0x140 [sctp]\n    [<ffffffffa086b383>] sctp_setsockopt+0xd03/0x1180 [sctp]\n    [<ffffffff815bfd94>] sock_common_setsockopt+0x14/0x20\n    [<ffffffff815beb61>] SyS_setsockopt+0x71/0xd0\n    [<ffffffff816e58a9>] system_call_fastpath+0x12/0x17\n    [<ffffffffffffffff>] 0xffffffffffffffff\n\nThis is bad because of two things, we can bring down a machine from\nuser space when auth_enable=1, but also we would leave security sensitive\nkeying material in memory without clearing it after use. The issue is\nthat sctp_auth_create_key() already sets the refcount to 1, but after\nallocation sctp_auth_set_key() does an additional refcount on it, and\nthus leaving it around when we free the socket.\n\nFixes: 65b07e5d0d0 (\"[SCTP]: API updates to suport SCTP-AUTH extensions.\")\nSigned-off-by: Daniel Borkmann <dborkman@redhat.com>\nCc: Vlad Yasevich <vyasevich@gmail.com>\nAcked-by: Neil Horman <nhorman@tuxdriver.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
  "full_message": "net: sctp: fix memory leak in auth key management\n\nA very minimal and simple user space application allocating an SCTP\nsocket, setting SCTP_AUTH_KEY setsockopt(2) on it and then closing\nthe socket again will leak the memory containing the authentication\nkey from user space:\n\nunreferenced object 0xffff8800837047c0 (size 16):\n  comm \"a.out\", pid 2789, jiffies 4296954322 (age 192.258s)\n  hex dump (first 16 bytes):\n    01 00 00 00 04 00 00 00 00 00 00 00 00 00 00 00  ................\n  backtrace:\n    [<ffffffff816d7e8e>] kmemleak_alloc+0x4e/0xb0\n    [<ffffffff811c88d8>] __kmalloc+0xe8/0x270\n    [<ffffffffa0870c23>] sctp_auth_create_key+0x23/0x50 [sctp]\n    [<ffffffffa08718b1>] sctp_auth_set_key+0xa1/0x140 [sctp]\n    [<ffffffffa086b383>] sctp_setsockopt+0xd03/0x1180 [sctp]\n    [<ffffffff815bfd94>] sock_common_setsockopt+0x14/0x20\n    [<ffffffff815beb61>] SyS_setsockopt+0x71/0xd0\n    [<ffffffff816e58a9>] system_call_fastpath+0x12/0x17\n    [<ffffffffffffffff>] 0xffffffffffffffff\n\nThis is bad because of two things, we can bring down a machine from\nuser space when auth_enable=1, but also we would leave security sensitive\nkeying material in memory without clearing it after use. The issue is\nthat sctp_auth_create_key() already sets the refcount to 1, but after\nallocation sctp_auth_set_key() does an additional refcount on it, and\nthus leaving it around when we free the socket.\n\nFixes: 65b07e5d0d0 (\"[SCTP]: API updates to suport SCTP-AUTH extensions.\")\nSigned-off-by: Daniel Borkmann <dborkman@redhat.com>\nCc: Vlad Yasevich <vyasevich@gmail.com>\nAcked-by: Neil Horman <nhorman@tuxdriver.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
  "author_name": "Daniel Borkmann",
  "author_email": "dborkman@redhat.com",
  "author_date": "Mon Nov 10 18:00:09 2014 +0100",
  "author_date_iso": "2014-11-10T18:00:09+01:00",
  "committer_name": "David S. Miller",
  "committer_email": "davem@davemloft.net",
  "committer_date": "Tue Nov 11 15:19:11 2014 -0500",
  "committer_date_iso": "2014-11-11T15:19:11-05:00",
  "files_changed": [
    "net/sctp/auth.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "net/sctp/auth.c",
      "insertions": 0,
      "deletions": 2
    }
  ],
  "total_insertions": 0,
  "total_deletions": 2,
  "total_changes": 2,
  "parents": [
    "e40607cbe270a9e8360907cb1e62ddf0736e4864"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v3.18",
    "v3.18-rc5",
    "v3.18-rc6",
    "v3.18-rc7",
    "v3.19",
    "v3.19-rc1",
    "v3.19-rc2",
    "v3.19-rc3",
    "v3.19-rc4",
    "v3.19-rc5"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "auth"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "net/sctp/auth.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}