diff --cc block/genhd.c
index 0f9769db2de8,03a96d6473e1..08f76135a637
--- a/block/genhd.c
+++ b/block/genhd.c
@@@ -527,9 -525,9 +526,10 @@@ out_unregister_bdi
  		bdi_unregister(disk->bdi);
  out_unregister_queue:
  	blk_unregister_queue(disk);
 +	rq_qos_exit(disk->queue);
  out_put_slave_dir:
  	kobject_put(disk->slave_dir);
+ 	disk->slave_dir = NULL;
  out_put_holder_dir:
  	kobject_put(disk->part0->bd_holder_dir);
  out_del_integrity:
diff --cc drivers/block/drbd/drbd_main.c
index 0aa1dde07a98,7213ffd69a16..2f16e1bfb6e7
--- a/drivers/block/drbd/drbd_main.c
+++ b/drivers/block/drbd/drbd_main.c
@@@ -2788,8 -2787,10 +2787,10 @@@ enum drbd_ret_code drbd_create_device(s
  	drbd_debugfs_device_add(device);
  	return NO_ERROR;
  
+ out_destroy_workqueue:
+ 	destroy_workqueue(device->submit.wq);
  out_idr_remove_from_resource:
 -	for_each_connection(connection, resource) {
 +	for_each_connection_safe(connection, n, resource) {
  		peer_device = idr_remove(&connection->peer_devices, vnr);
  		if (peer_device)
  			kref_put(&connection->kref, drbd_destroy_connection);