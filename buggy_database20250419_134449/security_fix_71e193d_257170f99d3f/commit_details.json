{
  "hash": "71e193d7cbcfc988c3802e15261bd807171adb6b",
  "hash_short": "71e193d7",
  "subject": "csky: Add support for function error injection",
  "body": "Inspired by the commit 42d038c4fb00 (\"arm64: Add support for function\nerror injection\"), this patch supports function error injection for\ncsky.\n\nThis patch mainly support two functions: one is regs_set_return_value()\nwhich is used to overwrite the return value; the another function is\noverride_function_with_return() which is to override the probed\nfunction returning and jump to its caller.\n\nTest log:\n\n cd /sys/kernel/debug/fail_function/\n echo sys_clone > inject\n echo 100 > probability\n echo 1 > interval\n ls /\n[  108.644163] FAULT_INJECTION: forcing a failure.\n[  108.644163] name fail_function, interval 1, probability 100, space 0, times 1\n[  108.647799] CPU: 0 PID: 104 Comm: sh Not tainted 5.8.0-rc5+ #46\n[  108.648384] Call Trace:\n[  108.649339] [<8005eed4>] walk_stackframe+0x0/0xf0\n[  108.649679] [<8005f16a>] show_stack+0x32/0x5c\n[  108.649927] [<8040f9d2>] dump_stack+0x6e/0x9c\n[  108.650271] [<80406f7e>] should_fail+0x15e/0x1ac\n[  108.650720] [<80118ba8>] fei_kprobe_handler+0x28/0x5c\n[  108.651519] [<80754110>] kprobe_breakpoint_handler+0x144/0x1cc\n[  108.652289] [<8005d6da>] trap_c+0x8e/0x110\n[  108.652816] [<8005ce8c>] csky_trap+0x5c/0x70\n-sh: can't fork: Invalid argument\n\nSigned-off-by: Guo Ren <guoren@linux.alibaba.com>\nCc: Arnd Bergmann <arnd@arndb.de>",
  "full_message": "csky: Add support for function error injection\n\nInspired by the commit 42d038c4fb00 (\"arm64: Add support for function\nerror injection\"), this patch supports function error injection for\ncsky.\n\nThis patch mainly support two functions: one is regs_set_return_value()\nwhich is used to overwrite the return value; the another function is\noverride_function_with_return() which is to override the probed\nfunction returning and jump to its caller.\n\nTest log:\n\n cd /sys/kernel/debug/fail_function/\n echo sys_clone > inject\n echo 100 > probability\n echo 1 > interval\n ls /\n[  108.644163] FAULT_INJECTION: forcing a failure.\n[  108.644163] name fail_function, interval 1, probability 100, space 0, times 1\n[  108.647799] CPU: 0 PID: 104 Comm: sh Not tainted 5.8.0-rc5+ #46\n[  108.648384] Call Trace:\n[  108.649339] [<8005eed4>] walk_stackframe+0x0/0xf0\n[  108.649679] [<8005f16a>] show_stack+0x32/0x5c\n[  108.649927] [<8040f9d2>] dump_stack+0x6e/0x9c\n[  108.650271] [<80406f7e>] should_fail+0x15e/0x1ac\n[  108.650720] [<80118ba8>] fei_kprobe_handler+0x28/0x5c\n[  108.651519] [<80754110>] kprobe_breakpoint_handler+0x144/0x1cc\n[  108.652289] [<8005d6da>] trap_c+0x8e/0x110\n[  108.652816] [<8005ce8c>] csky_trap+0x5c/0x70\n-sh: can't fork: Invalid argument\n\nSigned-off-by: Guo Ren <guoren@linux.alibaba.com>\nCc: Arnd Bergmann <arnd@arndb.de>",
  "author_name": "Guo Ren",
  "author_email": "guoren@linux.alibaba.com",
  "author_date": "Tue Jul 28 16:30:46 2020 +0000",
  "author_date_iso": "2020-07-28T16:30:46+00:00",
  "committer_name": "Guo Ren",
  "committer_email": "guoren@linux.alibaba.com",
  "committer_date": "Fri Jul 31 01:52:07 2020 +0000",
  "committer_date_iso": "2020-07-31T01:52:07+00:00",
  "files_changed": [
    "arch/csky/Kconfig",
    "arch/csky/include/asm/ptrace.h",
    "arch/csky/lib/Makefile",
    "arch/csky/lib/error-inject.c"
  ],
  "files_changed_count": 4,
  "stats": [
    {
      "file": "arch/csky/Kconfig",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/csky/include/asm/ptrace.h",
      "insertions": 6,
      "deletions": 0
    },
    {
      "file": "arch/csky/lib/Makefile",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/csky/lib/error-inject.c",
      "insertions": 10,
      "deletions": 0
    }
  ],
  "total_insertions": 18,
  "total_deletions": 0,
  "total_changes": 18,
  "parents": [
    "a5447fb9b32eb33b2f0f09a63e4852b46af5b056"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/csky/Kconfig",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/csky/include/asm/ptrace.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/csky/lib/Makefile",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/csky/lib/error-inject.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}