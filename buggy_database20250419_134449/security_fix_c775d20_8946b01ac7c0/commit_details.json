{
  "hash": "c775d2098d35bd130a883bbdf6af9401a8c4cb2d",
  "hash_short": "c775d209",
  "subject": "bio-integrity: Fix regression if profile verify_fn is NULL",
  "body": "In dm-integrity target we register integrity profile that have\nboth generate_fn and verify_fn callbacks set to NULL.\n\nThis is used if dm-integrity is stacked under a dm-crypt device\nfor authenticated encryption (integrity payload contains authentication\ntag and IV seed).\n\nIn this case the verification is done through own crypto API\nprocessing inside dm-crypt; integrity profile is only holder\nof these data. (And memory is owned by dm-crypt as well.)\n\nAfter the commit (and previous changes)\n  Commit 7c20f11680a441df09de7235206f70115fbf6290\n  Author: Christoph Hellwig <hch@lst.de>\n  Date:   Mon Jul 3 16:58:43 2017 -0600\n\n    bio-integrity: stop abusing bi_end_io\n\nwe get this crash:\n\n: BUG: unable to handle kernel NULL pointer dereference at   (null)\n: IP:   (null)\n: *pde = 00000000\n...\n:\n: Workqueue: kintegrityd bio_integrity_verify_fn\n: task: f48ae180 task.stack: f4b5c000\n: EIP:   (null)\n: EFLAGS: 00210286 CPU: 0\n: EAX: f4b5debc EBX: 00001000 ECX: 00000001 EDX: 00000000\n: ESI: 00001000 EDI: ed25f000 EBP: f4b5dee8 ESP: f4b5dea4\n:  DS: 007b ES: 007b FS: 00d8 GS: 00e0 SS: 0068\n: CR0: 80050033 CR2: 00000000 CR3: 32823000 CR4: 001406d0\n: Call Trace:\n:  ? bio_integrity_process+0xe3/0x1e0\n:  bio_integrity_verify_fn+0xea/0x150\n:  process_one_work+0x1c7/0x5c0\n:  worker_thread+0x39/0x380\n:  kthread+0xd6/0x110\n:  ? process_one_work+0x5c0/0x5c0\n:  ? kthread_worker_fn+0x100/0x100\n:  ? kthread_worker_fn+0x100/0x100\n:  ret_from_fork+0x19/0x24\n: Code:  Bad EIP value.\n: EIP:   (null) SS:ESP: 0068:f4b5dea4\n: CR2: 0000000000000000\n\nPatch just skip the whole verify workqueue if verify_fn is set to NULL.\n\nFixes: 7c20f116 (\"bio-integrity: stop abusing bi_end_io\")\nSigned-off-by: Milan Broz <gmazyland@gmail.com>\n[hch: trivial whitespace fix]\nSigned-off-by: Christoph Hellwig <hch@lst.de>\nSigned-off-by: Jens Axboe <axboe@kernel.dk>",
  "full_message": "bio-integrity: Fix regression if profile verify_fn is NULL\n\nIn dm-integrity target we register integrity profile that have\nboth generate_fn and verify_fn callbacks set to NULL.\n\nThis is used if dm-integrity is stacked under a dm-crypt device\nfor authenticated encryption (integrity payload contains authentication\ntag and IV seed).\n\nIn this case the verification is done through own crypto API\nprocessing inside dm-crypt; integrity profile is only holder\nof these data. (And memory is owned by dm-crypt as well.)\n\nAfter the commit (and previous changes)\n  Commit 7c20f11680a441df09de7235206f70115fbf6290\n  Author: Christoph Hellwig <hch@lst.de>\n  Date:   Mon Jul 3 16:58:43 2017 -0600\n\n    bio-integrity: stop abusing bi_end_io\n\nwe get this crash:\n\n: BUG: unable to handle kernel NULL pointer dereference at   (null)\n: IP:   (null)\n: *pde = 00000000\n...\n:\n: Workqueue: kintegrityd bio_integrity_verify_fn\n: task: f48ae180 task.stack: f4b5c000\n: EIP:   (null)\n: EFLAGS: 00210286 CPU: 0\n: EAX: f4b5debc EBX: 00001000 ECX: 00000001 EDX: 00000000\n: ESI: 00001000 EDI: ed25f000 EBP: f4b5dee8 ESP: f4b5dea4\n:  DS: 007b ES: 007b FS: 00d8 GS: 00e0 SS: 0068\n: CR0: 80050033 CR2: 00000000 CR3: 32823000 CR4: 001406d0\n: Call Trace:\n:  ? bio_integrity_process+0xe3/0x1e0\n:  bio_integrity_verify_fn+0xea/0x150\n:  process_one_work+0x1c7/0x5c0\n:  worker_thread+0x39/0x380\n:  kthread+0xd6/0x110\n:  ? process_one_work+0x5c0/0x5c0\n:  ? kthread_worker_fn+0x100/0x100\n:  ? kthread_worker_fn+0x100/0x100\n:  ret_from_fork+0x19/0x24\n: Code:  Bad EIP value.\n: EIP:   (null) SS:ESP: 0068:f4b5dea4\n: CR2: 0000000000000000\n\nPatch just skip the whole verify workqueue if verify_fn is set to NULL.\n\nFixes: 7c20f116 (\"bio-integrity: stop abusing bi_end_io\")\nSigned-off-by: Milan Broz <gmazyland@gmail.com>\n[hch: trivial whitespace fix]\nSigned-off-by: Christoph Hellwig <hch@lst.de>\nSigned-off-by: Jens Axboe <axboe@kernel.dk>",
  "author_name": "Milan Broz",
  "author_email": "gmazyland@gmail.com",
  "author_date": "Wed Aug 9 17:47:26 2017 +0200",
  "author_date_iso": "2017-08-09T17:47:26+02:00",
  "committer_name": "Jens Axboe",
  "committer_email": "axboe@kernel.dk",
  "committer_date": "Wed Aug 9 20:24:26 2017 -0600",
  "committer_date_iso": "2017-08-09T20:24:26-06:00",
  "files_changed": [
    "block/bio-integrity.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "block/bio-integrity.c",
      "insertions": 4,
      "deletions": 1
    }
  ],
  "total_insertions": 4,
  "total_deletions": 1,
  "total_changes": 5,
  "parents": [
    "31cf92f3dda8ecf4ce19761847cad6e1ffa144e1"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.13",
    "v4.13-rc5",
    "v4.13-rc6",
    "v4.13-rc7",
    "v4.14",
    "v4.14-rc1",
    "v4.14-rc2",
    "v4.14-rc3",
    "v4.14-rc4",
    "v4.14-rc5"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "authentication"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "block/bio-integrity.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}