{
  "hash": "7ce7e984ab2b218d6e92d5165629022fe2daf9ee",
  "hash_short": "7ce7e984",
  "subject": "kbuild: rename cmd_{bzip2,lzma,lzo,lz4,xzkern,zstd22}",
  "body": "GZIP-compressed files end with 4 byte data that represents the size\nof the original input. The decompressors (the self-extracting kernel)\nexploit it to know the vmlinux size beforehand. To mimic the GZIP's\ntrailer, Kbuild provides cmd_{bzip2,lzma,lzo,lz4,xzkern,zstd22}.\nUnfortunately these macros are used everywhere despite the appended\nsize data is only useful for the decompressors.\n\nThere is no guarantee that such hand-crafted trailers are safely ignored.\nIn fact, the kernel refuses compressed initramdfs with the garbage data.\nThat is why usr/Makefile overrides size_append to make it no-op.\n\nTo limit the use of such broken compressed files, this commit renames\nthe existing macros as follows:\n\n  cmd_bzip2   --> cmd_bzip2_with_size\n  cmd_lzma    --> cmd_lzma_with_size\n  cmd_lzo     --> cmd_lzo_with_size\n  cmd_lz4     --> cmd_lz4_with_size\n  cmd_xzkern  --> cmd_xzkern_with_size\n  cmd_zstd22  --> cmd_zstd22_with_size\n\nTo keep the decompressors working, I updated the following Makefiles\naccordingly:\n\n  arch/arm/boot/compressed/Makefile\n  arch/h8300/boot/compressed/Makefile\n  arch/mips/boot/compressed/Makefile\n  arch/parisc/boot/compressed/Makefile\n  arch/s390/boot/compressed/Makefile\n  arch/sh/boot/compressed/Makefile\n  arch/x86/boot/compressed/Makefile\n\nI reused the current macro names for the normal usecases; they produce\nthe compressed data in the proper format.\n\nI did not touch the following:\n\n  arch/arc/boot/Makefile\n  arch/arm64/boot/Makefile\n  arch/csky/boot/Makefile\n  arch/mips/boot/Makefile\n  arch/riscv/boot/Makefile\n  arch/sh/boot/Makefile\n  kernel/Makefile\n\nThis means those Makefiles will stop appending the size data.\n\nI dropped the 'override size_append' hack from usr/Makefile.\n\nSigned-off-by: Masahiro Yamada <masahiroy@kernel.org>\nReviewed-by: Nicolas Schier <n.schier@avm.de>",
  "full_message": "kbuild: rename cmd_{bzip2,lzma,lzo,lz4,xzkern,zstd22}\n\nGZIP-compressed files end with 4 byte data that represents the size\nof the original input. The decompressors (the self-extracting kernel)\nexploit it to know the vmlinux size beforehand. To mimic the GZIP's\ntrailer, Kbuild provides cmd_{bzip2,lzma,lzo,lz4,xzkern,zstd22}.\nUnfortunately these macros are used everywhere despite the appended\nsize data is only useful for the decompressors.\n\nThere is no guarantee that such hand-crafted trailers are safely ignored.\nIn fact, the kernel refuses compressed initramdfs with the garbage data.\nThat is why usr/Makefile overrides size_append to make it no-op.\n\nTo limit the use of such broken compressed files, this commit renames\nthe existing macros as follows:\n\n  cmd_bzip2   --> cmd_bzip2_with_size\n  cmd_lzma    --> cmd_lzma_with_size\n  cmd_lzo     --> cmd_lzo_with_size\n  cmd_lz4     --> cmd_lz4_with_size\n  cmd_xzkern  --> cmd_xzkern_with_size\n  cmd_zstd22  --> cmd_zstd22_with_size\n\nTo keep the decompressors working, I updated the following Makefiles\naccordingly:\n\n  arch/arm/boot/compressed/Makefile\n  arch/h8300/boot/compressed/Makefile\n  arch/mips/boot/compressed/Makefile\n  arch/parisc/boot/compressed/Makefile\n  arch/s390/boot/compressed/Makefile\n  arch/sh/boot/compressed/Makefile\n  arch/x86/boot/compressed/Makefile\n\nI reused the current macro names for the normal usecases; they produce\nthe compressed data in the proper format.\n\nI did not touch the following:\n\n  arch/arc/boot/Makefile\n  arch/arm64/boot/Makefile\n  arch/csky/boot/Makefile\n  arch/mips/boot/Makefile\n  arch/riscv/boot/Makefile\n  arch/sh/boot/Makefile\n  kernel/Makefile\n\nThis means those Makefiles will stop appending the size data.\n\nI dropped the 'override size_append' hack from usr/Makefile.\n\nSigned-off-by: Masahiro Yamada <masahiroy@kernel.org>\nReviewed-by: Nicolas Schier <n.schier@avm.de>",
  "author_name": "Masahiro Yamada",
  "author_email": "masahiroy@kernel.org",
  "author_date": "Mon Jan 10 03:15:27 2022 +0900",
  "author_date_iso": "2022-01-10T03:15:27+09:00",
  "committer_name": "Masahiro Yamada",
  "committer_email": "masahiroy@kernel.org",
  "committer_date": "Fri Jan 14 02:54:05 2022 +0900",
  "committer_date_iso": "2022-01-14T02:54:05+09:00",
  "files_changed": [
    "arch/arm/boot/compressed/Makefile",
    "arch/h8300/boot/compressed/Makefile",
    "arch/mips/boot/compressed/Makefile",
    "arch/parisc/boot/compressed/Makefile",
    "arch/s390/boot/compressed/Makefile",
    "arch/sh/boot/compressed/Makefile",
    "arch/x86/boot/compressed/Makefile",
    "scripts/Makefile.lib",
    "usr/Makefile"
  ],
  "files_changed_count": 9,
  "stats": [
    {
      "file": "arch/arm/boot/compressed/Makefile",
      "insertions": 4,
      "deletions": 4
    },
    {
      "file": "arch/h8300/boot/compressed/Makefile",
      "insertions": 3,
      "deletions": 1
    },
    {
      "file": "arch/mips/boot/compressed/Makefile",
      "insertions": 6,
      "deletions": 6
    },
    {
      "file": "arch/parisc/boot/compressed/Makefile",
      "insertions": 5,
      "deletions": 5
    },
    {
      "file": "arch/s390/boot/compressed/Makefile",
      "insertions": 6,
      "deletions": 6
    },
    {
      "file": "arch/sh/boot/compressed/Makefile",
      "insertions": 4,
      "deletions": 4
    },
    {
      "file": "arch/x86/boot/compressed/Makefile",
      "insertions": 6,
      "deletions": 6
    },
    {
      "file": "scripts/Makefile.lib",
      "insertions": 24,
      "deletions": 6
    },
    {
      "file": "usr/Makefile",
      "insertions": 0,
      "deletions": 5
    }
  ],
  "total_insertions": 58,
  "total_deletions": 43,
  "total_changes": 101,
  "parents": [
    "64d8aaa4ef388b22372de4dc9ce3b9b3e5f45b6c"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "exploit"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/arm/boot/compressed/Makefile",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/h8300/boot/compressed/Makefile",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/s390/boot/compressed/Makefile",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/sh/boot/compressed/Makefile",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/boot/compressed/Makefile",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/parisc/boot/compressed/Makefile",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/mips/boot/compressed/Makefile",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "scripts/Makefile.lib",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "usr/Makefile",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}