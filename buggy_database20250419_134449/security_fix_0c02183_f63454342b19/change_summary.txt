Files changed: 14
Insertions: 8673
Deletions: 3127
Total changes: 11800

File-specific changes:
Documentation/virt/kvm/api.rst: +3 -1
MAINTAINERS: +2 -0
arch/arm/include/asm/arm_pmuv3.h: +2 -0
arch/arm64/include/asm/kvm_arm.h: +50 -1
arch/arm64/include/asm/kvm_asm.h: +3 -0
arch/arm64/include/asm/kvm_host.h: +15 -9
arch/arm64/include/asm/kvm_mmu.h: +1 -0
arch/arm64/include/asm/kvm_nested.h: +2 -0
arch/arm64/include/asm/kvm_pgtable.h: +10 -0
arch/arm64/include/asm/sysreg.h: +266 -2
arch/arm64/include/asm/tlbflush.h: +71 -53
arch/arm64/kernel/cpufeature.c: +7 -0
arch/arm64/kvm/Kconfig: +1 -1
arch/arm64/kvm/arm.c: +20 -45
arch/arm64/kvm/emulate-nested.c: +1852 -0
arch/arm64/kvm/guest.c: +0 -15
arch/arm64/kvm/handle_exit.c: +28 -1
arch/arm64/kvm/hyp/include/hyp/switch.h: +94 -33
arch/arm64/kvm/hyp/include/nvhe/mm.h: +1 -0
arch/arm64/kvm/hyp/nvhe/hyp-main.c: +11 -0
arch/arm64/kvm/hyp/nvhe/mm.c: +66 -17
arch/arm64/kvm/hyp/nvhe/setup.c: +1 -26
arch/arm64/kvm/hyp/nvhe/switch.c: +1 -1
arch/arm64/kvm/hyp/nvhe/tlb.c: +30 -0
arch/arm64/kvm/hyp/pgtable.c: +55 -8
arch/arm64/kvm/hyp/vhe/tlb.c: +28 -0
arch/arm64/kvm/mmu.c: +81 -23
arch/arm64/kvm/nested.c: +6 -5
arch/arm64/kvm/pmu-emul.c: +26 -11
arch/arm64/kvm/pmu.c: +18 -0
arch/arm64/kvm/reset.c: +10 -15
arch/arm64/kvm/sys_regs.c: +15 -0
arch/arm64/kvm/trace_arm.h: +26 -0
arch/arm64/kvm/vgic/vgic.h: +0 -2
arch/arm64/tools/cpucaps: +1 -0
arch/arm64/tools/sysreg: +129 -0
arch/mips/include/asm/kvm_host.h: +1 -2
arch/mips/kvm/mips.c: +3 -9
arch/mips/kvm/mmu.c: +1 -1
arch/riscv/include/asm/csr.h: +2 -0
arch/riscv/include/asm/kvm_host.h: +9 -0
arch/riscv/include/asm/kvm_vcpu_vector.h: +2 -4
arch/riscv/include/uapi/asm/kvm.h: +16 -0
arch/riscv/kvm/Makefile: +1 -0
arch/riscv/kvm/aia.c: +2 -2
arch/riscv/kvm/mmu.c: +1 -7
arch/riscv/kvm/vcpu.c: +19 -528
arch/riscv/kvm/vcpu_fp.c: +6 -6
arch/riscv/kvm/vcpu_onereg.c: +1051 -0
arch/riscv/kvm/vcpu_sbi.c: +9 -7
arch/riscv/kvm/vcpu_timer.c: +6 -5
arch/riscv/kvm/vcpu_vector.c: +35 -37
arch/s390/include/asm/kvm_host.h: +2 -0
arch/s390/include/asm/uv.h: +18 -1
arch/s390/include/uapi/asm/kvm.h: +16 -0
arch/s390/kernel/uv.c: +1 -1
arch/s390/kvm/intercept.c: +32 -6
arch/s390/kvm/interrupt.c: +14 -0
arch/s390/kvm/kvm-s390.c: +96 -6
arch/s390/kvm/pv.c: +6 -3
arch/s390/mm/fault.c: +1 -1
arch/x86/include/asm/cpufeatures.h: +1 -0
arch/x86/include/asm/kexec.h: +0 -2
arch/x86/include/asm/kvm_host.h: +33 -13
arch/x86/include/asm/kvm_page_track.h: +25 -42
arch/x86/include/asm/reboot.h: +7 -0
arch/x86/include/asm/svm.h: +3 -2
arch/x86/include/asm/virtext.h: +0 -154
arch/x86/include/asm/vmx.h: +1 -1
arch/x86/kernel/crash.c: +0 -31
arch/x86/kernel/reboot.c: +50 -16
arch/x86/kvm/Kconfig: +14 -1
arch/x86/kvm/cpuid.c: +39 -1
arch/x86/kvm/cpuid.h: +46 -0
arch/x86/kvm/emulate.c: +0 -2
arch/x86/kvm/governed_features.h: +21 -0
arch/x86/kvm/hyperv.c: +0 -1
arch/x86/kvm/kvm_emulate.h: +0 -1
arch/x86/kvm/lapic.c: +25 -4
arch/x86/kvm/mmu.h: +2 -0
arch/x86/kvm/mmu/mmu.c: +160 -211
arch/x86/kvm/mmu/mmu_internal.h: +13 -14
arch/x86/kvm/mmu/page_track.c: +128 -124
arch/x86/kvm/mmu/page_track.h: +58 -0
arch/x86/kvm/mmu/paging_tmpl.h: +30 -11
arch/x86/kvm/mmu/spte.c: +2 -4
arch/x86/kvm/mmu/spte.h: +17 -4
arch/x86/kvm/mmu/tdp_iter.c: +6 -5
arch/x86/kvm/mmu/tdp_mmu.c: +19 -18
arch/x86/kvm/pmu.c: +1 -3
arch/x86/kvm/reverse_cpuid.h: +1 -0
arch/x86/kvm/svm/avic.c: +51 -8
arch/x86/kvm/svm/nested.c: +33 -24
arch/x86/kvm/svm/sev.c: +83 -17
arch/x86/kvm/svm/svm.c: +214 -113
arch/x86/kvm/svm/svm.h: +6 -55
arch/x86/kvm/vmx/capabilities.h: +1 -1
arch/x86/kvm/vmx/hyperv.c: +1 -1
arch/x86/kvm/vmx/nested.c: +7 -6
arch/x86/kvm/vmx/nested.h: +1 -1
arch/x86/kvm/vmx/pmu_intel.c: +55 -26
arch/x86/kvm/vmx/vmx.c: +116 -112
arch/x86/kvm/vmx/vmx.h: +1 -2
arch/x86/kvm/x86.c: +44 -39
arch/x86/kvm/x86.h: +1 -0
drivers/gpu/drm/i915/gvt/gtt.c: +13 -89
drivers/gpu/drm/i915/gvt/gtt.h: +0 -1
drivers/gpu/drm/i915/gvt/gvt.h: +2 -1
drivers/gpu/drm/i915/gvt/kvmgt.c: +46 -74
drivers/gpu/drm/i915/gvt/page_track.c: +2 -8
drivers/perf/arm_pmuv3.c: +2 -0
include/kvm/arm_pmu.h: +3 -1
include/linux/kvm_host.h: +42 -11
tools/arch/x86/include/asm/cpufeatures.h: +1 -0
tools/testing/selftests/kvm/Makefile: +18 -2
tools/testing/selftests/kvm/aarch64/aarch32_id_regs.c: +4 -4
tools/testing/selftests/kvm/aarch64/arch_timer.c: +9 -13
tools/testing/selftests/kvm/aarch64/debug-exceptions.c: +4 -4
tools/testing/selftests/kvm/aarch64/get-reg-list.c: +61 -493
tools/testing/selftests/kvm/aarch64/hypercalls.c: +9 -11
tools/testing/selftests/kvm/aarch64/page_fault_test.c: +8 -9
tools/testing/selftests/kvm/aarch64/vgic_irq.c: +1 -2
tools/testing/selftests/kvm/get-reg-list.c: +401 -0
tools/testing/selftests/kvm/guest_print_test.c: +219 -0
tools/testing/selftests/kvm/include/aarch64/arch_timer.h: +6 -6
tools/testing/selftests/kvm/include/aarch64/ucall.h: +20 -0
tools/testing/selftests/kvm/include/kvm_util_base.h: +21 -0
tools/testing/selftests/kvm/include/riscv/processor.h: +3 -0
tools/testing/selftests/kvm/include/riscv/ucall.h: +20 -0
tools/testing/selftests/kvm/include/s390x/ucall.h: +19 -0
tools/testing/selftests/kvm/include/test_util.h: +12 -8
tools/testing/selftests/kvm/include/ucall_common.h: +40 -58
tools/testing/selftests/kvm/include/x86_64/processor.h: +5 -0
tools/testing/selftests/kvm/include/x86_64/ucall.h: +13 -0
tools/testing/selftests/kvm/kvm_page_table_test.c: +4 -4
tools/testing/selftests/kvm/lib/aarch64/ucall.c: +1 -10
tools/testing/selftests/kvm/lib/guest_sprintf.c: +307 -0
tools/testing/selftests/kvm/lib/kvm_util.c: +5 -1
tools/testing/selftests/kvm/lib/riscv/ucall.c: +0 -11
tools/testing/selftests/kvm/lib/s390x/ucall.c: +0 -10
tools/testing/selftests/kvm/lib/sparsebit.c: +0 -1
tools/testing/selftests/kvm/lib/string_override.c: +9 -0
tools/testing/selftests/kvm/lib/test_util.c: +15 -0
tools/testing/selftests/kvm/lib/ucall_common.c: +44 -0
tools/testing/selftests/kvm/lib/x86_64/processor.c: +6 -12
tools/testing/selftests/kvm/lib/x86_64/ucall.c: +30 -6
tools/testing/selftests/kvm/max_guest_memory_test.c: +1 -1
tools/testing/selftests/kvm/memslot_perf_test.c: +2 -2
tools/testing/selftests/kvm/riscv/get-reg-list.c: +872 -0
tools/testing/selftests/kvm/s390x/cmma_test.c: +31 -31
tools/testing/selftests/kvm/s390x/debug_test.c: +160 -0
tools/testing/selftests/kvm/s390x/memop.c: +6 -7
tools/testing/selftests/kvm/s390x/tprot.c: +6 -5
tools/testing/selftests/kvm/set_memory_region_test.c: +12 -9
tools/testing/selftests/kvm/steal_time.c: +10 -10
tools/testing/selftests/kvm/x86_64/cpuid_test.c: +6 -6
tools/testing/selftests/kvm/x86_64/dirty_log_page_splitting_test.c: +9 -9
tools/testing/selftests/kvm/x86_64/exit_on_emulation_failure_test.c: +1 -1
tools/testing/selftests/kvm/x86_64/hyperv_extended_hypercalls.c: +1 -2
tools/testing/selftests/kvm/x86_64/hyperv_features.c: +19 -10
tools/testing/selftests/kvm/x86_64/kvm_pv_test.c: +4 -4
tools/testing/selftests/kvm/x86_64/monitor_mwait_test.c: +20 -15
tools/testing/selftests/kvm/x86_64/nested_exceptions_test.c: +7 -9
tools/testing/selftests/kvm/x86_64/pmu_event_filter_test.c: +223 -94
tools/testing/selftests/kvm/x86_64/recalc_apic_map_test.c: +3 -3
tools/testing/selftests/kvm/x86_64/set_boot_cpu_id.c: +3 -3
tools/testing/selftests/kvm/x86_64/svm_nested_soft_inject_test.c: +11 -11
tools/testing/selftests/kvm/x86_64/sync_regs_test.c: +132 -0
tools/testing/selftests/kvm/x86_64/tsc_msrs_test.c: +17 -17
tools/testing/selftests/kvm/x86_64/userspace_io_test.c: +6 -4
tools/testing/selftests/kvm/x86_64/vmx_exception_with_invalid_guest_state.c: +1 -1
tools/testing/selftests/kvm/x86_64/vmx_pmu_caps_test.c: +16 -15
tools/testing/selftests/kvm/x86_64/xapic_state_test.c: +4 -4
tools/testing/selftests/kvm/x86_64/xcr0_cpuid_test.c: +17 -12
tools/testing/selftests/kvm/x86_64/xen_vmcall_test.c: +10 -10
virt/kvm/Kconfig: +0 -3
virt/kvm/kvm_main.c: +40 -14
