{
  "hash": "ba58d1020a54933c6b087a3107661c8513556cb8",
  "hash_short": "ba58d102",
  "subject": "timekeeping: Ignore the bogus sleep time if pm_trace is enabled",
  "body": "Power management suspend/resume tracing (ab)uses the RTC to store\nsuspend/resume information persistently. As a consequence the RTC value is\nclobbered when timekeeping is resumed and tries to inject the sleep time.\n\nCommit a4f8f6667f09 (\"timekeeping: Cap array access in timekeeping_debug\")\nplugged a out of bounds array access in the timekeeping debug code which\nwas caused by the clobbered RTC value, but we still use the clobbered RTC\nvalue for sleep time injection into kernel timekeeping, which will result\nin random adjustments depending on the stored \"hash\" value.\n\nTo prevent this keep track of the RTC clobbering and ignore the invalid RTC\ntimestamp at resume. If the system resumed successfully clear the flag,\nwhich marks the RTC as unusable, warn the user about the RTC clobber and\nrecommend to adjust the RTC with 'ntpdate' or 'rdate'.\n\n[jstultz: Fixed up pr_warn formating, and implemented suggestions from Ingo]\n[ tglx: Rewrote changelog ]\n\nOriginally-from: Thomas Gleixner <tglx@linutronix.de>\nSigned-off-by: Chen Yu <yu.c.chen@intel.com>\nSigned-off-by: John Stultz <john.stultz@linaro.org>\nAcked-by: Pavel Machek <pavel@ucw.cz>\nAcked-by: Thomas Gleixner <tglx@linutronix.de>\nCc: Prarit Bhargava <prarit@redhat.com>\nCc: \"Rafael J. Wysocki\" <rjw@rjwysocki.net>\nCc: Richard Cochran <richardcochran@gmail.com>\nCc: Xunlei Pang <xlpang@redhat.com>\nCc: Len Brown <lenb@kernel.org>\nLink: http://lkml.kernel.org/r/1480372524-15181-3-git-send-email-john.stultz@linaro.org\nSigned-off-by: Thomas Gleixner <tglx@linutronix.de>",
  "full_message": "timekeeping: Ignore the bogus sleep time if pm_trace is enabled\n\nPower management suspend/resume tracing (ab)uses the RTC to store\nsuspend/resume information persistently. As a consequence the RTC value is\nclobbered when timekeeping is resumed and tries to inject the sleep time.\n\nCommit a4f8f6667f09 (\"timekeeping: Cap array access in timekeeping_debug\")\nplugged a out of bounds array access in the timekeeping debug code which\nwas caused by the clobbered RTC value, but we still use the clobbered RTC\nvalue for sleep time injection into kernel timekeeping, which will result\nin random adjustments depending on the stored \"hash\" value.\n\nTo prevent this keep track of the RTC clobbering and ignore the invalid RTC\ntimestamp at resume. If the system resumed successfully clear the flag,\nwhich marks the RTC as unusable, warn the user about the RTC clobber and\nrecommend to adjust the RTC with 'ntpdate' or 'rdate'.\n\n[jstultz: Fixed up pr_warn formating, and implemented suggestions from Ingo]\n[ tglx: Rewrote changelog ]\n\nOriginally-from: Thomas Gleixner <tglx@linutronix.de>\nSigned-off-by: Chen Yu <yu.c.chen@intel.com>\nSigned-off-by: John Stultz <john.stultz@linaro.org>\nAcked-by: Pavel Machek <pavel@ucw.cz>\nAcked-by: Thomas Gleixner <tglx@linutronix.de>\nCc: Prarit Bhargava <prarit@redhat.com>\nCc: \"Rafael J. Wysocki\" <rjw@rjwysocki.net>\nCc: Richard Cochran <richardcochran@gmail.com>\nCc: Xunlei Pang <xlpang@redhat.com>\nCc: Len Brown <lenb@kernel.org>\nLink: http://lkml.kernel.org/r/1480372524-15181-3-git-send-email-john.stultz@linaro.org\nSigned-off-by: Thomas Gleixner <tglx@linutronix.de>",
  "author_name": "Chen Yu",
  "author_email": "yu.c.chen@intel.com",
  "author_date": "Mon Nov 28 14:35:19 2016 -0800",
  "author_date_iso": "2016-11-28T14:35:19-08:00",
  "committer_name": "Thomas Gleixner",
  "committer_email": "tglx@linutronix.de",
  "committer_date": "Tue Nov 29 18:02:58 2016 +0100",
  "committer_date_iso": "2016-11-29T18:02:58+01:00",
  "files_changed": [
    "arch/x86/kernel/rtc.c",
    "drivers/base/power/trace.c",
    "drivers/rtc/rtc-cmos.c",
    "include/linux/mc146818rtc.h",
    "include/linux/pm-trace.h"
  ],
  "files_changed_count": 5,
  "stats": [
    {
      "file": "arch/x86/kernel/rtc.c",
      "insertions": 9,
      "deletions": 0
    },
    {
      "file": "drivers/base/power/trace.c",
      "insertions": 27,
      "deletions": 0
    },
    {
      "file": "drivers/rtc/rtc-cmos.c",
      "insertions": 7,
      "deletions": 0
    },
    {
      "file": "include/linux/mc146818rtc.h",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "include/linux/pm-trace.h",
      "insertions": 8,
      "deletions": 1
    }
  ],
  "total_insertions": 52,
  "total_deletions": 1,
  "total_changes": 53,
  "parents": [
    "a109ded26c8c85c17872c8f61e8979c5d650004d"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.10",
    "v4.10-rc1",
    "v4.10-rc2",
    "v4.10-rc3",
    "v4.10-rc4",
    "v4.10-rc5",
    "v4.10-rc6",
    "v4.10-rc7",
    "v4.10-rc8",
    "v4.11"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "inject"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/x86/kernel/rtc.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/base/power/trace.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/rtc/rtc-cmos.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/linux/mc146818rtc.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/linux/pm-trace.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}