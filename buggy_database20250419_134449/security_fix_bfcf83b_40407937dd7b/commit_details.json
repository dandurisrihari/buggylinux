{
  "hash": "bfcf83b1444d90f6e680a0dde0916f3b289b5066",
  "hash_short": "bfcf83b1",
  "subject": "KVM: nVMX: Fix trying to cancel vmlauch/vmresume",
  "body": "------------[ cut here ]------------\nWARNING: CPU: 7 PID: 3861 at /home/kernel/ssd/kvm/arch/x86/kvm//vmx.c:11299 nested_vmx_vmexit+0x176e/0x1980 [kvm_intel]\nCPU: 7 PID: 3861 Comm: qemu-system-x86 Tainted: G        W  OE   4.13.0-rc4+ #11\nRIP: 0010:nested_vmx_vmexit+0x176e/0x1980 [kvm_intel]\nCall Trace:\n ? kvm_multiple_exception+0x149/0x170 [kvm]\n ? handle_emulation_failure+0x79/0x230 [kvm]\n ? load_vmcs12_host_state+0xa80/0xa80 [kvm_intel]\n ? check_chain_key+0x137/0x1e0\n ? reexecute_instruction.part.168+0x130/0x130 [kvm]\n nested_vmx_inject_exception_vmexit+0xb7/0x100 [kvm_intel]\n ? nested_vmx_inject_exception_vmexit+0xb7/0x100 [kvm_intel]\n vmx_queue_exception+0x197/0x300 [kvm_intel]\n kvm_arch_vcpu_ioctl_run+0x1b0c/0x2c90 [kvm]\n ? kvm_arch_vcpu_runnable+0x220/0x220 [kvm]\n ? preempt_count_sub+0x18/0xc0\n ? restart_apic_timer+0x17d/0x300 [kvm]\n ? kvm_lapic_restart_hv_timer+0x37/0x50 [kvm]\n ? kvm_arch_vcpu_load+0x1d8/0x350 [kvm]\n kvm_vcpu_ioctl+0x4e4/0x910 [kvm]\n ? kvm_vcpu_ioctl+0x4e4/0x910 [kvm]\n ? kvm_dev_ioctl+0xbe0/0xbe0 [kvm]\n\nThe flag \"nested_run_pending\", which can override the decision of which should run\nnext, L1 or L2. nested_run_pending=1 means that we *must* run L2 next, not L1. This\nis necessary in particular when L1 did a VMLAUNCH of L2 and therefore expects L2 to\nbe run (and perhaps be injected with an event it specified, etc.). Nested_run_pending\nis especially intended to avoid switching  to L1 in the injection decision-point.\n\nThis can be handled just like the other cases in vmx_check_nested_events, instead of\nhaving a special case in vmx_queue_exception.\n\nCc: Paolo Bonzini <pbonzini@redhat.com>\nCc: Radim Kr\u010dm\u00e1\u0159 <rkrcmar@redhat.com>\nSigned-off-by: Wanpeng Li <wanpeng.li@hotmail.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "full_message": "KVM: nVMX: Fix trying to cancel vmlauch/vmresume\n\n------------[ cut here ]------------\nWARNING: CPU: 7 PID: 3861 at /home/kernel/ssd/kvm/arch/x86/kvm//vmx.c:11299 nested_vmx_vmexit+0x176e/0x1980 [kvm_intel]\nCPU: 7 PID: 3861 Comm: qemu-system-x86 Tainted: G        W  OE   4.13.0-rc4+ #11\nRIP: 0010:nested_vmx_vmexit+0x176e/0x1980 [kvm_intel]\nCall Trace:\n ? kvm_multiple_exception+0x149/0x170 [kvm]\n ? handle_emulation_failure+0x79/0x230 [kvm]\n ? load_vmcs12_host_state+0xa80/0xa80 [kvm_intel]\n ? check_chain_key+0x137/0x1e0\n ? reexecute_instruction.part.168+0x130/0x130 [kvm]\n nested_vmx_inject_exception_vmexit+0xb7/0x100 [kvm_intel]\n ? nested_vmx_inject_exception_vmexit+0xb7/0x100 [kvm_intel]\n vmx_queue_exception+0x197/0x300 [kvm_intel]\n kvm_arch_vcpu_ioctl_run+0x1b0c/0x2c90 [kvm]\n ? kvm_arch_vcpu_runnable+0x220/0x220 [kvm]\n ? preempt_count_sub+0x18/0xc0\n ? restart_apic_timer+0x17d/0x300 [kvm]\n ? kvm_lapic_restart_hv_timer+0x37/0x50 [kvm]\n ? kvm_arch_vcpu_load+0x1d8/0x350 [kvm]\n kvm_vcpu_ioctl+0x4e4/0x910 [kvm]\n ? kvm_vcpu_ioctl+0x4e4/0x910 [kvm]\n ? kvm_dev_ioctl+0xbe0/0xbe0 [kvm]\n\nThe flag \"nested_run_pending\", which can override the decision of which should run\nnext, L1 or L2. nested_run_pending=1 means that we *must* run L2 next, not L1. This\nis necessary in particular when L1 did a VMLAUNCH of L2 and therefore expects L2 to\nbe run (and perhaps be injected with an event it specified, etc.). Nested_run_pending\nis especially intended to avoid switching  to L1 in the injection decision-point.\n\nThis can be handled just like the other cases in vmx_check_nested_events, instead of\nhaving a special case in vmx_queue_exception.\n\nCc: Paolo Bonzini <pbonzini@redhat.com>\nCc: Radim Kr\u010dm\u00e1\u0159 <rkrcmar@redhat.com>\nSigned-off-by: Wanpeng Li <wanpeng.li@hotmail.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "author_name": "Wanpeng Li",
  "author_email": "wanpeng.li@hotmail.com",
  "author_date": "Thu Aug 24 03:35:11 2017 -0700",
  "author_date_iso": "2017-08-24T03:35:11-07:00",
  "committer_name": "Paolo Bonzini",
  "committer_email": "pbonzini@redhat.com",
  "committer_date": "Thu Aug 24 18:22:21 2017 +0200",
  "committer_date_iso": "2017-08-24T18:22:21+02:00",
  "files_changed": [
    "arch/x86/kvm/vmx.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "arch/x86/kvm/vmx.c",
      "insertions": 17,
      "deletions": 14
    }
  ],
  "total_insertions": 17,
  "total_deletions": 14,
  "total_changes": 31,
  "parents": [
    "664f8e26b00c7673a8303b0d40853a0c24ca93e1"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.14",
    "v4.14-rc1",
    "v4.14-rc2",
    "v4.14-rc3",
    "v4.14-rc4",
    "v4.14-rc5",
    "v4.14-rc6",
    "v4.14-rc7",
    "v4.14-rc8",
    "v4.15"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/x86/kvm/vmx.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}