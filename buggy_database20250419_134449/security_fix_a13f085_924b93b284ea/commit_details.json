{
  "hash": "a13f085d111e90469faf2d9965eb39b11c114d7e",
  "hash_short": "a13f085d",
  "subject": "reiserfs: fix broken xattr handling (heap corruption, bad retval)",
  "body": "This fixes the following issues:\n\n- When a buffer size is supplied to reiserfs_listxattr() such that each\n  individual name fits, but the concatenation of all names doesn't fit,\n  reiserfs_listxattr() overflows the supplied buffer.  This leads to a\n  kernel heap overflow (verified using KASAN) followed by an out-of-bounds\n  usercopy and is therefore a security bug.\n\n- When a buffer size is supplied to reiserfs_listxattr() such that a\n  name doesn't fit, -ERANGE should be returned.  But reiserfs instead just\n  truncates the list of names; I have verified that if the only xattr on a\n  file has a longer name than the supplied buffer length, listxattr()\n  incorrectly returns zero.\n\nWith my patch applied, -ERANGE is returned in both cases and the memory\ncorruption doesn't happen anymore.\n\nCredit for making me clean this code up a bit goes to Al Viro, who pointed\nout that the ->actor calling convention is suboptimal and should be\nchanged.\n\nLink: http://lkml.kernel.org/r/20180802151539.5373-1-jannh@google.com\nFixes: 48b32a3553a5 (\"reiserfs: use generic xattr handlers\")\nSigned-off-by: Jann Horn <jannh@google.com>\nAcked-by: Jeff Mahoney <jeffm@suse.com>\nCc: Eric Biggers <ebiggers@google.com>\nCc: Al Viro <viro@zeniv.linux.org.uk>\nCc: <stable@vger.kernel.org>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
  "full_message": "reiserfs: fix broken xattr handling (heap corruption, bad retval)\n\nThis fixes the following issues:\n\n- When a buffer size is supplied to reiserfs_listxattr() such that each\n  individual name fits, but the concatenation of all names doesn't fit,\n  reiserfs_listxattr() overflows the supplied buffer.  This leads to a\n  kernel heap overflow (verified using KASAN) followed by an out-of-bounds\n  usercopy and is therefore a security bug.\n\n- When a buffer size is supplied to reiserfs_listxattr() such that a\n  name doesn't fit, -ERANGE should be returned.  But reiserfs instead just\n  truncates the list of names; I have verified that if the only xattr on a\n  file has a longer name than the supplied buffer length, listxattr()\n  incorrectly returns zero.\n\nWith my patch applied, -ERANGE is returned in both cases and the memory\ncorruption doesn't happen anymore.\n\nCredit for making me clean this code up a bit goes to Al Viro, who pointed\nout that the ->actor calling convention is suboptimal and should be\nchanged.\n\nLink: http://lkml.kernel.org/r/20180802151539.5373-1-jannh@google.com\nFixes: 48b32a3553a5 (\"reiserfs: use generic xattr handlers\")\nSigned-off-by: Jann Horn <jannh@google.com>\nAcked-by: Jeff Mahoney <jeffm@suse.com>\nCc: Eric Biggers <ebiggers@google.com>\nCc: Al Viro <viro@zeniv.linux.org.uk>\nCc: <stable@vger.kernel.org>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
  "author_name": "Jann Horn",
  "author_email": "jannh@google.com",
  "author_date": "Tue Aug 21 21:59:37 2018 -0700",
  "author_date_iso": "2018-08-21T21:59:37-07:00",
  "committer_name": "Linus Torvalds",
  "committer_email": "torvalds@linux-foundation.org",
  "committer_date": "Wed Aug 22 10:52:50 2018 -0700",
  "committer_date_iso": "2018-08-22T10:52:50-07:00",
  "files_changed": [
    "fs/reiserfs/xattr.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "fs/reiserfs/xattr.c",
      "insertions": 3,
      "deletions": 1
    }
  ],
  "total_insertions": 3,
  "total_deletions": 1,
  "total_changes": 4,
  "parents": [
    "8b73ce6a4bae4fe12bcb2c361c0da4183c2e1b6f"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.19",
    "v4.19-rc1",
    "v4.19-rc2",
    "v4.19-rc3",
    "v4.19-rc4",
    "v4.19-rc5",
    "v4.19-rc6",
    "v4.19-rc7",
    "v4.19-rc8",
    "v4.20"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "security bug"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "fs/reiserfs/xattr.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}