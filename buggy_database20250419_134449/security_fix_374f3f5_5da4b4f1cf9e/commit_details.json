{
  "hash": "374f3f5979f9b28bfb5b5799208d82d08ef518a7",
  "hash_short": "374f3f59",
  "subject": "powerpc/mm/hash: Handle user access of kernel address gracefully",
  "body": "In commit 2865d08dd9ea (\"powerpc/mm: Move the DSISR_PROTFAULT sanity\ncheck\") we moved the protection fault access check before the vma\nlookup. That means we hit that WARN_ON when user space accesses a\nkernel address. Before that commit this was handled by find_vma() not\nfinding vma for the kernel address and considering that access as bad\narea access.\n\nAvoid the confusing WARN_ON and convert that to a ratelimited printk.\n\nWith the patch we now get:\n\nfor load:\n  a.out[5997]: User access of kernel address (c00000000000dea0) - exploit attempt? (uid: 1000)\n  a.out[5997]: segfault (11) at c00000000000dea0 nip 1317c0798 lr 7fff80d6441c code 1 in a.out[1317c0000+10000]\n  a.out[5997]: code: 60000000 60420000 3c4c0002 38427790 4bffff20 3c4c0002 38427784 fbe1fff8\n  a.out[5997]: code: f821ffc1 7c3f0b78 60000000 e9228030 <89290000> 993f002f 60000000 383f0040\n\nfor exec:\n  a.out[6067]: User access of kernel address (c00000000000dea0) - exploit attempt? (uid: 1000)\n  a.out[6067]: segfault (11) at c00000000000dea0 nip c00000000000dea0 lr 129d507b0 code 1\n  a.out[6067]: Bad NIP, not dumping instructions.\n\nFixes: 2865d08dd9ea (\"powerpc/mm: Move the DSISR_PROTFAULT sanity check\")\nSigned-off-by: Aneesh Kumar K.V <aneesh.kumar@linux.ibm.com>\nTested-by: Breno Leitao <leitao@debian.org>\n[mpe: Don't split printk() string across lines]\nSigned-off-by: Michael Ellerman <mpe@ellerman.id.au>",
  "full_message": "powerpc/mm/hash: Handle user access of kernel address gracefully\n\nIn commit 2865d08dd9ea (\"powerpc/mm: Move the DSISR_PROTFAULT sanity\ncheck\") we moved the protection fault access check before the vma\nlookup. That means we hit that WARN_ON when user space accesses a\nkernel address. Before that commit this was handled by find_vma() not\nfinding vma for the kernel address and considering that access as bad\narea access.\n\nAvoid the confusing WARN_ON and convert that to a ratelimited printk.\n\nWith the patch we now get:\n\nfor load:\n  a.out[5997]: User access of kernel address (c00000000000dea0) - exploit attempt? (uid: 1000)\n  a.out[5997]: segfault (11) at c00000000000dea0 nip 1317c0798 lr 7fff80d6441c code 1 in a.out[1317c0000+10000]\n  a.out[5997]: code: 60000000 60420000 3c4c0002 38427790 4bffff20 3c4c0002 38427784 fbe1fff8\n  a.out[5997]: code: f821ffc1 7c3f0b78 60000000 e9228030 <89290000> 993f002f 60000000 383f0040\n\nfor exec:\n  a.out[6067]: User access of kernel address (c00000000000dea0) - exploit attempt? (uid: 1000)\n  a.out[6067]: segfault (11) at c00000000000dea0 nip c00000000000dea0 lr 129d507b0 code 1\n  a.out[6067]: Bad NIP, not dumping instructions.\n\nFixes: 2865d08dd9ea (\"powerpc/mm: Move the DSISR_PROTFAULT sanity check\")\nSigned-off-by: Aneesh Kumar K.V <aneesh.kumar@linux.ibm.com>\nTested-by: Breno Leitao <leitao@debian.org>\n[mpe: Don't split printk() string across lines]\nSigned-off-by: Michael Ellerman <mpe@ellerman.id.au>",
  "author_name": "Aneesh Kumar K.V",
  "author_email": "aneesh.kumar@linux.ibm.com",
  "author_date": "Mon Nov 26 20:05:04 2018 +0530",
  "author_date_iso": "2018-11-26T20:05:04+05:30",
  "committer_name": "Michael Ellerman",
  "committer_email": "mpe@ellerman.id.au",
  "committer_date": "Thu Dec 20 20:52:54 2018 +1100",
  "committer_date_iso": "2018-12-20T20:52:54+11:00",
  "files_changed": [
    "arch/powerpc/mm/fault.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "arch/powerpc/mm/fault.c",
      "insertions": 19,
      "deletions": 5
    }
  ],
  "total_insertions": 19,
  "total_deletions": 5,
  "total_changes": 24,
  "parents": [
    "385e89d5b20f5a7c33fd7c1904da0e6a8e1b366f"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v5.0",
    "v5.0-rc1",
    "v5.0-rc2",
    "v5.0-rc3",
    "v5.0-rc4",
    "v5.0-rc5",
    "v5.0-rc6",
    "v5.0-rc7",
    "v5.0-rc8",
    "v5.1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "exploit"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/powerpc/mm/fault.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}