Commit Hash: 402b08622d9ac6e32e25289573272e0f21bb58a7
Subject: s390: KVM preparation: provide hook to enable pgstes in user pagetable


Security Keywords:
- exploit

Full commit message:
s390: KVM preparation: provide hook to enable pgstes in user pagetable

The SIE instruction on s390 uses the 2nd half of the page table page to
virtualize the storage keys of a guest. This patch offers the s390_enable_sie
function, which reorganizes the page tables of a single-threaded process to
reserve space in the page table:
s390_enable_sie makes sure that the process is single threaded and then uses
dup_mm to create a new mm with reorganized page tables. The old mm is freed
and the process has now a page status extended field after every page table.

Code that wants to exploit pgstes should SELECT CONFIG_PGSTE.

This patch has a small common code hit, namely making dup_mm non-static.

Edit (Carsten): I've modified Martin's patch, following Jeremy Fitzhardinge's
review feedback. Now we do have the prototype for dup_mm in
include/linux/sched.h. Following Martin's suggestion, s390_enable_sie() does now
call task_lock() to prevent race against ptrace modification of mm_users.

Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
Signed-off-by: Carsten Otte <cotte@de.ibm.com>
Acked-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Avi Kivity <avi@qumranet.com>

Metadata:
Author: Carsten Otte <cotte@de.ibm.com>
Author Date: Tue Mar 25 18:47:10 2008 +0100
Committer: Avi Kivity <avi@qumranet.com>
Commit Date: Sun Apr 27 12:00:40 2008 +0300

Files Changed: 8
Lines Added: 82
Lines Removed: 5
Total Changes: 87
