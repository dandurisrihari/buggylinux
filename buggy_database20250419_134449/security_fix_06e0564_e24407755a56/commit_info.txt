Commit Hash: 06e05645661211b9eaadaf6344c335d2e80f0ba2
Subject: KVM: close timer injection race window in __vcpu_run


Security Keywords:
- injection

Full commit message:
KVM: close timer injection race window in __vcpu_run

If a timer fires after kvm_inject_pending_timer_irqs() but before
local_irq_disable() the code will enter guest mode and only inject such
timer interrupt the next time an unrelated event causes an exit.

It would be simpler if the timer->pending irq conversion could be done
with IRQ's disabled, so that the above problem cannot happen.

For now introduce a new vcpu requests bit to cancel guest entry.

Signed-off-by: Marcelo Tosatti <mtosatti@redhat.com>
Signed-off-by: Avi Kivity <avi@qumranet.com>

Metadata:
Author: Marcelo Tosatti <mtosatti@redhat.com>
Author Date: Fri Jun 6 16:37:36 2008 -0300
Committer: Avi Kivity <avi@qumranet.com>
Commit Date: Tue Jun 24 12:16:59 2008 +0300

Files Changed: 4
Lines Added: 9
Lines Removed: 3
Total Changes: 12
