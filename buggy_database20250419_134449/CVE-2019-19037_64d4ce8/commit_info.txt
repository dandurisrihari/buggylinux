Commit Hash: 64d4ce892383b2ad6d782e080d25502f91bf2a38
Subject: ext4: fix ext4_empty_dir() for directories with holes

CVE Identifiers:
- CVE-2019-19037

Full commit message:
ext4: fix ext4_empty_dir() for directories with holes

Function ext4_empty_dir() doesn't correctly handle directories with
holes and crashes on bh->b_data dereference when bh is NULL. Reorganize
the loop to use 'offset' variable all the times instead of comparing
pointers to current direntry with bh->b_data pointer. Also add more
strict checking of '.' and '..' directory entries to avoid entering loop
in possibly invalid state on corrupted filesystems.

References: CVE-2019-19037
CC: stable@vger.kernel.org
Fixes: 4e19d6b65fb4 ("ext4: allow directory holes")
Signed-off-by: Jan Kara <jack@suse.cz>
Link: https://lore.kernel.org/r/20191202170213.4761-2-jack@suse.cz
Signed-off-by: Theodore Ts'o <tytso@mit.edu>

Metadata:
Author: Jan Kara <jack@suse.cz>
Author Date: Mon Dec 2 18:02:12 2019 +0100
Committer: Theodore Ts'o <tytso@mit.edu>
Commit Date: Sat Dec 14 17:22:45 2019 -0500

Files Changed: 1
Lines Added: 18
Lines Removed: 14
Total Changes: 32
