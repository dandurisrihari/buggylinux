commit 1227418989346af3af179742cf42ce842e0ad484
Author: Dov Murik <dovmurik@linux.ibm.com>
Date:   Tue Apr 12 21:21:24 2022 +0000

    efi: Save location of EFI confidential computing area
    
    Confidential computing (coco) hardware such as AMD SEV (Secure Encrypted
    Virtualization) allows a guest owner to inject secrets into the VMs
    memory without the host/hypervisor being able to read them.
    
    Firmware support for secret injection is available in OVMF, which
    reserves a memory area for secret injection and includes a pointer to it
    the in EFI config table entry LINUX_EFI_COCO_SECRET_TABLE_GUID.
    
    If EFI exposes such a table entry, uefi_init() will keep a pointer to
    the EFI config table entry in efi.coco_secret, so it can be used later
    by the kernel (specifically drivers/virt/coco/efi_secret).  It will also
    appear in the kernel log as "CocoSecret=ADDRESS"; for example:
    
        [    0.000000] efi: EFI v2.70 by EDK II
        [    0.000000] efi: CocoSecret=0x7f22e680 SMBIOS=0x7f541000 ACPI=0x7f77e000 ACPI 2.0=0x7f77e014 MEMATTR=0x7ea0c018
    
    The new functionality can be enabled with CONFIG_EFI_COCO_SECRET=y.
    
    Signed-off-by: Dov Murik <dovmurik@linux.ibm.com>
    Reviewed-by: Gerd Hoffmann <kraxel@redhat.com>
    Link: https://lore.kernel.org/r/20220412212127.154182-2-dovmurik@linux.ibm.com
    Signed-off-by: Ard Biesheuvel <ardb@kernel.org>

diff --git a/drivers/firmware/efi/Kconfig b/drivers/firmware/efi/Kconfig
index 243882f5e5f9..f8ddd2259ba0 100644
--- a/drivers/firmware/efi/Kconfig
+++ b/drivers/firmware/efi/Kconfig
@@ -299,3 +299,19 @@ config EFI_DISABLE_RUNTIME
 	  an issue for Real-Time kernels.
 
 	  This default can be overridden by using the efi=runtime option.
+
+config EFI_COCO_SECRET
+	bool "EFI Confidential Computing Secret Area Support"
+	depends on EFI
+	help
+	  Confidential Computing platforms (such as AMD SEV) allow the
+	  Guest Owner to securely inject secrets during guest VM launch.
+	  The secrets are placed in a designated EFI reserved memory area.
+
+	  In order to use the secrets in the kernel, the location of the secret
+	  area (as published in the EFI config table) must be kept.
+
+	  If you say Y here, the address of the EFI secret area will be kept
+	  for usage inside the kernel.  This will allow the
+	  virt/coco/efi_secret module to access the secrets, which in turn
+	  allows userspace programs to access the injected secrets.