Commit Hash: b50cb2b1555d8714e12a566b9b49fcac56a04a3f
Subject: KVM: x86: Use a dedicated flow for queueing re-injected exceptions


Security Keywords:
- injection

Full commit message:
KVM: x86: Use a dedicated flow for queueing re-injected exceptions

Open code the filling of vcpu->arch.exception in kvm_requeue_exception()
instead of bouncing through kvm_multiple_exception(), as re-injection
doesn't actually share that much code with "normal" injection, e.g. the
VM-Exit interception check, payload delivery, and nested exception code
is all bypassed as those flows only apply during initial injection.

When FRED comes along, the special casing will only get worse, as FRED
explicitly tracks nested exceptions and essentially delivers the payload
on the stack frame, i.e. re-injection will need more inputs, and normal
injection will have yet more code that needs to be bypassed when KVM is
re-injecting an exception.

No functional change intended.

Signed-off-by: Xin Li (Intel) <xin@zytor.com>
Tested-by: Shan Kang <shan.kang@intel.com>
Link: https://lore.kernel.org/r/20241001050110.3643764-2-xin@zytor.com
Signed-off-by: Sean Christopherson <seanjc@google.com>

Metadata:
Author: Sean Christopherson <seanjc@google.com>
Author Date: Mon Sep 30 22:00:44 2024 -0700
Committer: Sean Christopherson <seanjc@google.com>
Commit Date: Tue Feb 25 07:23:07 2025 -0800

Files Changed: 4
Lines Added: 63
Lines Removed: 61
Total Changes: 124
