Commit Hash: e06b8b98da071f7dd78fb7822991694288047df0
Subject: kbuild: allow -fstack-protector to take effect


Security Keywords:
- exploit

Full commit message:
kbuild: allow -fstack-protector to take effect

Arjan van de Ven <arjan@infradead.org> wrote:
===
I just read the excellent LWN writeup of the vmsplice
security thing, and that got me wondering why this attack
wasn't stopped by the CONFIG_CC_STACKPROTECTOR option...
because it plain should have been...

Some analysis later.. it turns out that the following line
in the top level Makefile, added by you in October 2007,
entirely disables CONFIG_CC_STACKPROTECTOR ;(
With this line removed the exploit will be nicely stopped.

CFLAGS          += $(call cc-option, -fno-stack-protector)

Now I realize that certain distros have patched gcc to
compensate for their lack of distro wide CFLAGS, and it's
great to work around that... but would there be a way to NOT
disable this for CONFIG_CC_STACKPROTECTOR please?
It would have made this exploit not possible for those kernels
that enable this feature (and that includes distros like Fedora)
===

Move the assignment to KBUILD_CFLAGS up before including
the arch specific Makefile so arch makefiles may override
the setting.

Signed-off-by: Sam Ravnborg <sam@ravnborg.org>
Cc: Arjan van de Ven <arjan@infradead.org>
Cc: stable@kernel.org

Metadata:
Author: Sam Ravnborg <sam@ravnborg.org>
Author Date: Wed Feb 13 22:43:28 2008 +0100
Committer: Sam Ravnborg <sam@ravnborg.org>
Commit Date: Thu Feb 14 23:33:21 2008 +0100

Files Changed: 1
Lines Added: 4
Lines Removed: 3
Total Changes: 7
