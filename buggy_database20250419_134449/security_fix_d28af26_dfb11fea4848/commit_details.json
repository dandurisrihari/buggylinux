{
  "hash": "d28af26faa0b1daf3c692603d46bc4687c16f19e",
  "hash_short": "d28af26f",
  "subject": "x86/MCE: Initialize mce.bank in the case of a fatal error in mce_no_way_out()",
  "body": "Internal injection testing crashed with a console log that said:\n\n  mce: [Hardware Error]: CPU 7: Machine Check Exception: f Bank 0: bd80000000100134\n\nThis caused a lot of head scratching because the MCACOD (bits 15:0) of\nthat status is a signature from an L1 data cache error. But Linux says\nthat it found it in \"Bank 0\", which on this model CPU only reports L1\ninstruction cache errors.\n\nThe answer was that Linux doesn't initialize \"m->bank\" in the case that\nit finds a fatal error in the mce_no_way_out() pre-scan of banks. If\nthis was a local machine check, then this partially initialized struct\nmce is being passed to mce_panic().\n\nFix is simple: just initialize m->bank in the case of a fatal error.\n\nFixes: 40c36e2741d7 (\"x86/mce: Fix incorrect \"Machine check from unknown source\" message\")\nSigned-off-by: Tony Luck <tony.luck@intel.com>\nSigned-off-by: Borislav Petkov <bp@suse.de>\nCc: \"H. Peter Anvin\" <hpa@zytor.com>\nCc: Ingo Molnar <mingo@redhat.com>\nCc: Thomas Gleixner <tglx@linutronix.de>\nCc: Vishal Verma <vishal.l.verma@intel.com>\nCc: x86-ml <x86@kernel.org>\nCc: stable@vger.kernel.org # v4.18 Note pre-v5.0 arch/x86/kernel/cpu/mce/core.c was called arch/x86/kernel/cpu/mcheck/mce.c\nLink: https://lkml.kernel.org/r/20190201003341.10638-1-tony.luck@intel.com",
  "full_message": "x86/MCE: Initialize mce.bank in the case of a fatal error in mce_no_way_out()\n\nInternal injection testing crashed with a console log that said:\n\n  mce: [Hardware Error]: CPU 7: Machine Check Exception: f Bank 0: bd80000000100134\n\nThis caused a lot of head scratching because the MCACOD (bits 15:0) of\nthat status is a signature from an L1 data cache error. But Linux says\nthat it found it in \"Bank 0\", which on this model CPU only reports L1\ninstruction cache errors.\n\nThe answer was that Linux doesn't initialize \"m->bank\" in the case that\nit finds a fatal error in the mce_no_way_out() pre-scan of banks. If\nthis was a local machine check, then this partially initialized struct\nmce is being passed to mce_panic().\n\nFix is simple: just initialize m->bank in the case of a fatal error.\n\nFixes: 40c36e2741d7 (\"x86/mce: Fix incorrect \"Machine check from unknown source\" message\")\nSigned-off-by: Tony Luck <tony.luck@intel.com>\nSigned-off-by: Borislav Petkov <bp@suse.de>\nCc: \"H. Peter Anvin\" <hpa@zytor.com>\nCc: Ingo Molnar <mingo@redhat.com>\nCc: Thomas Gleixner <tglx@linutronix.de>\nCc: Vishal Verma <vishal.l.verma@intel.com>\nCc: x86-ml <x86@kernel.org>\nCc: stable@vger.kernel.org # v4.18 Note pre-v5.0 arch/x86/kernel/cpu/mce/core.c was called arch/x86/kernel/cpu/mcheck/mce.c\nLink: https://lkml.kernel.org/r/20190201003341.10638-1-tony.luck@intel.com",
  "author_name": "Tony Luck",
  "author_email": "tony.luck@intel.com",
  "author_date": "Thu Jan 31 16:33:41 2019 -0800",
  "author_date_iso": "2019-01-31T16:33:41-08:00",
  "committer_name": "Borislav Petkov",
  "committer_email": "bp@suse.de",
  "committer_date": "Sun Feb 3 13:24:24 2019 +0100",
  "committer_date_iso": "2019-02-03T13:24:24+01:00",
  "files_changed": [
    "arch/x86/kernel/cpu/mce/core.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "arch/x86/kernel/cpu/mce/core.c",
      "insertions": 1,
      "deletions": 0
    }
  ],
  "total_insertions": 1,
  "total_deletions": 0,
  "total_changes": 1,
  "parents": [
    "e6d429313ea5c776d2e76b4494df69102e6b7115"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v5.0",
    "v5.0-rc6",
    "v5.0-rc7",
    "v5.0-rc8",
    "v5.1",
    "v5.1-rc1",
    "v5.1-rc2",
    "v5.1-rc3",
    "v5.1-rc4",
    "v5.1-rc5"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/x86/kernel/cpu/mce/core.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}