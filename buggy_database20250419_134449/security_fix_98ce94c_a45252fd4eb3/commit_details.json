{
  "hash": "98ce94c8df762d413b3ecb849e2b966b21606d04",
  "hash_short": "98ce94c8",
  "subject": "cifs: use server timestamp for ntlmv2 authentication",
  "body": "Linux cifs mount with ntlmssp against an Mac OS X (Yosemite\n10.10.5) share fails in case the clocks differ more than +/-2h:\n\ndigest-service: digest-request: od failed with 2 proto=ntlmv2\ndigest-service: digest-request: kdc failed with -1561745592 proto=ntlmv2\n\nFix this by (re-)using the given server timestamp for the\nntlmv2 authentication (as Windows 7 does).\n\nA related problem was also reported earlier by Namjae Jaen (see below):\n\nWindows machine has extended security feature which refuse to allow\nauthentication when there is time difference between server time and\nclient time when ntlmv2 negotiation is used. This problem is prevalent\nin embedded enviornment where system time is set to default 1970.\n\nModern servers send the server timestamp in the TargetInfo Av_Pair\nstructure in the challenge message [see MS-NLMP 2.2.2.1]\nIn [MS-NLMP 3.1.5.1.2] it is explicitly mentioned that the client must\nuse the server provided timestamp if present OR current time if it is\nnot\n\nReported-by: Namjae Jeon <namjae.jeon@samsung.com>\nSigned-off-by: Peter Seiderer <ps.report@gmx.net>\nSigned-off-by: Steve French <smfrench@gmail.com>\nCC: Stable <stable@vger.kernel.org>",
  "full_message": "cifs: use server timestamp for ntlmv2 authentication\n\nLinux cifs mount with ntlmssp against an Mac OS X (Yosemite\n10.10.5) share fails in case the clocks differ more than +/-2h:\n\ndigest-service: digest-request: od failed with 2 proto=ntlmv2\ndigest-service: digest-request: kdc failed with -1561745592 proto=ntlmv2\n\nFix this by (re-)using the given server timestamp for the\nntlmv2 authentication (as Windows 7 does).\n\nA related problem was also reported earlier by Namjae Jaen (see below):\n\nWindows machine has extended security feature which refuse to allow\nauthentication when there is time difference between server time and\nclient time when ntlmv2 negotiation is used. This problem is prevalent\nin embedded enviornment where system time is set to default 1970.\n\nModern servers send the server timestamp in the TargetInfo Av_Pair\nstructure in the challenge message [see MS-NLMP 2.2.2.1]\nIn [MS-NLMP 3.1.5.1.2] it is explicitly mentioned that the client must\nuse the server provided timestamp if present OR current time if it is\nnot\n\nReported-by: Namjae Jeon <namjae.jeon@samsung.com>\nSigned-off-by: Peter Seiderer <ps.report@gmx.net>\nSigned-off-by: Steve French <smfrench@gmail.com>\nCC: Stable <stable@vger.kernel.org>",
  "author_name": "Peter Seiderer",
  "author_email": "ps.report@gmx.net",
  "author_date": "Thu Sep 17 21:40:12 2015 +0200",
  "author_date_iso": "2015-09-17T21:40:12+02:00",
  "committer_name": "Steve French",
  "committer_email": "smfrench@gmail.com",
  "committer_date": "Tue Sep 22 15:24:02 2015 -0500",
  "committer_date_iso": "2015-09-22T15:24:02-05:00",
  "files_changed": [
    "fs/cifs/cifsencrypt.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "fs/cifs/cifsencrypt.c",
      "insertions": 51,
      "deletions": 2
    }
  ],
  "total_insertions": 51,
  "total_deletions": 2,
  "total_changes": 53,
  "parents": [
    "e0ddde9d44e37fbc21ce893553094ecf1a633ab5"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.10",
    "v4.10-rc1",
    "v4.10-rc2",
    "v4.10-rc3",
    "v4.10-rc4",
    "v4.10-rc5",
    "v4.10-rc6",
    "v4.10-rc7",
    "v4.10-rc8",
    "v4.11"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "authentication"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "fs/cifs/cifsencrypt.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}