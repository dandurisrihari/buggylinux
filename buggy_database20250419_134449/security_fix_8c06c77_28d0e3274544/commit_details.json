{
  "hash": "8c06c7740d191b9055cb9be920579d5ecdd26303",
  "hash_short": "8c06c774",
  "subject": "x86/pti: Leave kernel text global for !PCID",
  "body": "Global pages are bad for hardening because they potentially let an\nexploit read the kernel image via a Meltdown-style attack which\nmakes it easier to find gadgets.\n\nBut, global pages are good for performance because they reduce TLB\nmisses when making user/kernel transitions, especially when PCIDs\nare not available, such as on older hardware, or where a hypervisor\nhas disabled them for some reason.\n\nThis patch implements a basic, sane policy: If you have PCIDs, you\nonly map a minimal amount of kernel text global.  If you do not have\nPCIDs, you map all kernel text global.\n\nThis policy effectively makes PCIDs something that not only adds\nperformance but a little bit of hardening as well.\n\nI ran a simple \"lseek\" microbenchmark[1] to test the benefit on\na modern Atom microserver.  Most of the benefit comes from applying\nthe series before this patch (\"entry only\"), but there is still a\nsignifiant benefit from this patch.\n\n  No Global Lines (baseline  ): 6077741 lseeks/sec\n  88 Global Lines (entry only): 7528609 lseeks/sec (+23.9%)\n  94 Global Lines (this patch): 8433111 lseeks/sec (+38.8%)\n\n[1.] https://github.com/antonblanchard/will-it-scale/blob/master/tests/lseek1.c\n\nSigned-off-by: Dave Hansen <dave.hansen@linux.intel.com>\nCc: Andrea Arcangeli <aarcange@redhat.com>\nCc: Andy Lutomirski <luto@kernel.org>\nCc: Arjan van de Ven <arjan@linux.intel.com>\nCc: Borislav Petkov <bp@alien8.de>\nCc: Dan Williams <dan.j.williams@intel.com>\nCc: David Woodhouse <dwmw2@infradead.org>\nCc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>\nCc: Hugh Dickins <hughd@google.com>\nCc: Josh Poimboeuf <jpoimboe@redhat.com>\nCc: Juergen Gross <jgross@suse.com>\nCc: Kees Cook <keescook@google.com>\nCc: Linus Torvalds <torvalds@linux-foundation.org>\nCc: Nadav Amit <namit@vmware.com>\nCc: Peter Zijlstra <peterz@infradead.org>\nCc: Thomas Gleixner <tglx@linutronix.de>\nCc: linux-mm@kvack.org\nLink: http://lkml.kernel.org/r/20180406205518.E3D989EB@viggo.jf.intel.com\nSigned-off-by: Ingo Molnar <mingo@kernel.org>",
  "full_message": "x86/pti: Leave kernel text global for !PCID\n\nGlobal pages are bad for hardening because they potentially let an\nexploit read the kernel image via a Meltdown-style attack which\nmakes it easier to find gadgets.\n\nBut, global pages are good for performance because they reduce TLB\nmisses when making user/kernel transitions, especially when PCIDs\nare not available, such as on older hardware, or where a hypervisor\nhas disabled them for some reason.\n\nThis patch implements a basic, sane policy: If you have PCIDs, you\nonly map a minimal amount of kernel text global.  If you do not have\nPCIDs, you map all kernel text global.\n\nThis policy effectively makes PCIDs something that not only adds\nperformance but a little bit of hardening as well.\n\nI ran a simple \"lseek\" microbenchmark[1] to test the benefit on\na modern Atom microserver.  Most of the benefit comes from applying\nthe series before this patch (\"entry only\"), but there is still a\nsignifiant benefit from this patch.\n\n  No Global Lines (baseline  ): 6077741 lseeks/sec\n  88 Global Lines (entry only): 7528609 lseeks/sec (+23.9%)\n  94 Global Lines (this patch): 8433111 lseeks/sec (+38.8%)\n\n[1.] https://github.com/antonblanchard/will-it-scale/blob/master/tests/lseek1.c\n\nSigned-off-by: Dave Hansen <dave.hansen@linux.intel.com>\nCc: Andrea Arcangeli <aarcange@redhat.com>\nCc: Andy Lutomirski <luto@kernel.org>\nCc: Arjan van de Ven <arjan@linux.intel.com>\nCc: Borislav Petkov <bp@alien8.de>\nCc: Dan Williams <dan.j.williams@intel.com>\nCc: David Woodhouse <dwmw2@infradead.org>\nCc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>\nCc: Hugh Dickins <hughd@google.com>\nCc: Josh Poimboeuf <jpoimboe@redhat.com>\nCc: Juergen Gross <jgross@suse.com>\nCc: Kees Cook <keescook@google.com>\nCc: Linus Torvalds <torvalds@linux-foundation.org>\nCc: Nadav Amit <namit@vmware.com>\nCc: Peter Zijlstra <peterz@infradead.org>\nCc: Thomas Gleixner <tglx@linutronix.de>\nCc: linux-mm@kvack.org\nLink: http://lkml.kernel.org/r/20180406205518.E3D989EB@viggo.jf.intel.com\nSigned-off-by: Ingo Molnar <mingo@kernel.org>",
  "author_name": "Dave Hansen",
  "author_email": "dave.hansen@linux.intel.com",
  "author_date": "Fri Apr 6 13:55:18 2018 -0700",
  "author_date_iso": "2018-04-06T13:55:18-07:00",
  "committer_name": "Ingo Molnar",
  "committer_email": "mingo@kernel.org",
  "committer_date": "Thu Apr 12 09:06:00 2018 +0200",
  "committer_date_iso": "2018-04-12T09:06:00+02:00",
  "files_changed": [
    "arch/x86/include/asm/pti.h",
    "arch/x86/mm/init_64.c",
    "arch/x86/mm/pti.c"
  ],
  "files_changed_count": 3,
  "stats": [
    {
      "file": "arch/x86/include/asm/pti.h",
      "insertions": 2,
      "deletions": 0
    },
    {
      "file": "arch/x86/mm/init_64.c",
      "insertions": 6,
      "deletions": 0
    },
    {
      "file": "arch/x86/mm/pti.c",
      "insertions": 74,
      "deletions": 4
    }
  ],
  "total_insertions": 82,
  "total_deletions": 4,
  "total_changes": 86,
  "parents": [
    "39114b7a743e6759bab4d96b7d9651d44d17e3f9"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.17",
    "v4.17-rc1",
    "v4.17-rc2",
    "v4.17-rc3",
    "v4.17-rc4",
    "v4.17-rc5",
    "v4.17-rc6",
    "v4.17-rc7",
    "v4.18",
    "v4.18-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "hardening",
      "exploit"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/x86/include/asm/pti.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/mm/init_64.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/mm/pti.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}