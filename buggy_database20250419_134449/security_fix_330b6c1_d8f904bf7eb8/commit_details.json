{
  "hash": "330b6c1521d76d8b88513fbafe18709ad86dafc4",
  "hash_short": "330b6c15",
  "subject": "Bluetooth: Fix ACL alive for long in case of non pariable devices",
  "body": "For certain devices (ex: HID mouse), support for authentication,\npairing and bonding is optional. For such devices, the ACL alive\nfor too long after the L2CAP disconnection.\n\nTo avoid the ACL alive for too long after L2CAP disconnection, reset the\nACL disconnect timeout back to HCI_DISCONN_TIMEOUT during L2CAP connect.\n\nWhile merging the commit id:a9ea3ed9b71cc3271dd59e76f65748adcaa76422\nthis issue might have introduced.\n\nHcidump info:\nsh-4.1# /opt/hcidump -Xt\n2013-08-05 16:49:00.894129 < ACL data: handle 12 flags 0x00 dlen 12\n    L2CAP(s): Disconn req: dcid 0x004a scid 0x0041\n2013-08-05 16:49:00.894195 < HCI Command: Exit Sniff Mode (0x02|0x0004)\n    plen 2\n    handle 12\n2013-08-05 16:49:00.894269 < ACL data: handle 12 flags 0x00 dlen 12\n    L2CAP(s): Disconn req: dcid 0x0049 scid 0x0040\n2013-08-05 16:49:00.895645 > HCI Event: Command Status (0x0f) plen 4\n    Exit Sniff Mode (0x02|0x0004) status 0x00 ncmd 1\n2013-08-05 16:49:00.934391 > HCI Event: Mode Change (0x14) plen 6\n    status 0x00 handle 12 mode 0x00 interval 0\n    Mode: Active\n2013-08-05 16:49:00.936592 > HCI Event: Number of Completed Packets\n    (0x13) plen 5\n    handle 12 packets 2\n2013-08-05 16:49:00.951577 > ACL data: handle 12 flags 0x02 dlen 12\n    L2CAP(s): Disconn rsp: dcid 0x004a scid 0x0041\n2013-08-05 16:49:00.952820 > ACL data: handle 12 flags 0x02 dlen 12\n    L2CAP(s): Disconn rsp: dcid 0x0049 scid 0x0040\n2013-08-05 16:49:00.969165 > HCI Event: Mode Change (0x14) plen 6\n    status 0x00 handle 12 mode 0x02 interval 50\n    Mode: Sniff\n\n2013-08-05 16:49:48.175533 > HCI Event: Mode Change (0x14) plen 6\n    status 0x00 handle 12 mode 0x00 interval 0\n    Mode: Active\n2013-08-05 16:49:48.219045 > HCI Event: Mode Change (0x14) plen 6\n    status 0x00 handle 12 mode 0x02 interval 108\n    Mode: Sniff\n\n2013-08-05 16:51:00.968209 < HCI Command: Disconnect (0x01|0x0006) plen 3\n    handle 12 reason 0x13\n    Reason: Remote User Terminated Connection\n2013-08-05 16:51:00.969056 > HCI Event: Command Status (0x0f) plen 4\n    Disconnect (0x01|0x0006) status 0x00 ncmd 1\n2013-08-05 16:51:01.013495 > HCI Event: Mode Change (0x14) plen 6\n    status 0x00 handle 12 mode 0x00 interval 0\n    Mode: Active\n2013-08-05 16:51:01.073777 > HCI Event: Disconn Complete (0x05) plen 4\n    status 0x00 handle 12 reason 0x16\n    Reason: Connection Terminated by Local Host\n\n============================ After  fix ================================\n\n2013-08-05 16:57:35.986648 < ACL data: handle 11 flags 0x00 dlen 12\n    L2CAP(s): Disconn req: dcid 0x004c scid 0x0041\n2013-08-05 16:57:35.986713 < HCI Command: Exit Sniff Mode (0x02|0x0004)\n    plen 2\n    handle 11\n2013-08-05 16:57:35.986785 < ACL data: handle 11 flags 0x00 dlen 12\n    L2CAP(s): Disconn req: dcid 0x004b scid 0x0040\n2013-08-05 16:57:35.988110 > HCI Event: Command Status (0x0f) plen 4\n    Exit Sniff Mode (0x02|0x0004) status 0x00 ncmd 1\n2013-08-05 16:57:36.030714 > HCI Event: Mode Change (0x14) plen 6\n    status 0x00 handle 11 mode 0x00 interval 0\n    Mode: Active\n2013-08-05 16:57:36.032950 > HCI Event: Number of Completed Packets\n    (0x13) plen 5\n    handle 11 packets 2\n2013-08-05 16:57:36.047926 > ACL data: handle 11 flags 0x02 dlen 12\n    L2CAP(s): Disconn rsp: dcid 0x004c scid 0x0041\n2013-08-05 16:57:36.049200 > ACL data: handle 11 flags 0x02 dlen 12\n    L2CAP(s): Disconn rsp: dcid 0x004b scid 0x0040\n2013-08-05 16:57:36.065509 > HCI Event: Mode Change (0x14) plen 6\n    status 0x00 handle 11 mode 0x02 interval 50\n    Mode: Sniff\n\n2013-08-05 16:57:40.052006 < HCI Command: Disconnect (0x01|0x0006) plen 3\n    handle 11 reason 0x13\n    Reason: Remote User Terminated Connection\n2013-08-05 16:57:40.052869 > HCI Event: Command Status (0x0f) plen 4\n    Disconnect (0x01|0x0006) status 0x00 ncmd 1\n2013-08-05 16:57:40.104731 > HCI Event: Mode Change (0x14) plen 6\n    status 0x00 handle 11 mode 0x00 interval 0\n    Mode: Active\n2013-08-05 16:57:40.146935 > HCI Event: Disconn Complete (0x05) plen 4\n    status 0x00 handle 11 reason 0x16\n    Reason: Connection Terminated by Local Host\n\nSigned-off-by: Sang-Ki Park <sangki79.park@samsung.com>\nSigned-off-by: Chan-yeol Park <chanyeol.park@samsung.com>\nSigned-off-by: Jaganath Kanakkassery <jaganath.k@samsung.com>\nSigned-off-by: Szymon Janc <szymon.janc@tieto.com>\nSigned-off-by: Syam Sidhardhan <s.syam@samsung.com>\nSigned-off-by: Gustavo Padovan <gustavo.padovan@collabora.co.uk>",
  "full_message": "Bluetooth: Fix ACL alive for long in case of non pariable devices\n\nFor certain devices (ex: HID mouse), support for authentication,\npairing and bonding is optional. For such devices, the ACL alive\nfor too long after the L2CAP disconnection.\n\nTo avoid the ACL alive for too long after L2CAP disconnection, reset the\nACL disconnect timeout back to HCI_DISCONN_TIMEOUT during L2CAP connect.\n\nWhile merging the commit id:a9ea3ed9b71cc3271dd59e76f65748adcaa76422\nthis issue might have introduced.\n\nHcidump info:\nsh-4.1# /opt/hcidump -Xt\n2013-08-05 16:49:00.894129 < ACL data: handle 12 flags 0x00 dlen 12\n    L2CAP(s): Disconn req: dcid 0x004a scid 0x0041\n2013-08-05 16:49:00.894195 < HCI Command: Exit Sniff Mode (0x02|0x0004)\n    plen 2\n    handle 12\n2013-08-05 16:49:00.894269 < ACL data: handle 12 flags 0x00 dlen 12\n    L2CAP(s): Disconn req: dcid 0x0049 scid 0x0040\n2013-08-05 16:49:00.895645 > HCI Event: Command Status (0x0f) plen 4\n    Exit Sniff Mode (0x02|0x0004) status 0x00 ncmd 1\n2013-08-05 16:49:00.934391 > HCI Event: Mode Change (0x14) plen 6\n    status 0x00 handle 12 mode 0x00 interval 0\n    Mode: Active\n2013-08-05 16:49:00.936592 > HCI Event: Number of Completed Packets\n    (0x13) plen 5\n    handle 12 packets 2\n2013-08-05 16:49:00.951577 > ACL data: handle 12 flags 0x02 dlen 12\n    L2CAP(s): Disconn rsp: dcid 0x004a scid 0x0041\n2013-08-05 16:49:00.952820 > ACL data: handle 12 flags 0x02 dlen 12\n    L2CAP(s): Disconn rsp: dcid 0x0049 scid 0x0040\n2013-08-05 16:49:00.969165 > HCI Event: Mode Change (0x14) plen 6\n    status 0x00 handle 12 mode 0x02 interval 50\n    Mode: Sniff\n\n2013-08-05 16:49:48.175533 > HCI Event: Mode Change (0x14) plen 6\n    status 0x00 handle 12 mode 0x00 interval 0\n    Mode: Active\n2013-08-05 16:49:48.219045 > HCI Event: Mode Change (0x14) plen 6\n    status 0x00 handle 12 mode 0x02 interval 108\n    Mode: Sniff\n\n2013-08-05 16:51:00.968209 < HCI Command: Disconnect (0x01|0x0006) plen 3\n    handle 12 reason 0x13\n    Reason: Remote User Terminated Connection\n2013-08-05 16:51:00.969056 > HCI Event: Command Status (0x0f) plen 4\n    Disconnect (0x01|0x0006) status 0x00 ncmd 1\n2013-08-05 16:51:01.013495 > HCI Event: Mode Change (0x14) plen 6\n    status 0x00 handle 12 mode 0x00 interval 0\n    Mode: Active\n2013-08-05 16:51:01.073777 > HCI Event: Disconn Complete (0x05) plen 4\n    status 0x00 handle 12 reason 0x16\n    Reason: Connection Terminated by Local Host\n\n============================ After  fix ================================\n\n2013-08-05 16:57:35.986648 < ACL data: handle 11 flags 0x00 dlen 12\n    L2CAP(s): Disconn req: dcid 0x004c scid 0x0041\n2013-08-05 16:57:35.986713 < HCI Command: Exit Sniff Mode (0x02|0x0004)\n    plen 2\n    handle 11\n2013-08-05 16:57:35.986785 < ACL data: handle 11 flags 0x00 dlen 12\n    L2CAP(s): Disconn req: dcid 0x004b scid 0x0040\n2013-08-05 16:57:35.988110 > HCI Event: Command Status (0x0f) plen 4\n    Exit Sniff Mode (0x02|0x0004) status 0x00 ncmd 1\n2013-08-05 16:57:36.030714 > HCI Event: Mode Change (0x14) plen 6\n    status 0x00 handle 11 mode 0x00 interval 0\n    Mode: Active\n2013-08-05 16:57:36.032950 > HCI Event: Number of Completed Packets\n    (0x13) plen 5\n    handle 11 packets 2\n2013-08-05 16:57:36.047926 > ACL data: handle 11 flags 0x02 dlen 12\n    L2CAP(s): Disconn rsp: dcid 0x004c scid 0x0041\n2013-08-05 16:57:36.049200 > ACL data: handle 11 flags 0x02 dlen 12\n    L2CAP(s): Disconn rsp: dcid 0x004b scid 0x0040\n2013-08-05 16:57:36.065509 > HCI Event: Mode Change (0x14) plen 6\n    status 0x00 handle 11 mode 0x02 interval 50\n    Mode: Sniff\n\n2013-08-05 16:57:40.052006 < HCI Command: Disconnect (0x01|0x0006) plen 3\n    handle 11 reason 0x13\n    Reason: Remote User Terminated Connection\n2013-08-05 16:57:40.052869 > HCI Event: Command Status (0x0f) plen 4\n    Disconnect (0x01|0x0006) status 0x00 ncmd 1\n2013-08-05 16:57:40.104731 > HCI Event: Mode Change (0x14) plen 6\n    status 0x00 handle 11 mode 0x00 interval 0\n    Mode: Active\n2013-08-05 16:57:40.146935 > HCI Event: Disconn Complete (0x05) plen 4\n    status 0x00 handle 11 reason 0x16\n    Reason: Connection Terminated by Local Host\n\nSigned-off-by: Sang-Ki Park <sangki79.park@samsung.com>\nSigned-off-by: Chan-yeol Park <chanyeol.park@samsung.com>\nSigned-off-by: Jaganath Kanakkassery <jaganath.k@samsung.com>\nSigned-off-by: Szymon Janc <szymon.janc@tieto.com>\nSigned-off-by: Syam Sidhardhan <s.syam@samsung.com>\nSigned-off-by: Gustavo Padovan <gustavo.padovan@collabora.co.uk>",
  "author_name": "Syam Sidhardhan",
  "author_email": "s.syam@samsung.com",
  "author_date": "Tue Aug 6 01:59:12 2013 +0900",
  "author_date_iso": "2013-08-06T01:59:12+09:00",
  "committer_name": "Gustavo Padovan",
  "committer_email": "gustavo.padovan@collabora.co.uk",
  "committer_date": "Mon Sep 16 14:41:02 2013 -0300",
  "committer_date_iso": "2013-09-16T14:41:02-03:00",
  "files_changed": [
    "net/bluetooth/l2cap_core.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "net/bluetooth/l2cap_core.c",
      "insertions": 7,
      "deletions": 0
    }
  ],
  "total_insertions": 7,
  "total_deletions": 0,
  "total_changes": 7,
  "parents": [
    "38a172bef8c93ecbfd69715fd88396988e4073fd"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v3.12",
    "v3.12-rc4",
    "v3.12-rc5",
    "v3.12-rc6",
    "v3.12-rc7",
    "v3.13",
    "v3.13-rc1",
    "v3.13-rc2",
    "v3.13-rc3",
    "v3.13-rc4"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "authentication"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "net/bluetooth/l2cap_core.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}