diff --cc arch/arm64/include/asm/kvm_asm.h
index 8e5fa28b78c2,7ccf770c53d9..8a33d83ea843
--- a/arch/arm64/include/asm/kvm_asm.h
+++ b/arch/arm64/include/asm/kvm_asm.h
@@@ -198,14 -199,6 +199,12 @@@ extern void __vgic_v3_init_lrs(void)
  
  extern u32 __kvm_get_mdcr_el2(void);
  
- extern char __smccc_workaround_1_smc[__SMCCC_WORKAROUND_1_SMC_SZ];
- 
 +#if defined(GCC_VERSION) && GCC_VERSION < 50000
 +#define SYM_CONSTRAINT	"i"
 +#else
 +#define SYM_CONSTRAINT	"S"
 +#endif
 +
  /*
   * Obtain the PC-relative address of a kernel symbol
   * s: symbol
diff --cc arch/x86/kvm/svm/svm.c
index da7eb4aaf44f,941e5251e13f..cce0143a6f80
--- a/arch/x86/kvm/svm/svm.c
+++ b/arch/x86/kvm/svm/svm.c
@@@ -1309,10 -1347,8 +1347,10 @@@ static int svm_create_vcpu(struct kvm_v
  		svm->avic_is_running = true;
  
  	svm->msrpm = svm_vcpu_alloc_msrpm();
 -	if (!svm->msrpm)
 +	if (!svm->msrpm) {
 +		err = -ENOMEM;
- 		goto error_free_vmcb_page;
+ 		goto error_free_vmsa_page;
 +	}
  
  	svm_vcpu_init_msrpm(vcpu, svm->msrpm);