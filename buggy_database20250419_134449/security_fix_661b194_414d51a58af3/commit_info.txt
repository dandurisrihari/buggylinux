Commit Hash: 661b19473bf3ac0924560f0cbf84c15458b3c8de
Subject: thunderbolt: Perform USB4 router NVM upgrade in two phases


Security Keywords:
- authentication

Full commit message:
thunderbolt: Perform USB4 router NVM upgrade in two phases

The currect code expects that the router returns back the status of the
NVM authentication immediately. When tested against a real USB4 device
what happens is that the router is reset and only after that the result
is updated in the ROUTER_CS_26 register status field. This also seems to
align better what the spec suggests.

For this reason do the same what we already do with the Thunderbolt 3
devices and perform the NVM upgrade in two phases. First start the
NVM_AUTH router operation and once the router is added back after the
reset read the status in ROUTER_CS_26 and expose it to the userspace
accordingly.

Signed-off-by: Mika Westerberg <mika.westerberg@linux.intel.com>

Metadata:
Author: Mika Westerberg <mika.westerberg@linux.intel.com>
Author Date: Tue Nov 10 11:34:07 2020 +0300
Committer: Mika Westerberg <mika.westerberg@linux.intel.com>
Commit Date: Mon Nov 30 14:39:24 2020 +0300

Files Changed: 4
Lines Added: 77
Lines Removed: 20
Total Changes: 97
