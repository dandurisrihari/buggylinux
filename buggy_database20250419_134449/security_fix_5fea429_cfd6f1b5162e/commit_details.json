{
  "hash": "5fea4291deacd80188b996d2f555fc6a1940e5d4",
  "hash_short": "5fea4291",
  "subject": "[SCSI] zfcp: block queue limits with data router",
  "body": "Commit 86a9668a8d29ea711613e1cb37efa68e7c4db564\n\"[SCSI] zfcp: support for hardware data router\"\nreduced the initial block queue limits in the scsi_host_template to the\nabsolute minimum and adjusted them later on. However, the adjustment was\ntoo late for the BSG devices of Scsi_Host and fc_host.\n\nTherefore, ioctl(..., SG_IO, ...) with request or response size > 4kB to a\nBSG device of an fc_host or a Scsi_Host fails with EINVAL. As a result,\nusers of such ioctl such as HBA_SendCTPassThru() in libzfcphbaapi return\nwith error HBA_STATUS_ERROR.\n\nInitialize the block queue limits in zfcp_scsi_host_template to the\ngreatest common denominator (GCD).\n\nWhile we cannot exploit the slightly enlarged maximum request size with\ndata router, this should be neglectible. Doing so also avoids running into\ntrouble after live guest relocation (LGR) / migration from a data router\nFCP device to an FCP device that does not support data router. In that\ncase, zfcp would figure out the new limits on adapter recovery, but the\nfc_host and Scsi_Host (plus in fact all sdevs) still exist with the old and\nnow too large queue limits.\n\nIt should also OK, not to use half the size as in the DIX case, because\nfc_host and Scsi_Host do not transport FCP requests including SCSI commands\nusing protection data.\n\nSigned-off-by: Steffen Maier <maier@linux.vnet.ibm.com>\nReviewed-by: Martin Peschke <mpeschke@linux.vnet.ibm.com>\nCc: <stable@vger.kernel.org> #3.2+\nSigned-off-by: James Bottomley <JBottomley@Parallels.com>",
  "full_message": "[SCSI] zfcp: block queue limits with data router\n\nCommit 86a9668a8d29ea711613e1cb37efa68e7c4db564\n\"[SCSI] zfcp: support for hardware data router\"\nreduced the initial block queue limits in the scsi_host_template to the\nabsolute minimum and adjusted them later on. However, the adjustment was\ntoo late for the BSG devices of Scsi_Host and fc_host.\n\nTherefore, ioctl(..., SG_IO, ...) with request or response size > 4kB to a\nBSG device of an fc_host or a Scsi_Host fails with EINVAL. As a result,\nusers of such ioctl such as HBA_SendCTPassThru() in libzfcphbaapi return\nwith error HBA_STATUS_ERROR.\n\nInitialize the block queue limits in zfcp_scsi_host_template to the\ngreatest common denominator (GCD).\n\nWhile we cannot exploit the slightly enlarged maximum request size with\ndata router, this should be neglectible. Doing so also avoids running into\ntrouble after live guest relocation (LGR) / migration from a data router\nFCP device to an FCP device that does not support data router. In that\ncase, zfcp would figure out the new limits on adapter recovery, but the\nfc_host and Scsi_Host (plus in fact all sdevs) still exist with the old and\nnow too large queue limits.\n\nIt should also OK, not to use half the size as in the DIX case, because\nfc_host and Scsi_Host do not transport FCP requests including SCSI commands\nusing protection data.\n\nSigned-off-by: Steffen Maier <maier@linux.vnet.ibm.com>\nReviewed-by: Martin Peschke <mpeschke@linux.vnet.ibm.com>\nCc: <stable@vger.kernel.org> #3.2+\nSigned-off-by: James Bottomley <JBottomley@Parallels.com>",
  "author_name": "Steffen Maier",
  "author_email": "maier@linux.vnet.ibm.com",
  "author_date": "Fri Apr 26 17:33:45 2013 +0200",
  "author_date_iso": "2013-04-26T17:33:45+02:00",
  "committer_name": "James Bottomley",
  "committer_email": "JBottomley@Parallels.com",
  "committer_date": "Fri May 31 16:32:37 2013 -0700",
  "committer_date_iso": "2013-05-31T16:32:37-07:00",
  "files_changed": [
    "drivers/s390/scsi/zfcp_scsi.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/s390/scsi/zfcp_scsi.c",
      "insertions": 7,
      "deletions": 3
    }
  ],
  "total_insertions": 7,
  "total_deletions": 3,
  "total_changes": 10,
  "parents": [
    "f76ccaac4f82c463a037aa4a1e4ccb85c7011814"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v3.11",
    "v3.11-rc1",
    "v3.11-rc2",
    "v3.11-rc3",
    "v3.11-rc4",
    "v3.11-rc5",
    "v3.11-rc6",
    "v3.11-rc7",
    "v3.12",
    "v3.12-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "exploit"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/s390/scsi/zfcp_scsi.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}