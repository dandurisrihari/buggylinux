Commit Hash: 16ae56d7e0528559bf8dc9070e3bfd8ba3de80df
Subject: KVM: x86: nSVM: harden svm_free_nested against freeing vmcb02 while still in use

CVE Identifiers:
- CVE-2022-3344

Full commit message:
KVM: x86: nSVM: harden svm_free_nested against freeing vmcb02 while still in use

Make sure that KVM uses vmcb01 before freeing nested state, and warn if
that is not the case.

This is a minimal fix for CVE-2022-3344 making the kernel print a warning
instead of a kernel panic.

Cc: stable@vger.kernel.org
Signed-off-by: Maxim Levitsky <mlevitsk@redhat.com>
Message-Id: <20221103141351.50662-3-mlevitsk@redhat.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

Metadata:
Author: Maxim Levitsky <mlevitsk@redhat.com>
Author Date: Thu Nov 3 16:13:44 2022 +0200
Committer: Paolo Bonzini <pbonzini@redhat.com>
Commit Date: Thu Nov 17 11:39:54 2022 -0500

Files Changed: 1
Lines Added: 3
Lines Removed: 0
Total Changes: 3
