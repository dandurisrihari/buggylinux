{
  "hash": "69218e47994da614e7af600bf06887750ab6657a",
  "hash_short": "69218e47",
  "subject": "x86: Remap GDT tables in the fixmap section",
  "body": "Each processor holds a GDT in its per-cpu structure. The sgdt\ninstruction gives the base address of the current GDT. This address can\nbe used to bypass KASLR memory randomization. With another bug, an\nattacker could target other per-cpu structures or deduce the base of\nthe main memory section (PAGE_OFFSET).\n\nThis patch relocates the GDT table for each processor inside the\nfixmap section. The space is reserved based on number of supported\nprocessors.\n\nFor consistency, the remapping is done by default on 32 and 64-bit.\n\nEach processor switches to its remapped GDT at the end of\ninitialization. For hibernation, the main processor returns with the\noriginal GDT and switches back to the remapping at completion.\n\nThis patch was tested on both architectures. Hibernation and KVM were\nboth tested specially for their usage of the GDT.\n\nThanks to Boris Ostrovsky <boris.ostrovsky@oracle.com> for testing and\nrecommending changes for Xen support.\n\nSigned-off-by: Thomas Garnier <thgarnie@google.com>\nCc: Alexander Potapenko <glider@google.com>\nCc: Andrew Morton <akpm@linux-foundation.org>\nCc: Andrey Ryabinin <aryabinin@virtuozzo.com>\nCc: Andy Lutomirski <luto@kernel.org>\nCc: Ard Biesheuvel <ard.biesheuvel@linaro.org>\nCc: Boris Ostrovsky <boris.ostrovsky@oracle.com>\nCc: Borislav Petkov <bp@suse.de>\nCc: Chris Wilson <chris@chris-wilson.co.uk>\nCc: Christian Borntraeger <borntraeger@de.ibm.com>\nCc: Dmitry Vyukov <dvyukov@google.com>\nCc: Frederic Weisbecker <fweisbec@gmail.com>\nCc: Jiri Kosina <jikos@kernel.org>\nCc: Joerg Roedel <joro@8bytes.org>\nCc: Jonathan Corbet <corbet@lwn.net>\nCc: Josh Poimboeuf <jpoimboe@redhat.com>\nCc: Juergen Gross <jgross@suse.com>\nCc: Kees Cook <keescook@chromium.org>\nCc: Len Brown <len.brown@intel.com>\nCc: Linus Torvalds <torvalds@linux-foundation.org>\nCc: Lorenzo Stoakes <lstoakes@gmail.com>\nCc: Luis R . Rodriguez <mcgrof@kernel.org>\nCc: Matt Fleming <matt@codeblueprint.co.uk>\nCc: Michal Hocko <mhocko@suse.com>\nCc: Paolo Bonzini <pbonzini@redhat.com>\nCc: Paul Gortmaker <paul.gortmaker@windriver.com>\nCc: Pavel Machek <pavel@ucw.cz>\nCc: Peter Zijlstra <peterz@infradead.org>\nCc: Radim Kr\u010dm\u00e1\u0159 <rkrcmar@redhat.com>\nCc: Rafael J . Wysocki <rjw@rjwysocki.net>\nCc: Rusty Russell <rusty@rustcorp.com.au>\nCc: Stanislaw Gruszka <sgruszka@redhat.com>\nCc: Thomas Gleixner <tglx@linutronix.de>\nCc: Tim Chen <tim.c.chen@linux.intel.com>\nCc: Vitaly Kuznetsov <vkuznets@redhat.com>\nCc: kasan-dev@googlegroups.com\nCc: kernel-hardening@lists.openwall.com\nCc: kvm@vger.kernel.org\nCc: lguest@lists.ozlabs.org\nCc: linux-doc@vger.kernel.org\nCc: linux-efi@vger.kernel.org\nCc: linux-mm@kvack.org\nCc: linux-pm@vger.kernel.org\nCc: xen-devel@lists.xenproject.org\nCc: zijun_hu <zijun_hu@htc.com>\nLink: http://lkml.kernel.org/r/20170314170508.100882-2-thgarnie@google.com\nSigned-off-by: Ingo Molnar <mingo@kernel.org>",
  "full_message": "x86: Remap GDT tables in the fixmap section\n\nEach processor holds a GDT in its per-cpu structure. The sgdt\ninstruction gives the base address of the current GDT. This address can\nbe used to bypass KASLR memory randomization. With another bug, an\nattacker could target other per-cpu structures or deduce the base of\nthe main memory section (PAGE_OFFSET).\n\nThis patch relocates the GDT table for each processor inside the\nfixmap section. The space is reserved based on number of supported\nprocessors.\n\nFor consistency, the remapping is done by default on 32 and 64-bit.\n\nEach processor switches to its remapped GDT at the end of\ninitialization. For hibernation, the main processor returns with the\noriginal GDT and switches back to the remapping at completion.\n\nThis patch was tested on both architectures. Hibernation and KVM were\nboth tested specially for their usage of the GDT.\n\nThanks to Boris Ostrovsky <boris.ostrovsky@oracle.com> for testing and\nrecommending changes for Xen support.\n\nSigned-off-by: Thomas Garnier <thgarnie@google.com>\nCc: Alexander Potapenko <glider@google.com>\nCc: Andrew Morton <akpm@linux-foundation.org>\nCc: Andrey Ryabinin <aryabinin@virtuozzo.com>\nCc: Andy Lutomirski <luto@kernel.org>\nCc: Ard Biesheuvel <ard.biesheuvel@linaro.org>\nCc: Boris Ostrovsky <boris.ostrovsky@oracle.com>\nCc: Borislav Petkov <bp@suse.de>\nCc: Chris Wilson <chris@chris-wilson.co.uk>\nCc: Christian Borntraeger <borntraeger@de.ibm.com>\nCc: Dmitry Vyukov <dvyukov@google.com>\nCc: Frederic Weisbecker <fweisbec@gmail.com>\nCc: Jiri Kosina <jikos@kernel.org>\nCc: Joerg Roedel <joro@8bytes.org>\nCc: Jonathan Corbet <corbet@lwn.net>\nCc: Josh Poimboeuf <jpoimboe@redhat.com>\nCc: Juergen Gross <jgross@suse.com>\nCc: Kees Cook <keescook@chromium.org>\nCc: Len Brown <len.brown@intel.com>\nCc: Linus Torvalds <torvalds@linux-foundation.org>\nCc: Lorenzo Stoakes <lstoakes@gmail.com>\nCc: Luis R . Rodriguez <mcgrof@kernel.org>\nCc: Matt Fleming <matt@codeblueprint.co.uk>\nCc: Michal Hocko <mhocko@suse.com>\nCc: Paolo Bonzini <pbonzini@redhat.com>\nCc: Paul Gortmaker <paul.gortmaker@windriver.com>\nCc: Pavel Machek <pavel@ucw.cz>\nCc: Peter Zijlstra <peterz@infradead.org>\nCc: Radim Kr\u010dm\u00e1\u0159 <rkrcmar@redhat.com>\nCc: Rafael J . Wysocki <rjw@rjwysocki.net>\nCc: Rusty Russell <rusty@rustcorp.com.au>\nCc: Stanislaw Gruszka <sgruszka@redhat.com>\nCc: Thomas Gleixner <tglx@linutronix.de>\nCc: Tim Chen <tim.c.chen@linux.intel.com>\nCc: Vitaly Kuznetsov <vkuznets@redhat.com>\nCc: kasan-dev@googlegroups.com\nCc: kernel-hardening@lists.openwall.com\nCc: kvm@vger.kernel.org\nCc: lguest@lists.ozlabs.org\nCc: linux-doc@vger.kernel.org\nCc: linux-efi@vger.kernel.org\nCc: linux-mm@kvack.org\nCc: linux-pm@vger.kernel.org\nCc: xen-devel@lists.xenproject.org\nCc: zijun_hu <zijun_hu@htc.com>\nLink: http://lkml.kernel.org/r/20170314170508.100882-2-thgarnie@google.com\nSigned-off-by: Ingo Molnar <mingo@kernel.org>",
  "author_name": "Thomas Garnier",
  "author_email": "thgarnie@google.com",
  "author_date": "Tue Mar 14 10:05:07 2017 -0700",
  "author_date_iso": "2017-03-14T10:05:07-07:00",
  "committer_name": "Ingo Molnar",
  "committer_email": "mingo@kernel.org",
  "committer_date": "Thu Mar 16 09:06:35 2017 +0100",
  "committer_date_iso": "2017-03-16T09:06:35+01:00",
  "files_changed": [
    "arch/x86/entry/vdso/vma.c",
    "arch/x86/include/asm/desc.h",
    "arch/x86/include/asm/fixmap.h",
    "arch/x86/include/asm/processor.h",
    "arch/x86/include/asm/stackprotector.h",
    "arch/x86/kernel/acpi/sleep.c",
    "arch/x86/kernel/apm_32.c",
    "arch/x86/kernel/cpu/common.c",
    "arch/x86/kernel/setup_percpu.c",
    "arch/x86/kernel/smpboot.c",
    "arch/x86/platform/efi/efi_32.c",
    "arch/x86/power/cpu.c",
    "arch/x86/xen/enlighten.c",
    "arch/x86/xen/mmu.c",
    "arch/x86/xen/smp.c",
    "drivers/lguest/x86/core.c",
    "drivers/pnp/pnpbios/bioscalls.c"
  ],
  "files_changed_count": 17,
  "stats": [
    {
      "file": "arch/x86/entry/vdso/vma.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/x86/include/asm/desc.h",
      "insertions": 53,
      "deletions": 5
    },
    {
      "file": "arch/x86/include/asm/fixmap.h",
      "insertions": 4,
      "deletions": 0
    },
    {
      "file": "arch/x86/include/asm/processor.h",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/x86/include/asm/stackprotector.h",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/x86/kernel/acpi/sleep.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/x86/kernel/apm_32.c",
      "insertions": 3,
      "deletions": 3
    },
    {
      "file": "arch/x86/kernel/cpu/common.c",
      "insertions": 27,
      "deletions": 2
    },
    {
      "file": "arch/x86/kernel/setup_percpu.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/x86/kernel/smpboot.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/x86/platform/efi/efi_32.c",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "arch/x86/power/cpu.c",
      "insertions": 5,
      "deletions": 2
    },
    {
      "file": "arch/x86/xen/enlighten.c",
      "insertions": 4,
      "deletions": 1
    },
    {
      "file": "arch/x86/xen/mmu.c",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/x86/xen/smp.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/lguest/x86/core.c",
      "insertions": 3,
      "deletions": 3
    },
    {
      "file": "drivers/pnp/pnpbios/bioscalls.c",
      "insertions": 5,
      "deletions": 5
    }
  ],
  "total_insertions": 114,
  "total_deletions": 29,
  "total_changes": 143,
  "parents": [
    "f06bdd4001c257792c54dce9427399f2896470af"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.12",
    "v4.12-rc1",
    "v4.12-rc2",
    "v4.12-rc3",
    "v4.12-rc4",
    "v4.12-rc5",
    "v4.12-rc6",
    "v4.12-rc7",
    "v4.13",
    "v4.13-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "hardening",
      "bypass"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/x86/kernel/cpu/common.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/include/asm/processor.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/entry/vdso/vma.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/include/asm/stackprotector.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/include/asm/fixmap.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kernel/apm_32.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/include/asm/desc.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kernel/acpi/sleep.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/platform/efi/efi_32.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kernel/setup_percpu.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/power/cpu.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/xen/mmu.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kernel/smpboot.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/xen/enlighten.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/pnp/pnpbios/bioscalls.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/xen/smp.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/lguest/x86/core.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}