{
  "hash": "f037fc9905ffa6fa19b89bfbc86946798cede071",
  "hash_short": "f037fc99",
  "subject": "net: microchip: sparx5: Fix memory leak for vcap_api_rule_add_keyvalue_test()",
  "body": "Inject fault while probing kunit-example-test.ko, the field which\nis allocated by kzalloc in vcap_rule_add_key() of\nvcap_rule_add_key_bit/u32/u128() is not freed, and it cause\nthe memory leaks below.\n\nunreferenced object 0xffff0276c14b7240 (size 64):\n  comm \"kunit_try_catch\", pid 284, jiffies 4294894220 (age 920.072s)\n  hex dump (first 32 bytes):\n    28 3c 61 82 00 80 ff ff 28 3c 61 82 00 80 ff ff  (<a.....(<a.....\n    67 00 00 00 00 00 00 00 00 01 37 2b af ab ff ff  g.........7+....\n  backtrace:\n    [<0000000028f08898>] slab_post_alloc_hook+0xb8/0x368\n    [<00000000514b9b37>] __kmem_cache_alloc_node+0x174/0x290\n    [<000000004620684a>] kmalloc_trace+0x40/0x164\n    [<0000000059ad6bcd>] vcap_rule_add_key+0x104/0x180\n    [<00000000ff8002d3>] vcap_api_rule_add_keyvalue_test+0x100/0xba8\n    [<00000000fcc5326c>] kunit_try_run_case+0x50/0xac\n    [<00000000f5f45b20>] kunit_generic_run_threadfn_adapter+0x20/0x2c\n    [<0000000026284079>] kthread+0x124/0x130\n    [<0000000024d4a996>] ret_from_fork+0x10/0x20\nunreferenced object 0xffff0276c14b7280 (size 64):\n  comm \"kunit_try_catch\", pid 284, jiffies 4294894221 (age 920.068s)\n  hex dump (first 32 bytes):\n    28 3c 61 82 00 80 ff ff 28 3c 61 82 00 80 ff ff  (<a.....(<a.....\n    67 00 00 00 00 00 00 00 01 01 37 2b af ab ff ff  g.........7+....\n  backtrace:\n    [<0000000028f08898>] slab_post_alloc_hook+0xb8/0x368\n    [<00000000514b9b37>] __kmem_cache_alloc_node+0x174/0x290\n    [<000000004620684a>] kmalloc_trace+0x40/0x164\n    [<0000000059ad6bcd>] vcap_rule_add_key+0x104/0x180\n    [<00000000f5ac9dc7>] vcap_api_rule_add_keyvalue_test+0x168/0xba8\n    [<00000000fcc5326c>] kunit_try_run_case+0x50/0xac\n    [<00000000f5f45b20>] kunit_generic_run_threadfn_adapter+0x20/0x2c\n    [<0000000026284079>] kthread+0x124/0x130\n    [<0000000024d4a996>] ret_from_fork+0x10/0x20\nunreferenced object 0xffff0276c14b72c0 (size 64):\n  comm \"kunit_try_catch\", pid 284, jiffies 4294894221 (age 920.068s)\n  hex dump (first 32 bytes):\n    28 3c 61 82 00 80 ff ff 28 3c 61 82 00 80 ff ff  (<a.....(<a.....\n    67 00 00 00 00 00 00 00 00 00 37 2b af ab ff ff  g.........7+....\n  backtrace:\n    [<0000000028f08898>] slab_post_alloc_hook+0xb8/0x368\n    [<00000000514b9b37>] __kmem_cache_alloc_node+0x174/0x290\n    [<000000004620684a>] kmalloc_trace+0x40/0x164\n    [<0000000059ad6bcd>] vcap_rule_add_key+0x104/0x180\n    [<00000000c918ae7f>] vcap_api_rule_add_keyvalue_test+0x1d0/0xba8\n    [<00000000fcc5326c>] kunit_try_run_case+0x50/0xac\n    [<00000000f5f45b20>] kunit_generic_run_threadfn_adapter+0x20/0x2c\n    [<0000000026284079>] kthread+0x124/0x130\n    [<0000000024d4a996>] ret_from_fork+0x10/0x20\nunreferenced object 0xffff0276c14b7300 (size 64):\n  comm \"kunit_try_catch\", pid 284, jiffies 4294894221 (age 920.084s)\n  hex dump (first 32 bytes):\n    28 3c 61 82 00 80 ff ff 28 3c 61 82 00 80 ff ff  (<a.....(<a.....\n    7d 00 00 00 01 00 00 00 32 54 76 98 ab ff 00 ff  }.......2Tv.....\n  backtrace:\n    [<0000000028f08898>] slab_post_alloc_hook+0xb8/0x368\n    [<00000000514b9b37>] __kmem_cache_alloc_node+0x174/0x290\n    [<000000004620684a>] kmalloc_trace+0x40/0x164\n    [<0000000059ad6bcd>] vcap_rule_add_key+0x104/0x180\n    [<0000000003352814>] vcap_api_rule_add_keyvalue_test+0x240/0xba8\n    [<00000000fcc5326c>] kunit_try_run_case+0x50/0xac\n    [<00000000f5f45b20>] kunit_generic_run_threadfn_adapter+0x20/0x2c\n    [<0000000026284079>] kthread+0x124/0x130\n    [<0000000024d4a996>] ret_from_fork+0x10/0x20\nunreferenced object 0xffff0276c14b7340 (size 64):\n  comm \"kunit_try_catch\", pid 284, jiffies 4294894221 (age 920.084s)\n  hex dump (first 32 bytes):\n    28 3c 61 82 00 80 ff ff 28 3c 61 82 00 80 ff ff  (<a.....(<a.....\n    51 00 00 00 07 00 00 00 17 26 35 44 63 62 71 00  Q........&5Dcbq.\n  backtrace:\n    [<0000000028f08898>] slab_post_alloc_hook+0xb8/0x368\n    [<00000000514b9b37>] __kmem_cache_alloc_node+0x174/0x290\n    [<000000004620684a>] kmalloc_trace+0x40/0x164\n    [<0000000059ad6bcd>] vcap_rule_add_key+0x104/0x180\n    [<000000001516f109>] vcap_api_rule_add_keyvalue_test+0x2cc/0xba8\n    [<00000000fcc5326c>] kunit_try_run_case+0x50/0xac\n    [<00000000f5f45b20>] kunit_generic_run_threadfn_adapter+0x20/0x2c\n    [<0000000026284079>] kthread+0x124/0x130\n    [<0000000024d4a996>] ret_from_fork+0x10/0x20\n\nFixes: c956b9b318d9 (\"net: microchip: sparx5: Adding KUNIT tests of key/action values in VCAP API\")\nSigned-off-by: Jinjie Ruan <ruanjinjie@huawei.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
  "full_message": "net: microchip: sparx5: Fix memory leak for vcap_api_rule_add_keyvalue_test()\n\nInject fault while probing kunit-example-test.ko, the field which\nis allocated by kzalloc in vcap_rule_add_key() of\nvcap_rule_add_key_bit/u32/u128() is not freed, and it cause\nthe memory leaks below.\n\nunreferenced object 0xffff0276c14b7240 (size 64):\n  comm \"kunit_try_catch\", pid 284, jiffies 4294894220 (age 920.072s)\n  hex dump (first 32 bytes):\n    28 3c 61 82 00 80 ff ff 28 3c 61 82 00 80 ff ff  (<a.....(<a.....\n    67 00 00 00 00 00 00 00 00 01 37 2b af ab ff ff  g.........7+....\n  backtrace:\n    [<0000000028f08898>] slab_post_alloc_hook+0xb8/0x368\n    [<00000000514b9b37>] __kmem_cache_alloc_node+0x174/0x290\n    [<000000004620684a>] kmalloc_trace+0x40/0x164\n    [<0000000059ad6bcd>] vcap_rule_add_key+0x104/0x180\n    [<00000000ff8002d3>] vcap_api_rule_add_keyvalue_test+0x100/0xba8\n    [<00000000fcc5326c>] kunit_try_run_case+0x50/0xac\n    [<00000000f5f45b20>] kunit_generic_run_threadfn_adapter+0x20/0x2c\n    [<0000000026284079>] kthread+0x124/0x130\n    [<0000000024d4a996>] ret_from_fork+0x10/0x20\nunreferenced object 0xffff0276c14b7280 (size 64):\n  comm \"kunit_try_catch\", pid 284, jiffies 4294894221 (age 920.068s)\n  hex dump (first 32 bytes):\n    28 3c 61 82 00 80 ff ff 28 3c 61 82 00 80 ff ff  (<a.....(<a.....\n    67 00 00 00 00 00 00 00 01 01 37 2b af ab ff ff  g.........7+....\n  backtrace:\n    [<0000000028f08898>] slab_post_alloc_hook+0xb8/0x368\n    [<00000000514b9b37>] __kmem_cache_alloc_node+0x174/0x290\n    [<000000004620684a>] kmalloc_trace+0x40/0x164\n    [<0000000059ad6bcd>] vcap_rule_add_key+0x104/0x180\n    [<00000000f5ac9dc7>] vcap_api_rule_add_keyvalue_test+0x168/0xba8\n    [<00000000fcc5326c>] kunit_try_run_case+0x50/0xac\n    [<00000000f5f45b20>] kunit_generic_run_threadfn_adapter+0x20/0x2c\n    [<0000000026284079>] kthread+0x124/0x130\n    [<0000000024d4a996>] ret_from_fork+0x10/0x20\nunreferenced object 0xffff0276c14b72c0 (size 64):\n  comm \"kunit_try_catch\", pid 284, jiffies 4294894221 (age 920.068s)\n  hex dump (first 32 bytes):\n    28 3c 61 82 00 80 ff ff 28 3c 61 82 00 80 ff ff  (<a.....(<a.....\n    67 00 00 00 00 00 00 00 00 00 37 2b af ab ff ff  g.........7+....\n  backtrace:\n    [<0000000028f08898>] slab_post_alloc_hook+0xb8/0x368\n    [<00000000514b9b37>] __kmem_cache_alloc_node+0x174/0x290\n    [<000000004620684a>] kmalloc_trace+0x40/0x164\n    [<0000000059ad6bcd>] vcap_rule_add_key+0x104/0x180\n    [<00000000c918ae7f>] vcap_api_rule_add_keyvalue_test+0x1d0/0xba8\n    [<00000000fcc5326c>] kunit_try_run_case+0x50/0xac\n    [<00000000f5f45b20>] kunit_generic_run_threadfn_adapter+0x20/0x2c\n    [<0000000026284079>] kthread+0x124/0x130\n    [<0000000024d4a996>] ret_from_fork+0x10/0x20\nunreferenced object 0xffff0276c14b7300 (size 64):\n  comm \"kunit_try_catch\", pid 284, jiffies 4294894221 (age 920.084s)\n  hex dump (first 32 bytes):\n    28 3c 61 82 00 80 ff ff 28 3c 61 82 00 80 ff ff  (<a.....(<a.....\n    7d 00 00 00 01 00 00 00 32 54 76 98 ab ff 00 ff  }.......2Tv.....\n  backtrace:\n    [<0000000028f08898>] slab_post_alloc_hook+0xb8/0x368\n    [<00000000514b9b37>] __kmem_cache_alloc_node+0x174/0x290\n    [<000000004620684a>] kmalloc_trace+0x40/0x164\n    [<0000000059ad6bcd>] vcap_rule_add_key+0x104/0x180\n    [<0000000003352814>] vcap_api_rule_add_keyvalue_test+0x240/0xba8\n    [<00000000fcc5326c>] kunit_try_run_case+0x50/0xac\n    [<00000000f5f45b20>] kunit_generic_run_threadfn_adapter+0x20/0x2c\n    [<0000000026284079>] kthread+0x124/0x130\n    [<0000000024d4a996>] ret_from_fork+0x10/0x20\nunreferenced object 0xffff0276c14b7340 (size 64):\n  comm \"kunit_try_catch\", pid 284, jiffies 4294894221 (age 920.084s)\n  hex dump (first 32 bytes):\n    28 3c 61 82 00 80 ff ff 28 3c 61 82 00 80 ff ff  (<a.....(<a.....\n    51 00 00 00 07 00 00 00 17 26 35 44 63 62 71 00  Q........&5Dcbq.\n  backtrace:\n    [<0000000028f08898>] slab_post_alloc_hook+0xb8/0x368\n    [<00000000514b9b37>] __kmem_cache_alloc_node+0x174/0x290\n    [<000000004620684a>] kmalloc_trace+0x40/0x164\n    [<0000000059ad6bcd>] vcap_rule_add_key+0x104/0x180\n    [<000000001516f109>] vcap_api_rule_add_keyvalue_test+0x2cc/0xba8\n    [<00000000fcc5326c>] kunit_try_run_case+0x50/0xac\n    [<00000000f5f45b20>] kunit_generic_run_threadfn_adapter+0x20/0x2c\n    [<0000000026284079>] kthread+0x124/0x130\n    [<0000000024d4a996>] ret_from_fork+0x10/0x20\n\nFixes: c956b9b318d9 (\"net: microchip: sparx5: Adding KUNIT tests of key/action values in VCAP API\")\nSigned-off-by: Jinjie Ruan <ruanjinjie@huawei.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
  "author_name": "Jinjie Ruan",
  "author_email": "ruanjinjie@huawei.com",
  "author_date": "Tue Sep 12 19:03:06 2023 +0800",
  "author_date_iso": "2023-09-12T19:03:06+08:00",
  "committer_name": "David S. Miller",
  "committer_email": "davem@davemloft.net",
  "committer_date": "Fri Sep 15 07:32:35 2023 +0100",
  "committer_date_iso": "2023-09-15T07:32:35+01:00",
  "files_changed": [
    "drivers/net/ethernet/microchip/vcap/vcap_api_kunit.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/net/ethernet/microchip/vcap/vcap_api_kunit.c",
      "insertions": 15,
      "deletions": 0
    }
  ],
  "total_insertions": 15,
  "total_deletions": 0,
  "total_changes": 15,
  "parents": [
    "9fdfb15a3dbf818e06be514f4abbfc071004cbe7"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "Inject"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/net/ethernet/microchip/vcap/vcap_api_kunit.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}