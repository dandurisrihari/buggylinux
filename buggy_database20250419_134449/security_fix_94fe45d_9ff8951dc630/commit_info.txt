Commit Hash: 94fe45da48f921d01d8ff02a0ad54ee9c326d7f0
Subject: KVM: x86: Fix guest single-stepping while interruptible


Security Keywords:
- injection

Full commit message:
KVM: x86: Fix guest single-stepping while interruptible

Commit 705c5323 opened the doors of hell by unconditionally injecting
single-step flags as long as guest_debug signaled this. This doesn't
work when the guest branches into some interrupt or exception handler
and triggers a vmexit with flag reloading.

Fix it by saving cs:rip when user space requests single-stepping and
restricting the trace flag injection to this guest code position.

Signed-off-by: Jan Kiszka <jan.kiszka@siemens.com>
Signed-off-by: Marcelo Tosatti <mtosatti@redhat.com>

Metadata:
Author: Jan Kiszka <jan.kiszka@web.de>
Author Date: Sun Oct 18 13:24:44 2009 +0200
Committer: Avi Kivity <avi@redhat.com>
Commit Date: Thu Dec 3 09:32:19 2009 +0200

Files Changed: 2
Lines Added: 32
Lines Removed: 19
Total Changes: 51
