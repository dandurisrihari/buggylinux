{
  "hash": "6c593b5276e6ce411dcdf03e2f7d4b93c2e7138e",
  "hash_short": "6c593b52",
  "subject": "KVM: x86: Hoist nested event checks above event injection logic",
  "body": "Perform nested event checks before re-injecting exceptions/events into\nL2.  If a pending exception causes VM-Exit to L1, re-injecting events\ninto vmcs02 is premature and wasted effort.  Take care to ensure events\nthat need to be re-injected are still re-injected if checking for nested\nevents \"fails\", i.e. if KVM needs to force an immediate entry+exit to\ncomplete the to-be-re-injecteed event.\n\nKeep the \"can_inject\" logic the same for now; it too can be pushed below\nthe nested checks, but is a slightly riskier change (see past bugs about\nevents not being properly purged on nested VM-Exit).\n\nAdd and/or modify comments to better document the various interactions.\nOf note is the comment regarding \"blocking\" previously injected NMIs and\nIRQs if an exception is pending.  The old comment isn't wrong strictly\nspeaking, but it failed to capture the reason why the logic even exists.\n\nSigned-off-by: Sean Christopherson <seanjc@google.com>\nReviewed-by: Maxim Levitsky <mlevitsk@redhat.com>\nLink: https://lore.kernel.org/r/20220830231614.3580124-18-seanjc@google.com\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "full_message": "KVM: x86: Hoist nested event checks above event injection logic\n\nPerform nested event checks before re-injecting exceptions/events into\nL2.  If a pending exception causes VM-Exit to L1, re-injecting events\ninto vmcs02 is premature and wasted effort.  Take care to ensure events\nthat need to be re-injected are still re-injected if checking for nested\nevents \"fails\", i.e. if KVM needs to force an immediate entry+exit to\ncomplete the to-be-re-injecteed event.\n\nKeep the \"can_inject\" logic the same for now; it too can be pushed below\nthe nested checks, but is a slightly riskier change (see past bugs about\nevents not being properly purged on nested VM-Exit).\n\nAdd and/or modify comments to better document the various interactions.\nOf note is the comment regarding \"blocking\" previously injected NMIs and\nIRQs if an exception is pending.  The old comment isn't wrong strictly\nspeaking, but it failed to capture the reason why the logic even exists.\n\nSigned-off-by: Sean Christopherson <seanjc@google.com>\nReviewed-by: Maxim Levitsky <mlevitsk@redhat.com>\nLink: https://lore.kernel.org/r/20220830231614.3580124-18-seanjc@google.com\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "author_name": "Sean Christopherson",
  "author_email": "seanjc@google.com",
  "author_date": "Tue Aug 30 23:16:04 2022 +0000",
  "author_date_iso": "2022-08-30T23:16:04+00:00",
  "committer_name": "Paolo Bonzini",
  "committer_email": "pbonzini@redhat.com",
  "committer_date": "Mon Sep 26 12:03:09 2022 -0400",
  "committer_date_iso": "2022-09-26T12:03:09-04:00",
  "files_changed": [
    "arch/x86/kvm/x86.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "arch/x86/kvm/x86.c",
      "insertions": 53,
      "deletions": 36
    }
  ],
  "total_insertions": 53,
  "total_deletions": 36,
  "total_changes": 89,
  "parents": [
    "81601495c5f9839b76eef4edb920b2f101f2fc77"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/x86/kvm/x86.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}