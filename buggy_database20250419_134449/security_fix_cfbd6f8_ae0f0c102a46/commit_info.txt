Commit Hash: cfbd6f84c2e26c13ded16b6bb0871edb7d75974f
Subject: cifs: Fix broken sec=ntlmv2/i sec option (try #2)


Security Keywords:
- authentication

Full commit message:
cifs: Fix broken sec=ntlmv2/i sec option (try #2)

Fix sec=ntlmv2/i authentication option during mount of Samba shares.

cifs client was coding ntlmv2 response incorrectly.
All that is needed in temp as specified in MS-NLMP seciton 3.3.2

"Define ComputeResponse(NegFlg, ResponseKeyNT, ResponseKeyLM,
CHALLENGE_MESSAGE.ServerChallenge, ClientChallenge, Time, ServerName)

as
Set temp to ConcatenationOf(Responserversion, HiResponserversion,
Z(6), Time, ClientChallenge, Z(4), ServerName, Z(4)"

is MsvAvNbDomainName.

For sec=ntlmsspi, build_av_pair is not used, a blob is plucked from
type 2 response sent by the server to use in authentication.

I tested sec=ntlmv2/i and sec=ntlmssp/i mount options against
Samba (3.6) and Windows - XP, 2003 Server and 7.
They all worked.

Signed-off-by: Shirish Pargaonkar <shirishpargaonkar@gmail.com>
Signed-off-by: Steve French <sfrench@us.ibm.com>

Metadata:
Author: Shirish Pargaonkar <shirishpargaonkar@gmail.com>
Author Date: Wed Aug 24 23:05:46 2011 -0500
Committer: Steve French <sfrench@us.ibm.com>
Commit Date: Mon Sep 19 21:16:58 2011 -0500

Files Changed: 1
Lines Added: 11
Lines Removed: 43
Total Changes: 54
