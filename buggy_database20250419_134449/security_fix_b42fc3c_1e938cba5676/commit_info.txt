Commit Hash: b42fc3cbc3d6e284463e93896679379443e19d56
Subject: KVM: Fix off by one in kvm_for_each_vcpu iteration


Security Keywords:
- security issue

Full commit message:
KVM: Fix off by one in kvm_for_each_vcpu iteration

This patch avoids gcc issuing the following warning when KVM_MAX_VCPUS=1:
warning: array subscript is above array bounds

kvm_for_each_vcpu currently checks to see if the index for the vcpu is
valid /after/ loading it. We don't run into problems because the address
is still inside the enclosing struct kvm and we never deference or write
to it, so this isn't a security issue.

The warning occurs when KVM_MAX_VCPUS=1 because the increment portion of
the loop will *always* cause the loop to load an invalid location since
++idx will always be > 0.

This patch moves the load so that the check occurs before the load and
we don't run into the compiler warning.

Signed-off-by: Neil Brown <neilb@suse.de>
Signed-off-by: Jeff Mahoney <jeffm@suse.com>
Signed-off-by: Avi Kivity <avi@redhat.com>

Metadata:
Author: Jeff Mahoney <jeffm@suse.com>
Author Date: Tue Apr 12 21:30:17 2011 -0400
Committer: Avi Kivity <avi@redhat.com>
Commit Date: Wed May 11 07:57:09 2011 -0400

Files Changed: 1
Lines Added: 4
Lines Removed: 3
Total Changes: 7
