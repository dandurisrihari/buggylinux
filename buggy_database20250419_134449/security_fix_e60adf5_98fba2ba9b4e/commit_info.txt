Commit Hash: e60adf513275c3a38e5cb67f7fd12387e43a3ff5
Subject: bpf: Take return from set_memory_rox() into account with bpf_jit_binary_lock_ro()


Security Keywords:
- hardening

Full commit message:
bpf: Take return from set_memory_rox() into account with bpf_jit_binary_lock_ro()

set_memory_rox() can fail, leaving memory unprotected.

Check return and bail out when bpf_jit_binary_lock_ro() returns
an error.

Link: https://github.com/KSPP/linux/issues/7
Signed-off-by: Christophe Leroy <christophe.leroy@csgroup.eu>
Cc: linux-hardening@vger.kernel.org <linux-hardening@vger.kernel.org>
Reviewed-by: Kees Cook <keescook@chromium.org>
Reviewed-by: Puranjay Mohan <puranjay12@gmail.com>
Reviewed-by: Ilya Leoshkevich <iii@linux.ibm.com>  # s390x
Acked-by: Tiezhu Yang <yangtiezhu@loongson.cn>  # LoongArch
Reviewed-by: Johan Almbladh <johan.almbladh@anyfinetworks.com> # MIPS Part
Message-ID: <036b6393f23a2032ce75a1c92220b2afcb798d5d.1709850515.git.christophe.leroy@csgroup.eu>
Signed-off-by: Alexei Starovoitov <ast@kernel.org>

Metadata:
Author: Christophe Leroy <christophe.leroy@csgroup.eu>
Author Date: Fri Mar 8 06:38:08 2024 +0100
Committer: Alexei Starovoitov <ast@kernel.org>
Commit Date: Thu Mar 14 19:28:52 2024 -0700

Files Changed: 8
Lines Added: 51
Lines Removed: 27
Total Changes: 78
