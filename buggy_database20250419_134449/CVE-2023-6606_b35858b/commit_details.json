{
  "hash": "b35858b3786ddbb56e1c35138ba25d6adf8d0bef",
  "hash_short": "b35858b3",
  "subject": "smb: client: fix OOB in smbCalcSize()",
  "body": "Validate @smb->WordCount to avoid reading off the end of @smb and thus\ncausing the following KASAN splat:\n\n  BUG: KASAN: slab-out-of-bounds in smbCalcSize+0x32/0x40 [cifs]\n  Read of size 2 at addr ffff88801c024ec5 by task cifsd/1328\n\n  CPU: 1 PID: 1328 Comm: cifsd Not tainted 6.7.0-rc5 #9\n  Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS\n  rel-1.16.2-3-gd478f380-rebuilt.opensuse.org 04/01/2014\n  Call Trace:\n   <TASK>\n   dump_stack_lvl+0x4a/0x80\n   print_report+0xcf/0x650\n   ? srso_alias_return_thunk+0x5/0xfbef5\n   ? srso_alias_return_thunk+0x5/0xfbef5\n   ? __phys_addr+0x46/0x90\n   kasan_report+0xd8/0x110\n   ? smbCalcSize+0x32/0x40 [cifs]\n   ? smbCalcSize+0x32/0x40 [cifs]\n   kasan_check_range+0x105/0x1b0\n   smbCalcSize+0x32/0x40 [cifs]\n   checkSMB+0x162/0x370 [cifs]\n   ? __pfx_checkSMB+0x10/0x10 [cifs]\n   cifs_handle_standard+0xbc/0x2f0 [cifs]\n   ? srso_alias_return_thunk+0x5/0xfbef5\n   cifs_demultiplex_thread+0xed1/0x1360 [cifs]\n   ? __pfx_cifs_demultiplex_thread+0x10/0x10 [cifs]\n   ? srso_alias_return_thunk+0x5/0xfbef5\n   ? lockdep_hardirqs_on_prepare+0x136/0x210\n   ? __pfx_lock_release+0x10/0x10\n   ? srso_alias_return_thunk+0x5/0xfbef5\n   ? mark_held_locks+0x1a/0x90\n   ? lockdep_hardirqs_on_prepare+0x136/0x210\n   ? srso_alias_return_thunk+0x5/0xfbef5\n   ? srso_alias_return_thunk+0x5/0xfbef5\n   ? __kthread_parkme+0xce/0xf0\n   ? __pfx_cifs_demultiplex_thread+0x10/0x10 [cifs]\n   kthread+0x18d/0x1d0\n   ? kthread+0xdb/0x1d0\n   ? __pfx_kthread+0x10/0x10\n   ret_from_fork+0x34/0x60\n   ? __pfx_kthread+0x10/0x10\n   ret_from_fork_asm+0x1b/0x30\n   </TASK>\n\nThis fixes CVE-2023-6606.\n\nReported-by: j51569436@gmail.com\nCloses: https://bugzilla.kernel.org/show_bug.cgi?id=218218\nCc: stable@vger.kernel.org\nSigned-off-by: Paulo Alcantara (SUSE) <pc@manguebit.com>\nSigned-off-by: Steve French <stfrench@microsoft.com>",
  "full_message": "smb: client: fix OOB in smbCalcSize()\n\nValidate @smb->WordCount to avoid reading off the end of @smb and thus\ncausing the following KASAN splat:\n\n  BUG: KASAN: slab-out-of-bounds in smbCalcSize+0x32/0x40 [cifs]\n  Read of size 2 at addr ffff88801c024ec5 by task cifsd/1328\n\n  CPU: 1 PID: 1328 Comm: cifsd Not tainted 6.7.0-rc5 #9\n  Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS\n  rel-1.16.2-3-gd478f380-rebuilt.opensuse.org 04/01/2014\n  Call Trace:\n   <TASK>\n   dump_stack_lvl+0x4a/0x80\n   print_report+0xcf/0x650\n   ? srso_alias_return_thunk+0x5/0xfbef5\n   ? srso_alias_return_thunk+0x5/0xfbef5\n   ? __phys_addr+0x46/0x90\n   kasan_report+0xd8/0x110\n   ? smbCalcSize+0x32/0x40 [cifs]\n   ? smbCalcSize+0x32/0x40 [cifs]\n   kasan_check_range+0x105/0x1b0\n   smbCalcSize+0x32/0x40 [cifs]\n   checkSMB+0x162/0x370 [cifs]\n   ? __pfx_checkSMB+0x10/0x10 [cifs]\n   cifs_handle_standard+0xbc/0x2f0 [cifs]\n   ? srso_alias_return_thunk+0x5/0xfbef5\n   cifs_demultiplex_thread+0xed1/0x1360 [cifs]\n   ? __pfx_cifs_demultiplex_thread+0x10/0x10 [cifs]\n   ? srso_alias_return_thunk+0x5/0xfbef5\n   ? lockdep_hardirqs_on_prepare+0x136/0x210\n   ? __pfx_lock_release+0x10/0x10\n   ? srso_alias_return_thunk+0x5/0xfbef5\n   ? mark_held_locks+0x1a/0x90\n   ? lockdep_hardirqs_on_prepare+0x136/0x210\n   ? srso_alias_return_thunk+0x5/0xfbef5\n   ? srso_alias_return_thunk+0x5/0xfbef5\n   ? __kthread_parkme+0xce/0xf0\n   ? __pfx_cifs_demultiplex_thread+0x10/0x10 [cifs]\n   kthread+0x18d/0x1d0\n   ? kthread+0xdb/0x1d0\n   ? __pfx_kthread+0x10/0x10\n   ret_from_fork+0x34/0x60\n   ? __pfx_kthread+0x10/0x10\n   ret_from_fork_asm+0x1b/0x30\n   </TASK>\n\nThis fixes CVE-2023-6606.\n\nReported-by: j51569436@gmail.com\nCloses: https://bugzilla.kernel.org/show_bug.cgi?id=218218\nCc: stable@vger.kernel.org\nSigned-off-by: Paulo Alcantara (SUSE) <pc@manguebit.com>\nSigned-off-by: Steve French <stfrench@microsoft.com>",
  "author_name": "Paulo Alcantara",
  "author_email": "pc@manguebit.com",
  "author_date": "Fri Dec 15 19:59:14 2023 -0300",
  "author_date_iso": "2023-12-15T19:59:14-03:00",
  "committer_name": "Steve French",
  "committer_email": "stfrench@microsoft.com",
  "committer_date": "Sun Dec 17 19:02:59 2023 -0600",
  "committer_date_iso": "2023-12-17T19:02:59-06:00",
  "files_changed": [
    "fs/smb/client/misc.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "fs/smb/client/misc.c",
      "insertions": 4,
      "deletions": 0
    }
  ],
  "total_insertions": 4,
  "total_deletions": 0,
  "total_changes": 4,
  "parents": [
    "33eae65c6f49770fec7a662935d4eb4a6406d24b"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [
      "CVE-2023-6606"
    ],
    "security_keywords": []
  },
  "fix_type": "cve",
  "file_results": [
    {
      "file": "fs/smb/client/misc.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}