commit b0c3f5df92913de6b9936cb0707cf1c8cdad66a2
Author: Sean Christopherson <seanjc@google.com>
Date:   Fri Jan 10 16:50:44 2025 -0800

    KVM: selftests: Macrofy vm_get_stat() to auto-generate stat name string
    
    Turn vm_get_stat() into a macro that generates a string for the stat name,
    as opposed to taking a string.  This will allow hardening stat usage in
    the future to generate errors on unknown stats at compile time.
    
    No functional change intended.
    
    Link: https://lore.kernel.org/r/20250111005049.1247555-5-seanjc@google.com
    Signed-off-by: Sean Christopherson <seanjc@google.com>

diff --git a/tools/testing/selftests/kvm/include/kvm_util.h b/tools/testing/selftests/kvm/include/kvm_util.h
index 4c4e5a847f67..044c2231431e 100644
--- a/tools/testing/selftests/kvm/include/kvm_util.h
+++ b/tools/testing/selftests/kvm/include/kvm_util.h
@@ -534,13 +534,13 @@ void read_stat_data(int stats_fd, struct kvm_stats_header *header,
 void __vm_get_stat(struct kvm_vm *vm, const char *stat_name, uint64_t *data,
 		   size_t max_elements);
 
-static inline uint64_t vm_get_stat(struct kvm_vm *vm, const char *stat_name)
-{
-	uint64_t data;
-
-	__vm_get_stat(vm, stat_name, &data, 1);
-	return data;
-}
+#define vm_get_stat(vm, stat)				\
+({							\
+	uint64_t data;					\
+							\
+	__vm_get_stat(vm, #stat, &data, 1);		\
+	data;						\
+})
 
 void vm_create_irqchip(struct kvm_vm *vm);