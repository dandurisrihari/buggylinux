{
  "hash": "2dcfe9e2d370f6643486e327c6ae17af8887756c",
  "hash_short": "2dcfe9e2",
  "subject": "niu: Silence randstruct warnings",
  "body": "Clang randstruct gets upset when it sees struct addresspace (which is\nrandomized) being assigned to a struct page (which is not randomized):\n\ndrivers/net/ethernet/sun/niu.c:3385:12: error: casting from randomized structure pointer type 'struct address_space *' to 'struct page *'\n                        *link = (struct page *) page->mapping;\n                                ^\n\nIt looks like niu.c is looking for an in-line place to chain its allocated\npages together and is overloading the \"mapping\" member, as it is unused.\nThis is very non-standard, and is expected to be cleaned up in the\nfuture[1], but there is no \"correct\" way to handle it today.\n\nNo meaningful machine code changes result after this change, and source\nreadability is improved.\n\nDrop the randstruct exception now that there is no \"confusing\" cross-type\nassignment.\n\n[1] https://lore.kernel.org/lkml/YnqgjVoMDu5v9PNG@casper.infradead.org/\n\nCc: \"Matthew Wilcox (Oracle)\" <willy@infradead.org>\nCc: Christoph Hellwig <hch@infradead.org>\nCc: \"David S. Miller\" <davem@davemloft.net>\nCc: Jakub Kicinski <kuba@kernel.org>\nCc: Paolo Abeni <pabeni@redhat.com>\nCc: Du Cheng <ducheng2@gmail.com>\nCc: Christophe JAILLET <christophe.jaillet@wanadoo.fr>\nCc: Vlastimil Babka <vbabka@suse.cz>\nCc: William Kucharski <william.kucharski@oracle.com>\nCc: Arnd Bergmann <arnd@arndb.de>\nCc: Nathan Chancellor <nathan@kernel.org>\nCc: netdev@vger.kernel.org\nCc: linux-mm@kvack.org\nCc: linux-hardening@vger.kernel.org\nAcked-by: Jakub Kicinski <kuba@kernel.org>\nLink: https://lore.kernel.org/lkml/20220511151647.7290adbe@kernel.org\nSigned-off-by: Kees Cook <keescook@chromium.org>",
  "full_message": "niu: Silence randstruct warnings\n\nClang randstruct gets upset when it sees struct addresspace (which is\nrandomized) being assigned to a struct page (which is not randomized):\n\ndrivers/net/ethernet/sun/niu.c:3385:12: error: casting from randomized structure pointer type 'struct address_space *' to 'struct page *'\n                        *link = (struct page *) page->mapping;\n                                ^\n\nIt looks like niu.c is looking for an in-line place to chain its allocated\npages together and is overloading the \"mapping\" member, as it is unused.\nThis is very non-standard, and is expected to be cleaned up in the\nfuture[1], but there is no \"correct\" way to handle it today.\n\nNo meaningful machine code changes result after this change, and source\nreadability is improved.\n\nDrop the randstruct exception now that there is no \"confusing\" cross-type\nassignment.\n\n[1] https://lore.kernel.org/lkml/YnqgjVoMDu5v9PNG@casper.infradead.org/\n\nCc: \"Matthew Wilcox (Oracle)\" <willy@infradead.org>\nCc: Christoph Hellwig <hch@infradead.org>\nCc: \"David S. Miller\" <davem@davemloft.net>\nCc: Jakub Kicinski <kuba@kernel.org>\nCc: Paolo Abeni <pabeni@redhat.com>\nCc: Du Cheng <ducheng2@gmail.com>\nCc: Christophe JAILLET <christophe.jaillet@wanadoo.fr>\nCc: Vlastimil Babka <vbabka@suse.cz>\nCc: William Kucharski <william.kucharski@oracle.com>\nCc: Arnd Bergmann <arnd@arndb.de>\nCc: Nathan Chancellor <nathan@kernel.org>\nCc: netdev@vger.kernel.org\nCc: linux-mm@kvack.org\nCc: linux-hardening@vger.kernel.org\nAcked-by: Jakub Kicinski <kuba@kernel.org>\nLink: https://lore.kernel.org/lkml/20220511151647.7290adbe@kernel.org\nSigned-off-by: Kees Cook <keescook@chromium.org>",
  "author_name": "Kees Cook",
  "author_email": "keescook@chromium.org",
  "author_date": "Mon May 9 15:11:54 2022 -0700",
  "author_date_iso": "2022-05-09T15:11:54-07:00",
  "committer_name": "Kees Cook",
  "committer_email": "keescook@chromium.org",
  "committer_date": "Mon May 16 16:02:21 2022 -0700",
  "committer_date_iso": "2022-05-16T16:02:21-07:00",
  "files_changed": [
    "drivers/net/ethernet/sun/niu.c",
    "scripts/gcc-plugins/randomize_layout_plugin.c"
  ],
  "files_changed_count": 2,
  "stats": [
    {
      "file": "drivers/net/ethernet/sun/niu.c",
      "insertions": 31,
      "deletions": 10
    },
    {
      "file": "scripts/gcc-plugins/randomize_layout_plugin.c",
      "insertions": 0,
      "deletions": 2
    }
  ],
  "total_insertions": 31,
  "total_deletions": 12,
  "total_changes": 43,
  "parents": [
    "c1298a3a1139c9a73a188fbb153b6eb83dbd4d7d"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "hardening"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/net/ethernet/sun/niu.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "scripts/gcc-plugins/randomize_layout_plugin.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}