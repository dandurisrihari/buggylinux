Commit Hash: 696e1a48b1a1b01edad542a1ef293665864a4dd0
Subject: netfilter: nft_payload: incorrect arithmetics when fetching VLAN header bits

CVE Identifiers:
- CVE-2023-0179

Full commit message:
netfilter: nft_payload: incorrect arithmetics when fetching VLAN header bits

If the offset + length goes over the ethernet + vlan header, then the
length is adjusted to copy the bytes that are within the boundaries of
the vlan_ethhdr scratchpad area. The remaining bytes beyond ethernet +
vlan header are copied directly from the skbuff data area.

Fix incorrect arithmetic operator: subtract, not add, the size of the
vlan header in case of double-tagged packets to adjust the length
accordingly to address CVE-2023-0179.

Reported-by: Davide Ornaghi <d.ornaghi97@gmail.com>
Fixes: f6ae9f120dad ("netfilter: nft_payload: add C-VLAN support")
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>

Metadata:
Author: Pablo Neira Ayuso <pablo@netfilter.org>
Author Date: Wed Jan 11 17:07:33 2023 +0100
Committer: Pablo Neira Ayuso <pablo@netfilter.org>
Commit Date: Wed Jan 11 19:18:04 2023 +0100

Files Changed: 1
Lines Added: 1
Lines Removed: 1
Total Changes: 2
