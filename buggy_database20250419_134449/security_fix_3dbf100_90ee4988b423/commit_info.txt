Commit Hash: 3dbf100b0b10e91d65bd83b91cee3ef61f1b96c4
Subject: KVM: arm64: Abstract the size of the HYP vectors pre-amble


Security Keywords:
- hardening

Full commit message:
KVM: arm64: Abstract the size of the HYP vectors pre-amble

The EL2 vector hardening feature causes KVM to generate vectors for
each type of CPU present in the system. The generated sequences already
do some of the early guest-exit work (i.e. saving registers). To avoid
duplication the generated vectors branch to the original vector just
after the preamble. This size is hard coded.

Adding new instructions to the HYP vector causes strange side effects,
which are difficult to debug as the affected code is patched in at
runtime.

Add KVM_VECTOR_PREAMBLE to tell kvm_patch_vector_branch() how big
the preamble is. The valid_vect macro can then validate this at
build time.

Reviewed-by: Julien Thierry <julien.thierry@arm.com>
Signed-off-by: James Morse <james.morse@arm.com>
Signed-off-by: Marc Zyngier <marc.zyngier@arm.com>

Metadata:
Author: James Morse <james.morse@arm.com>
Author Date: Tue Jun 18 16:17:34 2019 +0100
Committer: Marc Zyngier <marc.zyngier@arm.com>
Commit Date: Fri Jul 5 13:03:29 2019 +0100

Files Changed: 3
Lines Added: 26
Lines Removed: 5
Total Changes: 31
