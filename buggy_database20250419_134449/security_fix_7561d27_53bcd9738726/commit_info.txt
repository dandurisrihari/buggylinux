Commit Hash: 7561d27e90fa0df0aac2a1d6b49c2a28eaae7026
Subject: xfs: buffer lru reference count error injection tag


Security Keywords:
- injection

Full commit message:
xfs: buffer lru reference count error injection tag

XFS uses a fixed reference count for certain types of buffers in the
internal LRU cache. These reference counts dictate how aggressively
certain buffers are reclaimed vs. others. While the reference counts
implements priority across different buffer types, all buffers
(other than uncached buffers) are typically cached for at least one
reclaim cycle.

We've had at least one bug recently that has been hidden by a
released buffer sitting around in the LRU. Users hitting the problem
were able to reproduce under enough memory pressure to cause
aggressive reclaim in a particular window of time.

To support future xfstests cases, add an error injection tag to
hardcode the buffer reference count to zero. When enabled, this
bypasses caching of associated buffers and facilitates test cases
that depend on this behavior.

Signed-off-by: Brian Foster <bfoster@redhat.com>
Reviewed-by: Darrick J. Wong <darrick.wong@oracle.com>
Signed-off-by: Darrick J. Wong <darrick.wong@oracle.com>

Metadata:
Author: Brian Foster <bfoster@redhat.com>
Author Date: Tue Oct 17 14:16:29 2017 -0700
Committer: Darrick J. Wong <darrick.wong@oracle.com>
Commit Date: Thu Oct 26 15:38:23 2017 -0700

Files Changed: 4
Lines Added: 23
Lines Removed: 5
Total Changes: 28
