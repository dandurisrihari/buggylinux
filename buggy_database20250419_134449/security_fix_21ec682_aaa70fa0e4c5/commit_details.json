{
  "hash": "21ec68234826b1b54ab980a8df6e33c74cfbee58",
  "hash_short": "21ec6823",
  "subject": "f2fs: fix to avoid potential panic during recovery",
  "body": "During recovery, if FAULT_BLOCK is on, it is possible that\nf2fs_reserve_new_block() will return -ENOSPC during recovery,\nthen it may trigger panic.\n\nAlso, if fault injection rate is 1 and only FAULT_BLOCK fault\ntype is on, it may encounter deadloop in loop of block reservation.\n\nLet's change as below to fix these issues:\n- remove bug_on() to avoid panic.\n- limit the loop count of block reservation to avoid potential\ndeadloop.\n\nFixes: 956fa1ddc132 (\"f2fs: fix to check return value of f2fs_reserve_new_block()\")\nReported-by: Zhiguo Niu <zhiguo.niu@unisoc.com>\nSigned-off-by: Chao Yu <chao@kernel.org>\nSigned-off-by: Jaegeuk Kim <jaegeuk@kernel.org>",
  "full_message": "f2fs: fix to avoid potential panic during recovery\n\nDuring recovery, if FAULT_BLOCK is on, it is possible that\nf2fs_reserve_new_block() will return -ENOSPC during recovery,\nthen it may trigger panic.\n\nAlso, if fault injection rate is 1 and only FAULT_BLOCK fault\ntype is on, it may encounter deadloop in loop of block reservation.\n\nLet's change as below to fix these issues:\n- remove bug_on() to avoid panic.\n- limit the loop count of block reservation to avoid potential\ndeadloop.\n\nFixes: 956fa1ddc132 (\"f2fs: fix to check return value of f2fs_reserve_new_block()\")\nReported-by: Zhiguo Niu <zhiguo.niu@unisoc.com>\nSigned-off-by: Chao Yu <chao@kernel.org>\nSigned-off-by: Jaegeuk Kim <jaegeuk@kernel.org>",
  "author_name": "Chao Yu",
  "author_email": "chao@kernel.org",
  "author_date": "Wed Jan 24 22:49:15 2024 +0800",
  "author_date_iso": "2024-01-24T22:49:15+08:00",
  "committer_name": "Jaegeuk Kim",
  "committer_email": "jaegeuk@kernel.org",
  "committer_date": "Mon Feb 5 18:58:41 2024 -0800",
  "committer_date_iso": "2024-02-05T18:58:41-08:00",
  "files_changed": [
    "fs/f2fs/f2fs.h",
    "fs/f2fs/recovery.c"
  ],
  "files_changed_count": 2,
  "stats": [
    {
      "file": "fs/f2fs/f2fs.h",
      "insertions": 5,
      "deletions": 0
    },
    {
      "file": "fs/f2fs/recovery.c",
      "insertions": 16,
      "deletions": 17
    }
  ],
  "total_insertions": 21,
  "total_deletions": 17,
  "total_changes": 38,
  "parents": [
    "8e9c1a349b5e227f687fa6f047e1a785b07371ea"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "fs/f2fs/f2fs.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "fs/f2fs/recovery.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}