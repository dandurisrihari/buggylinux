Commit Hash: 21ec68234826b1b54ab980a8df6e33c74cfbee58
Subject: f2fs: fix to avoid potential panic during recovery


Security Keywords:
- injection

Full commit message:
f2fs: fix to avoid potential panic during recovery

During recovery, if FAULT_BLOCK is on, it is possible that
f2fs_reserve_new_block() will return -ENOSPC during recovery,
then it may trigger panic.

Also, if fault injection rate is 1 and only FAULT_BLOCK fault
type is on, it may encounter deadloop in loop of block reservation.

Let's change as below to fix these issues:
- remove bug_on() to avoid panic.
- limit the loop count of block reservation to avoid potential
deadloop.

Fixes: 956fa1ddc132 ("f2fs: fix to check return value of f2fs_reserve_new_block()")
Reported-by: Zhiguo Niu <zhiguo.niu@unisoc.com>
Signed-off-by: Chao Yu <chao@kernel.org>
Signed-off-by: Jaegeuk Kim <jaegeuk@kernel.org>

Metadata:
Author: Chao Yu <chao@kernel.org>
Author Date: Wed Jan 24 22:49:15 2024 +0800
Committer: Jaegeuk Kim <jaegeuk@kernel.org>
Commit Date: Mon Feb 5 18:58:41 2024 -0800

Files Changed: 2
Lines Added: 21
Lines Removed: 17
Total Changes: 38
