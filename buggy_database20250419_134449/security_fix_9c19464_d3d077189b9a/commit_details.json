{
  "hash": "9c19464469556a0cd342fc40a24926ab46d7d243",
  "hash_short": "9c194644",
  "subject": "xfs: propagate bmap updates to rmapbt",
  "body": "When we map, unmap, or convert an extent in a file's data or attr\nfork, schedule a respective update in the rmapbt.  Previous versions\nof this patch required a 1:1 correspondence between bmap and rmap,\nbut this is no longer true as we now have ability to make interval\nqueries against the rmapbt.\n\nWe use the deferred operations code to handle redo operations\natomically and deadlock free.  This plumbs in all five rmap actions\n(map, unmap, convert extent, alloc, free); we'll use the first three\nnow for file data, and reflink will want the last two.  We also add\nan error injection site to test log recovery.\n\nFinally, we need to fix the bmap shift extent code to adjust the\nrmaps correctly.\n\nSigned-off-by: Darrick J. Wong <darrick.wong@oracle.com>\nReviewed-by: Dave Chinner <dchinner@redhat.com>\nSigned-off-by: Dave Chinner <david@fromorbit.com>",
  "full_message": "xfs: propagate bmap updates to rmapbt\n\nWhen we map, unmap, or convert an extent in a file's data or attr\nfork, schedule a respective update in the rmapbt.  Previous versions\nof this patch required a 1:1 correspondence between bmap and rmap,\nbut this is no longer true as we now have ability to make interval\nqueries against the rmapbt.\n\nWe use the deferred operations code to handle redo operations\natomically and deadlock free.  This plumbs in all five rmap actions\n(map, unmap, convert extent, alloc, free); we'll use the first three\nnow for file data, and reflink will want the last two.  We also add\nan error injection site to test log recovery.\n\nFinally, we need to fix the bmap shift extent code to adjust the\nrmaps correctly.\n\nSigned-off-by: Darrick J. Wong <darrick.wong@oracle.com>\nReviewed-by: Dave Chinner <dchinner@redhat.com>\nSigned-off-by: Dave Chinner <david@fromorbit.com>",
  "author_name": "Darrick J. Wong",
  "author_email": "darrick.wong@oracle.com",
  "author_date": "Wed Aug 3 12:16:05 2016 +1000",
  "author_date_iso": "2016-08-03T12:16:05+10:00",
  "committer_name": "Dave Chinner",
  "committer_email": "david@fromorbit.com",
  "committer_date": "Wed Aug 3 12:16:05 2016 +1000",
  "committer_date_iso": "2016-08-03T12:16:05+10:00",
  "files_changed": [
    "fs/xfs/libxfs/xfs_bmap.c",
    "fs/xfs/libxfs/xfs_rmap.c",
    "fs/xfs/libxfs/xfs_rmap.h",
    "fs/xfs/xfs_bmap_util.c",
    "fs/xfs/xfs_error.h",
    "fs/xfs/xfs_rmap_item.c",
    "fs/xfs/xfs_trans.h",
    "fs/xfs/xfs_trans_rmap.c"
  ],
  "files_changed_count": 8,
  "stats": [
    {
      "file": "fs/xfs/libxfs/xfs_bmap.c",
      "insertions": 47,
      "deletions": 8
    },
    {
      "file": "fs/xfs/libxfs/xfs_rmap.c",
      "insertions": 259,
      "deletions": 0
    },
    {
      "file": "fs/xfs/libxfs/xfs_rmap.h",
      "insertions": 24,
      "deletions": 0
    },
    {
      "file": "fs/xfs/xfs_bmap_util.c",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "fs/xfs/xfs_error.h",
      "insertions": 3,
      "deletions": 1
    },
    {
      "file": "fs/xfs/xfs_rmap_item.c",
      "insertions": 55,
      "deletions": 2
    },
    {
      "file": "fs/xfs/xfs_trans.h",
      "insertions": 2,
      "deletions": 1
    },
    {
      "file": "fs/xfs/xfs_trans_rmap.c",
      "insertions": 9,
      "deletions": 4
    }
  ],
  "total_insertions": 400,
  "total_deletions": 16,
  "total_changes": 416,
  "parents": [
    "f8dbebef98f0b960a0e91d6b8d45c288c377797b"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.10",
    "v4.10-rc1",
    "v4.10-rc2",
    "v4.10-rc3",
    "v4.10-rc4",
    "v4.10-rc5",
    "v4.10-rc6",
    "v4.10-rc7",
    "v4.10-rc8",
    "v4.11"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "fs/xfs/libxfs/xfs_rmap.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "fs/xfs/xfs_rmap_item.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "fs/xfs/xfs_trans.h",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "fs/xfs/xfs_bmap_util.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "fs/xfs/libxfs/xfs_rmap.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "fs/xfs/xfs_error.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "fs/xfs/xfs_trans_rmap.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "fs/xfs/libxfs/xfs_bmap.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}