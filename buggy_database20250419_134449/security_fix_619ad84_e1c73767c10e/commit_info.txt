Commit Hash: 619ad846fc3452adaf71ca246c5aa711e2055398
Subject: KVM: nSVM: clear events pending from svm_complete_interrupts() when exiting to L1


Security Keywords:
- injection

Full commit message:
KVM: nSVM: clear events pending from svm_complete_interrupts() when exiting to L1

kvm-unit-tests' eventinj "NMI failing on IDT" test results in NMI being
delivered to the host (L1) when it's running nested. The problem seems to
be: svm_complete_interrupts() raises 'nmi_injected' flag but later we
decide to reflect EXIT_NPF to L1. The flag remains pending and we do NMI
injection upon entry so it got delivered to L1 instead of L2.

It seems that VMX code solves the same issue in prepare_vmcs12(), this was
introduced with code refactoring in commit 5f3d5799974b ("KVM: nVMX: Rework
event injection and recovery").

Signed-off-by: Vitaly Kuznetsov <vkuznets@redhat.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

Metadata:
Author: Vitaly Kuznetsov <vkuznets@redhat.com>
Author Date: Mon Jan 7 19:44:51 2019 +0100
Committer: Paolo Bonzini <pbonzini@redhat.com>
Commit Date: Fri Jan 25 19:11:35 2019 +0100

Files Changed: 1
Lines Added: 8
Lines Removed: 0
Total Changes: 8
