{
  "hash": "619ad846fc3452adaf71ca246c5aa711e2055398",
  "hash_short": "619ad846",
  "subject": "KVM: nSVM: clear events pending from svm_complete_interrupts() when exiting to L1",
  "body": "kvm-unit-tests' eventinj \"NMI failing on IDT\" test results in NMI being\ndelivered to the host (L1) when it's running nested. The problem seems to\nbe: svm_complete_interrupts() raises 'nmi_injected' flag but later we\ndecide to reflect EXIT_NPF to L1. The flag remains pending and we do NMI\ninjection upon entry so it got delivered to L1 instead of L2.\n\nIt seems that VMX code solves the same issue in prepare_vmcs12(), this was\nintroduced with code refactoring in commit 5f3d5799974b (\"KVM: nVMX: Rework\nevent injection and recovery\").\n\nSigned-off-by: Vitaly Kuznetsov <vkuznets@redhat.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "full_message": "KVM: nSVM: clear events pending from svm_complete_interrupts() when exiting to L1\n\nkvm-unit-tests' eventinj \"NMI failing on IDT\" test results in NMI being\ndelivered to the host (L1) when it's running nested. The problem seems to\nbe: svm_complete_interrupts() raises 'nmi_injected' flag but later we\ndecide to reflect EXIT_NPF to L1. The flag remains pending and we do NMI\ninjection upon entry so it got delivered to L1 instead of L2.\n\nIt seems that VMX code solves the same issue in prepare_vmcs12(), this was\nintroduced with code refactoring in commit 5f3d5799974b (\"KVM: nVMX: Rework\nevent injection and recovery\").\n\nSigned-off-by: Vitaly Kuznetsov <vkuznets@redhat.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "author_name": "Vitaly Kuznetsov",
  "author_email": "vkuznets@redhat.com",
  "author_date": "Mon Jan 7 19:44:51 2019 +0100",
  "author_date_iso": "2019-01-07T19:44:51+01:00",
  "committer_name": "Paolo Bonzini",
  "committer_email": "pbonzini@redhat.com",
  "committer_date": "Fri Jan 25 19:11:35 2019 +0100",
  "committer_date_iso": "2019-01-25T19:11:35+01:00",
  "files_changed": [
    "arch/x86/kvm/svm.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "arch/x86/kvm/svm.c",
      "insertions": 8,
      "deletions": 0
    }
  ],
  "total_insertions": 8,
  "total_deletions": 0,
  "total_changes": 8,
  "parents": [
    "bb218fbcfaaa3b115d4cd7a43c0ca164f3a96e57"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v5.0",
    "v5.0-rc4",
    "v5.0-rc5",
    "v5.0-rc6",
    "v5.0-rc7",
    "v5.0-rc8",
    "v5.1",
    "v5.1-rc1",
    "v5.1-rc2",
    "v5.1-rc3"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/x86/kvm/svm.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}