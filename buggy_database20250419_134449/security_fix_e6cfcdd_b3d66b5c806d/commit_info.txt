Commit Hash: e6cfcdda8cbe81eaf821c897369a65fec987b404
Subject: x86/bugs: Enable STIBP for IBPB mitigated RETBleed


Security Keywords:
- vulnerability

Full commit message:
x86/bugs: Enable STIBP for IBPB mitigated RETBleed

AMD's "Technical Guidance for Mitigating Branch Type Confusion,
Rev. 1.0 2022-07-12" whitepaper, under section 6.1.2 "IBPB On
Privileged Mode Entry / SMT Safety" says:

  Similar to the Jmp2Ret mitigation, if the code on the sibling thread
  cannot be trusted, software should set STIBP to 1 or disable SMT to
  ensure SMT safety when using this mitigation.

So, like already being done for retbleed=unret, and now also for
retbleed=ibpb, force STIBP on machines that have it, and report its SMT
vulnerability status accordingly.

 [ bp: Remove the "we" and remove "[AMD]" applicability parameter which
   doesn't work here. ]

Fixes: 3ebc17006888 ("x86/bugs: Add retbleed=ibpb")
Signed-off-by: Kim Phillips <kim.phillips@amd.com>
Signed-off-by: Borislav Petkov <bp@suse.de>
Cc: stable@vger.kernel.org # 5.10, 5.15, 5.19
Link: https://bugzilla.kernel.org/show_bug.cgi?id=206537
Link: https://lore.kernel.org/r/20220804192201.439596-1-kim.phillips@amd.com

Metadata:
Author: Kim Phillips <kim.phillips@amd.com>
Author Date: Mon Aug 8 09:32:33 2022 -0500
Committer: Borislav Petkov <bp@suse.de>
Commit Date: Mon Aug 8 19:12:17 2022 +0200

Files Changed: 2
Lines Added: 27
Lines Removed: 12
Total Changes: 39
