{
  "hash": "0005e01e1e875c5e27130c5e2ed0189749d1e08a",
  "hash_short": "0005e01e",
  "subject": "erofs: fix out-of-bound access when z_erofs_gbuf_growsize() partially fails",
  "body": "If z_erofs_gbuf_growsize() partially fails on a global buffer due to\nmemory allocation failure or fault injection (as reported by syzbot [1]),\nnew pages need to be freed by comparing to the existing pages to avoid\nmemory leaks.\n\nHowever, the old gbuf->pages[] array may not be large enough, which can\nlead to null-ptr-deref or out-of-bound access.\n\nFix this by checking against gbuf->nrpages in advance.\n\n[1] https://lore.kernel.org/r/000000000000f7b96e062018c6e3@google.com\n\nReported-by: syzbot+242ee56aaa9585553766@syzkaller.appspotmail.com\nFixes: d6db47e571dc (\"erofs: do not use pagepool in z_erofs_gbuf_growsize()\")\nCc: <stable@vger.kernel.org> # 6.10+\nReviewed-by: Chunhai Guo <guochunhai@vivo.com>\nReviewed-by: Sandeep Dhavale <dhavale@google.com>\nSigned-off-by: Gao Xiang <hsiangkao@linux.alibaba.com>\nLink: https://lore.kernel.org/r/20240820085619.1375963-1-hsiangkao@linux.alibaba.com",
  "full_message": "erofs: fix out-of-bound access when z_erofs_gbuf_growsize() partially fails\n\nIf z_erofs_gbuf_growsize() partially fails on a global buffer due to\nmemory allocation failure or fault injection (as reported by syzbot [1]),\nnew pages need to be freed by comparing to the existing pages to avoid\nmemory leaks.\n\nHowever, the old gbuf->pages[] array may not be large enough, which can\nlead to null-ptr-deref or out-of-bound access.\n\nFix this by checking against gbuf->nrpages in advance.\n\n[1] https://lore.kernel.org/r/000000000000f7b96e062018c6e3@google.com\n\nReported-by: syzbot+242ee56aaa9585553766@syzkaller.appspotmail.com\nFixes: d6db47e571dc (\"erofs: do not use pagepool in z_erofs_gbuf_growsize()\")\nCc: <stable@vger.kernel.org> # 6.10+\nReviewed-by: Chunhai Guo <guochunhai@vivo.com>\nReviewed-by: Sandeep Dhavale <dhavale@google.com>\nSigned-off-by: Gao Xiang <hsiangkao@linux.alibaba.com>\nLink: https://lore.kernel.org/r/20240820085619.1375963-1-hsiangkao@linux.alibaba.com",
  "author_name": "Gao Xiang",
  "author_email": "hsiangkao@linux.alibaba.com",
  "author_date": "Tue Aug 20 16:56:19 2024 +0800",
  "author_date_iso": "2024-08-20T16:56:19+08:00",
  "committer_name": "Gao Xiang",
  "committer_email": "hsiangkao@linux.alibaba.com",
  "committer_date": "Wed Aug 21 08:12:05 2024 +0800",
  "committer_date_iso": "2024-08-21T08:12:05+08:00",
  "files_changed": [
    "fs/erofs/zutil.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "fs/erofs/zutil.c",
      "insertions": 2,
      "deletions": 1
    }
  ],
  "total_insertions": 2,
  "total_deletions": 1,
  "total_changes": 3,
  "parents": [
    "e080a26725fb36f535f22ea42694c60ab005fb2e"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "fs/erofs/zutil.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}