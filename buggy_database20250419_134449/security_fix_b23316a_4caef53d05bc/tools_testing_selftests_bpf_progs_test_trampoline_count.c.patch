commit b23316aabffa835ecc516cb81daeef5b9155e8a5
Author: Yuntao Wang <ytcoode@gmail.com>
Date:   Thu May 19 23:06:10 2022 +0800

    selftests/bpf: Add missing trampoline program type to trampoline_count test
    
    Currently the trampoline_count test doesn't include any fmod_ret bpf
    programs, fix it to make the test cover all possible trampoline program
    types.
    
    Since fmod_ret bpf programs can't be attached to __set_task_comm function,
    as it's neither whitelisted for error injection nor a security hook, change
    it to bpf_modify_return_test.
    
    This patch also does some other cleanups such as removing duplicate code,
    dropping inconsistent comments, etc.
    
    Signed-off-by: Yuntao Wang <ytcoode@gmail.com>
    Signed-off-by: Andrii Nakryiko <andrii@kernel.org>
    Acked-by: Yonghong Song <yhs@fb.com>
    Link: https://lore.kernel.org/bpf/20220519150610.601313-1-ytcoode@gmail.com

diff --git a/tools/testing/selftests/bpf/progs/test_trampoline_count.c b/tools/testing/selftests/bpf/progs/test_trampoline_count.c
index f030e469d05b..7765720da7d5 100644
--- a/tools/testing/selftests/bpf/progs/test_trampoline_count.c
+++ b/tools/testing/selftests/bpf/progs/test_trampoline_count.c
@@ -1,20 +1,22 @@
 // SPDX-License-Identifier: GPL-2.0
-#include <stdbool.h>
-#include <stddef.h>
 #include <linux/bpf.h>
 #include <bpf/bpf_helpers.h>
 #include <bpf/bpf_tracing.h>
 
-struct task_struct;
+SEC("fentry/bpf_modify_return_test")
+int BPF_PROG(fentry_test, int a, int *b)
+{
+	return 0;
+}
 
-SEC("fentry/__set_task_comm")
-int BPF_PROG(prog1, struct task_struct *tsk, const char *buf, bool exec)
+SEC("fmod_ret/bpf_modify_return_test")
+int BPF_PROG(fmod_ret_test, int a, int *b, int ret)
 {
 	return 0;
 }
 
-SEC("fexit/__set_task_comm")
-int BPF_PROG(prog2, struct task_struct *tsk, const char *buf, bool exec)
+SEC("fexit/bpf_modify_return_test")
+int BPF_PROG(fexit_test, int a, int *b, int ret)
 {
 	return 0;
 }