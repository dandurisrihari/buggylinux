{
  "hash": "f331601c65ad217a5c000ce20c26266d3f0aceb3",
  "hash_short": "f331601c",
  "subject": "KVM: x86/pmu: Don't generate PEBS records for emulated instructions",
  "body": "KVM will accumulate an enabled counter for at least INSTRUCTIONS or\nBRANCH_INSTRUCTION hw event from any KVM emulated instructions,\ngenerating emulated overflow interrupt on counter overflow, which\nin theory should also happen when the PEBS counter overflows but\nit currently lacks this part of the underlying support (e.g. through\nsoftware injection of records in the irq context or a lazy approach).\n\nIn this case, KVM skips the injection of this BUFFER_OVF PMI (effectively\ndropping one PEBS record) and let the overflow counter move on. The loss\nof a single sample does not introduce a loss of accuracy, but is easily\nnoticeable for certain specific instructions.\n\nThis issue is expected to be addressed along with the issue\nof PEBS cross-mapped counters with a slow-path proposal.\n\nFixes: 79f3e3b58386 (\"KVM: x86/pmu: Reprogram PEBS event to emulate guest PEBS counter\")\nSigned-off-by: Like Xu <likexu@tencent.com>\nLink: https://lore.kernel.org/r/20220831085328.45489-3-likexu@tencent.com\nSigned-off-by: Sean Christopherson <seanjc@google.com>",
  "full_message": "KVM: x86/pmu: Don't generate PEBS records for emulated instructions\n\nKVM will accumulate an enabled counter for at least INSTRUCTIONS or\nBRANCH_INSTRUCTION hw event from any KVM emulated instructions,\ngenerating emulated overflow interrupt on counter overflow, which\nin theory should also happen when the PEBS counter overflows but\nit currently lacks this part of the underlying support (e.g. through\nsoftware injection of records in the irq context or a lazy approach).\n\nIn this case, KVM skips the injection of this BUFFER_OVF PMI (effectively\ndropping one PEBS record) and let the overflow counter move on. The loss\nof a single sample does not introduce a loss of accuracy, but is easily\nnoticeable for certain specific instructions.\n\nThis issue is expected to be addressed along with the issue\nof PEBS cross-mapped counters with a slow-path proposal.\n\nFixes: 79f3e3b58386 (\"KVM: x86/pmu: Reprogram PEBS event to emulate guest PEBS counter\")\nSigned-off-by: Like Xu <likexu@tencent.com>\nLink: https://lore.kernel.org/r/20220831085328.45489-3-likexu@tencent.com\nSigned-off-by: Sean Christopherson <seanjc@google.com>",
  "author_name": "Like Xu",
  "author_email": "likexu@tencent.com",
  "author_date": "Wed Aug 31 16:53:23 2022 +0800",
  "author_date_iso": "2022-08-31T16:53:23+08:00",
  "committer_name": "Sean Christopherson",
  "committer_email": "seanjc@google.com",
  "committer_date": "Wed Sep 28 12:47:21 2022 -0700",
  "committer_date_iso": "2022-09-28T12:47:21-07:00",
  "files_changed": [
    "arch/x86/kvm/pmu.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "arch/x86/kvm/pmu.c",
      "insertions": 13,
      "deletions": 3
    }
  ],
  "total_insertions": 13,
  "total_deletions": 3,
  "total_changes": 16,
  "parents": [
    "c23981df6642eec1da94a8125ec0ec402f7b1b7b"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/x86/kvm/pmu.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}