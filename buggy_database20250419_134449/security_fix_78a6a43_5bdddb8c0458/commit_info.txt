Commit Hash: 78a6a43aaf87180ec7425a2a90468e1b4d09a1ec
Subject: wifi: mac80211: mlme: fix null-ptr deref on failed assoc


Security Keywords:
- authentication

Full commit message:
wifi: mac80211: mlme: fix null-ptr deref on failed assoc

If association to an AP without a link 0 fails, then we crash in
tracing because it assumes that either ap_mld_addr or link 0 BSS
is valid, since we clear sdata->vif.valid_links and then don't
add the ap_mld_addr to the struct.

Since we clear also sdata->vif.cfg.ap_addr, keep a local copy of
it and assign it earlier, before clearing valid_links, to fix
this.

Fixes: 81151ce462e5 ("wifi: mac80211: support MLO authentication/association with one link")
Signed-off-by: Johannes Berg <johannes.berg@intel.com>

Metadata:
Author: Johannes Berg <johannes.berg@intel.com>
Author Date: Wed Sep 21 02:44:58 2022 +0200
Committer: Johannes Berg <johannes.berg@intel.com>
Commit Date: Fri Oct 7 15:24:16 2022 +0200

Files Changed: 1
Lines Added: 6
Lines Removed: 2
Total Changes: 8
