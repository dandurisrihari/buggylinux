Commit Hash: ef2e78ddadbb939ce79553b10dee0131d65d8f3e
Subject: KVM: arm64: Opportunistically turn off WFI trapping when using direct LPI injection


Security Keywords:
- injection

Full commit message:
KVM: arm64: Opportunistically turn off WFI trapping when using direct LPI injection

Just like we do for WFE trapping, it can be useful to turn off
WFI trapping when the physical CPU is not oversubscribed (that
is, the vcpu is the only runnable process on this CPU) *and*
that we're using direct injection of interrupts.

The conditions are reevaluated on each vcpu_load(), ensuring that
we don't switch to this mode on a busy system.

On a GICv4 system, this has the effect of reducing the generation
of doorbell interrupts to zero when the right conditions are
met, which is a huge improvement over the current situation
(where the doorbells are screaming if the CPU ever hits a
blocking WFI).

Signed-off-by: Marc Zyngier <maz@kernel.org>
Reviewed-by: Zenghui Yu <yuzenghui@huawei.com>
Reviewed-by: Christoffer Dall <christoffer.dall@arm.com>
Link: https://lore.kernel.org/r/20191107160412.30301-3-maz@kernel.org

Metadata:
Author: Marc Zyngier <maz@kernel.org>
Author Date: Thu Nov 7 16:04:12 2019 +0000
Committer: Marc Zyngier <maz@kernel.org>
Commit Date: Fri Nov 8 11:14:36 2019 +0000

Files Changed: 3
Lines Added: 11
Lines Removed: 6
Total Changes: 17
