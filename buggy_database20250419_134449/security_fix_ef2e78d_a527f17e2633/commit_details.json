{
  "hash": "ef2e78ddadbb939ce79553b10dee0131d65d8f3e",
  "hash_short": "ef2e78dd",
  "subject": "KVM: arm64: Opportunistically turn off WFI trapping when using direct LPI injection",
  "body": "Just like we do for WFE trapping, it can be useful to turn off\nWFI trapping when the physical CPU is not oversubscribed (that\nis, the vcpu is the only runnable process on this CPU) *and*\nthat we're using direct injection of interrupts.\n\nThe conditions are reevaluated on each vcpu_load(), ensuring that\nwe don't switch to this mode on a busy system.\n\nOn a GICv4 system, this has the effect of reducing the generation\nof doorbell interrupts to zero when the right conditions are\nmet, which is a huge improvement over the current situation\n(where the doorbells are screaming if the CPU ever hits a\nblocking WFI).\n\nSigned-off-by: Marc Zyngier <maz@kernel.org>\nReviewed-by: Zenghui Yu <yuzenghui@huawei.com>\nReviewed-by: Christoffer Dall <christoffer.dall@arm.com>\nLink: https://lore.kernel.org/r/20191107160412.30301-3-maz@kernel.org",
  "full_message": "KVM: arm64: Opportunistically turn off WFI trapping when using direct LPI injection\n\nJust like we do for WFE trapping, it can be useful to turn off\nWFI trapping when the physical CPU is not oversubscribed (that\nis, the vcpu is the only runnable process on this CPU) *and*\nthat we're using direct injection of interrupts.\n\nThe conditions are reevaluated on each vcpu_load(), ensuring that\nwe don't switch to this mode on a busy system.\n\nOn a GICv4 system, this has the effect of reducing the generation\nof doorbell interrupts to zero when the right conditions are\nmet, which is a huge improvement over the current situation\n(where the doorbells are screaming if the CPU ever hits a\nblocking WFI).\n\nSigned-off-by: Marc Zyngier <maz@kernel.org>\nReviewed-by: Zenghui Yu <yuzenghui@huawei.com>\nReviewed-by: Christoffer Dall <christoffer.dall@arm.com>\nLink: https://lore.kernel.org/r/20191107160412.30301-3-maz@kernel.org",
  "author_name": "Marc Zyngier",
  "author_email": "maz@kernel.org",
  "author_date": "Thu Nov 7 16:04:12 2019 +0000",
  "author_date_iso": "2019-11-07T16:04:12+00:00",
  "committer_name": "Marc Zyngier",
  "committer_email": "maz@kernel.org",
  "committer_date": "Fri Nov 8 11:14:36 2019 +0000",
  "committer_date_iso": "2019-11-08T11:14:36+00:00",
  "files_changed": [
    "arch/arm/include/asm/kvm_emulate.h",
    "arch/arm64/include/asm/kvm_emulate.h",
    "virt/kvm/arm/arm.c"
  ],
  "files_changed_count": 3,
  "stats": [
    {
      "file": "arch/arm/include/asm/kvm_emulate.h",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "arch/arm64/include/asm/kvm_emulate.h",
      "insertions": 7,
      "deletions": 2
    },
    {
      "file": "virt/kvm/arm/arm.c",
      "insertions": 2,
      "deletions": 2
    }
  ],
  "total_insertions": 11,
  "total_deletions": 6,
  "total_changes": 17,
  "parents": [
    "5bd90b0989731520f2cdcfbbe467f1271f3cc803"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v5.5",
    "v5.5-rc1",
    "v5.5-rc2",
    "v5.5-rc3",
    "v5.5-rc4",
    "v5.5-rc5",
    "v5.5-rc6",
    "v5.5-rc7",
    "v5.6",
    "v5.6-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/arm/include/asm/kvm_emulate.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/arm64/include/asm/kvm_emulate.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "virt/kvm/arm/arm.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}