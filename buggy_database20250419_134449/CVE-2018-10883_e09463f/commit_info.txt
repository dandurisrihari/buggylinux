Commit Hash: e09463f220ca9a1a1ecfda84fcda658f99a1f12a
Subject: jbd2: don't mark block as modified if the handle is out of credits

CVE Identifiers:
- CVE-2018-10883

Full commit message:
jbd2: don't mark block as modified if the handle is out of credits

Do not set the b_modified flag in block's journal head should not
until after we're sure that jbd2_journal_dirty_metadat() will not
abort with an error due to there not being enough space reserved in
the jbd2 handle.

Otherwise, future attempts to modify the buffer may lead a large
number of spurious errors and warnings.

This addresses CVE-2018-10883.

https://bugzilla.kernel.org/show_bug.cgi?id=200071

Signed-off-by: Theodore Ts'o <tytso@mit.edu>
Cc: stable@kernel.org

Metadata:
Author: Theodore Ts'o <tytso@mit.edu>
Author Date: Sat Jun 16 20:21:45 2018 -0400
Committer: Theodore Ts'o <tytso@mit.edu>
Commit Date: Sat Jun 16 20:21:45 2018 -0400

Files Changed: 1
Lines Added: 8
Lines Removed: 1
Total Changes: 9
