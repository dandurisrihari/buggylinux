{
  "hash": "5f1bc39979d868a0358c683864bec3fc8395440b",
  "hash_short": "5f1bc399",
  "subject": "SUNRPC: Fix buffer handling of GSS MIC without slack",
  "body": "The GSS Message Integrity Check data for krb5i may lie partially in the XDR\nreply buffer's pages and tail.  If so, we try to copy the entire MIC into\nfree space in the tail.  But as the estimations of the slack space required\nfor authentication and verification have improved there may be less free\nspace in the tail to complete this copy -- see commit 2c94b8eca1a2\n(\"SUNRPC: Use au_rslack when computing reply buffer size\").  In fact, there\nmay only be room in the tail for a single copy of the MIC, and not part of\nthe MIC and then another complete copy.\n\nThe real world failure reported is that `ls` of a directory on NFS may\nsometimes return -EIO, which can be traced back to xdr_buf_read_netobj()\nfailing to find available free space in the tail to copy the MIC.\n\nFix this by checking for the case of the MIC crossing the boundaries of\nhead, pages, and tail. If so, shift the buffer until the MIC is contained\ncompletely within the pages or tail.  This allows the remainder of the\nfunction to create a sub buffer that directly address the complete MIC.\n\nSigned-off-by: Benjamin Coddington <bcodding@redhat.com>\nCc: stable@vger.kernel.org # v5.1\nReviewed-by: Chuck Lever <chuck.lever@oracle.com>\nSigned-off-by: Anna Schumaker <Anna.Schumaker@Netapp.com>",
  "full_message": "SUNRPC: Fix buffer handling of GSS MIC without slack\n\nThe GSS Message Integrity Check data for krb5i may lie partially in the XDR\nreply buffer's pages and tail.  If so, we try to copy the entire MIC into\nfree space in the tail.  But as the estimations of the slack space required\nfor authentication and verification have improved there may be less free\nspace in the tail to complete this copy -- see commit 2c94b8eca1a2\n(\"SUNRPC: Use au_rslack when computing reply buffer size\").  In fact, there\nmay only be room in the tail for a single copy of the MIC, and not part of\nthe MIC and then another complete copy.\n\nThe real world failure reported is that `ls` of a directory on NFS may\nsometimes return -EIO, which can be traced back to xdr_buf_read_netobj()\nfailing to find available free space in the tail to copy the MIC.\n\nFix this by checking for the case of the MIC crossing the boundaries of\nhead, pages, and tail. If so, shift the buffer until the MIC is contained\ncompletely within the pages or tail.  This allows the remainder of the\nfunction to create a sub buffer that directly address the complete MIC.\n\nSigned-off-by: Benjamin Coddington <bcodding@redhat.com>\nCc: stable@vger.kernel.org # v5.1\nReviewed-by: Chuck Lever <chuck.lever@oracle.com>\nSigned-off-by: Anna Schumaker <Anna.Schumaker@Netapp.com>",
  "author_name": "Benjamin Coddington",
  "author_email": "bcodding@redhat.com",
  "author_date": "Mon Sep 16 07:59:37 2019 -0400",
  "author_date_iso": "2019-09-16T07:59:37-04:00",
  "committer_name": "Anna Schumaker",
  "committer_email": "Anna.Schumaker@Netapp.com",
  "committer_date": "Fri Sep 20 15:15:24 2019 -0400",
  "committer_date_iso": "2019-09-20T15:15:24-04:00",
  "files_changed": [
    "net/sunrpc/xdr.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "net/sunrpc/xdr.c",
      "insertions": 18,
      "deletions": 9
    }
  ],
  "total_insertions": 18,
  "total_deletions": 9,
  "total_changes": 27,
  "parents": [
    "714fbc73888f59321854e7f6c2f224213923bcad"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v5.4",
    "v5.4-rc1",
    "v5.4-rc2",
    "v5.4-rc3",
    "v5.4-rc4",
    "v5.4-rc5",
    "v5.4-rc6",
    "v5.4-rc7",
    "v5.4-rc8",
    "v5.5"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "authentication"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "net/sunrpc/xdr.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}