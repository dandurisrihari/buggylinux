Commit Hash: 8dacc7da69a491c515851e68de6036f21b5663ce
Subject: libceph: replace connection state bits with states


Security Keywords:
- injection

Full commit message:
libceph: replace connection state bits with states

Use a simple set of 6 enumerated values for the socket states (CON_STATE_*)
and use those instead of the state bits.  All of the con->state checks are
now under the protection of the con mutex, so this is safe.  It also
simplifies many of the state checks because we can check for anything other
than the expected state instead of various bits for races we can think of.

This appears to hold up well to stress testing both with and without socket
failure injection on the server side.

Signed-off-by: Sage Weil <sage@inktank.com>

Metadata:
Author: Sage Weil <sage@inktank.com>
Author Date: Fri Jul 20 17:24:40 2012 -0700
Committer: Sage Weil <sage@inktank.com>
Commit Date: Mon Jul 30 18:16:00 2012 -0700

Files Changed: 2
Lines Added: 68
Lines Removed: 74
Total Changes: 142
