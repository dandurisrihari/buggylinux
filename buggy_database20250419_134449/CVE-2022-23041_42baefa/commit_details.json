{
  "hash": "42baefac638f06314298087394b982ead9ec444b",
  "hash_short": "42baefac",
  "subject": "xen/gnttab: fix gnttab_end_foreign_access() without page specified",
  "body": "gnttab_end_foreign_access() is used to free a grant reference and\noptionally to free the associated page. In case the grant is still in\nuse by the other side processing is being deferred. This leads to a\nproblem in case no page to be freed is specified by the caller: the\ncaller doesn't know that the page is still mapped by the other side\nand thus should not be used for other purposes.\n\nThe correct way to handle this situation is to take an additional\nreference to the granted page in case handling is being deferred and\nto drop that reference when the grant reference could be freed\nfinally.\n\nThis requires that there are no users of gnttab_end_foreign_access()\nleft directly repurposing the granted page after the call, as this\nmight result in clobbered data or information leaks via the not yet\nfreed grant reference.\n\nThis is part of CVE-2022-23041 / XSA-396.\n\nReported-by: Simon Gaiser <simon@invisiblethingslab.com>\nSigned-off-by: Juergen Gross <jgross@suse.com>\nReviewed-by: Jan Beulich <jbeulich@suse.com>\n---\nV4:\n- expand comment in header\nV5:\n- get page ref in case of kmalloc() failure, too",
  "full_message": "xen/gnttab: fix gnttab_end_foreign_access() without page specified\n\ngnttab_end_foreign_access() is used to free a grant reference and\noptionally to free the associated page. In case the grant is still in\nuse by the other side processing is being deferred. This leads to a\nproblem in case no page to be freed is specified by the caller: the\ncaller doesn't know that the page is still mapped by the other side\nand thus should not be used for other purposes.\n\nThe correct way to handle this situation is to take an additional\nreference to the granted page in case handling is being deferred and\nto drop that reference when the grant reference could be freed\nfinally.\n\nThis requires that there are no users of gnttab_end_foreign_access()\nleft directly repurposing the granted page after the call, as this\nmight result in clobbered data or information leaks via the not yet\nfreed grant reference.\n\nThis is part of CVE-2022-23041 / XSA-396.\n\nReported-by: Simon Gaiser <simon@invisiblethingslab.com>\nSigned-off-by: Juergen Gross <jgross@suse.com>\nReviewed-by: Jan Beulich <jbeulich@suse.com>\n---\nV4:\n- expand comment in header\nV5:\n- get page ref in case of kmalloc() failure, too",
  "author_name": "Juergen Gross",
  "author_email": "jgross@suse.com",
  "author_date": "Mon Mar 7 09:48:55 2022 +0100",
  "author_date_iso": "2022-03-07T09:48:55+01:00",
  "committer_name": "Juergen Gross",
  "committer_email": "jgross@suse.com",
  "committer_date": "Mon Mar 7 09:48:55 2022 +0100",
  "committer_date_iso": "2022-03-07T09:48:55+01:00",
  "files_changed": [
    "drivers/xen/grant-table.c",
    "include/xen/grant_table.h"
  ],
  "files_changed_count": 2,
  "stats": [
    {
      "file": "drivers/xen/grant-table.c",
      "insertions": 29,
      "deletions": 7
    },
    {
      "file": "include/xen/grant_table.h",
      "insertions": 6,
      "deletions": 1
    }
  ],
  "total_insertions": 35,
  "total_deletions": 8,
  "total_changes": 43,
  "parents": [
    "b0576cc9c6b843d99c6982888d59a56209341888"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [
      "CVE-2022-23041"
    ],
    "security_keywords": []
  },
  "fix_type": "cve",
  "file_results": [
    {
      "file": "drivers/xen/grant-table.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/xen/grant_table.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}