{
  "hash": "b5daffb120bb60f974ae1a5589160b05c98e00e5",
  "hash_short": "b5daffb1",
  "subject": "KVM: arm64: vgic-v3: Optimize affinity-based SGI injection",
  "body": "Our affinity-based SGI injection code is a bit daft. We iterate\nover all the CPUs trying to match the set of affinities that the\nguest is trying to reach, leading to some very bad behaviours\nif the selected targets are at a high vcpu index.\n\nInstead, we can now use the fact that we have an optimised\nMPIDR to vcpu mapping, and only look at the relevant values.\n\nThis results in a much faster injection for large VMs, and\nin a near constant time, irrespective of the position in the\nvcpu index space.\n\nAs a bonus, this is mostly deleting a lot of hard-to-read\ncode. Nobody will complain about that.\n\nSuggested-by: Xu Zhao <zhaoxu.35@bytedance.com>\nTested-by: Joey Gouly <joey.gouly@arm.com>\nTested-by: Shameer Kolothum <shameerali.kolothum.thodi@huawei.com>\nReviewed-by: Zenghui Yu <yuzenghui@huawei.com>\nSigned-off-by: Marc Zyngier <maz@kernel.org>\nLink: https://lore.kernel.org/r/20230927090911.3355209-11-maz@kernel.org\nSigned-off-by: Oliver Upton <oliver.upton@linux.dev>",
  "full_message": "KVM: arm64: vgic-v3: Optimize affinity-based SGI injection\n\nOur affinity-based SGI injection code is a bit daft. We iterate\nover all the CPUs trying to match the set of affinities that the\nguest is trying to reach, leading to some very bad behaviours\nif the selected targets are at a high vcpu index.\n\nInstead, we can now use the fact that we have an optimised\nMPIDR to vcpu mapping, and only look at the relevant values.\n\nThis results in a much faster injection for large VMs, and\nin a near constant time, irrespective of the position in the\nvcpu index space.\n\nAs a bonus, this is mostly deleting a lot of hard-to-read\ncode. Nobody will complain about that.\n\nSuggested-by: Xu Zhao <zhaoxu.35@bytedance.com>\nTested-by: Joey Gouly <joey.gouly@arm.com>\nTested-by: Shameer Kolothum <shameerali.kolothum.thodi@huawei.com>\nReviewed-by: Zenghui Yu <yuzenghui@huawei.com>\nSigned-off-by: Marc Zyngier <maz@kernel.org>\nLink: https://lore.kernel.org/r/20230927090911.3355209-11-maz@kernel.org\nSigned-off-by: Oliver Upton <oliver.upton@linux.dev>",
  "author_name": "Marc Zyngier",
  "author_email": "maz@kernel.org",
  "author_date": "Wed Sep 27 10:09:10 2023 +0100",
  "author_date_iso": "2023-09-27T10:09:10+01:00",
  "committer_name": "Oliver Upton",
  "committer_email": "oliver.upton@linux.dev",
  "committer_date": "Sat Sep 30 18:15:44 2023 +0000",
  "committer_date_iso": "2023-09-30T18:15:44+00:00",
  "files_changed": [
    "arch/arm64/kvm/vgic/vgic-mmio-v3.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "arch/arm64/kvm/vgic/vgic-mmio-v3.c",
      "insertions": 11,
      "deletions": 53
    }
  ],
  "total_insertions": 11,
  "total_deletions": 53,
  "total_changes": 64,
  "parents": [
    "54a8006d0b49044d0cb682119686a45de906fe3c"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/arm64/kvm/vgic/vgic-mmio-v3.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}