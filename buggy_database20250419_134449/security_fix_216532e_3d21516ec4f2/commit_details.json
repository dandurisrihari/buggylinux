{
  "hash": "216532e147b2fee6ee830f4a844bbc3cbb9137af",
  "hash_short": "216532e1",
  "subject": "Merge tag 'hardening-v6.9-rc1' of git://git.kernel.org/pub/scm/linux/kernel/git/kees/linux",
  "body": "Pull hardening updates from Kees Cook:\n \"As is pretty normal for this tree, there are changes all over the\n  place, especially for small fixes, selftest improvements, and improved\n  macro usability.\n\n  Some header changes ended up landing via this tree as they depended on\n  the string header cleanups. Also, a notable set of changes is the work\n  for the reintroduction of the UBSAN signed integer overflow sanitizer\n  so that we can continue to make improvements on the compiler side to\n  make this sanitizer a more viable future security hardening option.\n\n  Summary:\n\n   - string.h and related header cleanups (Tanzir Hasan, Andy\n     Shevchenko)\n\n   - VMCI memcpy() usage and struct_size() cleanups (Vasiliy Kovalev,\n     Harshit Mogalapalli)\n\n   - selftests/powerpc: Fix load_unaligned_zeropad build failure\n     (Michael Ellerman)\n\n   - hardened Kconfig fragment updates (Marco Elver, Lukas Bulwahn)\n\n   - Handle tail call optimization better in LKDTM (Douglas Anderson)\n\n   - Use long form types in overflow.h (Andy Shevchenko)\n\n   - Add flags param to string_get_size() (Andy Shevchenko)\n\n   - Add Coccinelle script for potential struct_size() use (Jacob\n     Keller)\n\n   - Fix objtool corner case under KCFI (Josh Poimboeuf)\n\n   - Drop 13 year old backward compat CAP_SYS_ADMIN check (Jingzi Meng)\n\n   - Add str_plural() helper (Michal Wajdeczko, Kees Cook)\n\n   - Ignore relocations in .notes section\n\n   - Add comments to explain how __is_constexpr() works\n\n   - Fix m68k stack alignment expectations in stackinit Kunit test\n\n   - Convert string selftests to KUnit\n\n   - Add KUnit tests for fortified string functions\n\n   - Improve reporting during fortified string warnings\n\n   - Allow non-type arg to type_max() and type_min()\n\n   - Allow strscpy() to be called with only 2 arguments\n\n   - Add binary mode to leaking_addresses scanner\n\n   - Various small cleanups to leaking_addresses scanner\n\n   - Adding wrapping_*() arithmetic helper\n\n   - Annotate initial signed integer wrap-around in refcount_t\n\n   - Add explicit UBSAN section to MAINTAINERS\n\n   - Fix UBSAN self-test warnings\n\n   - Simplify UBSAN build via removal of CONFIG_UBSAN_SANITIZE_ALL\n\n   - Reintroduce UBSAN's signed overflow sanitizer\"\n\n* tag 'hardening-v6.9-rc1' of git://git.kernel.org/pub/scm/linux/kernel/git/kees/linux: (51 commits)\n  selftests/powerpc: Fix load_unaligned_zeropad build failure\n  string: Convert helpers selftest to KUnit\n  string: Convert selftest to KUnit\n  sh: Fix build with CONFIG_UBSAN=y\n  compiler.h: Explain how __is_constexpr() works\n  overflow: Allow non-type arg to type_max() and type_min()\n  VMCI: Fix possible memcpy() run-time warning in vmci_datagram_invoke_guest_handler()\n  lib/string_helpers: Add flags param to string_get_size()\n  x86, relocs: Ignore relocations in .notes section\n  objtool: Fix UNWIND_HINT_{SAVE,RESTORE} across basic blocks\n  overflow: Use POD in check_shl_overflow()\n  lib: stackinit: Adjust target string to 8 bytes for m68k\n  sparc: vdso: Disable UBSAN instrumentation\n  kernel.h: Move lib/cmdline.c prototypes to string.h\n  leaking_addresses: Provide mechanism to scan binary files\n  leaking_addresses: Ignore input device status lines\n  leaking_addresses: Use File::Temp for /tmp files\n  MAINTAINERS: Update LEAKING_ADDRESSES details\n  fortify: Improve buffer overflow reporting\n  fortify: Add KUnit tests for runtime overflows\n  ...",
  "full_message": "Merge tag 'hardening-v6.9-rc1' of git://git.kernel.org/pub/scm/linux/kernel/git/kees/linux\n\nPull hardening updates from Kees Cook:\n \"As is pretty normal for this tree, there are changes all over the\n  place, especially for small fixes, selftest improvements, and improved\n  macro usability.\n\n  Some header changes ended up landing via this tree as they depended on\n  the string header cleanups. Also, a notable set of changes is the work\n  for the reintroduction of the UBSAN signed integer overflow sanitizer\n  so that we can continue to make improvements on the compiler side to\n  make this sanitizer a more viable future security hardening option.\n\n  Summary:\n\n   - string.h and related header cleanups (Tanzir Hasan, Andy\n     Shevchenko)\n\n   - VMCI memcpy() usage and struct_size() cleanups (Vasiliy Kovalev,\n     Harshit Mogalapalli)\n\n   - selftests/powerpc: Fix load_unaligned_zeropad build failure\n     (Michael Ellerman)\n\n   - hardened Kconfig fragment updates (Marco Elver, Lukas Bulwahn)\n\n   - Handle tail call optimization better in LKDTM (Douglas Anderson)\n\n   - Use long form types in overflow.h (Andy Shevchenko)\n\n   - Add flags param to string_get_size() (Andy Shevchenko)\n\n   - Add Coccinelle script for potential struct_size() use (Jacob\n     Keller)\n\n   - Fix objtool corner case under KCFI (Josh Poimboeuf)\n\n   - Drop 13 year old backward compat CAP_SYS_ADMIN check (Jingzi Meng)\n\n   - Add str_plural() helper (Michal Wajdeczko, Kees Cook)\n\n   - Ignore relocations in .notes section\n\n   - Add comments to explain how __is_constexpr() works\n\n   - Fix m68k stack alignment expectations in stackinit Kunit test\n\n   - Convert string selftests to KUnit\n\n   - Add KUnit tests for fortified string functions\n\n   - Improve reporting during fortified string warnings\n\n   - Allow non-type arg to type_max() and type_min()\n\n   - Allow strscpy() to be called with only 2 arguments\n\n   - Add binary mode to leaking_addresses scanner\n\n   - Various small cleanups to leaking_addresses scanner\n\n   - Adding wrapping_*() arithmetic helper\n\n   - Annotate initial signed integer wrap-around in refcount_t\n\n   - Add explicit UBSAN section to MAINTAINERS\n\n   - Fix UBSAN self-test warnings\n\n   - Simplify UBSAN build via removal of CONFIG_UBSAN_SANITIZE_ALL\n\n   - Reintroduce UBSAN's signed overflow sanitizer\"\n\n* tag 'hardening-v6.9-rc1' of git://git.kernel.org/pub/scm/linux/kernel/git/kees/linux: (51 commits)\n  selftests/powerpc: Fix load_unaligned_zeropad build failure\n  string: Convert helpers selftest to KUnit\n  string: Convert selftest to KUnit\n  sh: Fix build with CONFIG_UBSAN=y\n  compiler.h: Explain how __is_constexpr() works\n  overflow: Allow non-type arg to type_max() and type_min()\n  VMCI: Fix possible memcpy() run-time warning in vmci_datagram_invoke_guest_handler()\n  lib/string_helpers: Add flags param to string_get_size()\n  x86, relocs: Ignore relocations in .notes section\n  objtool: Fix UNWIND_HINT_{SAVE,RESTORE} across basic blocks\n  overflow: Use POD in check_shl_overflow()\n  lib: stackinit: Adjust target string to 8 bytes for m68k\n  sparc: vdso: Disable UBSAN instrumentation\n  kernel.h: Move lib/cmdline.c prototypes to string.h\n  leaking_addresses: Provide mechanism to scan binary files\n  leaking_addresses: Ignore input device status lines\n  leaking_addresses: Use File::Temp for /tmp files\n  MAINTAINERS: Update LEAKING_ADDRESSES details\n  fortify: Improve buffer overflow reporting\n  fortify: Add KUnit tests for runtime overflows\n  ...",
  "author_name": "Linus Torvalds",
  "author_email": "torvalds@linux-foundation.org",
  "author_date": "Tue Mar 12 14:49:30 2024 -0700",
  "author_date_iso": "2024-03-12T14:49:30-07:00",
  "committer_name": "Linus Torvalds",
  "committer_email": "torvalds@linux-foundation.org",
  "committer_date": "Tue Mar 12 14:49:30 2024 -0700",
  "committer_date_iso": "2024-03-12T14:49:30-07:00",
  "files_changed": [
    "MAINTAINERS",
    "arch/arm/Kconfig",
    "arch/arm64/Kconfig",
    "arch/mips/Kconfig",
    "arch/parisc/Kconfig",
    "arch/powerpc/Kconfig",
    "arch/riscv/Kconfig",
    "arch/s390/Kconfig",
    "arch/x86/Kconfig",
    "arch/x86/boot/compressed/misc.c",
    "arch/x86/kvm/mmu/mmu.c",
    "fs/namei.c",
    "include/linux/compiler.h",
    "include/linux/compiler_types.h",
    "include/linux/string.h",
    "lib/Kconfig.debug",
    "lib/Makefile",
    "scripts/Makefile.lib",
    "tools/objtool/check.c"
  ],
  "files_changed_count": 19,
  "stats": [
    {
      "file": "Documentation/dev-tools/ubsan.rst",
      "insertions": 8,
      "deletions": 20
    },
    {
      "file": "MAINTAINERS",
      "insertions": 22,
      "deletions": 4
    },
    {
      "file": "arch/arm/Kconfig",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/arm/boot/compressed/misc.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/arm/boot/compressed/misc.h",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/arm/include/asm/word-at-a-time.h",
      "insertions": 2,
      "deletions": 1
    },
    {
      "file": "arch/arm64/Kconfig",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/arm64/include/asm/word-at-a-time.h",
      "insertions": 2,
      "deletions": 1
    },
    {
      "file": "arch/mips/Kconfig",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/parisc/Kconfig",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/powerpc/Kconfig",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/powerpc/include/asm/word-at-a-time.h",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "arch/riscv/Kconfig",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/riscv/include/asm/word-at-a-time.h",
      "insertions": 2,
      "deletions": 1
    },
    {
      "file": "arch/s390/Kconfig",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/s390/include/asm/word-at-a-time.h",
      "insertions": 2,
      "deletions": 1
    },
    {
      "file": "arch/sh/boot/compressed/Makefile",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/sh/include/asm/word-at-a-time.h",
      "insertions": 2,
      "deletions": 0
    },
    {
      "file": "arch/sparc/vdso/Makefile",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/um/drivers/net_kern.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/um/drivers/vector_kern.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/um/drivers/vector_user.c",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "arch/um/include/shared/user.h",
      "insertions": 2,
      "deletions": 1
    },
    {
      "file": "arch/um/os-Linux/drivers/ethertap_user.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/um/os-Linux/drivers/tuntap_user.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/um/os-Linux/umid.c",
      "insertions": 3,
      "deletions": 3
    },
    {
      "file": "arch/x86/Kconfig",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/x86/boot/compressed/misc.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/x86/include/asm/word-at-a-time.h",
      "insertions": 2,
      "deletions": 1
    },
    {
      "file": "arch/x86/kvm/mmu/mmu.c",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/x86/tools/relocs.c",
      "insertions": 8,
      "deletions": 0
    },
    {
      "file": "drivers/misc/lkdtm/bugs.c",
      "insertions": 2,
      "deletions": 1
    },
    {
      "file": "drivers/misc/lkdtm/core.c",
      "insertions": 14,
      "deletions": 8
    },
    {
      "file": "drivers/misc/vmw_vmci/vmci_datagram.c",
      "insertions": 6,
      "deletions": 4
    },
    {
      "file": "fs/namei.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "include/asm-generic/word-at-a-time.h",
      "insertions": 2,
      "deletions": 1
    },
    {
      "file": "include/linux/compiler.h",
      "insertions": 39,
      "deletions": 0
    },
    {
      "file": "include/linux/compiler_types.h",
      "insertions": 8,
      "deletions": 1
    },
    {
      "file": "include/linux/fortify-string.h",
      "insertions": 75,
      "deletions": 47
    },
    {
      "file": "include/linux/kernel.h",
      "insertions": 2,
      "deletions": 42
    },
    {
      "file": "include/linux/overflow.h",
      "insertions": 97,
      "deletions": 18
    },
    {
      "file": "include/linux/refcount.h",
      "insertions": 6,
      "deletions": 3
    },
    {
      "file": "include/linux/string.h",
      "insertions": 81,
      "deletions": 5
    },
    {
      "file": "include/linux/string_choices.h",
      "insertions": 11,
      "deletions": 0
    },
    {
      "file": "include/linux/string_helpers.h",
      "insertions": 7,
      "deletions": 3
    },
    {
      "file": "include/linux/wordpart.h",
      "insertions": 42,
      "deletions": 0
    },
    {
      "file": "kernel/configs/hardening.config",
      "insertions": 3,
      "deletions": 4
    },
    {
      "file": "kernel/printk/printk.c",
      "insertions": 0,
      "deletions": 11
    },
    {
      "file": "lib/Kconfig.debug",
      "insertions": 9,
      "deletions": 5
    },
    {
      "file": "lib/Kconfig.ubsan",
      "insertions": 15,
      "deletions": 13
    },
    {
      "file": "lib/Makefile",
      "insertions": 5,
      "deletions": 2
    },
    {
      "file": "lib/fortify_kunit.c",
      "insertions": 660,
      "deletions": 2
    },
    {
      "file": "lib/overflow_kunit.c",
      "insertions": 63,
      "deletions": 4
    },
    {
      "file": "lib/stackinit_kunit.c",
      "insertions": 16,
      "deletions": 3
    },
    {
      "file": "lib/string.c",
      "insertions": 11,
      "deletions": 12
    },
    {
      "file": "lib/string_helpers.c",
      "insertions": 39,
      "deletions": 50
    },
    {
      "file": "lib/{test-string_helpers.c => string_helpers_kunit.c}",
      "insertions": 137,
      "deletions": 118
    },
    {
      "file": "lib/string_kunit.c",
      "insertions": 199,
      "deletions": 0
    },
    {
      "file": "lib/test_string.c",
      "insertions": 0,
      "deletions": 257
    },
    {
      "file": "lib/test_ubsan.c",
      "insertions": 39,
      "deletions": 2
    },
    {
      "file": "lib/ubsan.c",
      "insertions": 68,
      "deletions": 0
    },
    {
      "file": "lib/ubsan.h",
      "insertions": 4,
      "deletions": 0
    },
    {
      "file": "scripts/Makefile.lib",
      "insertions": 4,
      "deletions": 1
    },
    {
      "file": "scripts/Makefile.ubsan",
      "insertions": 4,
      "deletions": 1
    },
    {
      "file": "scripts/coccinelle/api/string_choices.cocci",
      "insertions": 41,
      "deletions": 0
    },
    {
      "file": "scripts/coccinelle/misc/struct_size.cocci",
      "insertions": 74,
      "deletions": 0
    },
    {
      "file": "scripts/leaking_addresses.pl",
      "insertions": 74,
      "deletions": 16
    },
    {
      "file": "tools/objtool/check.c",
      "insertions": 12,
      "deletions": 0
    },
    {
      "file": "tools/objtool/noreturns.h",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "tools/testing/selftests/powerpc/primitives/linux/bitops.h",
      "insertions": 0,
      "deletions": 0
    },
    {
      "file": "tools/testing/selftests/powerpc/primitives/linux/wordpart.h",
      "insertions": 1,
      "deletions": 0
    }
  ],
  "total_insertions": 1949,
  "total_deletions": 688,
  "total_changes": 2637,
  "parents": [
    "b32273ee89a866b01b316b9a8de407efde01090c",
    "3fe1eb4dd2e4b872ffb7b9b081b34ffcfa934ba7"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": true,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "hardening"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/parisc/Kconfig",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/riscv/Kconfig",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/arm/Kconfig",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/powerpc/Kconfig",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/mips/Kconfig",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/s390/Kconfig",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/arm64/Kconfig",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/Kconfig",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/boot/compressed/misc.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/linux/compiler.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kvm/mmu/mmu.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "fs/namei.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "MAINTAINERS",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/linux/compiler_types.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/linux/string.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "lib/Makefile",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "scripts/Makefile.lib",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "lib/Kconfig.debug",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "tools/objtool/check.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}