{
  "hash": "39d0ccc185315408e7cecfcaf06d167927b51052",
  "hash_short": "39d0ccc1",
  "subject": "net: microchip: sparx5: Fix memory leak for vcap_api_rule_add_actionvalue_test()",
  "body": "Inject fault while probing kunit-example-test.ko, the field which\nis allocated by kzalloc in vcap_rule_add_action() of\nvcap_rule_add_action_bit/u32() is not freed, and it cause\nthe memory leaks below.\n\nunreferenced object 0xffff0276c496b300 (size 64):\n  comm \"kunit_try_catch\", pid 286, jiffies 4294894224 (age 920.072s)\n  hex dump (first 32 bytes):\n    68 3c 62 82 00 80 ff ff 68 3c 62 82 00 80 ff ff  h<b.....h<b.....\n    3c 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  <...............\n  backtrace:\n    [<0000000028f08898>] slab_post_alloc_hook+0xb8/0x368\n    [<00000000514b9b37>] __kmem_cache_alloc_node+0x174/0x290\n    [<000000004620684a>] kmalloc_trace+0x40/0x164\n    [<000000008b41c84d>] vcap_rule_add_action+0x104/0x178\n    [<00000000ae66c16c>] vcap_api_rule_add_actionvalue_test+0xa4/0x990\n    [<00000000fcc5326c>] kunit_try_run_case+0x50/0xac\n    [<00000000f5f45b20>] kunit_generic_run_threadfn_adapter+0x20/0x2c\n    [<0000000026284079>] kthread+0x124/0x130\n    [<0000000024d4a996>] ret_from_fork+0x10/0x20\nunreferenced object 0xffff0276c496b2c0 (size 64):\n  comm \"kunit_try_catch\", pid 286, jiffies 4294894224 (age 920.072s)\n  hex dump (first 32 bytes):\n    68 3c 62 82 00 80 ff ff 68 3c 62 82 00 80 ff ff  h<b.....h<b.....\n    3c 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00  <...............\n  backtrace:\n    [<0000000028f08898>] slab_post_alloc_hook+0xb8/0x368\n    [<00000000514b9b37>] __kmem_cache_alloc_node+0x174/0x290\n    [<000000004620684a>] kmalloc_trace+0x40/0x164\n    [<000000008b41c84d>] vcap_rule_add_action+0x104/0x178\n    [<00000000607782aa>] vcap_api_rule_add_actionvalue_test+0x100/0x990\n    [<00000000fcc5326c>] kunit_try_run_case+0x50/0xac\n    [<00000000f5f45b20>] kunit_generic_run_threadfn_adapter+0x20/0x2c\n    [<0000000026284079>] kthread+0x124/0x130\n    [<0000000024d4a996>] ret_from_fork+0x10/0x20\nunreferenced object 0xffff0276c496b280 (size 64):\n  comm \"kunit_try_catch\", pid 286, jiffies 4294894224 (age 920.072s)\n  hex dump (first 32 bytes):\n    68 3c 62 82 00 80 ff ff 68 3c 62 82 00 80 ff ff  h<b.....h<b.....\n    3c 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  <...............\n  backtrace:\n    [<0000000028f08898>] slab_post_alloc_hook+0xb8/0x368\n    [<00000000514b9b37>] __kmem_cache_alloc_node+0x174/0x290\n    [<000000004620684a>] kmalloc_trace+0x40/0x164\n    [<000000008b41c84d>] vcap_rule_add_action+0x104/0x178\n    [<000000004e640602>] vcap_api_rule_add_actionvalue_test+0x15c/0x990\n    [<00000000fcc5326c>] kunit_try_run_case+0x50/0xac\n    [<00000000f5f45b20>] kunit_generic_run_threadfn_adapter+0x20/0x2c\n    [<0000000026284079>] kthread+0x124/0x130\n    [<0000000024d4a996>] ret_from_fork+0x10/0x20\nunreferenced object 0xffff0276c496b240 (size 64):\n  comm \"kunit_try_catch\", pid 286, jiffies 4294894224 (age 920.092s)\n  hex dump (first 32 bytes):\n    68 3c 62 82 00 80 ff ff 68 3c 62 82 00 80 ff ff  h<b.....h<b.....\n    5a 00 00 00 01 00 00 00 32 54 76 98 00 00 00 00  Z.......2Tv.....\n  backtrace:\n    [<0000000028f08898>] slab_post_alloc_hook+0xb8/0x368\n    [<00000000514b9b37>] __kmem_cache_alloc_node+0x174/0x290\n    [<000000004620684a>] kmalloc_trace+0x40/0x164\n    [<000000008b41c84d>] vcap_rule_add_action+0x104/0x178\n    [<0000000011141bf8>] vcap_api_rule_add_actionvalue_test+0x1bc/0x990\n    [<00000000fcc5326c>] kunit_try_run_case+0x50/0xac\n    [<00000000f5f45b20>] kunit_generic_run_threadfn_adapter+0x20/0x2c\n    [<0000000026284079>] kthread+0x124/0x130\n    [<0000000024d4a996>] ret_from_fork+0x10/0x20\nunreferenced object 0xffff0276c496b200 (size 64):\n  comm \"kunit_try_catch\", pid 286, jiffies 4294894224 (age 920.092s)\n  hex dump (first 32 bytes):\n    68 3c 62 82 00 80 ff ff 68 3c 62 82 00 80 ff ff  h<b.....h<b.....\n    28 00 00 00 01 00 00 00 dd cc bb aa 00 00 00 00  (...............\n  backtrace:\n    [<0000000028f08898>] slab_post_alloc_hook+0xb8/0x368\n    [<00000000514b9b37>] __kmem_cache_alloc_node+0x174/0x290\n    [<000000004620684a>] kmalloc_trace+0x40/0x164\n    [<000000008b41c84d>] vcap_rule_add_action+0x104/0x178\n    [<00000000d5ed3088>] vcap_api_rule_add_actionvalue_test+0x22c/0x990\n    [<00000000fcc5326c>] kunit_try_run_case+0x50/0xac\n    [<00000000f5f45b20>] kunit_generic_run_threadfn_adapter+0x20/0x2c\n    [<0000000026284079>] kthread+0x124/0x130\n    [<0000000024d4a996>] ret_from_fork+0x10/0x20\n\nFixes: c956b9b318d9 (\"net: microchip: sparx5: Adding KUNIT tests of key/action values in VCAP API\")\nSigned-off-by: Jinjie Ruan <ruanjinjie@huawei.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
  "full_message": "net: microchip: sparx5: Fix memory leak for vcap_api_rule_add_actionvalue_test()\n\nInject fault while probing kunit-example-test.ko, the field which\nis allocated by kzalloc in vcap_rule_add_action() of\nvcap_rule_add_action_bit/u32() is not freed, and it cause\nthe memory leaks below.\n\nunreferenced object 0xffff0276c496b300 (size 64):\n  comm \"kunit_try_catch\", pid 286, jiffies 4294894224 (age 920.072s)\n  hex dump (first 32 bytes):\n    68 3c 62 82 00 80 ff ff 68 3c 62 82 00 80 ff ff  h<b.....h<b.....\n    3c 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  <...............\n  backtrace:\n    [<0000000028f08898>] slab_post_alloc_hook+0xb8/0x368\n    [<00000000514b9b37>] __kmem_cache_alloc_node+0x174/0x290\n    [<000000004620684a>] kmalloc_trace+0x40/0x164\n    [<000000008b41c84d>] vcap_rule_add_action+0x104/0x178\n    [<00000000ae66c16c>] vcap_api_rule_add_actionvalue_test+0xa4/0x990\n    [<00000000fcc5326c>] kunit_try_run_case+0x50/0xac\n    [<00000000f5f45b20>] kunit_generic_run_threadfn_adapter+0x20/0x2c\n    [<0000000026284079>] kthread+0x124/0x130\n    [<0000000024d4a996>] ret_from_fork+0x10/0x20\nunreferenced object 0xffff0276c496b2c0 (size 64):\n  comm \"kunit_try_catch\", pid 286, jiffies 4294894224 (age 920.072s)\n  hex dump (first 32 bytes):\n    68 3c 62 82 00 80 ff ff 68 3c 62 82 00 80 ff ff  h<b.....h<b.....\n    3c 00 00 00 00 00 00 00 01 00 00 00 00 00 00 00  <...............\n  backtrace:\n    [<0000000028f08898>] slab_post_alloc_hook+0xb8/0x368\n    [<00000000514b9b37>] __kmem_cache_alloc_node+0x174/0x290\n    [<000000004620684a>] kmalloc_trace+0x40/0x164\n    [<000000008b41c84d>] vcap_rule_add_action+0x104/0x178\n    [<00000000607782aa>] vcap_api_rule_add_actionvalue_test+0x100/0x990\n    [<00000000fcc5326c>] kunit_try_run_case+0x50/0xac\n    [<00000000f5f45b20>] kunit_generic_run_threadfn_adapter+0x20/0x2c\n    [<0000000026284079>] kthread+0x124/0x130\n    [<0000000024d4a996>] ret_from_fork+0x10/0x20\nunreferenced object 0xffff0276c496b280 (size 64):\n  comm \"kunit_try_catch\", pid 286, jiffies 4294894224 (age 920.072s)\n  hex dump (first 32 bytes):\n    68 3c 62 82 00 80 ff ff 68 3c 62 82 00 80 ff ff  h<b.....h<b.....\n    3c 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  <...............\n  backtrace:\n    [<0000000028f08898>] slab_post_alloc_hook+0xb8/0x368\n    [<00000000514b9b37>] __kmem_cache_alloc_node+0x174/0x290\n    [<000000004620684a>] kmalloc_trace+0x40/0x164\n    [<000000008b41c84d>] vcap_rule_add_action+0x104/0x178\n    [<000000004e640602>] vcap_api_rule_add_actionvalue_test+0x15c/0x990\n    [<00000000fcc5326c>] kunit_try_run_case+0x50/0xac\n    [<00000000f5f45b20>] kunit_generic_run_threadfn_adapter+0x20/0x2c\n    [<0000000026284079>] kthread+0x124/0x130\n    [<0000000024d4a996>] ret_from_fork+0x10/0x20\nunreferenced object 0xffff0276c496b240 (size 64):\n  comm \"kunit_try_catch\", pid 286, jiffies 4294894224 (age 920.092s)\n  hex dump (first 32 bytes):\n    68 3c 62 82 00 80 ff ff 68 3c 62 82 00 80 ff ff  h<b.....h<b.....\n    5a 00 00 00 01 00 00 00 32 54 76 98 00 00 00 00  Z.......2Tv.....\n  backtrace:\n    [<0000000028f08898>] slab_post_alloc_hook+0xb8/0x368\n    [<00000000514b9b37>] __kmem_cache_alloc_node+0x174/0x290\n    [<000000004620684a>] kmalloc_trace+0x40/0x164\n    [<000000008b41c84d>] vcap_rule_add_action+0x104/0x178\n    [<0000000011141bf8>] vcap_api_rule_add_actionvalue_test+0x1bc/0x990\n    [<00000000fcc5326c>] kunit_try_run_case+0x50/0xac\n    [<00000000f5f45b20>] kunit_generic_run_threadfn_adapter+0x20/0x2c\n    [<0000000026284079>] kthread+0x124/0x130\n    [<0000000024d4a996>] ret_from_fork+0x10/0x20\nunreferenced object 0xffff0276c496b200 (size 64):\n  comm \"kunit_try_catch\", pid 286, jiffies 4294894224 (age 920.092s)\n  hex dump (first 32 bytes):\n    68 3c 62 82 00 80 ff ff 68 3c 62 82 00 80 ff ff  h<b.....h<b.....\n    28 00 00 00 01 00 00 00 dd cc bb aa 00 00 00 00  (...............\n  backtrace:\n    [<0000000028f08898>] slab_post_alloc_hook+0xb8/0x368\n    [<00000000514b9b37>] __kmem_cache_alloc_node+0x174/0x290\n    [<000000004620684a>] kmalloc_trace+0x40/0x164\n    [<000000008b41c84d>] vcap_rule_add_action+0x104/0x178\n    [<00000000d5ed3088>] vcap_api_rule_add_actionvalue_test+0x22c/0x990\n    [<00000000fcc5326c>] kunit_try_run_case+0x50/0xac\n    [<00000000f5f45b20>] kunit_generic_run_threadfn_adapter+0x20/0x2c\n    [<0000000026284079>] kthread+0x124/0x130\n    [<0000000024d4a996>] ret_from_fork+0x10/0x20\n\nFixes: c956b9b318d9 (\"net: microchip: sparx5: Adding KUNIT tests of key/action values in VCAP API\")\nSigned-off-by: Jinjie Ruan <ruanjinjie@huawei.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
  "author_name": "Jinjie Ruan",
  "author_email": "ruanjinjie@huawei.com",
  "author_date": "Tue Sep 12 19:03:07 2023 +0800",
  "author_date_iso": "2023-09-12T19:03:07+08:00",
  "committer_name": "David S. Miller",
  "committer_email": "davem@davemloft.net",
  "committer_date": "Fri Sep 15 07:32:35 2023 +0100",
  "committer_date_iso": "2023-09-15T07:32:35+01:00",
  "files_changed": [
    "drivers/net/ethernet/microchip/vcap/vcap_api_kunit.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/net/ethernet/microchip/vcap/vcap_api_kunit.c",
      "insertions": 16,
      "deletions": 0
    }
  ],
  "total_insertions": 16,
  "total_deletions": 0,
  "total_changes": 16,
  "parents": [
    "f037fc9905ffa6fa19b89bfbc86946798cede071"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "Inject"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/net/ethernet/microchip/vcap/vcap_api_kunit.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}