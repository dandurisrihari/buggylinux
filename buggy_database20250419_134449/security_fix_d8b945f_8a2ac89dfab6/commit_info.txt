Commit Hash: d8b945fa475f13d787df00c26a6dc45a3e2e1d1d
Subject: ext4: forbid commit inconsistent quota data when errors=remount-ro


Security Keywords:
- injection

Full commit message:
ext4: forbid commit inconsistent quota data when errors=remount-ro

There's issue as follows When do IO fault injection test:
Quota error (device dm-3): find_block_dqentry: Quota for id 101 referenced but not present
Quota error (device dm-3): qtree_read_dquot: Can't read quota structure for id 101
Quota error (device dm-3): do_check_range: Getting block 2021161007 out of range 1-186
Quota error (device dm-3): qtree_read_dquot: Can't read quota structure for id 661

Now, ext4_write_dquot()/ext4_acquire_dquot()/ext4_release_dquot() may commit
inconsistent quota data even if process failed. This may lead to filesystem
corruption.
To ensure filesystem consistent when errors=remount-ro there is need to call
ext4_handle_error() to abort journal.

Signed-off-by: Ye Bin <yebin10@huawei.com>
Reviewed-by: Jan Kara <jack@suse.cz>
Link: https://lore.kernel.org/r/20240119062908.3598806-1-yebin10@huawei.com
Signed-off-by: Theodore Ts'o <tytso@mit.edu>

Metadata:
Author: Ye Bin <yebin10@huawei.com>
Author Date: Fri Jan 19 14:29:08 2024 +0800
Committer: Theodore Ts'o <tytso@mit.edu>
Commit Date: Wed Feb 21 22:40:57 2024 -0500

Files Changed: 1
Lines Added: 12
Lines Removed: 0
Total Changes: 12
