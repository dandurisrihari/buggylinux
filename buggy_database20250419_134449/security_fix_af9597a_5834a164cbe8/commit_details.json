{
  "hash": "af9597adc2f1e3609c67c9792a2469bb64e43ae9",
  "hash_short": "af9597ad",
  "subject": "drivers/perf: add DesignWare PCIe PMU driver",
  "body": "This commit adds the PCIe Performance Monitoring Unit (PMU) driver support\nfor T-Head Yitian SoC chip. Yitian is based on the Synopsys PCI Express\nCore controller IP which provides statistics feature. The PMU is a PCIe\nconfiguration space register block provided by each PCIe Root Port in a\nVendor-Specific Extended Capability named RAS D.E.S (Debug, Error\ninjection, and Statistics).\n\nTo facilitate collection of statistics the controller provides the\nfollowing two features for each Root Port:\n\n- one 64-bit counter for Time Based Analysis (RX/TX data throughput and\n  time spent in each low-power LTSSM state) and\n- one 32-bit counter for Event Counting (error and non-error events for\n  a specified lane)\n\nNote: There is no interrupt for counter overflow.\n\nThis driver adds PMU devices for each PCIe Root Port. And the PMU device is\nnamed based the BDF of Root Port. For example,\n\n    30:03.0 PCI bridge: Device 1ded:8000 (rev 01)\n\nthe PMU device name for this Root Port is dwc_rootport_3018.\n\nExample usage of counting PCIe RX TLP data payload (Units of bytes)::\n\n    $# perf stat -a -e dwc_rootport_3018/Rx_PCIe_TLP_Data_Payload/\n\naverage RX bandwidth can be calculated like this:\n\n    PCIe TX Bandwidth = Rx_PCIe_TLP_Data_Payload / Measure_Time_Window\n\nSigned-off-by: Shuai Xue <xueshuai@linux.alibaba.com>\nReviewed-by: Baolin Wang <baolin.wang@linux.alibaba.com>\nReviewed-by: Jonathan Cameron <Jonathan.Cameron@huawei.com>\nReviewed-by: Yicong Yang <yangyicong@hisilicon.com>\nReviewed-and-tested-by: Ilkka Koskinen <ilkka@os.amperecomputing.com>\nLink: https://lore.kernel.org/r/20231208025652.87192-5-xueshuai@linux.alibaba.com\n[will: Fix sparse error due to use of uninitialised 'vsec' symbol in\n dwc_pcie_match_des_cap()]\nSigned-off-by: Will Deacon <will@kernel.org>",
  "full_message": "drivers/perf: add DesignWare PCIe PMU driver\n\nThis commit adds the PCIe Performance Monitoring Unit (PMU) driver support\nfor T-Head Yitian SoC chip. Yitian is based on the Synopsys PCI Express\nCore controller IP which provides statistics feature. The PMU is a PCIe\nconfiguration space register block provided by each PCIe Root Port in a\nVendor-Specific Extended Capability named RAS D.E.S (Debug, Error\ninjection, and Statistics).\n\nTo facilitate collection of statistics the controller provides the\nfollowing two features for each Root Port:\n\n- one 64-bit counter for Time Based Analysis (RX/TX data throughput and\n  time spent in each low-power LTSSM state) and\n- one 32-bit counter for Event Counting (error and non-error events for\n  a specified lane)\n\nNote: There is no interrupt for counter overflow.\n\nThis driver adds PMU devices for each PCIe Root Port. And the PMU device is\nnamed based the BDF of Root Port. For example,\n\n    30:03.0 PCI bridge: Device 1ded:8000 (rev 01)\n\nthe PMU device name for this Root Port is dwc_rootport_3018.\n\nExample usage of counting PCIe RX TLP data payload (Units of bytes)::\n\n    $# perf stat -a -e dwc_rootport_3018/Rx_PCIe_TLP_Data_Payload/\n\naverage RX bandwidth can be calculated like this:\n\n    PCIe TX Bandwidth = Rx_PCIe_TLP_Data_Payload / Measure_Time_Window\n\nSigned-off-by: Shuai Xue <xueshuai@linux.alibaba.com>\nReviewed-by: Baolin Wang <baolin.wang@linux.alibaba.com>\nReviewed-by: Jonathan Cameron <Jonathan.Cameron@huawei.com>\nReviewed-by: Yicong Yang <yangyicong@hisilicon.com>\nReviewed-and-tested-by: Ilkka Koskinen <ilkka@os.amperecomputing.com>\nLink: https://lore.kernel.org/r/20231208025652.87192-5-xueshuai@linux.alibaba.com\n[will: Fix sparse error due to use of uninitialised 'vsec' symbol in\n dwc_pcie_match_des_cap()]\nSigned-off-by: Will Deacon <will@kernel.org>",
  "author_name": "Shuai Xue",
  "author_email": "xueshuai@linux.alibaba.com",
  "author_date": "Fri Dec 8 10:56:51 2023 +0800",
  "author_date_iso": "2023-12-08T10:56:51+08:00",
  "committer_name": "Will Deacon",
  "committer_email": "will@kernel.org",
  "committer_date": "Wed Dec 13 15:35:28 2023 +0000",
  "committer_date_iso": "2023-12-13T15:35:28+00:00",
  "files_changed": [
    "drivers/perf/Kconfig",
    "drivers/perf/Makefile",
    "drivers/perf/dwc_pcie_pmu.c"
  ],
  "files_changed_count": 3,
  "stats": [
    {
      "file": "drivers/perf/Kconfig",
      "insertions": 7,
      "deletions": 0
    },
    {
      "file": "drivers/perf/Makefile",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "drivers/perf/dwc_pcie_pmu.c",
      "insertions": 792,
      "deletions": 0
    }
  ],
  "total_insertions": 800,
  "total_deletions": 0,
  "total_changes": 800,
  "parents": [
    "ac16087134b837d42b75bb1c741070b6c142f258"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/perf/Kconfig",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/perf/Makefile",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/perf/dwc_pcie_pmu.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}