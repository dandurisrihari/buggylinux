{
  "hash": "38313c6d2a02c28162e06753b01bd885caf9386d",
  "hash_short": "38313c6d",
  "subject": "RDMA/irdma: Replace one-element array with flexible-array member",
  "body": "One-element and zero-length arrays are deprecated. So, replace\none-element array in struct irdma_qvlist_info with flexible-array\nmember.\n\nA patch for this was sent a while ago[1]. However, it seems that, at\nthe time, the changes were partially folded[2][3], and the actual\nflexible-array transformation was omitted. This patch fixes that.\n\nThe only binary difference seen before/after changes is shown below:\n\n|  drivers/infiniband/hw/irdma/hw.o\n| @@ -868,7 +868,7 @@\n| drivers/infiniband/hw/irdma/hw.c:484 (discriminator 2)\n|\tsize += struct_size(iw_qvlist, qv_info, rf->msix_count);\n|      55b:      imul   $0x45c,%rdi,%rdi\n|-     562:      add    $0x10,%rdi\n|+     562:      add    $0x4,%rdi\n\nwhich is, of course, expected as it reflects the mistake made\nwhile folding the patch I've mentioned above.\n\nWorth mentioning is the fact that with this change we save 12 bytes\nof memory, as can be inferred from the diff snapshot above. Notice\nthat:\n\n$ pahole -C rdma_qv_info idrivers/infiniband/hw/irdma/hw.o\nstruct irdma_qv_info {\n\tu32                        v_idx;                /*     0     4 */\n\tu16                        ceq_idx;              /*     4     2 */\n\tu16                        aeq_idx;              /*     6     2 */\n\tu8                         itr_idx;              /*     8     1 */\n\n\t/* size: 12, cachelines: 1, members: 4 */\n\t/* padding: 3 */\n\t/* last cacheline: 12 bytes */\n};\n\nLink: https://lore.kernel.org/linux-hardening/20210525230038.GA175516@embeddedor/ [1]\nLink: https://lore.kernel.org/linux-hardening/bf46b428deef4e9e89b0ea1704b1f0e5@intel.com/ [2]\nLink: https://lore.kernel.org/linux-rdma/20210520143809.819-1-shiraz.saleem@intel.com/T/#u [3]\nFixes: 44d9e52977a1 (\"RDMA/irdma: Implement device initialization definitions\")\nSigned-off-by: Gustavo A. R. Silva <gustavoars@kernel.org>\nLink: https://lore.kernel.org/r/ZMpsQrZadBaJGkt4@work\nSigned-off-by: Leon Romanovsky <leon@kernel.org>",
  "full_message": "RDMA/irdma: Replace one-element array with flexible-array member\n\nOne-element and zero-length arrays are deprecated. So, replace\none-element array in struct irdma_qvlist_info with flexible-array\nmember.\n\nA patch for this was sent a while ago[1]. However, it seems that, at\nthe time, the changes were partially folded[2][3], and the actual\nflexible-array transformation was omitted. This patch fixes that.\n\nThe only binary difference seen before/after changes is shown below:\n\n|  drivers/infiniband/hw/irdma/hw.o\n| @@ -868,7 +868,7 @@\n| drivers/infiniband/hw/irdma/hw.c:484 (discriminator 2)\n|\tsize += struct_size(iw_qvlist, qv_info, rf->msix_count);\n|      55b:      imul   $0x45c,%rdi,%rdi\n|-     562:      add    $0x10,%rdi\n|+     562:      add    $0x4,%rdi\n\nwhich is, of course, expected as it reflects the mistake made\nwhile folding the patch I've mentioned above.\n\nWorth mentioning is the fact that with this change we save 12 bytes\nof memory, as can be inferred from the diff snapshot above. Notice\nthat:\n\n$ pahole -C rdma_qv_info idrivers/infiniband/hw/irdma/hw.o\nstruct irdma_qv_info {\n\tu32                        v_idx;                /*     0     4 */\n\tu16                        ceq_idx;              /*     4     2 */\n\tu16                        aeq_idx;              /*     6     2 */\n\tu8                         itr_idx;              /*     8     1 */\n\n\t/* size: 12, cachelines: 1, members: 4 */\n\t/* padding: 3 */\n\t/* last cacheline: 12 bytes */\n};\n\nLink: https://lore.kernel.org/linux-hardening/20210525230038.GA175516@embeddedor/ [1]\nLink: https://lore.kernel.org/linux-hardening/bf46b428deef4e9e89b0ea1704b1f0e5@intel.com/ [2]\nLink: https://lore.kernel.org/linux-rdma/20210520143809.819-1-shiraz.saleem@intel.com/T/#u [3]\nFixes: 44d9e52977a1 (\"RDMA/irdma: Implement device initialization definitions\")\nSigned-off-by: Gustavo A. R. Silva <gustavoars@kernel.org>\nLink: https://lore.kernel.org/r/ZMpsQrZadBaJGkt4@work\nSigned-off-by: Leon Romanovsky <leon@kernel.org>",
  "author_name": "Gustavo A. R. Silva",
  "author_email": "gustavoars@kernel.org",
  "author_date": "Wed Aug 2 08:46:26 2023 -0600",
  "author_date_iso": "2023-08-02T08:46:26-06:00",
  "committer_name": "Leon Romanovsky",
  "committer_email": "leon@kernel.org",
  "committer_date": "Thu Aug 3 21:11:18 2023 +0300",
  "committer_date_iso": "2023-08-03T21:11:18+03:00",
  "files_changed": [
    "drivers/infiniband/hw/irdma/main.h"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/infiniband/hw/irdma/main.h",
      "insertions": 1,
      "deletions": 1
    }
  ],
  "total_insertions": 1,
  "total_deletions": 1,
  "total_changes": 2,
  "parents": [
    "2897f1925be9a3fad3972660ca4bb0909cd64f35"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "hardening"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/infiniband/hw/irdma/main.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}