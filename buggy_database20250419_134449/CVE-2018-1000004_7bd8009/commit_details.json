{
  "hash": "7bd80091567789f1c0cb70eb4737aac8bcd2b6b9",
  "hash_short": "7bd80091",
  "subject": "ALSA: seq: More protection for concurrent write and ioctl races",
  "body": "This patch is an attempt for further hardening against races between\nthe concurrent write and ioctls.  The previous fix d15d662e89fc\n(\"ALSA: seq: Fix racy pool initializations\") covered the race of the\npool initialization at writer and the pool resize ioctl by the\nclient->ioctl_mutex (CVE-2018-1000004).  However, basically this mutex\nshould be applied more widely to the whole write operation for\navoiding the unexpected pool operations by another thread.\n\nThe only change outside snd_seq_write() is the additional mutex\nargument to helper functions, so that we can unlock / relock the given\nmutex temporarily during schedule() call for blocking write.\n\nFixes: d15d662e89fc (\"ALSA: seq: Fix racy pool initializations\")\nReported-by: \u8303\u9f99\u98de <long7573@126.com>\nReported-by: Nicolai Stange <nstange@suse.de>\nReviewed-and-tested-by: Nicolai Stange <nstange@suse.de>\nCc: <stable@vger.kernel.org>\nSigned-off-by: Takashi Iwai <tiwai@suse.de>",
  "full_message": "ALSA: seq: More protection for concurrent write and ioctl races\n\nThis patch is an attempt for further hardening against races between\nthe concurrent write and ioctls.  The previous fix d15d662e89fc\n(\"ALSA: seq: Fix racy pool initializations\") covered the race of the\npool initialization at writer and the pool resize ioctl by the\nclient->ioctl_mutex (CVE-2018-1000004).  However, basically this mutex\nshould be applied more widely to the whole write operation for\navoiding the unexpected pool operations by another thread.\n\nThe only change outside snd_seq_write() is the additional mutex\nargument to helper functions, so that we can unlock / relock the given\nmutex temporarily during schedule() call for blocking write.\n\nFixes: d15d662e89fc (\"ALSA: seq: Fix racy pool initializations\")\nReported-by: \u8303\u9f99\u98de <long7573@126.com>\nReported-by: Nicolai Stange <nstange@suse.de>\nReviewed-and-tested-by: Nicolai Stange <nstange@suse.de>\nCc: <stable@vger.kernel.org>\nSigned-off-by: Takashi Iwai <tiwai@suse.de>",
  "author_name": "Takashi Iwai",
  "author_email": "tiwai@suse.de",
  "author_date": "Mon Mar 5 22:06:09 2018 +0100",
  "author_date_iso": "2018-03-05T22:06:09+01:00",
  "committer_name": "Takashi Iwai",
  "committer_email": "tiwai@suse.de",
  "committer_date": "Thu Mar 8 12:05:37 2018 +0100",
  "committer_date_iso": "2018-03-08T12:05:37+01:00",
  "files_changed": [
    "sound/core/seq/seq_clientmgr.c",
    "sound/core/seq/seq_fifo.c",
    "sound/core/seq/seq_memory.c",
    "sound/core/seq/seq_memory.h"
  ],
  "files_changed_count": 4,
  "stats": [
    {
      "file": "sound/core/seq/seq_clientmgr.c",
      "insertions": 11,
      "deletions": 7
    },
    {
      "file": "sound/core/seq/seq_fifo.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "sound/core/seq/seq_memory.c",
      "insertions": 10,
      "deletions": 4
    },
    {
      "file": "sound/core/seq/seq_memory.h",
      "insertions": 2,
      "deletions": 1
    }
  ],
  "total_insertions": 24,
  "total_deletions": 13,
  "total_changes": 37,
  "parents": [
    "d85739367c6d56e475c281945c68fdb05ca74b4c"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.16",
    "v4.16-rc5",
    "v4.16-rc6",
    "v4.16-rc7",
    "v4.17",
    "v4.17-rc1",
    "v4.17-rc2",
    "v4.17-rc3",
    "v4.17-rc4",
    "v4.17-rc5"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [
      "CVE-2018-1000004"
    ],
    "security_keywords": [
      "hardening"
    ]
  },
  "fix_type": "cve",
  "file_results": [
    {
      "file": "sound/core/seq/seq_clientmgr.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "sound/core/seq/seq_fifo.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "sound/core/seq/seq_memory.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "sound/core/seq/seq_memory.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}