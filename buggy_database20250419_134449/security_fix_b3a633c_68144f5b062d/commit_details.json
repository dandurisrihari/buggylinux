{
  "hash": "b3a633c8527ef155b1a4e22e8f5abc58f7af54c9",
  "hash_short": "b3a633c8",
  "subject": "personality handling: fix PER_CLEAR_ON_SETID for security reasons",
  "body": "We have found that the current PER_CLEAR_ON_SETID mask on Linux\ndoesn't include neither ADDR_COMPAT_LAYOUT, nor MMAP_PAGE_ZERO.\n\nThe current mask is READ_IMPLIES_EXEC|ADDR_NO_RANDOMIZE.\n\nWe believe it is important to add MMAP_PAGE_ZERO, because by using\nthis personality it is possible to have the first page mapped inside a\nprocess running as setuid root. This could be used in those scenarios:\n\n- Exploiting a NULL pointer dereference issue in a setuid root binary\n- Bypassing the mmap_min_addr restrictions of the Linux kernel: by\nrunning a setuid binary that would drop privileges before giving us\ncontrol back (for instance by loading a user-supplied library), we\ncould get the first page mapped in a process we control. By further\nusing mremap and mprotect on this mapping, we can then completely\nbypass the mmap_min_addr restrictions.\n\nLess importantly, we believe ADDR_COMPAT_LAYOUT should also be added\nsince on x86 32bits it will in practice disable most of the address\nspace layout randomization (only the stack will remain randomized).\n\nSigned-off-by: Julien Tinnes <jt@cr0.org>\nSigned-off-by: Tavis Ormandy <taviso@sdf.lonestar.org>\nAcked-by: Christoph Hellwig <hch@infradead.org>\nAcked-by: Kees Cook <kees.cook@canonical.com>\nSigned-off-by: James Morris <jmorris@namei.org>",
  "full_message": "personality handling: fix PER_CLEAR_ON_SETID for security reasons\n\nWe have found that the current PER_CLEAR_ON_SETID mask on Linux\ndoesn't include neither ADDR_COMPAT_LAYOUT, nor MMAP_PAGE_ZERO.\n\nThe current mask is READ_IMPLIES_EXEC|ADDR_NO_RANDOMIZE.\n\nWe believe it is important to add MMAP_PAGE_ZERO, because by using\nthis personality it is possible to have the first page mapped inside a\nprocess running as setuid root. This could be used in those scenarios:\n\n- Exploiting a NULL pointer dereference issue in a setuid root binary\n- Bypassing the mmap_min_addr restrictions of the Linux kernel: by\nrunning a setuid binary that would drop privileges before giving us\ncontrol back (for instance by loading a user-supplied library), we\ncould get the first page mapped in a process we control. By further\nusing mremap and mprotect on this mapping, we can then completely\nbypass the mmap_min_addr restrictions.\n\nLess importantly, we believe ADDR_COMPAT_LAYOUT should also be added\nsince on x86 32bits it will in practice disable most of the address\nspace layout randomization (only the stack will remain randomized).\n\nSigned-off-by: Julien Tinnes <jt@cr0.org>\nSigned-off-by: Tavis Ormandy <taviso@sdf.lonestar.org>\nAcked-by: Christoph Hellwig <hch@infradead.org>\nAcked-by: Kees Cook <kees.cook@canonical.com>\nSigned-off-by: James Morris <jmorris@namei.org>",
  "author_name": "Julien Tinnes",
  "author_email": "jt@cr0.org",
  "author_date": "Fri Jul 10 10:46:30 2009 -0700",
  "author_date_iso": "2009-07-10T10:46:30-07:00",
  "committer_name": "James Morris",
  "committer_email": "jmorris@namei.org",
  "committer_date": "Mon Jul 13 08:01:47 2009 +1000",
  "committer_date_iso": "2009-07-13T08:01:47+10:00",
  "files_changed": [
    "include/linux/personality.h"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "include/linux/personality.h",
      "insertions": 5,
      "deletions": 1
    }
  ],
  "total_insertions": 5,
  "total_deletions": 1,
  "total_changes": 6,
  "parents": [
    "8113a8d80f4c6a3dc3724b39b470f3fee9c426b6"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v2.6.32",
    "v2.6.32-rc1",
    "v2.6.32-rc2",
    "v2.6.32-rc3",
    "v2.6.32-rc4",
    "v2.6.32-rc5",
    "v2.6.32-rc6",
    "v2.6.32-rc7",
    "v2.6.32-rc8",
    "v2.6.33"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "bypass"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "include/linux/personality.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}