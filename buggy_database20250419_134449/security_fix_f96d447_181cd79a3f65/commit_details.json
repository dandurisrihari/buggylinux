{
  "hash": "f96d44743a44e3332f75d23d2075bb8270900e1d",
  "hash_short": "f96d4474",
  "subject": "btrfs: check error value from btrfs_update_inode in tree log",
  "body": "Error injection testing uncovered a case where we ended up with invalid\nlink counts on an inode.  This happened because we failed to notice an\nerror when updating the inode while replaying the tree log, and\ncommitted the transaction with an invalid file system.\n\nFix this by checking the return value of btrfs_update_inode.  This\nresolved the link count errors I was seeing, and we already properly\nhandle passing up the error values in these paths.\n\nCC: stable@vger.kernel.org # 4.4+\nReviewed-by: Johannes Thumshirn <johannes.thumshirn@wdc.com>\nReviewed-by: Qu Wenruo <wqu@suse.com>\nSigned-off-by: Josef Bacik <josef@toxicpanda.com>\nReviewed-by: David Sterba <dsterba@suse.com>\nSigned-off-by: David Sterba <dsterba@suse.com>",
  "full_message": "btrfs: check error value from btrfs_update_inode in tree log\n\nError injection testing uncovered a case where we ended up with invalid\nlink counts on an inode.  This happened because we failed to notice an\nerror when updating the inode while replaying the tree log, and\ncommitted the transaction with an invalid file system.\n\nFix this by checking the return value of btrfs_update_inode.  This\nresolved the link count errors I was seeing, and we already properly\nhandle passing up the error values in these paths.\n\nCC: stable@vger.kernel.org # 4.4+\nReviewed-by: Johannes Thumshirn <johannes.thumshirn@wdc.com>\nReviewed-by: Qu Wenruo <wqu@suse.com>\nSigned-off-by: Josef Bacik <josef@toxicpanda.com>\nReviewed-by: David Sterba <dsterba@suse.com>\nSigned-off-by: David Sterba <dsterba@suse.com>",
  "author_name": "Josef Bacik",
  "author_email": "josef@toxicpanda.com",
  "author_date": "Wed May 19 11:26:25 2021 -0400",
  "author_date_iso": "2021-05-19T11:26:25-04:00",
  "committer_name": "David Sterba",
  "committer_email": "dsterba@suse.com",
  "committer_date": "Thu May 27 23:31:13 2021 +0200",
  "committer_date_iso": "2021-05-27T23:31:13+02:00",
  "files_changed": [
    "fs/btrfs/tree-log.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "fs/btrfs/tree-log.c",
      "insertions": 6,
      "deletions": 2
    }
  ],
  "total_insertions": 6,
  "total_deletions": 2,
  "total_changes": 8,
  "parents": [
    "011b28acf940eb61c000059dd9e2cfcbf52ed96b"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "fs/btrfs/tree-log.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}