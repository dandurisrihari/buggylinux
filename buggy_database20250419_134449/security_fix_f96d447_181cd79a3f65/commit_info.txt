Commit Hash: f96d44743a44e3332f75d23d2075bb8270900e1d
Subject: btrfs: check error value from btrfs_update_inode in tree log


Security Keywords:
- injection

Full commit message:
btrfs: check error value from btrfs_update_inode in tree log

Error injection testing uncovered a case where we ended up with invalid
link counts on an inode.  This happened because we failed to notice an
error when updating the inode while replaying the tree log, and
committed the transaction with an invalid file system.

Fix this by checking the return value of btrfs_update_inode.  This
resolved the link count errors I was seeing, and we already properly
handle passing up the error values in these paths.

CC: stable@vger.kernel.org # 4.4+
Reviewed-by: Johannes Thumshirn <johannes.thumshirn@wdc.com>
Reviewed-by: Qu Wenruo <wqu@suse.com>
Signed-off-by: Josef Bacik <josef@toxicpanda.com>
Reviewed-by: David Sterba <dsterba@suse.com>
Signed-off-by: David Sterba <dsterba@suse.com>

Metadata:
Author: Josef Bacik <josef@toxicpanda.com>
Author Date: Wed May 19 11:26:25 2021 -0400
Committer: David Sterba <dsterba@suse.com>
Commit Date: Thu May 27 23:31:13 2021 +0200

Files Changed: 1
Lines Added: 6
Lines Removed: 2
Total Changes: 8
