{
  "hash": "cd414f4f59f64d7d2a249caaf387edbc5a874020",
  "hash_short": "cd414f4f",
  "subject": "drm/i915/guc: Fix missing return code checks in submission init",
  "body": "The CI results for the 'fast request' patch set (enables error return\ncodes for fire-and-forget H2G messages) hit an issue with the KMD\nsending context submission requests on an invalid context. That was\ncaused by a fault injection probe failing the context creation of a\nkernel context. However, there was no return code checking on any of\nthe kernel context registration paths. So the driver kept going and\ntried to use the kernel context for the record defaults process.\n\nThis would not cause any actual problems. The invalid requests would\nbe rejected by GuC and ultimately the start up sequence would\ncorrectly wedge due to the context creation failure. But fixing the\nissue correctly rather ignoring it means we won't get CI complaining\nwhen the fast request patch lands and enables the extra error checking.\n\nSo fix it by checking for errors and aborting as appropriate when\ncreating kernel contexts. While at it, clean up some other submission\ninit related failure cleanup paths. Also, rename guc_init_lrc_mapping\nto guc_init_submission as the former name hasn't been valid in a long\ntime.\n\nv2: Add another wrapper to keep the flow balanced (Daniele)\n\nSigned-off-by: John Harrison <John.C.Harrison@Intel.com>\nReviewed-by: Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>\nLink: https://patchwork.freedesktop.org/patch/msgid/20230217223308.3449737-3-John.C.Harrison@Intel.com",
  "full_message": "drm/i915/guc: Fix missing return code checks in submission init\n\nThe CI results for the 'fast request' patch set (enables error return\ncodes for fire-and-forget H2G messages) hit an issue with the KMD\nsending context submission requests on an invalid context. That was\ncaused by a fault injection probe failing the context creation of a\nkernel context. However, there was no return code checking on any of\nthe kernel context registration paths. So the driver kept going and\ntried to use the kernel context for the record defaults process.\n\nThis would not cause any actual problems. The invalid requests would\nbe rejected by GuC and ultimately the start up sequence would\ncorrectly wedge due to the context creation failure. But fixing the\nissue correctly rather ignoring it means we won't get CI complaining\nwhen the fast request patch lands and enables the extra error checking.\n\nSo fix it by checking for errors and aborting as appropriate when\ncreating kernel contexts. While at it, clean up some other submission\ninit related failure cleanup paths. Also, rename guc_init_lrc_mapping\nto guc_init_submission as the former name hasn't been valid in a long\ntime.\n\nv2: Add another wrapper to keep the flow balanced (Daniele)\n\nSigned-off-by: John Harrison <John.C.Harrison@Intel.com>\nReviewed-by: Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>\nLink: https://patchwork.freedesktop.org/patch/msgid/20230217223308.3449737-3-John.C.Harrison@Intel.com",
  "author_name": "John Harrison",
  "author_email": "John.C.Harrison@Intel.com",
  "author_date": "Fri Feb 17 14:33:08 2023 -0800",
  "author_date_iso": "2023-02-17T14:33:08-08:00",
  "committer_name": "John Harrison",
  "committer_email": "John.C.Harrison@Intel.com",
  "committer_date": "Fri Mar 10 17:47:22 2023 -0800",
  "committer_date_iso": "2023-03-10T17:47:22-08:00",
  "files_changed": [
    "drivers/gpu/drm/i915/gt/uc/intel_guc_submission.c",
    "drivers/gpu/drm/i915/gt/uc/intel_guc_submission.h",
    "drivers/gpu/drm/i915/gt/uc/intel_uc.c"
  ],
  "files_changed_count": 3,
  "stats": [
    {
      "file": "drivers/gpu/drm/i915/gt/uc/intel_guc_submission.c",
      "insertions": 74,
      "deletions": 23
    },
    {
      "file": "drivers/gpu/drm/i915/gt/uc/intel_guc_submission.h",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/gpu/drm/i915/gt/uc/intel_uc.c",
      "insertions": 5,
      "deletions": 2
    }
  ],
  "total_insertions": 80,
  "total_deletions": 26,
  "total_changes": 106,
  "parents": [
    "fcb0348912ab718a3613c13cba264aecc7462c74"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/gpu/drm/i915/gt/uc/intel_guc_submission.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/gpu/drm/i915/gt/uc/intel_guc_submission.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/gpu/drm/i915/gt/uc/intel_uc.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}