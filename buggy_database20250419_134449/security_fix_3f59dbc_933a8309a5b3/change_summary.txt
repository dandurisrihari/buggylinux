Files changed: 5
Insertions: 32874
Deletions: 23281
Total changes: 56155

File-specific changes:
MAINTAINERS: +7 -0
arch/powerpc/perf/core-book3s.c: +8 -10
arch/x86/events/amd/core.c: +2 -11
arch/x86/events/core.c: +8 -0
arch/x86/events/intel/bts.c: +5 -3
arch/x86/events/intel/core.c: +10 -2
arch/x86/events/intel/lbr.c: +23 -0
arch/x86/events/intel/p4.c: +3 -2
arch/x86/events/intel/pt.c: +168 -35
arch/x86/events/intel/pt.h: +9 -3
arch/x86/events/perf_event.h: +11 -0
arch/x86/include/asm/asm.h: +5 -3
arch/x86/include/asm/emulate_prefix.h: +14 -0
arch/x86/include/asm/insn.h: +6 -0
arch/x86/include/asm/xen/interface.h: +4 -7
arch/x86/kernel/kprobes/core.c: +4 -0
arch/x86/kvm/x86.c: +3 -1
arch/x86/lib/insn.c: +34 -0
arch/x86/lib/x86-opcode-map.txt: +12 -6
include/linux/lsm_hooks.h: +15 -0
include/linux/perf_event.h: +59 -5
include/linux/security.h: +38 -1
include/uapi/linux/perf_event.h: +8 -2
kernel/events/core.c: +290 -38
kernel/events/internal.h: +1 -0
kernel/events/ring_buffer.c: +48 -12
kernel/trace/trace_event_perf.c: +10 -5
security/security.c: +27 -0
security/selinux/hooks.c: +69 -0
security/selinux/include/classmap.h: +2 -0
security/selinux/include/objsec.h: +5 -1
tools/arch/x86/include/asm/emulate_prefix.h: +14 -0
tools/arch/x86/include/asm/insn.h: +6 -0
tools/arch/x86/include/asm/irq_vectors.h: +146 -0
tools/arch/x86/include/asm/msr-index.h: +857 -0
tools/arch/x86/lib/insn.c: +34 -0
tools/arch/x86/lib/x86-opcode-map.txt: +12 -6
tools/include/uapi/linux/perf_event.h: +8 -2
tools/lib/subcmd/Makefile: +6 -3
tools/lib/traceevent/Makefile: +4 -4
tools/lib/traceevent/event-parse.c: +5 -2
tools/lib/traceevent/parse-filter.c: +7 -2
tools/objtool/sync-check.sh: +2 -1
tools/perf/Documentation/intel-pt.txt: +57 -2
tools/perf/Documentation/perf-config.txt: +5 -0
tools/perf/Documentation/perf-diff.txt: +5 -0
tools/perf/Documentation/perf-list.txt: +3 -0
tools/perf/Documentation/perf-record.txt: +16 -0
tools/perf/Documentation/perf-report.txt: +11 -0
tools/perf/Documentation/perf-stat.txt: +11 -0
tools/perf/Documentation/perf-trace.txt: +14 -0
tools/perf/Documentation/perf.data-directory-format.txt: +63 -0
tools/perf/Documentation/perf.txt: +2 -0
tools/perf/Makefile.config: +20 -13
tools/perf/Makefile.perf: +20 -1
tools/perf/arch/arm/util/Build: +2 -0
tools/perf/arch/arm/util/perf_regs.c: +6 -0
tools/perf/arch/arm64/util/Build: +1 -0
tools/perf/arch/arm64/util/perf_regs.c: +6 -0
tools/perf/arch/arm64/util/sym-handling.c: +2 -1
tools/perf/arch/csky/util/Build: +2 -0
tools/perf/arch/csky/util/perf_regs.c: +6 -0
tools/perf/arch/powerpc/util/kvm-stat.c: +2 -2
tools/perf/arch/riscv/util/Build: +2 -0
tools/perf/arch/riscv/util/perf_regs.c: +6 -0
tools/perf/arch/s390/annotate/instructions.c: +4 -4
tools/perf/arch/s390/util/Build: +1 -0
tools/perf/arch/s390/util/perf_regs.c: +6 -0
tools/perf/arch/x86/tests/insn-x86-dat-32.c: +52 -0
tools/perf/arch/x86/tests/insn-x86-dat-64.c: +62 -0
tools/perf/arch/x86/tests/insn-x86-dat-src.c: +109 -0
tools/perf/arch/x86/tests/perf-time-to-tsc.c: +5 -4
tools/perf/arch/x86/util/auxtrace.c: +4 -0
tools/perf/arch/x86/util/event.c: +1 -1
tools/perf/arch/x86/util/intel-bts.c: +5 -0
tools/perf/arch/x86/util/intel-pt.c: +80 -1
tools/perf/builtin-annotate.c: +4 -4
tools/perf/builtin-diff.c: +155 -103
tools/perf/builtin-inject.c: +29 -54
tools/perf/builtin-kmem.c: +2 -2
tools/perf/builtin-kvm.c: +7 -6
tools/perf/builtin-list.c: +10 -4
tools/perf/builtin-record.c: +150 -10
tools/perf/builtin-report.c: +72 -9
tools/perf/builtin-sched.c: +1 -1
tools/perf/builtin-script.c: +3 -7
tools/perf/builtin-stat.c: +60 -0
tools/perf/builtin-top.c: +21 -8
tools/perf/builtin-trace.c: +834 -159
tools/perf/check-headers.sh: +4 -1
tools/perf/lib/Build: +1 -0
tools/perf/lib/Makefile: +4 -2
tools/perf/lib/core.c: +2 -1
tools/perf/lib/evlist.c: +357 -0
tools/perf/lib/evsel.c: +2 -1
tools/perf/lib/include/internal/evlist.h: +43 -0
tools/perf/lib/include/internal/evsel.h: +1 -0
tools/perf/lib/include/internal/mmap.h: +34 -11
tools/perf/lib/include/internal/tests.h: +17 -3
tools/perf/lib/include/perf/core.h: +3 -0
tools/perf/lib/include/perf/evlist.h: +14 -1
tools/perf/lib/include/perf/evsel.h: +0 -2
tools/perf/lib/include/perf/mmap.h: +15 -0
tools/perf/lib/internal.h: +5 -0
tools/perf/lib/libperf.map: +8 -2
tools/perf/lib/mmap.c: +275 -0
tools/perf/lib/tests/Makefile: +3 -3
tools/perf/lib/tests/test-cpumap.c: +1 -1
tools/perf/lib/tests/test-evlist.c: +218 -1
tools/perf/lib/tests/test-evsel.c: +1 -1
tools/perf/lib/tests/test-threadmap.c: +1 -1
tools/perf/pmu-events/arch/arm64/ampere/emag/branch.json: +4 -4
tools/perf/pmu-events/arch/arm64/ampere/emag/bus.json: +7 -7
tools/perf/pmu-events/arch/arm64/ampere/emag/cache.json: +14 -14
tools/perf/pmu-events/arch/arm64/ampere/emag/clock.json: +1 -1
tools/perf/pmu-events/arch/arm64/ampere/emag/exception.json: +13 -13
tools/perf/pmu-events/arch/arm64/ampere/emag/instruction.json: +14 -14
tools/perf/pmu-events/arch/arm64/ampere/emag/intrinsic.json: +5 -5
tools/perf/pmu-events/arch/arm64/ampere/emag/memory.json: +6 -6
tools/perf/pmu-events/arch/arm64/ampere/emag/pipeline.json: +1 -1
tools/perf/pmu-events/arch/arm64/arm/cortex-a53/branch.json: +1 -1
tools/perf/pmu-events/arch/arm64/arm/cortex-a53/bus.json: +2 -2
tools/perf/pmu-events/arch/arm64/arm/cortex-a53/other.json: +2 -2
tools/perf/pmu-events/arch/arm64/arm/cortex-a57-a72/core-imp-def.json: +60 -60
tools/perf/pmu-events/arch/arm64/armv8-recommended.json: +79 -79
tools/perf/pmu-events/arch/arm64/cavium/thunderx2/core-imp-def.json: +37 -37
tools/perf/pmu-events/arch/arm64/hisilicon/hip08/core-imp-def.json: +30 -30
tools/perf/pmu-events/arch/arm64/hisilicon/hip08/uncore-ddrc.json: +22 -8
tools/perf/pmu-events/arch/arm64/hisilicon/hip08/uncore-hha.json: +29 -8
tools/perf/pmu-events/arch/arm64/hisilicon/hip08/uncore-l3c.json: +61 -5
tools/perf/pmu-events/arch/powerpc/power8/cache.json: +30 -30
tools/perf/pmu-events/arch/powerpc/power8/floating-point.json: +3 -3
tools/perf/pmu-events/arch/powerpc/power8/frontend.json: +79 -79
tools/perf/pmu-events/arch/powerpc/power8/marked.json: +133 -133
tools/perf/pmu-events/arch/powerpc/power8/memory.json: +36 -36
tools/perf/pmu-events/arch/powerpc/power8/other.json: +575 -575
tools/perf/pmu-events/arch/powerpc/power8/pipeline.json: +59 -59
tools/perf/pmu-events/arch/powerpc/power8/pmc.json: +24 -24
tools/perf/pmu-events/arch/powerpc/power8/translation.json: +30 -30
tools/perf/pmu-events/arch/powerpc/power9/cache.json: +22 -22
tools/perf/pmu-events/arch/powerpc/power9/floating-point.json: +7 -7
tools/perf/pmu-events/arch/powerpc/power9/frontend.json: +71 -71
tools/perf/pmu-events/arch/powerpc/power9/marked.json: +125 -125
tools/perf/pmu-events/arch/powerpc/power9/memory.json: +26 -26
tools/perf/pmu-events/arch/powerpc/power9/other.json: +467 -467
tools/perf/pmu-events/arch/powerpc/power9/pipeline.json: +106 -106
tools/perf/pmu-events/arch/powerpc/power9/pmc.json: +24 -24
tools/perf/pmu-events/arch/powerpc/power9/translation.json: +46 -46
tools/perf/pmu-events/arch/x86/broadwell/bdw-metrics.json: +89 -89
tools/perf/pmu-events/arch/x86/broadwellx/bdx-metrics.json: +92 -92
tools/perf/pmu-events/arch/x86/cascadelakex/cache.json: +5936 -6132
tools/perf/pmu-events/arch/x86/cascadelakex/clx-metrics.json: +114 -96
tools/perf/pmu-events/arch/x86/cascadelakex/floating-point.json: +46 -46
tools/perf/pmu-events/arch/x86/cascadelakex/frontend.json: +328 -328
tools/perf/pmu-events/arch/x86/cascadelakex/memory.json: +5704 -5704
tools/perf/pmu-events/arch/x86/cascadelakex/other.json: +4687 -4933
tools/perf/pmu-events/arch/x86/cascadelakex/pipeline.json: +617 -617
tools/perf/pmu-events/arch/x86/cascadelakex/uncore-memory.json: +191 -0
tools/perf/pmu-events/arch/x86/cascadelakex/uncore-other.json: +1550 -35
tools/perf/pmu-events/arch/x86/cascadelakex/virtual-memory.json: +169 -170
tools/perf/pmu-events/arch/x86/haswell/hsw-metrics.json: +82 -82
tools/perf/pmu-events/arch/x86/haswellx/hsx-metrics.json: +85 -85
tools/perf/pmu-events/arch/x86/ivybridge/ivb-metrics.json: +85 -85
tools/perf/pmu-events/arch/x86/ivytown/ivt-metrics.json: +86 -86
tools/perf/pmu-events/arch/x86/jaketown/jkt-metrics.json: +57 -57
tools/perf/pmu-events/arch/x86/sandybridge/snb-metrics.json: +56 -56
tools/perf/pmu-events/arch/x86/skylake/skl-metrics.json: +97 -91
tools/perf/pmu-events/arch/x86/skylakex/skx-metrics.json: +111 -93
tools/perf/pmu-events/jevents.c: +31 -8
tools/perf/pmu-events/jevents.h: +2 -1
tools/perf/pmu-events/pmu-events.h: +1 -0
tools/perf/scripts/python/exported-sql-viewer.py: +1539 -26
tools/perf/tests/attr/base-record: +1 -1
tools/perf/tests/attr/base-stat: +1 -1
tools/perf/tests/backward-ring-buffer.c: +13 -3
tools/perf/tests/bp_account.c: +16 -4
tools/perf/tests/bp_signal.c: +6 -9
tools/perf/tests/bpf.c: +4 -3
tools/perf/tests/builtin-test.c: +1 -1
tools/perf/tests/code-reading.c: +5 -4
tools/perf/tests/dwarf-unwind.c: +1 -1
tools/perf/tests/keep-tracking.c: +5 -4
tools/perf/tests/map_groups.c: +5 -6
tools/perf/tests/mmap-basic.c: +5 -4
tools/perf/tests/openat-syscall-tp-fields.c: +5 -4
tools/perf/tests/parse-events.c: +2 -1
tools/perf/tests/perf-record.c: +5 -4
tools/perf/tests/sample-parsing.c: +15 -1
tools/perf/tests/sw-clock.c: +5 -4
tools/perf/tests/switch-tracking.c: +5 -4
tools/perf/tests/task-exit.c: +14 -4
tools/perf/tests/tests.h: +1 -0
tools/perf/tests/vmlinux-kallsyms.c: +3 -3
tools/perf/trace/beauty/Build: +1 -0
tools/perf/trace/beauty/beauty.h: +34 -1
tools/perf/trace/beauty/mmap.c: +2 -2
tools/perf/trace/beauty/tracepoints/Build: +2 -0
tools/perf/trace/beauty/tracepoints/x86_irq_vectors.c: +29 -0
tools/perf/trace/beauty/tracepoints/x86_irq_vectors.sh: +27 -0
tools/perf/trace/beauty/tracepoints/x86_msr.c: +39 -0
tools/perf/trace/beauty/tracepoints/x86_msr.sh: +40 -0
tools/perf/ui/browsers/annotate.c: +12 -13
tools/perf/ui/browsers/hists.c: +91 -14
tools/perf/ui/browsers/hists.h: +2 -0
tools/perf/ui/gtk/annotate.c: +14 -13
tools/perf/ui/stdio/hist.c: +28 -1
tools/perf/util/Build: +2 -0
tools/perf/util/annotate.c: +188 -117
tools/perf/util/annotate.h: +10 -14
tools/perf/util/auxtrace.c: +338 -12
tools/perf/util/auxtrace.h: +44 -0
tools/perf/util/block-info.c: +477 -0
tools/perf/util/block-info.h: +79 -0
tools/perf/util/callchain.c: +20 -20
tools/perf/util/callchain.h: +2 -3
tools/perf/util/cpumap.c: +18 -0
tools/perf/util/cpumap.h: +3 -0
tools/perf/util/cs-etm.c: +2 -2
tools/perf/util/data.c: +43 -3
tools/perf/util/data.h: +12 -0
tools/perf/util/db-export.c: +8 -8
tools/perf/util/debug.c: +2 -0
tools/perf/util/debug.h: +9 -0
tools/perf/util/dso.c: +112 -47
tools/perf/util/dso.h: +20 -0
tools/perf/util/dsos.c: +77 -20
tools/perf/util/dsos.h: +5 -9
tools/perf/util/dwarf-aux.c: +124 -18
tools/perf/util/dwarf-aux.h: +3 -0
tools/perf/util/env.c: +56 -0
tools/perf/util/env.h: +7 -0
tools/perf/util/event.c: +3 -3
tools/perf/util/event.h: +6 -0
tools/perf/util/evlist.c: +135 -199
tools/perf/util/evlist.h: +13 -0
tools/perf/util/evsel.c: +55 -21
tools/perf/util/evsel_config.h: +13 -0
tools/perf/util/evsel_fprintf.c: +17 -12
tools/perf/util/header.h: +0 -4
tools/perf/util/hist.c: +43 -28
tools/perf/util/hist.h: +17 -1
tools/perf/util/intel-pt.c: +106 -3
tools/perf/util/llvm-utils.c: +2 -3
tools/perf/util/machine.c: +58 -67
tools/perf/util/machine.h: +2 -2
tools/perf/util/map.c: +82 -96
tools/perf/util/map.h: +7 -10
tools/perf/util/map_groups.h: +20 -11
tools/perf/util/map_symbol.h: +3 -2
tools/perf/util/mem-events.c: +1 -1
tools/perf/util/metricgroup.c: +1 -1
tools/perf/util/mmap.c: +15 -245
tools/perf/util/mmap.h: +5 -23
tools/perf/util/parse-events.c: +237 -71
tools/perf/util/parse-events.h: +9 -1
tools/perf/util/parse-events.l: +1 -0
tools/perf/util/parse-events.y: +287 -104
tools/perf/util/parse-regs-options.c: +6 -2
tools/perf/util/perf_event_attr_fprintf.c: +2 -1
tools/perf/util/perf_regs.c: +0 -4
tools/perf/util/perf_regs.h: +2 -2
tools/perf/util/pmu.c: +42 -17
tools/perf/util/pmu.h: +5 -1
tools/perf/util/probe-event.c: +17 -4
tools/perf/util/probe-event.h: +3 -0
tools/perf/util/probe-file.c: +14 -0
tools/perf/util/probe-file.h: +2 -0
tools/perf/util/probe-finder.c: +162 -31
tools/perf/util/probe-finder.h: +1 -0
tools/perf/util/python.c: +5 -3
tools/perf/util/record.c: +31 -0
tools/perf/util/record.h: +3 -0
tools/perf/util/scripting-engines/trace-event-perl.c: +8 -8
tools/perf/util/scripting-engines/trace-event-python.c: +9 -9
tools/perf/util/session.c: +69 -50
tools/perf/util/session.h: +6 -5
tools/perf/util/sort.c: +49 -64
tools/perf/util/sort.h: +4 -0
tools/perf/util/spark.c: +34 -0
tools/perf/util/spark.h: +8 -0
tools/perf/util/stat-display.c: +15 -0
tools/perf/util/stat.c: +11 -0
tools/perf/util/stat.h: +3 -0
tools/perf/util/string2.h: +3 -0
tools/perf/util/symbol-elf.c: +1 -1
tools/perf/util/symbol.c: +81 -79
tools/perf/util/symbol.h: +2 -24
tools/perf/util/symbol_conf.h: +1 -0
tools/perf/util/synthetic-events.c: +13 -1
tools/perf/util/thread.c: +1 -1
tools/perf/util/time-utils.c: +24 -3
tools/perf/util/time-utils.h: +5 -0
tools/perf/util/unwind-libdw.c: +4 -3
tools/perf/util/unwind-libunwind-local.c: +4 -3
tools/perf/util/unwind.h: +3 -5
tools/perf/util/util.c: +18 -1
tools/perf/util/vdso.c: +2 -2
