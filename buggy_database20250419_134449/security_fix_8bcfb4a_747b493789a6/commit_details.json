{
  "hash": "8bcfb4ae4d970b9a9724ddfbac26c387934e0e94",
  "hash_short": "8bcfb4ae",
  "subject": "selftests: forwarding: Fix failing tests with old libnet",
  "body": "The custom multipath hash tests use mausezahn in order to test how\nchanges in various packet fields affect the packet distribution across\nthe available nexthops.\n\nThe tool uses the libnet library for various low-level packet\nconstruction and injection. The library started using the\n\"SO_BINDTODEVICE\" socket option for IPv6 sockets in version 1.1.6 and\nfor IPv4 sockets in version 1.2.\n\nWhen the option is not set, packets are not routed according to the\ntable associated with the VRF master device and tests fail.\n\nFix this by prefixing the command with \"ip vrf exec\", which will cause\nthe route lookup to occur in the VRF routing table. This makes the tests\npass regardless of the libnet library version.\n\nFixes: 511e8db54036 (\"selftests: forwarding: Add test for custom multipath hash\")\nFixes: 185b0c190bb6 (\"selftests: forwarding: Add test for custom multipath hash with IPv4 GRE\")\nFixes: b7715acba4d3 (\"selftests: forwarding: Add test for custom multipath hash with IPv6 GRE\")\nReported-by: Ivan Vecera <ivecera@redhat.com>\nTested-by: Ivan Vecera <ivecera@redhat.com>\nSigned-off-by: Ido Schimmel <idosch@nvidia.com>\nReviewed-by: Amit Cohen <amcohen@nvidia.com>\nLink: https://lore.kernel.org/r/20220809113320.751413-1-idosch@nvidia.com\nSigned-off-by: Jakub Kicinski <kuba@kernel.org>",
  "full_message": "selftests: forwarding: Fix failing tests with old libnet\n\nThe custom multipath hash tests use mausezahn in order to test how\nchanges in various packet fields affect the packet distribution across\nthe available nexthops.\n\nThe tool uses the libnet library for various low-level packet\nconstruction and injection. The library started using the\n\"SO_BINDTODEVICE\" socket option for IPv6 sockets in version 1.1.6 and\nfor IPv4 sockets in version 1.2.\n\nWhen the option is not set, packets are not routed according to the\ntable associated with the VRF master device and tests fail.\n\nFix this by prefixing the command with \"ip vrf exec\", which will cause\nthe route lookup to occur in the VRF routing table. This makes the tests\npass regardless of the libnet library version.\n\nFixes: 511e8db54036 (\"selftests: forwarding: Add test for custom multipath hash\")\nFixes: 185b0c190bb6 (\"selftests: forwarding: Add test for custom multipath hash with IPv4 GRE\")\nFixes: b7715acba4d3 (\"selftests: forwarding: Add test for custom multipath hash with IPv6 GRE\")\nReported-by: Ivan Vecera <ivecera@redhat.com>\nTested-by: Ivan Vecera <ivecera@redhat.com>\nSigned-off-by: Ido Schimmel <idosch@nvidia.com>\nReviewed-by: Amit Cohen <amcohen@nvidia.com>\nLink: https://lore.kernel.org/r/20220809113320.751413-1-idosch@nvidia.com\nSigned-off-by: Jakub Kicinski <kuba@kernel.org>",
  "author_name": "Ido Schimmel",
  "author_email": "idosch@nvidia.com",
  "author_date": "Tue Aug 9 14:33:20 2022 +0300",
  "author_date_iso": "2022-08-09T14:33:20+03:00",
  "committer_name": "Jakub Kicinski",
  "committer_email": "kuba@kernel.org",
  "committer_date": "Wed Aug 10 22:36:14 2022 -0700",
  "committer_date_iso": "2022-08-10T22:36:14-07:00",
  "files_changed": [
    "tools/testing/selftests/net/forwarding/custom_multipath_hash.sh",
    "tools/testing/selftests/net/forwarding/gre_custom_multipath_hash.sh",
    "tools/testing/selftests/net/forwarding/ip6gre_custom_multipath_hash.sh"
  ],
  "files_changed_count": 3,
  "stats": [
    {
      "file": "tools/testing/selftests/net/forwarding/custom_multipath_hash.sh",
      "insertions": 16,
      "deletions": 8
    },
    {
      "file": "tools/testing/selftests/net/forwarding/gre_custom_multipath_hash.sh",
      "insertions": 16,
      "deletions": 8
    },
    {
      "file": "tools/testing/selftests/net/forwarding/ip6gre_custom_multipath_hash.sh",
      "insertions": 16,
      "deletions": 8
    }
  ],
  "total_insertions": 48,
  "total_deletions": 24,
  "total_changes": 72,
  "parents": [
    "fbe8870f72e8e71bb57b883d29c600aaaca6cd20"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "tools/testing/selftests/net/forwarding/custom_multipath_hash.sh",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "tools/testing/selftests/net/forwarding/gre_custom_multipath_hash.sh",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "tools/testing/selftests/net/forwarding/ip6gre_custom_multipath_hash.sh",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}