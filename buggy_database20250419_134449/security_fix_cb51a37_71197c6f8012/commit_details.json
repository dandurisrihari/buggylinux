{
  "hash": "cb51a371d08e813b0be4253ad9efbc8488b69149",
  "hash_short": "cb51a371",
  "subject": "EDAC/ghes: Setup DIMM label from DMI and use it in error reports",
  "body": "The ghes driver reports errors with 'unknown label' even if the actual\nDIMM label is known, e.g.:\n\n EDAC MC0: 1 CE Single-bit ECC on unknown label (node:0 card:0\n   module:0 rank:1 bank:0 col:13 bit_pos:16 DIMM location:N0 DIMM_A0\n   page:0x966a9b3 offset:0x0 grain:1 syndrome:0x0 - APEI location:\n   node:0 card:0 module:0 rank:1 bank:0 col:13 bit_pos:16 DIMM\n   location:N0 DIMM_A0 status(0x0000000000000400): Storage error in\n   DRAM memory)\n\nFix this by using struct dimm_info's label string in error reports:\n\n EDAC MC0: 1 CE Single-bit ECC on N0 DIMM_A0 (node:0 card:0 module:0\n   rank:1 bank:515 col:14 bit_pos:16 DIMM location:N0 DIMM_A0\n   page:0x99223d8 offset:0x0 grain:1 syndrome:0x0 - APEI location:\n   node:0 card:0 module:0 rank:1 bank:515 col:14 bit_pos:16 DIMM\n   location:N0 DIMM_A0 status(0x0000000000000400): Storage error in\n   DRAM memory)\n\nThe labels are initialized by reading the bank and device strings\nfrom DMI. Now, the label information can also read from sysfs. E.g. a\nThunderX2 system will show the following:\n\n  /sys/devices/system/edac/mc/mc0/dimm0/dimm_label:N0 DIMM_A0\n  /sys/devices/system/edac/mc/mc0/dimm1/dimm_label:N0 DIMM_B0\n  /sys/devices/system/edac/mc/mc0/dimm2/dimm_label:N0 DIMM_C0\n  /sys/devices/system/edac/mc/mc0/dimm3/dimm_label:N0 DIMM_D0\n  /sys/devices/system/edac/mc/mc0/dimm4/dimm_label:N0 DIMM_E0\n  /sys/devices/system/edac/mc/mc0/dimm5/dimm_label:N0 DIMM_F0\n  /sys/devices/system/edac/mc/mc0/dimm6/dimm_label:N0 DIMM_G0\n  /sys/devices/system/edac/mc/mc0/dimm7/dimm_label:N0 DIMM_H0\n  /sys/devices/system/edac/mc/mc0/dimm8/dimm_label:N1 DIMM_I0\n  /sys/devices/system/edac/mc/mc0/dimm9/dimm_label:N1 DIMM_J0\n  /sys/devices/system/edac/mc/mc0/dimm10/dimm_label:N1 DIMM_K0\n  /sys/devices/system/edac/mc/mc0/dimm11/dimm_label:N1 DIMM_L0\n  /sys/devices/system/edac/mc/mc0/dimm12/dimm_label:N1 DIMM_M0\n  /sys/devices/system/edac/mc/mc0/dimm13/dimm_label:N1 DIMM_N0\n  /sys/devices/system/edac/mc/mc0/dimm14/dimm_label:N1 DIMM_O0\n  /sys/devices/system/edac/mc/mc0/dimm15/dimm_label:N1 DIMM_P0\n\nSince dimm_labels can be rewritten, that label will be used in a later\nerror report:\n\n  # echo foobar >/sys/devices/system/edac/mc/mc0/dimm0/dimm_label\n  # # some error injection here\n  # dmesg | grep foobar\n  [ 751.383533] EDAC MC0: 1 CE Single-bit ECC on foobar (node:0 card:0\n  module:0 rank:1 bank:259 col:3 bit_pos:16 DIMM location:N0 DIMM_A0\n  page:0x8c8dc74 offset:0x0 grain:1 syndrome:0x0 - APEI location:\n  node:0 card:0 module:0 rank:1 bank:259 col:3 bit_pos:16 DIMM\n  location:N0 DIMM_A0 status(0x0000000000000400): Storage error in DRAM\n  memory)\n\n [ bp: Remove curly brackets around a single if-statement in dimm_setup_label(). ]\n\nSigned-off-by: Robert Richter <rrichter@marvell.com>\nSigned-off-by: Borislav Petkov <bp@suse.de>\nLink: https://lkml.kernel.org/r/20200528101307.23245-1-rrichter@marvell.com",
  "full_message": "EDAC/ghes: Setup DIMM label from DMI and use it in error reports\n\nThe ghes driver reports errors with 'unknown label' even if the actual\nDIMM label is known, e.g.:\n\n EDAC MC0: 1 CE Single-bit ECC on unknown label (node:0 card:0\n   module:0 rank:1 bank:0 col:13 bit_pos:16 DIMM location:N0 DIMM_A0\n   page:0x966a9b3 offset:0x0 grain:1 syndrome:0x0 - APEI location:\n   node:0 card:0 module:0 rank:1 bank:0 col:13 bit_pos:16 DIMM\n   location:N0 DIMM_A0 status(0x0000000000000400): Storage error in\n   DRAM memory)\n\nFix this by using struct dimm_info's label string in error reports:\n\n EDAC MC0: 1 CE Single-bit ECC on N0 DIMM_A0 (node:0 card:0 module:0\n   rank:1 bank:515 col:14 bit_pos:16 DIMM location:N0 DIMM_A0\n   page:0x99223d8 offset:0x0 grain:1 syndrome:0x0 - APEI location:\n   node:0 card:0 module:0 rank:1 bank:515 col:14 bit_pos:16 DIMM\n   location:N0 DIMM_A0 status(0x0000000000000400): Storage error in\n   DRAM memory)\n\nThe labels are initialized by reading the bank and device strings\nfrom DMI. Now, the label information can also read from sysfs. E.g. a\nThunderX2 system will show the following:\n\n  /sys/devices/system/edac/mc/mc0/dimm0/dimm_label:N0 DIMM_A0\n  /sys/devices/system/edac/mc/mc0/dimm1/dimm_label:N0 DIMM_B0\n  /sys/devices/system/edac/mc/mc0/dimm2/dimm_label:N0 DIMM_C0\n  /sys/devices/system/edac/mc/mc0/dimm3/dimm_label:N0 DIMM_D0\n  /sys/devices/system/edac/mc/mc0/dimm4/dimm_label:N0 DIMM_E0\n  /sys/devices/system/edac/mc/mc0/dimm5/dimm_label:N0 DIMM_F0\n  /sys/devices/system/edac/mc/mc0/dimm6/dimm_label:N0 DIMM_G0\n  /sys/devices/system/edac/mc/mc0/dimm7/dimm_label:N0 DIMM_H0\n  /sys/devices/system/edac/mc/mc0/dimm8/dimm_label:N1 DIMM_I0\n  /sys/devices/system/edac/mc/mc0/dimm9/dimm_label:N1 DIMM_J0\n  /sys/devices/system/edac/mc/mc0/dimm10/dimm_label:N1 DIMM_K0\n  /sys/devices/system/edac/mc/mc0/dimm11/dimm_label:N1 DIMM_L0\n  /sys/devices/system/edac/mc/mc0/dimm12/dimm_label:N1 DIMM_M0\n  /sys/devices/system/edac/mc/mc0/dimm13/dimm_label:N1 DIMM_N0\n  /sys/devices/system/edac/mc/mc0/dimm14/dimm_label:N1 DIMM_O0\n  /sys/devices/system/edac/mc/mc0/dimm15/dimm_label:N1 DIMM_P0\n\nSince dimm_labels can be rewritten, that label will be used in a later\nerror report:\n\n  # echo foobar >/sys/devices/system/edac/mc/mc0/dimm0/dimm_label\n  # # some error injection here\n  # dmesg | grep foobar\n  [ 751.383533] EDAC MC0: 1 CE Single-bit ECC on foobar (node:0 card:0\n  module:0 rank:1 bank:259 col:3 bit_pos:16 DIMM location:N0 DIMM_A0\n  page:0x8c8dc74 offset:0x0 grain:1 syndrome:0x0 - APEI location:\n  node:0 card:0 module:0 rank:1 bank:259 col:3 bit_pos:16 DIMM\n  location:N0 DIMM_A0 status(0x0000000000000400): Storage error in DRAM\n  memory)\n\n [ bp: Remove curly brackets around a single if-statement in dimm_setup_label(). ]\n\nSigned-off-by: Robert Richter <rrichter@marvell.com>\nSigned-off-by: Borislav Petkov <bp@suse.de>\nLink: https://lkml.kernel.org/r/20200528101307.23245-1-rrichter@marvell.com",
  "author_name": "Robert Richter",
  "author_email": "rrichter@marvell.com",
  "author_date": "Thu May 28 12:13:06 2020 +0200",
  "author_date_iso": "2020-05-28T12:13:06+02:00",
  "committer_name": "Borislav Petkov",
  "committer_email": "bp@suse.de",
  "committer_date": "Tue Jun 16 15:22:04 2020 +0200",
  "committer_date_iso": "2020-06-16T15:22:04+02:00",
  "files_changed": [
    "drivers/edac/ghes_edac.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/edac/ghes_edac.c",
      "insertions": 24,
      "deletions": 11
    }
  ],
  "total_insertions": 24,
  "total_deletions": 11,
  "total_changes": 35,
  "parents": [
    "b3a9e3b9622ae10064826dccb4f7a52bd88c7407"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/edac/ghes_edac.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}