{
  "hash": "4b21d25bf519c9487935a664886956bb18f04f6d",
  "hash_short": "4b21d25b",
  "subject": "overflow: Introduce overflows_type() and castable_to_type()",
  "body": "Implement a robust overflows_type() macro to test if a variable or\nconstant value would overflow another variable or type. This can be\nused as a constant expression for static_assert() (which requires a\nconstant expression[1][2]) when used on constant values. This must be\nconstructed manually, since __builtin_add_overflow() does not produce\na constant expression[3].\n\nAdditionally adds castable_to_type(), similar to __same_type(), but for\nchecking if a constant value would overflow if cast to a given type.\n\nAdd unit tests for overflows_type(), __same_type(), and castable_to_type()\nto the existing KUnit \"overflow\" test:\n\n[16:03:33] ================== overflow (21 subtests) ==================\n...\n[16:03:33] [PASSED] overflows_type_test\n[16:03:33] [PASSED] same_type_test\n[16:03:33] [PASSED] castable_to_type_test\n[16:03:33] ==================== [PASSED] overflow =====================\n[16:03:33] ============================================================\n[16:03:33] Testing complete. Ran 21 tests: passed: 21\n[16:03:33] Elapsed time: 24.022s total, 0.002s configuring, 22.598s building, 0.767s running\n\n[1] https://en.cppreference.com/w/c/language/_Static_assert\n[2] C11 standard (ISO/IEC 9899:2011): 6.7.10 Static assertions\n[3] https://gcc.gnu.org/onlinedocs/gcc/Integer-Overflow-Builtins.html\n    6.56 Built-in Functions to Perform Arithmetic with Overflow Checking\n    Built-in Function: bool __builtin_add_overflow (type1 a, type2 b,\n\nCc: Luc Van Oostenryck <luc.vanoostenryck@gmail.com>\nCc: Nathan Chancellor <nathan@kernel.org>\nCc: Nick Desaulniers <ndesaulniers@google.com>\nCc: Tom Rix <trix@redhat.com>\nCc: Daniel Latypov <dlatypov@google.com>\nCc: Vitor Massaru Iha <vitor@massaru.org>\nCc: \"Gustavo A. R. Silva\" <gustavoars@kernel.org>\nCc: Jani Nikula <jani.nikula@intel.com>\nCc: Mauro Carvalho Chehab <mchehab@kernel.org>\nCc: linux-hardening@vger.kernel.org\nCc: llvm@lists.linux.dev\nCo-developed-by: Gwan-gyeong Mun <gwan-gyeong.mun@intel.com>\nSigned-off-by: Gwan-gyeong Mun <gwan-gyeong.mun@intel.com>\nSigned-off-by: Kees Cook <keescook@chromium.org>\nLink: https://lore.kernel.org/r/20221024201125.1416422-1-gwan-gyeong.mun@intel.com",
  "full_message": "overflow: Introduce overflows_type() and castable_to_type()\n\nImplement a robust overflows_type() macro to test if a variable or\nconstant value would overflow another variable or type. This can be\nused as a constant expression for static_assert() (which requires a\nconstant expression[1][2]) when used on constant values. This must be\nconstructed manually, since __builtin_add_overflow() does not produce\na constant expression[3].\n\nAdditionally adds castable_to_type(), similar to __same_type(), but for\nchecking if a constant value would overflow if cast to a given type.\n\nAdd unit tests for overflows_type(), __same_type(), and castable_to_type()\nto the existing KUnit \"overflow\" test:\n\n[16:03:33] ================== overflow (21 subtests) ==================\n...\n[16:03:33] [PASSED] overflows_type_test\n[16:03:33] [PASSED] same_type_test\n[16:03:33] [PASSED] castable_to_type_test\n[16:03:33] ==================== [PASSED] overflow =====================\n[16:03:33] ============================================================\n[16:03:33] Testing complete. Ran 21 tests: passed: 21\n[16:03:33] Elapsed time: 24.022s total, 0.002s configuring, 22.598s building, 0.767s running\n\n[1] https://en.cppreference.com/w/c/language/_Static_assert\n[2] C11 standard (ISO/IEC 9899:2011): 6.7.10 Static assertions\n[3] https://gcc.gnu.org/onlinedocs/gcc/Integer-Overflow-Builtins.html\n    6.56 Built-in Functions to Perform Arithmetic with Overflow Checking\n    Built-in Function: bool __builtin_add_overflow (type1 a, type2 b,\n\nCc: Luc Van Oostenryck <luc.vanoostenryck@gmail.com>\nCc: Nathan Chancellor <nathan@kernel.org>\nCc: Nick Desaulniers <ndesaulniers@google.com>\nCc: Tom Rix <trix@redhat.com>\nCc: Daniel Latypov <dlatypov@google.com>\nCc: Vitor Massaru Iha <vitor@massaru.org>\nCc: \"Gustavo A. R. Silva\" <gustavoars@kernel.org>\nCc: Jani Nikula <jani.nikula@intel.com>\nCc: Mauro Carvalho Chehab <mchehab@kernel.org>\nCc: linux-hardening@vger.kernel.org\nCc: llvm@lists.linux.dev\nCo-developed-by: Gwan-gyeong Mun <gwan-gyeong.mun@intel.com>\nSigned-off-by: Gwan-gyeong Mun <gwan-gyeong.mun@intel.com>\nSigned-off-by: Kees Cook <keescook@chromium.org>\nLink: https://lore.kernel.org/r/20221024201125.1416422-1-gwan-gyeong.mun@intel.com",
  "author_name": "Kees Cook",
  "author_email": "keescook@chromium.org",
  "author_date": "Mon Oct 24 23:11:25 2022 +0300",
  "author_date_iso": "2022-10-24T23:11:25+03:00",
  "committer_name": "Kees Cook",
  "committer_email": "keescook@chromium.org",
  "committer_date": "Wed Nov 2 12:39:27 2022 -0700",
  "committer_date_iso": "2022-11-02T12:39:27-07:00",
  "files_changed": [
    "drivers/gpu/drm/i915/i915_user_extensions.c",
    "drivers/gpu/drm/i915/i915_utils.h",
    "include/linux/compiler.h",
    "include/linux/overflow.h",
    "lib/Makefile",
    "lib/overflow_kunit.c"
  ],
  "files_changed_count": 6,
  "stats": [
    {
      "file": "drivers/gpu/drm/i915/i915_user_extensions.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/gpu/drm/i915/i915_utils.h",
      "insertions": 0,
      "deletions": 4
    },
    {
      "file": "include/linux/compiler.h",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "include/linux/overflow.h",
      "insertions": 47,
      "deletions": 0
    },
    {
      "file": "lib/Makefile",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "lib/overflow_kunit.c",
      "insertions": 381,
      "deletions": 0
    }
  ],
  "total_insertions": 431,
  "total_deletions": 5,
  "total_changes": 436,
  "parents": [
    "6dd142d9013ca82155d0c069434c60a0d5755ec0"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "hardening"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "include/linux/overflow.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/gpu/drm/i915/i915_utils.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/linux/compiler.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/gpu/drm/i915/i915_user_extensions.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "lib/overflow_kunit.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "lib/Makefile",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}