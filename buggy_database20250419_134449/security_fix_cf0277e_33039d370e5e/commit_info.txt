Commit Hash: cf0277e714a0db302a8f80e1b85fd61c32cf00b3
Subject: mac80211: fix skb buffering issue


Security Keywords:
- injection

Full commit message:
mac80211: fix skb buffering issue

Since I removed the master netdev, we've been
keeping internal queues only, and even before
that we never told the networking stack above
the virtual interfaces about congestion. This
means that packets are queued in mac80211 and
the upper layers never know, possibly leading
to memory exhaustion and other problems.

This patch makes all interfaces multiqueue and
uses ndo_select_queue to put the packets into
queues per AC. Additionally, when the driver
stops a queue, we now stop all corresponding
queues for the virtual interfaces as well.

The injection case will use VO by default for
non-data frames, and BE for data frames, but
downgrade any data frames according to ACM. It
needs to be fleshed out in the future to allow
chosing the queue/AC in radiotap.

Reported-by: Lennert Buytenhek <buytenh@marvell.com>
Signed-off-by: Johannes Berg <johannes@sipsolutions.net>
Cc: stable@kernel.org [2.6.32]
Signed-off-by: John W. Linville <linville@tuxdriver.com>

Metadata:
Author: Johannes Berg <johannes@sipsolutions.net>
Author Date: Tue Jan 5 18:00:58 2010 +0100
Committer: John W. Linville <linville@tuxdriver.com>
Commit Date: Tue Jan 5 16:21:40 2010 -0500

Files Changed: 6
Lines Added: 132
Lines Removed: 32
Total Changes: 164
