Commit Hash: beda430177f56656e7980dcce93456ffaa35676b
Subject: KVM: x86: Ensure deadline timer has truly expired before posting its IRQ


Security Keywords:
- injection

Full commit message:
KVM: x86: Ensure deadline timer has truly expired before posting its IRQ

When posting a deadline timer interrupt, open code the checks guarding
__kvm_wait_lapic_expire() in order to skip the lapic_timer_int_injected()
check in kvm_wait_lapic_expire().  The injection check will always fail
since the interrupt has not yet be injected.  Moving the call after
injection would also be wrong as that wouldn't actually delay delivery
of the IRQ if it is indeed sent via posted interrupt.

Fixes: 010fd37fddf6 ("KVM: LAPIC: Reduce world switch latency caused by timer_advance_ns")
Cc: stable@vger.kernel.org
Signed-off-by: Sean Christopherson <seanjc@google.com>
Message-Id: <20210305021808.3769732-1-seanjc@google.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

Metadata:
Author: Sean Christopherson <seanjc@google.com>
Author Date: Thu Mar 4 18:18:08 2021 -0800
Committer: Paolo Bonzini <pbonzini@redhat.com>
Commit Date: Fri Mar 5 08:30:21 2021 -0500

Files Changed: 1
Lines Added: 10
Lines Removed: 1
Total Changes: 11
