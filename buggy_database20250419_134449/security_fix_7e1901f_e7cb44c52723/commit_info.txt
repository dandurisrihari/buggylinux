Commit Hash: 7e1901f6c86c896acff6609e0176f93f756d8b2a
Subject: KVM: VMX: prepare sync_pir_to_irr for running with APICv disabled


Security Keywords:
- injection

Full commit message:
KVM: VMX: prepare sync_pir_to_irr for running with APICv disabled

If APICv is disabled for this vCPU, assigned devices may still attempt to
post interrupts.  In that case, we need to cancel the vmentry and deliver
the interrupt with KVM_REQ_EVENT.  Extend the existing code that handles
injection of L1 interrupts into L2 to cover this case as well.

vmx_hwapic_irr_update is only called when APICv is active so it would be
confusing to add a check for vcpu->arch.apicv_active in there.  Instead,
just use vmx_set_rvi directly in vmx_sync_pir_to_irr.

Cc: stable@vger.kernel.org
Reviewed-by: Maxim Levitsky <mlevitsk@redhat.com>
Reviewed-by: David Matlack <dmatlack@google.com>
Reviewed-by: Sean Christopherson <seanjc@google.com>
Message-Id: <20211123004311.2954158-3-pbonzini@redhat.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

Metadata:
Author: Paolo Bonzini <pbonzini@redhat.com>
Author Date: Mon Nov 22 19:43:09 2021 -0500
Committer: Paolo Bonzini <pbonzini@redhat.com>
Commit Date: Tue Nov 30 03:51:58 2021 -0500

Files Changed: 1
Lines Added: 25
Lines Removed: 14
Total Changes: 39
