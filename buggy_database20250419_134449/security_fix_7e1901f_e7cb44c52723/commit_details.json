{
  "hash": "7e1901f6c86c896acff6609e0176f93f756d8b2a",
  "hash_short": "7e1901f6",
  "subject": "KVM: VMX: prepare sync_pir_to_irr for running with APICv disabled",
  "body": "If APICv is disabled for this vCPU, assigned devices may still attempt to\npost interrupts.  In that case, we need to cancel the vmentry and deliver\nthe interrupt with KVM_REQ_EVENT.  Extend the existing code that handles\ninjection of L1 interrupts into L2 to cover this case as well.\n\nvmx_hwapic_irr_update is only called when APICv is active so it would be\nconfusing to add a check for vcpu->arch.apicv_active in there.  Instead,\njust use vmx_set_rvi directly in vmx_sync_pir_to_irr.\n\nCc: stable@vger.kernel.org\nReviewed-by: Maxim Levitsky <mlevitsk@redhat.com>\nReviewed-by: David Matlack <dmatlack@google.com>\nReviewed-by: Sean Christopherson <seanjc@google.com>\nMessage-Id: <20211123004311.2954158-3-pbonzini@redhat.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "full_message": "KVM: VMX: prepare sync_pir_to_irr for running with APICv disabled\n\nIf APICv is disabled for this vCPU, assigned devices may still attempt to\npost interrupts.  In that case, we need to cancel the vmentry and deliver\nthe interrupt with KVM_REQ_EVENT.  Extend the existing code that handles\ninjection of L1 interrupts into L2 to cover this case as well.\n\nvmx_hwapic_irr_update is only called when APICv is active so it would be\nconfusing to add a check for vcpu->arch.apicv_active in there.  Instead,\njust use vmx_set_rvi directly in vmx_sync_pir_to_irr.\n\nCc: stable@vger.kernel.org\nReviewed-by: Maxim Levitsky <mlevitsk@redhat.com>\nReviewed-by: David Matlack <dmatlack@google.com>\nReviewed-by: Sean Christopherson <seanjc@google.com>\nMessage-Id: <20211123004311.2954158-3-pbonzini@redhat.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "author_name": "Paolo Bonzini",
  "author_email": "pbonzini@redhat.com",
  "author_date": "Mon Nov 22 19:43:09 2021 -0500",
  "author_date_iso": "2021-11-22T19:43:09-05:00",
  "committer_name": "Paolo Bonzini",
  "committer_email": "pbonzini@redhat.com",
  "committer_date": "Tue Nov 30 03:51:58 2021 -0500",
  "committer_date_iso": "2021-11-30T03:51:58-05:00",
  "files_changed": [
    "arch/x86/kvm/vmx/vmx.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "arch/x86/kvm/vmx/vmx.c",
      "insertions": 25,
      "deletions": 14
    }
  ],
  "total_insertions": 25,
  "total_deletions": 14,
  "total_changes": 39,
  "parents": [
    "81835ee113e92683160030fe3328f3c3187a92c2"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/x86/kvm/vmx/vmx.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}