{
  "hash": "a1767077b0176de17fa40ec743a20cbdac7a0d56",
  "hash_short": "a1767077",
  "subject": "rxrpc: Make Tx loss-injection go through normal return and adjust tracing",
  "body": "In rxrpc_send_data_packet() make the loss-injection path return through the\nsame code as the transmission path so that the RTT determination is\ninitiated and any future timer shuffling will be done, despite the packet\nhaving been binned.\n\nWhilst we're at it:\n\n (1) Add to the tx_data tracepoint an indication of whether or not we're\n     retransmitting a data packet.\n\n (2) When we're deciding whether or not to request an ACK, rather than\n     checking if we're in fast-retransmit mode check instead if we're\n     retransmitting.\n\n (3) Don't invoke the lose_skb tracepoint when losing a Tx packet as we're\n     not altering the sk_buff refcount nor are we just seeing it after\n     getting it off the Tx list.\n\n (4) The rxrpc_skb_tx_lost note is then no longer used so remove it.\n\n (5) rxrpc_lose_skb() no longer needs to deal with rxrpc_skb_tx_lost.\n\nSigned-off-by: David Howells <dhowells@redhat.com>",
  "full_message": "rxrpc: Make Tx loss-injection go through normal return and adjust tracing\n\nIn rxrpc_send_data_packet() make the loss-injection path return through the\nsame code as the transmission path so that the RTT determination is\ninitiated and any future timer shuffling will be done, despite the packet\nhaving been binned.\n\nWhilst we're at it:\n\n (1) Add to the tx_data tracepoint an indication of whether or not we're\n     retransmitting a data packet.\n\n (2) When we're deciding whether or not to request an ACK, rather than\n     checking if we're in fast-retransmit mode check instead if we're\n     retransmitting.\n\n (3) Don't invoke the lose_skb tracepoint when losing a Tx packet as we're\n     not altering the sk_buff refcount nor are we just seeing it after\n     getting it off the Tx list.\n\n (4) The rxrpc_skb_tx_lost note is then no longer used so remove it.\n\n (5) rxrpc_lose_skb() no longer needs to deal with rxrpc_skb_tx_lost.\n\nSigned-off-by: David Howells <dhowells@redhat.com>",
  "author_name": "David Howells",
  "author_email": "dhowells@redhat.com",
  "author_date": "Thu Sep 29 22:37:15 2016 +0100",
  "author_date_iso": "2016-09-29T22:37:15+01:00",
  "committer_name": "David Howells",
  "committer_email": "dhowells@redhat.com",
  "committer_date": "Thu Sep 29 22:37:15 2016 +0100",
  "committer_date_iso": "2016-09-29T22:37:15+01:00",
  "files_changed": [
    "include/trace/events/rxrpc.h",
    "net/rxrpc/ar-internal.h",
    "net/rxrpc/call_event.c",
    "net/rxrpc/misc.c",
    "net/rxrpc/output.c",
    "net/rxrpc/sendmsg.c",
    "net/rxrpc/skbuff.c"
  ],
  "files_changed_count": 7,
  "stats": [
    {
      "file": "include/trace/events/rxrpc.h",
      "insertions": 4,
      "deletions": 2
    },
    {
      "file": "net/rxrpc/ar-internal.h",
      "insertions": 1,
      "deletions": 2
    },
    {
      "file": "net/rxrpc/call_event.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "net/rxrpc/misc.c",
      "insertions": 0,
      "deletions": 1
    },
    {
      "file": "net/rxrpc/output.c",
      "insertions": 9,
      "deletions": 8
    },
    {
      "file": "net/rxrpc/sendmsg.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "net/rxrpc/skbuff.c",
      "insertions": 3,
      "deletions": 8
    }
  ],
  "total_insertions": 19,
  "total_deletions": 23,
  "total_changes": 42,
  "parents": [
    "8732db67c6b6dcdb455b73773ea2fc1e1d5024b1"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.10",
    "v4.10-rc1",
    "v4.10-rc2",
    "v4.10-rc3",
    "v4.10-rc4",
    "v4.10-rc5",
    "v4.10-rc6",
    "v4.10-rc7",
    "v4.10-rc8",
    "v4.11"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "net/rxrpc/output.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "net/rxrpc/call_event.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "net/rxrpc/ar-internal.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "net/rxrpc/misc.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "net/rxrpc/sendmsg.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/trace/events/rxrpc.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "net/rxrpc/skbuff.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}