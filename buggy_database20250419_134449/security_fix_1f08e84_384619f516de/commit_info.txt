Commit Hash: 1f08e84ff642294e42d138442a388989ffb20865
Subject: mac80211: Fix [re]association power saving issue on AP side


Security Keywords:
- authentication

Full commit message:
mac80211: Fix [re]association power saving issue on AP side

Consider the following step-by step:
1. A STA authenticates and associates with the AP and exchanges
traffic.
2. The STA reports to the AP that it is going to PS state.
3. Some time later the STA device goes to the stand-by mode (not only
its wi-fi card, but the device itself) and drops the association state
without sending a disassociation frame.
4. The STA device wakes up and begins authentication with an
Auth frame as it hasn't been authenticated/associated previously.

At the step 4 the AP "remembers" the STA and considers it is still in
the PS state, so the AP buffers frames, which it has to send to the STA.
But the STA isn't actually in the PS state and so it neither checks
TIM bits nor reports to the AP that it isn't power saving.
Because of that authentication/[re]association fails.

To fix authentication/[re]association stage of this issue, Auth, Assoc
Resp and Reassoc Resp frames are transmitted disregarding of STA's power
saving state.

N.B. This patch doesn't fix further data frame exchange after
authentication/[re]association. A patch in hostapd is required to fix
that.

Signed-off-by: Igor Perminov <igor.perminov@inbox.ru>
Signed-off-by: John W. Linville <linville@tuxdriver.com>

Metadata:
Author: Igor Perminov <igor.perminov@inbox.ru>
Author Date: Tue Sep 22 00:25:44 2009 +0400
Committer: John W. Linville <linville@tuxdriver.com>
Commit Date: Tue Sep 29 17:25:15 2009 -0400

Files Changed: 1
Lines Added: 4
Lines Removed: 1
Total Changes: 5
