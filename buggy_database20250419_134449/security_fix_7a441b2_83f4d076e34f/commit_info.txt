Commit Hash: 7a441b2110527851f630144ec76ab8409e1d6c61
Subject: iommu/amd: Use pci_ats_supported()


Security Keywords:
- exploit

Full commit message:
iommu/amd: Use pci_ats_supported()

The pci_ats_supported() function checks if a device supports ATS and is
allowed to use it. In addition to checking that the device has an ATS
capability and that the global pci=noats is not set
(pci_ats_disabled()), it also checks if a device is untrusted.

A device is untrusted if it is plugged into an external-facing port such
as Thunderbolt and could be spoofing an existing device to exploit
weaknesses in the IOMMU configuration. By calling pci_ats_supported() we
keep DTE[I]=0 for untrusted devices and abort transactions with
Pretranslated Addresses.

Signed-off-by: Jean-Philippe Brucker <jean-philippe@linaro.org>
Reviewed-by: Joerg Roedel <jroedel@suse.de>
Link: https://lore.kernel.org/r/20200520152201.3309416-3-jean-philippe@linaro.org
Signed-off-by: Joerg Roedel <jroedel@suse.de>

Metadata:
Author: Jean-Philippe Brucker <jean-philippe@linaro.org>
Author Date: Wed May 20 17:22:01 2020 +0200
Committer: Joerg Roedel <jroedel@suse.de>
Commit Date: Wed May 27 14:35:41 2020 +0200

Files Changed: 1
Lines Added: 4
Lines Removed: 8
Total Changes: 12
