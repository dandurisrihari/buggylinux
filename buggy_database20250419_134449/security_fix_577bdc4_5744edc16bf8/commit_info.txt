Commit Hash: 577bdc496614ced56d999bbb425e85adf2386490
Subject: KVM: Avoid instruction emulation when event delivery is pending


Security Keywords:
- injection

Full commit message:
KVM: Avoid instruction emulation when event delivery is pending

When an event (such as an interrupt) is injected, and the stack is
shadowed (and therefore write protected), the guest will exit.  The
current code will see that the stack is shadowed and emulate a few
instructions, each time postponing the injection.  Eventually the
injection may succeed, but at that time the guest may be unwilling
to accept the interrupt (for example, the TPR may have changed).

This occurs every once in a while during a Windows 2008 boot.

Fix by unshadowing the fault address if the fault was due to an event
injection.

Signed-off-by: Avi Kivity <avi@qumranet.com>

Metadata:
Author: Avi Kivity <avi@qumranet.com>
Author Date: Sat Jul 19 08:57:05 2008 +0300
Committer: Avi Kivity <avi@qumranet.com>
Commit Date: Sun Jul 27 11:34:10 2008 +0300

Files Changed: 3
Lines Added: 9
Lines Removed: 1
Total Changes: 10
