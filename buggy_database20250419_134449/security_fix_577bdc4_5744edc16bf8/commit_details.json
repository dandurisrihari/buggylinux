{
  "hash": "577bdc496614ced56d999bbb425e85adf2386490",
  "hash_short": "577bdc49",
  "subject": "KVM: Avoid instruction emulation when event delivery is pending",
  "body": "When an event (such as an interrupt) is injected, and the stack is\nshadowed (and therefore write protected), the guest will exit.  The\ncurrent code will see that the stack is shadowed and emulate a few\ninstructions, each time postponing the injection.  Eventually the\ninjection may succeed, but at that time the guest may be unwilling\nto accept the interrupt (for example, the TPR may have changed).\n\nThis occurs every once in a while during a Windows 2008 boot.\n\nFix by unshadowing the fault address if the fault was due to an event\ninjection.\n\nSigned-off-by: Avi Kivity <avi@qumranet.com>",
  "full_message": "KVM: Avoid instruction emulation when event delivery is pending\n\nWhen an event (such as an interrupt) is injected, and the stack is\nshadowed (and therefore write protected), the guest will exit.  The\ncurrent code will see that the stack is shadowed and emulate a few\ninstructions, each time postponing the injection.  Eventually the\ninjection may succeed, but at that time the guest may be unwilling\nto accept the interrupt (for example, the TPR may have changed).\n\nThis occurs every once in a while during a Windows 2008 boot.\n\nFix by unshadowing the fault address if the fault was due to an event\ninjection.\n\nSigned-off-by: Avi Kivity <avi@qumranet.com>",
  "author_name": "Avi Kivity",
  "author_email": "avi@qumranet.com",
  "author_date": "Sat Jul 19 08:57:05 2008 +0300",
  "author_date_iso": "2008-07-19T08:57:05+03:00",
  "committer_name": "Avi Kivity",
  "committer_email": "avi@qumranet.com",
  "committer_date": "Sun Jul 27 11:34:10 2008 +0300",
  "committer_date_iso": "2008-07-27T11:34:10+03:00",
  "files_changed": [
    "arch/x86/kvm/mmu.c",
    "arch/x86/kvm/svm.c",
    "arch/x86/kvm/vmx.c"
  ],
  "files_changed_count": 3,
  "stats": [
    {
      "file": "arch/x86/kvm/mmu.c",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/x86/kvm/svm.c",
      "insertions": 6,
      "deletions": 1
    },
    {
      "file": "arch/x86/kvm/vmx.c",
      "insertions": 2,
      "deletions": 0
    }
  ],
  "total_insertions": 9,
  "total_deletions": 1,
  "total_changes": 10,
  "parents": [
    "34198bf8426276a2ce1e97056a0f02d43637e5ae"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v2.6.27",
    "v2.6.27-rc1",
    "v2.6.27-rc2",
    "v2.6.27-rc3",
    "v2.6.27-rc4",
    "v2.6.27-rc5",
    "v2.6.27-rc6",
    "v2.6.27-rc7",
    "v2.6.27-rc8",
    "v2.6.27-rc9"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/x86/kvm/mmu.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kvm/svm.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kvm/vmx.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}