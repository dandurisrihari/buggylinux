{
  "hash": "1ee60356c2dca938362528404af95b8ef3e49b6a",
  "hash_short": "1ee60356",
  "subject": "gcc-plugins: randstruct: Only warn about true flexible arrays",
  "body": "The randstruct GCC plugin tried to discover \"fake\" flexible arrays\nto issue warnings about them in randomized structs. In the future\nLSM overhead reduction series, it would be legal to have a randomized\nstruct with a 1-element array, and this should _not_ be treated as a\nflexible array, especially since commit df8fc4e934c1 (\"kbuild: Enable\n-fstrict-flex-arrays=3\"). Disable the 0-sized and 1-element array\ndiscovery logic in the plugin, but keep the \"true\" flexible array check.\n\nCc: KP Singh <kpsingh@kernel.org>\nCc: linux-hardening@vger.kernel.org\nReported-by: kernel test robot <lkp@intel.com>\nCloses: https://lore.kernel.org/oe-kbuild-all/202311021532.iBwuZUZ0-lkp@intel.com/\nFixes: df8fc4e934c1 (\"kbuild: Enable -fstrict-flex-arrays=3\")\nReviewed-by: Bill Wendling <morbo@google.com>\nAcked-by: \"Gustavo A. R. Silva\" <gustavoars@kernel.org>\nLink: https://lore.kernel.org/r/20231104204334.work.160-kees@kernel.org\nSigned-off-by: Kees Cook <keescook@chromium.org>",
  "full_message": "gcc-plugins: randstruct: Only warn about true flexible arrays\n\nThe randstruct GCC plugin tried to discover \"fake\" flexible arrays\nto issue warnings about them in randomized structs. In the future\nLSM overhead reduction series, it would be legal to have a randomized\nstruct with a 1-element array, and this should _not_ be treated as a\nflexible array, especially since commit df8fc4e934c1 (\"kbuild: Enable\n-fstrict-flex-arrays=3\"). Disable the 0-sized and 1-element array\ndiscovery logic in the plugin, but keep the \"true\" flexible array check.\n\nCc: KP Singh <kpsingh@kernel.org>\nCc: linux-hardening@vger.kernel.org\nReported-by: kernel test robot <lkp@intel.com>\nCloses: https://lore.kernel.org/oe-kbuild-all/202311021532.iBwuZUZ0-lkp@intel.com/\nFixes: df8fc4e934c1 (\"kbuild: Enable -fstrict-flex-arrays=3\")\nReviewed-by: Bill Wendling <morbo@google.com>\nAcked-by: \"Gustavo A. R. Silva\" <gustavoars@kernel.org>\nLink: https://lore.kernel.org/r/20231104204334.work.160-kees@kernel.org\nSigned-off-by: Kees Cook <keescook@chromium.org>",
  "author_name": "Kees Cook",
  "author_email": "keescook@chromium.org",
  "author_date": "Sat Nov 4 13:43:37 2023 -0700",
  "author_date_iso": "2023-11-04T13:43:37-07:00",
  "committer_name": "Kees Cook",
  "committer_email": "keescook@chromium.org",
  "committer_date": "Wed Nov 8 14:18:57 2023 -0800",
  "committer_date_iso": "2023-11-08T14:18:57-08:00",
  "files_changed": [
    "scripts/gcc-plugins/randomize_layout_plugin.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "scripts/gcc-plugins/randomize_layout_plugin.c",
      "insertions": 0,
      "deletions": 10
    }
  ],
  "total_insertions": 0,
  "total_deletions": 10,
  "total_changes": 10,
  "parents": [
    "65120498aaf8d7320647a8b6d6de7db42e74ea52"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "hardening"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "scripts/gcc-plugins/randomize_layout_plugin.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}