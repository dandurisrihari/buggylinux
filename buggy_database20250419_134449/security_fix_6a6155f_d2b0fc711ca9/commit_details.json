{
  "hash": "6a6155f664e31c9be43cd690541a9a682ba3dc22",
  "hash_short": "6a6155f6",
  "subject": "ubsan: introduce CONFIG_UBSAN_LOCAL_BOUNDS for Clang",
  "body": "When the kernel is compiled with Clang, -fsanitize=bounds expands to\n-fsanitize=array-bounds and -fsanitize=local-bounds.\n\nEnabling -fsanitize=local-bounds with Clang has the unfortunate\nside-effect of inserting traps; this goes back to its original intent,\nwhich was as a hardening and not a debugging feature [1].  The same\nfeature made its way into -fsanitize=bounds, but the traps remained.  For\nthat reason, -fsanitize=bounds was split into 'array-bounds' and\n'local-bounds' [2].\n\nSince 'local-bounds' doesn't behave like a normal sanitizer, enable it\nwith Clang only if trapping behaviour was requested by\nCONFIG_UBSAN_TRAP=y.\n\nAdd the UBSAN_BOUNDS_LOCAL config to Kconfig.ubsan to enable the\n'local-bounds' option by default when UBSAN_TRAP is enabled.\n\n[1] http://lists.llvm.org/pipermail/llvm-dev/2012-May/049972.html\n[2] http://lists.llvm.org/pipermail/cfe-commits/Week-of-Mon-20131021/091536.html\n\nSuggested-by: Marco Elver <elver@google.com>\nSigned-off-by: George Popescu <georgepope@android.com>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>\nReviewed-by: David Brazdil <dbrazdil@google.com>\nReviewed-by: Marco Elver <elver@google.com>\nCc: Masahiro Yamada <masahiroy@kernel.org>\nCc: Michal Marek <michal.lkml@markovi.net>\nCc: Nathan Chancellor <natechancellor@gmail.com>\nCc: Nick Desaulniers <ndesaulniers@google.com>\nCc: Kees Cook <keescook@chromium.org>\nCc: Dmitry Vyukov <dvyukov@google.com>\nCc: Arnd Bergmann <arnd@arndb.de>\nCc: Peter Zijlstra <a.p.zijlstra@chello.nl>\nLink: https://lkml.kernel.org/r/20200922074330.2549523-1-georgepope@google.com\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
  "full_message": "ubsan: introduce CONFIG_UBSAN_LOCAL_BOUNDS for Clang\n\nWhen the kernel is compiled with Clang, -fsanitize=bounds expands to\n-fsanitize=array-bounds and -fsanitize=local-bounds.\n\nEnabling -fsanitize=local-bounds with Clang has the unfortunate\nside-effect of inserting traps; this goes back to its original intent,\nwhich was as a hardening and not a debugging feature [1].  The same\nfeature made its way into -fsanitize=bounds, but the traps remained.  For\nthat reason, -fsanitize=bounds was split into 'array-bounds' and\n'local-bounds' [2].\n\nSince 'local-bounds' doesn't behave like a normal sanitizer, enable it\nwith Clang only if trapping behaviour was requested by\nCONFIG_UBSAN_TRAP=y.\n\nAdd the UBSAN_BOUNDS_LOCAL config to Kconfig.ubsan to enable the\n'local-bounds' option by default when UBSAN_TRAP is enabled.\n\n[1] http://lists.llvm.org/pipermail/llvm-dev/2012-May/049972.html\n[2] http://lists.llvm.org/pipermail/cfe-commits/Week-of-Mon-20131021/091536.html\n\nSuggested-by: Marco Elver <elver@google.com>\nSigned-off-by: George Popescu <georgepope@android.com>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>\nReviewed-by: David Brazdil <dbrazdil@google.com>\nReviewed-by: Marco Elver <elver@google.com>\nCc: Masahiro Yamada <masahiroy@kernel.org>\nCc: Michal Marek <michal.lkml@markovi.net>\nCc: Nathan Chancellor <natechancellor@gmail.com>\nCc: Nick Desaulniers <ndesaulniers@google.com>\nCc: Kees Cook <keescook@chromium.org>\nCc: Dmitry Vyukov <dvyukov@google.com>\nCc: Arnd Bergmann <arnd@arndb.de>\nCc: Peter Zijlstra <a.p.zijlstra@chello.nl>\nLink: https://lkml.kernel.org/r/20200922074330.2549523-1-georgepope@google.com\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
  "author_name": "George Popescu",
  "author_email": "georgepope@android.com",
  "author_date": "Thu Oct 15 20:13:38 2020 -0700",
  "author_date_iso": "2020-10-15T20:13:38-07:00",
  "committer_name": "Linus Torvalds",
  "committer_email": "torvalds@linux-foundation.org",
  "committer_date": "Fri Oct 16 11:11:22 2020 -0700",
  "committer_date_iso": "2020-10-16T11:11:22-07:00",
  "files_changed": [
    "lib/Kconfig.ubsan",
    "scripts/Makefile.ubsan"
  ],
  "files_changed_count": 2,
  "stats": [
    {
      "file": "lib/Kconfig.ubsan",
      "insertions": 14,
      "deletions": 0
    },
    {
      "file": "scripts/Makefile.ubsan",
      "insertions": 9,
      "deletions": 1
    }
  ],
  "total_insertions": 23,
  "total_deletions": 1,
  "total_changes": 24,
  "parents": [
    "5cf53f3ce3b9ff5321b56f9ed9d90d59307be7d0"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "hardening"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "lib/Kconfig.ubsan",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "scripts/Makefile.ubsan",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}