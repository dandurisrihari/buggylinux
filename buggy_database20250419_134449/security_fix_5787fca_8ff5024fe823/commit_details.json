{
  "hash": "5787fcaab9eb5930f5378d6a1dd03d916d146622",
  "hash_short": "5787fcaa",
  "subject": "nilfs2: fix missing cleanup on rollforward recovery error",
  "body": "In an error injection test of a routine for mount-time recovery, KASAN\nfound a use-after-free bug.\n\nIt turned out that if data recovery was performed using partial logs\ncreated by dsync writes, but an error occurred before starting the log\nwriter to create a recovered checkpoint, the inodes whose data had been\nrecovered were left in the ns_dirty_files list of the nilfs object and\nwere not freed.\n\nFix this issue by cleaning up inodes that have read the recovery data if\nthe recovery routine fails midway before the log writer starts.\n\nLink: https://lkml.kernel.org/r/20240810065242.3701-1-konishi.ryusuke@gmail.com\nFixes: 0f3e1c7f23f8 (\"nilfs2: recovery functions\")\nSigned-off-by: Ryusuke Konishi <konishi.ryusuke@gmail.com>\nTested-by: Ryusuke Konishi <konishi.ryusuke@gmail.com>\nCc: <stable@vger.kernel.org>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>",
  "full_message": "nilfs2: fix missing cleanup on rollforward recovery error\n\nIn an error injection test of a routine for mount-time recovery, KASAN\nfound a use-after-free bug.\n\nIt turned out that if data recovery was performed using partial logs\ncreated by dsync writes, but an error occurred before starting the log\nwriter to create a recovered checkpoint, the inodes whose data had been\nrecovered were left in the ns_dirty_files list of the nilfs object and\nwere not freed.\n\nFix this issue by cleaning up inodes that have read the recovery data if\nthe recovery routine fails midway before the log writer starts.\n\nLink: https://lkml.kernel.org/r/20240810065242.3701-1-konishi.ryusuke@gmail.com\nFixes: 0f3e1c7f23f8 (\"nilfs2: recovery functions\")\nSigned-off-by: Ryusuke Konishi <konishi.ryusuke@gmail.com>\nTested-by: Ryusuke Konishi <konishi.ryusuke@gmail.com>\nCc: <stable@vger.kernel.org>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>",
  "author_name": "Ryusuke Konishi",
  "author_email": "konishi.ryusuke@gmail.com",
  "author_date": "Sat Aug 10 15:52:42 2024 +0900",
  "author_date_iso": "2024-08-10T15:52:42+09:00",
  "committer_name": "Andrew Morton",
  "committer_email": "akpm@linux-foundation.org",
  "committer_date": "Sun Sep 1 17:59:00 2024 -0700",
  "committer_date_iso": "2024-09-01T17:59:00-07:00",
  "files_changed": [
    "fs/nilfs2/recovery.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "fs/nilfs2/recovery.c",
      "insertions": 33,
      "deletions": 2
    }
  ],
  "total_insertions": 33,
  "total_deletions": 2,
  "total_changes": 35,
  "parents": [
    "683408258917541bdb294cd717c210a04381931e"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "fs/nilfs2/recovery.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}