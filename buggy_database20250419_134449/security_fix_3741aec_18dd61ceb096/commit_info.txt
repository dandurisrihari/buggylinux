Commit Hash: 3741aec4c38fa4123ab08ae552f05366d4fd05d8
Subject: KVM: SVM: Stuff next_rip on emulated INT3 injection if NRIPS is supported


Security Keywords:
- injection

Full commit message:
KVM: SVM: Stuff next_rip on emulated INT3 injection if NRIPS is supported

If NRIPS is supported in hardware but disabled in KVM, set next_rip to
the next RIP when advancing RIP as part of emulating INT3 injection.
There is no flag to tell the CPU that KVM isn't using next_rip, and so
leaving next_rip is left as is will result in the CPU pushing garbage
onto the stack when vectoring the injected event.

Reviewed-by: Maxim Levitsky <mlevitsk@redhat.com>
Fixes: 66b7138f9136 ("KVM: SVM: Emulate nRIP feature when reinjecting INT3")
Signed-off-by: Sean Christopherson <seanjc@google.com>
Signed-off-by: Maciej S. Szmigiero <maciej.szmigiero@oracle.com>
Message-Id: <cd328309a3b88604daa2359ad56f36cb565ce2d4.1651440202.git.maciej.szmigiero@oracle.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

Metadata:
Author: Sean Christopherson <seanjc@google.com>
Author Date: Mon May 2 00:07:28 2022 +0200
Committer: Paolo Bonzini <pbonzini@redhat.com>
Commit Date: Wed Jun 8 04:46:48 2022 -0400

Files Changed: 1
Lines Added: 5
Lines Removed: 1
Total Changes: 6
