{
  "hash": "0b7808818cb9df6680f98996b8e9a439fa7bcc2f",
  "hash_short": "0b780881",
  "subject": "wifi: cfg80211: fix BSS refcounting bugs",
  "body": "There are multiple refcounting bugs related to multi-BSSID:\n - In bss_ref_get(), if the BSS has a hidden_beacon_bss, then\n   the bss pointer is overwritten before checking for the\n   transmitted BSS, which is clearly wrong. Fix this by using\n   the bss_from_pub() macro.\n\n - In cfg80211_bss_update() we copy the transmitted_bss pointer\n   from tmp into new, but then if we release new, we'll unref\n   it erroneously. We already set the pointer and ref it, but\n   need to NULL it since it was copied from the tmp data.\n\n - In cfg80211_inform_single_bss_data(), if adding to the non-\n   transmitted list fails, we unlink the BSS and yet still we\n   return it, but this results in returning an entry without\n   a reference. We shouldn't return it anyway if it was broken\n   enough to not get added there.\n\nThis fixes CVE-2022-42720.\n\nReported-by: S\u00f6nke Huster <shuster@seemoo.tu-darmstadt.de>\nTested-by: S\u00f6nke Huster <shuster@seemoo.tu-darmstadt.de>\nFixes: a3584f56de1c (\"cfg80211: Properly track transmitting and non-transmitting BSS\")\nSigned-off-by: Johannes Berg <johannes.berg@intel.com>",
  "full_message": "wifi: cfg80211: fix BSS refcounting bugs\n\nThere are multiple refcounting bugs related to multi-BSSID:\n - In bss_ref_get(), if the BSS has a hidden_beacon_bss, then\n   the bss pointer is overwritten before checking for the\n   transmitted BSS, which is clearly wrong. Fix this by using\n   the bss_from_pub() macro.\n\n - In cfg80211_bss_update() we copy the transmitted_bss pointer\n   from tmp into new, but then if we release new, we'll unref\n   it erroneously. We already set the pointer and ref it, but\n   need to NULL it since it was copied from the tmp data.\n\n - In cfg80211_inform_single_bss_data(), if adding to the non-\n   transmitted list fails, we unlink the BSS and yet still we\n   return it, but this results in returning an entry without\n   a reference. We shouldn't return it anyway if it was broken\n   enough to not get added there.\n\nThis fixes CVE-2022-42720.\n\nReported-by: S\u00f6nke Huster <shuster@seemoo.tu-darmstadt.de>\nTested-by: S\u00f6nke Huster <shuster@seemoo.tu-darmstadt.de>\nFixes: a3584f56de1c (\"cfg80211: Properly track transmitting and non-transmitting BSS\")\nSigned-off-by: Johannes Berg <johannes.berg@intel.com>",
  "author_name": "Johannes Berg",
  "author_email": "johannes.berg@intel.com",
  "author_date": "Fri Sep 30 23:44:23 2022 +0200",
  "author_date_iso": "2022-09-30T23:44:23+02:00",
  "committer_name": "Johannes Berg",
  "committer_email": "johannes.berg@intel.com",
  "committer_date": "Mon Oct 10 09:50:51 2022 +0200",
  "committer_date_iso": "2022-10-10T09:50:51+02:00",
  "files_changed": [
    "net/wireless/scan.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "net/wireless/scan.c",
      "insertions": 14,
      "deletions": 13
    }
  ],
  "total_insertions": 14,
  "total_deletions": 13,
  "total_changes": 27,
  "parents": [
    "567e14e39e8f8c6997a1378bc3be615afca86063"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [
      "CVE-2022-42720"
    ],
    "security_keywords": []
  },
  "fix_type": "cve",
  "file_results": [
    {
      "file": "net/wireless/scan.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}