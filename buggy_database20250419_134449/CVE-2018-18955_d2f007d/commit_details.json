{
  "hash": "d2f007dbe7e4c9583eea6eb04d60001e85c6f1bd",
  "hash_short": "d2f007db",
  "subject": "userns: also map extents in the reverse map to kernel IDs",
  "body": "The current logic first clones the extent array and sorts both copies, then\nmaps the lower IDs of the forward mapping into the lower namespace, but\ndoesn't map the lower IDs of the reverse mapping.\n\nThis means that code in a nested user namespace with >5 extents will see\nincorrect IDs. It also breaks some access checks, like\ninode_owner_or_capable() and privileged_wrt_inode_uidgid(), so a process\ncan incorrectly appear to be capable relative to an inode.\n\nTo fix it, we have to make sure that the \"lower_first\" members of extents\nin both arrays are translated; and we have to make sure that the reverse\nmap is sorted *after* the translation (since otherwise the translation can\nbreak the sorting).\n\nThis is CVE-2018-18955.\n\nFixes: 6397fac4915a (\"userns: bump idmap limits to 340\")\nCc: stable@vger.kernel.org\nSigned-off-by: Jann Horn <jannh@google.com>\nTested-by: Eric W. Biederman <ebiederm@xmission.com>\nReviewed-by: Eric W. Biederman <ebiederm@xmission.com>\nSigned-off-by: Eric W. Biederman <ebiederm@xmission.com>",
  "full_message": "userns: also map extents in the reverse map to kernel IDs\n\nThe current logic first clones the extent array and sorts both copies, then\nmaps the lower IDs of the forward mapping into the lower namespace, but\ndoesn't map the lower IDs of the reverse mapping.\n\nThis means that code in a nested user namespace with >5 extents will see\nincorrect IDs. It also breaks some access checks, like\ninode_owner_or_capable() and privileged_wrt_inode_uidgid(), so a process\ncan incorrectly appear to be capable relative to an inode.\n\nTo fix it, we have to make sure that the \"lower_first\" members of extents\nin both arrays are translated; and we have to make sure that the reverse\nmap is sorted *after* the translation (since otherwise the translation can\nbreak the sorting).\n\nThis is CVE-2018-18955.\n\nFixes: 6397fac4915a (\"userns: bump idmap limits to 340\")\nCc: stable@vger.kernel.org\nSigned-off-by: Jann Horn <jannh@google.com>\nTested-by: Eric W. Biederman <ebiederm@xmission.com>\nReviewed-by: Eric W. Biederman <ebiederm@xmission.com>\nSigned-off-by: Eric W. Biederman <ebiederm@xmission.com>",
  "author_name": "Jann Horn",
  "author_email": "jannh@google.com",
  "author_date": "Mon Nov 5 20:55:09 2018 +0100",
  "author_date_iso": "2018-11-05T20:55:09+01:00",
  "committer_name": "Eric W. Biederman",
  "committer_email": "ebiederm@xmission.com",
  "committer_date": "Wed Nov 7 23:51:16 2018 -0600",
  "committer_date_iso": "2018-11-07T23:51:16-06:00",
  "files_changed": [
    "kernel/user_namespace.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "kernel/user_namespace.c",
      "insertions": 8,
      "deletions": 4
    }
  ],
  "total_insertions": 8,
  "total_deletions": 4,
  "total_changes": 12,
  "parents": [
    "651022382c7f8da46cb4872a545ee1da6d097d2a"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.20",
    "v4.20-rc2",
    "v4.20-rc3",
    "v4.20-rc4",
    "v4.20-rc5",
    "v4.20-rc6",
    "v4.20-rc7",
    "v5.0",
    "v5.0-rc1",
    "v5.0-rc2"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [
      "CVE-2018-18955"
    ],
    "security_keywords": []
  },
  "fix_type": "cve",
  "file_results": [
    {
      "file": "kernel/user_namespace.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}