Commit Hash: a58d9166a756a0f4a6618e4f593232593d6df134
Subject: KVM: SVM: load control fields from VMCB12 before checking them

CVE Identifiers:
- CVE-2021-29657

Full commit message:
KVM: SVM: load control fields from VMCB12 before checking them

Avoid races between check and use of the nested VMCB controls.  This
for example ensures that the VMRUN intercept is always reflected to the
nested hypervisor, instead of being processed by the host.  Without this
patch, it is possible to end up with svm->nested.hsave pointing to
the MSR permission bitmap for nested guests.

This bug is CVE-2021-29657.

Reported-by: Felix Wilhelm <fwilhelm@google.com>
Cc: stable@vger.kernel.org
Fixes: 2fcf4876ada ("KVM: nSVM: implement on demand allocation of the nested state")
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

Metadata:
Author: Paolo Bonzini <pbonzini@redhat.com>
Author Date: Wed Mar 31 06:24:43 2021 -0400
Committer: Paolo Bonzini <pbonzini@redhat.com>
Commit Date: Thu Apr 1 05:09:31 2021 -0400

Files Changed: 1
Lines Added: 6
Lines Removed: 4
Total Changes: 10
