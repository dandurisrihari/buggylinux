{
  "hash": "5d81de8e8667da7135d3a32a964087c0faf5483f",
  "hash_short": "5d81de8e",
  "subject": "cifs: ensure that uncached writes handle unmapped areas correctly",
  "body": "It's possible for userland to pass down an iovec via writev() that has a\nbogus user pointer in it. If that happens and we're doing an uncached\nwrite, then we can end up getting less bytes than we expect from the\ncall to iov_iter_copy_from_user. This is CVE-2014-0069\n\ncifs_iovec_write isn't set up to handle that situation however. It'll\nblindly keep chugging through the page array and not filling those pages\nwith anything useful. Worse yet, we'll later end up with a negative\nnumber in wdata->tailsz, which will confuse the sending routines and\ncause an oops at the very least.\n\nFix this by having the copy phase of cifs_iovec_write stop copying data\nin this situation and send the last write as a short one. At the same\ntime, we want to avoid sending a zero-length write to the server, so\nbreak out of the loop and set rc to -EFAULT if that happens. This also\nallows us to handle the case where no address in the iovec is valid.\n\n[Note: Marking this for stable on v3.4+ kernels, but kernels as old as\n       v2.6.38 may have a similar problem and may need similar fix]\n\nCc: <stable@vger.kernel.org> # v3.4+\nReviewed-by: Pavel Shilovsky <piastry@etersoft.ru>\nReported-by: Al Viro <viro@zeniv.linux.org.uk>\nSigned-off-by: Jeff Layton <jlayton@redhat.com>\nSigned-off-by: Steve French <smfrench@gmail.com>",
  "full_message": "cifs: ensure that uncached writes handle unmapped areas correctly\n\nIt's possible for userland to pass down an iovec via writev() that has a\nbogus user pointer in it. If that happens and we're doing an uncached\nwrite, then we can end up getting less bytes than we expect from the\ncall to iov_iter_copy_from_user. This is CVE-2014-0069\n\ncifs_iovec_write isn't set up to handle that situation however. It'll\nblindly keep chugging through the page array and not filling those pages\nwith anything useful. Worse yet, we'll later end up with a negative\nnumber in wdata->tailsz, which will confuse the sending routines and\ncause an oops at the very least.\n\nFix this by having the copy phase of cifs_iovec_write stop copying data\nin this situation and send the last write as a short one. At the same\ntime, we want to avoid sending a zero-length write to the server, so\nbreak out of the loop and set rc to -EFAULT if that happens. This also\nallows us to handle the case where no address in the iovec is valid.\n\n[Note: Marking this for stable on v3.4+ kernels, but kernels as old as\n       v2.6.38 may have a similar problem and may need similar fix]\n\nCc: <stable@vger.kernel.org> # v3.4+\nReviewed-by: Pavel Shilovsky <piastry@etersoft.ru>\nReported-by: Al Viro <viro@zeniv.linux.org.uk>\nSigned-off-by: Jeff Layton <jlayton@redhat.com>\nSigned-off-by: Steve French <smfrench@gmail.com>",
  "author_name": "Jeff Layton",
  "author_email": "jlayton@redhat.com",
  "author_date": "Fri Feb 14 07:20:35 2014 -0500",
  "author_date_iso": "2014-02-14T07:20:35-05:00",
  "committer_name": "Steve French",
  "committer_email": "smfrench@gmail.com",
  "committer_date": "Fri Feb 14 16:46:15 2014 -0600",
  "committer_date_iso": "2014-02-14T16:46:15-06:00",
  "files_changed": [
    "fs/cifs/file.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "fs/cifs/file.c",
      "insertions": 34,
      "deletions": 3
    }
  ],
  "total_insertions": 34,
  "total_deletions": 3,
  "total_changes": 37,
  "parents": [
    "42eacf9e57b65ffa768af72cb7fc86cc6f6af042"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v3.14",
    "v3.14-rc4",
    "v3.14-rc5",
    "v3.14-rc6",
    "v3.14-rc7",
    "v3.14-rc8",
    "v3.15",
    "v3.15-rc1",
    "v3.15-rc2",
    "v3.15-rc3"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [
      "CVE-2014-0069"
    ],
    "security_keywords": []
  },
  "fix_type": "cve",
  "file_results": [
    {
      "file": "fs/cifs/file.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}