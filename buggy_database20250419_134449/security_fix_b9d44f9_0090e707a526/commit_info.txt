Commit Hash: b9d44f9091ac6c325fc2f7b7671b462fb36abbed
Subject: KVM: nVMX: Prioritize TSS T-flag #DBs over Monitor Trap Flag


Security Keywords:
- injection

Full commit message:
KVM: nVMX: Prioritize TSS T-flag #DBs over Monitor Trap Flag

Service TSS T-flag #DBs prior to pending MTFs, as such #DBs are higher
priority than MTF.  KVM itself doesn't emulate TSS #DBs, and any such
exceptions injected from L1 will be handled by hardware (or morphed to
a fault-like exception if injection fails), but theoretically userspace
could pend a TSS T-flag #DB in conjunction with a pending MTF.

Note, there's no known use case this fixes, it's purely to be technically
correct with respect to Intel's SDM.

Cc: Oliver Upton <oupton@google.com>
Cc: Peter Shier <pshier@google.com>
Fixes: 5ef8acbdd687 ("KVM: nVMX: Emulate MTF when performing instruction emulation")
Signed-off-by: Sean Christopherson <seanjc@google.com>
Reviewed-by: Maxim Levitsky <mlevitsk@redhat.com>
Link: https://lore.kernel.org/r/20220830231614.3580124-8-seanjc@google.com
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

Metadata:
Author: Sean Christopherson <seanjc@google.com>
Author Date: Tue Aug 30 23:15:54 2022 +0000
Committer: Paolo Bonzini <pbonzini@redhat.com>
Commit Date: Mon Sep 26 12:03:05 2022 -0400

Files Changed: 1
Lines Added: 5
Lines Removed: 3
Total Changes: 8
