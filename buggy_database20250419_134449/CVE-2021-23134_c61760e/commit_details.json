{
  "hash": "c61760e6940dd4039a7f5e84a6afc9cdbf4d82b6",
  "hash_short": "c61760e6",
  "subject": "net/nfc: fix use-after-free llcp_sock_bind/connect",
  "body": "Commits 8a4cd82d (\"nfc: fix refcount leak in llcp_sock_connect()\")\nand c33b1cc62 (\"nfc: fix refcount leak in llcp_sock_bind()\")\nfixed a refcount leak bug in bind/connect but introduced a\nuse-after-free if the same local is assigned to 2 different sockets.\n\nThis can be triggered by the following simple program:\n    int sock1 = socket( AF_NFC, SOCK_STREAM, NFC_SOCKPROTO_LLCP );\n    int sock2 = socket( AF_NFC, SOCK_STREAM, NFC_SOCKPROTO_LLCP );\n    memset( &addr, 0, sizeof(struct sockaddr_nfc_llcp) );\n    addr.sa_family = AF_NFC;\n    addr.nfc_protocol = NFC_PROTO_NFC_DEP;\n    bind( sock1, (struct sockaddr*) &addr, sizeof(struct sockaddr_nfc_llcp) )\n    bind( sock2, (struct sockaddr*) &addr, sizeof(struct sockaddr_nfc_llcp) )\n    close(sock1);\n    close(sock2);\n\nFix this by assigning NULL to llcp_sock->local after calling\nnfc_llcp_local_put.\n\nThis addresses CVE-2021-23134.\n\nReported-by: Or Cohen <orcohen@paloaltonetworks.com>\nReported-by: Nadav Markus <nmarkus@paloaltonetworks.com>\nFixes: c33b1cc62 (\"nfc: fix refcount leak in llcp_sock_bind()\")\nSigned-off-by: Or Cohen <orcohen@paloaltonetworks.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
  "full_message": "net/nfc: fix use-after-free llcp_sock_bind/connect\n\nCommits 8a4cd82d (\"nfc: fix refcount leak in llcp_sock_connect()\")\nand c33b1cc62 (\"nfc: fix refcount leak in llcp_sock_bind()\")\nfixed a refcount leak bug in bind/connect but introduced a\nuse-after-free if the same local is assigned to 2 different sockets.\n\nThis can be triggered by the following simple program:\n    int sock1 = socket( AF_NFC, SOCK_STREAM, NFC_SOCKPROTO_LLCP );\n    int sock2 = socket( AF_NFC, SOCK_STREAM, NFC_SOCKPROTO_LLCP );\n    memset( &addr, 0, sizeof(struct sockaddr_nfc_llcp) );\n    addr.sa_family = AF_NFC;\n    addr.nfc_protocol = NFC_PROTO_NFC_DEP;\n    bind( sock1, (struct sockaddr*) &addr, sizeof(struct sockaddr_nfc_llcp) )\n    bind( sock2, (struct sockaddr*) &addr, sizeof(struct sockaddr_nfc_llcp) )\n    close(sock1);\n    close(sock2);\n\nFix this by assigning NULL to llcp_sock->local after calling\nnfc_llcp_local_put.\n\nThis addresses CVE-2021-23134.\n\nReported-by: Or Cohen <orcohen@paloaltonetworks.com>\nReported-by: Nadav Markus <nmarkus@paloaltonetworks.com>\nFixes: c33b1cc62 (\"nfc: fix refcount leak in llcp_sock_bind()\")\nSigned-off-by: Or Cohen <orcohen@paloaltonetworks.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
  "author_name": "Or Cohen",
  "author_email": "orcohen@paloaltonetworks.com",
  "author_date": "Tue May 4 10:16:46 2021 +0300",
  "author_date_iso": "2021-05-04T10:16:46+03:00",
  "committer_name": "David S. Miller",
  "committer_email": "davem@davemloft.net",
  "committer_date": "Tue May 4 11:59:48 2021 -0700",
  "committer_date_iso": "2021-05-04T11:59:48-07:00",
  "files_changed": [
    "net/nfc/llcp_sock.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "net/nfc/llcp_sock.c",
      "insertions": 4,
      "deletions": 0
    }
  ],
  "total_insertions": 4,
  "total_deletions": 0,
  "total_changes": 4,
  "parents": [
    "8d432592f30fcc34ef5a10aac4887b4897884493"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [
      "CVE-2021-23134"
    ],
    "security_keywords": []
  },
  "fix_type": "cve",
  "file_results": [
    {
      "file": "net/nfc/llcp_sock.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}