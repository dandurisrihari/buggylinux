{
  "hash": "6e46496302df7e63158fa1476cf9a30d5ee59dee",
  "hash_short": "6e464963",
  "subject": "iwlwifi: mvm: remove DQA non-STA client mode special case",
  "body": "When we get a non-STA frame to transmit in client mode, we try to use\nthe IWL_MVM_DQA_BSS_CLIENT_QUEUE queue (queue #4). However, at this\npoint, the queue might not be allocated at all, causing warnings. The\nscenario on which this happened was a race condition between mac80211\nand our queue allocation work:\n * mac80211 sends auth\n * we stop mac80211 queues to allocate a hw queue\n * authentication is aborted\n * we allocate HW queue and start mac80211 queues\n * mac80211 removes station\n * mac80211 hands us the auth frame from the pending queue\n\nAt this point, since mac80211 has already removed the station, we try\nto transmit the frame through this special non-station case on queue\n4 anyway.\n\nIn order to really use it properly, we'd have to again go through the\nhw queue allocation work, and attach it to a station, etc. In this\ncase that isn't possible (there's no station anymore), but if this\nspecial case were needed, then we'd have to do it this way.\n\nHowever, the special case is documented to exist for TDLS, but can't\ntrigger there because the TDLS setup frames etc. are normal to-DS\nframes going to the peer through the AP. Testing also confirms that\nthis code path isn't triggered in TDLS.\n\nTherefore, remove the code path to avoid using an unused queue. The\nerroneous frame described above will still be transmitted on the AUX\nqueue, but arguably that's a mac80211 problem, which will eventually\nbe fixed by moving everything there to TXQs.\n\nFixes: e3118ad74d7e (\"iwlwifi: mvm: support tdls in dqa mode\")\nSigned-off-by: Johannes Berg <johannes.berg@intel.com>\nSigned-off-by: Luca Coelho <luciano.coelho@intel.com>",
  "full_message": "iwlwifi: mvm: remove DQA non-STA client mode special case\n\nWhen we get a non-STA frame to transmit in client mode, we try to use\nthe IWL_MVM_DQA_BSS_CLIENT_QUEUE queue (queue #4). However, at this\npoint, the queue might not be allocated at all, causing warnings. The\nscenario on which this happened was a race condition between mac80211\nand our queue allocation work:\n * mac80211 sends auth\n * we stop mac80211 queues to allocate a hw queue\n * authentication is aborted\n * we allocate HW queue and start mac80211 queues\n * mac80211 removes station\n * mac80211 hands us the auth frame from the pending queue\n\nAt this point, since mac80211 has already removed the station, we try\nto transmit the frame through this special non-station case on queue\n4 anyway.\n\nIn order to really use it properly, we'd have to again go through the\nhw queue allocation work, and attach it to a station, etc. In this\ncase that isn't possible (there's no station anymore), but if this\nspecial case were needed, then we'd have to do it this way.\n\nHowever, the special case is documented to exist for TDLS, but can't\ntrigger there because the TDLS setup frames etc. are normal to-DS\nframes going to the peer through the AP. Testing also confirms that\nthis code path isn't triggered in TDLS.\n\nTherefore, remove the code path to avoid using an unused queue. The\nerroneous frame described above will still be transmitted on the AUX\nqueue, but arguably that's a mac80211 problem, which will eventually\nbe fixed by moving everything there to TXQs.\n\nFixes: e3118ad74d7e (\"iwlwifi: mvm: support tdls in dqa mode\")\nSigned-off-by: Johannes Berg <johannes.berg@intel.com>\nSigned-off-by: Luca Coelho <luciano.coelho@intel.com>",
  "author_name": "Johannes Berg",
  "author_email": "johannes.berg@intel.com",
  "author_date": "Thu Jun 22 13:06:21 2017 +0200",
  "author_date_iso": "2017-06-22T13:06:21+02:00",
  "committer_name": "Luca Coelho",
  "committer_email": "luciano.coelho@intel.com",
  "committer_date": "Thu Jun 29 20:42:18 2017 +0300",
  "committer_date_iso": "2017-06-29T20:42:18+03:00",
  "files_changed": [
    "drivers/net/wireless/intel/iwlwifi/mvm/tx.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/net/wireless/intel/iwlwifi/mvm/tx.c",
      "insertions": 0,
      "deletions": 8
    }
  ],
  "total_insertions": 0,
  "total_deletions": 8,
  "total_changes": 8,
  "parents": [
    "6344436e9d3f4fb4878c12169477d4beb5b825ea"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.13",
    "v4.13-rc1",
    "v4.13-rc2",
    "v4.13-rc3",
    "v4.13-rc4",
    "v4.13-rc5",
    "v4.13-rc6",
    "v4.13-rc7",
    "v4.14",
    "v4.14-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "auth"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/net/wireless/intel/iwlwifi/mvm/tx.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}