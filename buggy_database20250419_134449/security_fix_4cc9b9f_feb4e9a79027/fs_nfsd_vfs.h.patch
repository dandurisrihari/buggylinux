commit 4cc9b9f2bf4dfe13fe573da978e626e2248df388
Author: NeilBrown <neilb@suse.de>
Date:   Fri Oct 18 08:42:31 2024 +1100

    nfsd: refine and rename NFSD_MAY_LOCK
    
    NFSD_MAY_LOCK means a few different things.
    - it means that GSS is not required.
    - it means that with NFSEXP_NOAUTHNLM, authentication is not required
    - it means that OWNER_OVERRIDE is allowed.
    
    None of these are specific to locking, they are specific to the NLM
    protocol.
    So:
     - rename to NFSD_MAY_NLM
     - set NFSD_MAY_OWNER_OVERRIDE and NFSD_MAY_BYPASS_GSS in nlm_fopen()
       so that NFSD_MAY_NLM doesn't need to imply these.
     - move the test on NFSEXP_NOAUTHNLM out of nfsd_permission() and
       into fh_verify where other special-case tests on the MAY flags
       happen.  nfsd_permission() can be called from other places than
       fh_verify(), but none of these will have NFSD_MAY_NLM.
    
    Signed-off-by: NeilBrown <neilb@suse.de>
    Signed-off-by: Chuck Lever <chuck.lever@oracle.com>

diff --git a/fs/nfsd/vfs.h b/fs/nfsd/vfs.h
index 854fb95dfdca..f9b09b842856 100644
--- a/fs/nfsd/vfs.h
+++ b/fs/nfsd/vfs.h
@@ -20,7 +20,7 @@
 #define NFSD_MAY_READ			0x004 /* == MAY_READ */
 #define NFSD_MAY_SATTR			0x008
 #define NFSD_MAY_TRUNC			0x010
-#define NFSD_MAY_LOCK			0x020
+#define NFSD_MAY_NLM			0x020 /* request is from lockd */
 #define NFSD_MAY_MASK			0x03f
 
 /* extra hints to permission and open routines: */