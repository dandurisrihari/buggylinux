{
  "hash": "410e5e55c9c1c9c0d452ac5b9adb37b933a7747e",
  "hash_short": "410e5e55",
  "subject": "ASoC: SOF: core: release resources on errors in probe_continue",
  "body": "The initial intent of releasing resources in the .remove does not work\nwell with HDaudio codecs. If the probe_continue() fails in a work\nqueue, e.g. due to missing firmware or authentication issues, we don't\nrelease any resources, and as a result the kernel oopses during\nsuspend operations.\n\nThe suggested fix is to release all resources during errors in\nprobe_continue(), and use fw_state to track resource allocation\nstate, so that .remove does not attempt to release the same\nhardware resources twice. PM operations are also modified so that\nno action is done if DSP resources have been freed due to\nan error at probe.\n\nReported-by: Takashi Iwai <tiwai@suse.de>\nCo-developed-by: Kai Vehmanen <kai.vehmanen@linux.intel.com>\nSigned-off-by: Kai Vehmanen <kai.vehmanen@linux.intel.com>\nBugzilla:  http://bugzilla.suse.com/show_bug.cgi?id=1161246\nSigned-off-by: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>\nReviewed-by: Takashi Iwai <tiwai@suse.de>\nLink: https://lore.kernel.org/r/20200124213625.30186-4-pierre-louis.bossart@linux.intel.com\nSigned-off-by: Mark Brown <broonie@kernel.org>\nCc: stable@vger.kernel.org",
  "full_message": "ASoC: SOF: core: release resources on errors in probe_continue\n\nThe initial intent of releasing resources in the .remove does not work\nwell with HDaudio codecs. If the probe_continue() fails in a work\nqueue, e.g. due to missing firmware or authentication issues, we don't\nrelease any resources, and as a result the kernel oopses during\nsuspend operations.\n\nThe suggested fix is to release all resources during errors in\nprobe_continue(), and use fw_state to track resource allocation\nstate, so that .remove does not attempt to release the same\nhardware resources twice. PM operations are also modified so that\nno action is done if DSP resources have been freed due to\nan error at probe.\n\nReported-by: Takashi Iwai <tiwai@suse.de>\nCo-developed-by: Kai Vehmanen <kai.vehmanen@linux.intel.com>\nSigned-off-by: Kai Vehmanen <kai.vehmanen@linux.intel.com>\nBugzilla:  http://bugzilla.suse.com/show_bug.cgi?id=1161246\nSigned-off-by: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>\nReviewed-by: Takashi Iwai <tiwai@suse.de>\nLink: https://lore.kernel.org/r/20200124213625.30186-4-pierre-louis.bossart@linux.intel.com\nSigned-off-by: Mark Brown <broonie@kernel.org>\nCc: stable@vger.kernel.org",
  "author_name": "Pierre-Louis Bossart",
  "author_email": "pierre-louis.bossart@linux.intel.com",
  "author_date": "Fri Jan 24 15:36:21 2020 -0600",
  "author_date_iso": "2020-01-24T15:36:21-06:00",
  "committer_name": "Mark Brown",
  "committer_email": "broonie@kernel.org",
  "committer_date": "Mon Jan 27 17:51:59 2020 +0000",
  "committer_date_iso": "2020-01-27T17:51:59+00:00",
  "files_changed": [
    "sound/soc/sof/core.c",
    "sound/soc/sof/pm.c"
  ],
  "files_changed_count": 2,
  "stats": [
    {
      "file": "sound/soc/sof/core.c",
      "insertions": 12,
      "deletions": 21
    },
    {
      "file": "sound/soc/sof/pm.c",
      "insertions": 4,
      "deletions": 0
    }
  ],
  "total_insertions": 16,
  "total_deletions": 21,
  "total_changes": 37,
  "parents": [
    "37e97e6faeabda405d0c4319f8419dcc3da14b2b"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v5.6",
    "v5.6-rc1",
    "v5.6-rc2",
    "v5.6-rc3",
    "v5.6-rc4",
    "v5.6-rc5",
    "v5.6-rc6",
    "v5.6-rc7",
    "v5.7-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "authentication"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "sound/soc/sof/core.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "sound/soc/sof/pm.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}