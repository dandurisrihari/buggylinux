Commit Hash: 410e5e55c9c1c9c0d452ac5b9adb37b933a7747e
Subject: ASoC: SOF: core: release resources on errors in probe_continue


Security Keywords:
- authentication

Full commit message:
ASoC: SOF: core: release resources on errors in probe_continue

The initial intent of releasing resources in the .remove does not work
well with HDaudio codecs. If the probe_continue() fails in a work
queue, e.g. due to missing firmware or authentication issues, we don't
release any resources, and as a result the kernel oopses during
suspend operations.

The suggested fix is to release all resources during errors in
probe_continue(), and use fw_state to track resource allocation
state, so that .remove does not attempt to release the same
hardware resources twice. PM operations are also modified so that
no action is done if DSP resources have been freed due to
an error at probe.

Reported-by: Takashi Iwai <tiwai@suse.de>
Co-developed-by: Kai Vehmanen <kai.vehmanen@linux.intel.com>
Signed-off-by: Kai Vehmanen <kai.vehmanen@linux.intel.com>
Bugzilla:  http://bugzilla.suse.com/show_bug.cgi?id=1161246
Signed-off-by: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
Reviewed-by: Takashi Iwai <tiwai@suse.de>
Link: https://lore.kernel.org/r/20200124213625.30186-4-pierre-louis.bossart@linux.intel.com
Signed-off-by: Mark Brown <broonie@kernel.org>
Cc: stable@vger.kernel.org

Metadata:
Author: Pierre-Louis Bossart <pierre-louis.bossart@linux.intel.com>
Author Date: Fri Jan 24 15:36:21 2020 -0600
Committer: Mark Brown <broonie@kernel.org>
Commit Date: Mon Jan 27 17:51:59 2020 +0000

Files Changed: 2
Lines Added: 16
Lines Removed: 21
Total Changes: 37
