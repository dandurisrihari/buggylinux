Commit Hash: 6ca9a2beb54a385c8cc5e39a9d2ef49945896c64
Subject: drm/i915: Unwind i915_gem_init() failure


Security Keywords:
- injection

Full commit message:
drm/i915: Unwind i915_gem_init() failure

Since Michal introduced new user controllable errors other than -EIO
during i915_gem_init(), we need to actually unwind on the error path as
we have to abort the module load (and we expect to do so cleanly!).

As we now teardown key state and then mark the driver as wedged (on
EIO), we have to be careful to not allow ourselves to resume and
unwedge, thus attempting to use the uninitialised driver.

v2: Try not to free driver state for the suppressed EIO
v3: Use load-fault-injection to test both error/recovery paths.

References: 8620eb1dbbf2 ("drm/i915/uc: Don't use -EIO to report missing firmware")
Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
Cc: Michal Wajdeczko <michal.wajdeczko@intel.com>
Cc: Joonas Lahtinen <joonas.lahtinen@linux.intel.com>
Cc: Sagar Arun Kamble <sagar.a.kamble@intel.com>
Reviewed-by: Micha≈Ç Winiarski <michal.winiarski@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20171213134347.4608-1-chris@chris-wilson.co.uk

Metadata:
Author: Chris Wilson <chris@chris-wilson.co.uk>
Author Date: Wed Dec 13 13:43:47 2017 +0000
Committer: Chris Wilson <chris@chris-wilson.co.uk>
Commit Date: Wed Dec 13 18:53:35 2017 +0000

Files Changed: 1
Lines Added: 66
Lines Removed: 14
Total Changes: 80
