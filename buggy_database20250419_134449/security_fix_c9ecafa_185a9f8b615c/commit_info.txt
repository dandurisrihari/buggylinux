Commit Hash: c9ecafaf0113a305f5085ceb9c7a4b64ca70eae9
Subject: KVM: selftests: evmcs_test: Check that VMCS12 is alway properly synced to eVMCS after restore


Security Keywords:
- injection

Full commit message:
KVM: selftests: evmcs_test: Check that VMCS12 is alway properly synced to eVMCS after restore

Add a test for the regression, introduced by commit f2c7ef3ba955
("KVM: nSVM: cancel KVM_REQ_GET_NESTED_STATE_PAGES on nested vmexit"). When
L2->L1 exit is forced immediately after restoring nested state,
KVM_REQ_GET_NESTED_STATE_PAGES request is cleared and VMCS12 changes
(e.g. fresh RIP) are not reflected to eVMCS. The consequent nested
vCPU run gets broken.

Utilize NMI injection to do the job.

Signed-off-by: Vitaly Kuznetsov <vkuznets@redhat.com>
Message-Id: <20210505151823.1341678-3-vkuznets@redhat.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

Metadata:
Author: Vitaly Kuznetsov <vkuznets@redhat.com>
Author Date: Wed May 5 17:18:22 2021 +0200
Committer: Paolo Bonzini <pbonzini@redhat.com>
Commit Date: Fri May 7 06:06:12 2021 -0400

Files Changed: 1
Lines Added: 55
Lines Removed: 11
Total Changes: 66
