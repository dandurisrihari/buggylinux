{
  "hash": "fa40a8214bb9bcae8d49c234c19d8b4a6c1f37ff",
  "hash_short": "fa40a821",
  "subject": "KVM: switch irq injection/acking data structures to irq_lock",
  "body": "Protect irq injection/acking data structures with a separate irq_lock\nmutex. This fixes the following deadlock:\n\nCPU A                               CPU B\nkvm_vm_ioctl_deassign_dev_irq()\n  mutex_lock(&kvm->lock);            worker_thread()\n  -> kvm_deassign_irq()                -> kvm_assigned_dev_interrupt_work_handler()\n    -> deassign_host_irq()               mutex_lock(&kvm->lock);\n      -> cancel_work_sync() [blocked]\n\n[gleb: fix ia64 path]\n\nReported-by: Alex Williamson <alex.williamson@hp.com>\nSigned-off-by: Marcelo Tosatti <mtosatti@redhat.com>\nSigned-off-by: Gleb Natapov <gleb@redhat.com>\nSigned-off-by: Avi Kivity <avi@redhat.com>",
  "full_message": "KVM: switch irq injection/acking data structures to irq_lock\n\nProtect irq injection/acking data structures with a separate irq_lock\nmutex. This fixes the following deadlock:\n\nCPU A                               CPU B\nkvm_vm_ioctl_deassign_dev_irq()\n  mutex_lock(&kvm->lock);            worker_thread()\n  -> kvm_deassign_irq()                -> kvm_assigned_dev_interrupt_work_handler()\n    -> deassign_host_irq()               mutex_lock(&kvm->lock);\n      -> cancel_work_sync() [blocked]\n\n[gleb: fix ia64 path]\n\nReported-by: Alex Williamson <alex.williamson@hp.com>\nSigned-off-by: Marcelo Tosatti <mtosatti@redhat.com>\nSigned-off-by: Gleb Natapov <gleb@redhat.com>\nSigned-off-by: Avi Kivity <avi@redhat.com>",
  "author_name": "Marcelo Tosatti",
  "author_email": "mtosatti@redhat.com",
  "author_date": "Thu Jun 4 15:08:24 2009 -0300",
  "author_date_iso": "2009-06-04T15:08:24-03:00",
  "committer_name": "Avi Kivity",
  "committer_email": "avi@redhat.com",
  "committer_date": "Thu Sep 10 08:32:49 2009 +0300",
  "committer_date_iso": "2009-09-10T08:32:49+03:00",
  "files_changed": [
    "arch/ia64/kvm/kvm-ia64.c",
    "arch/x86/kvm/i8254.c",
    "arch/x86/kvm/lapic.c",
    "arch/x86/kvm/x86.c",
    "include/linux/kvm_host.h",
    "virt/kvm/eventfd.c",
    "virt/kvm/irq_comm.c",
    "virt/kvm/kvm_main.c"
  ],
  "files_changed_count": 8,
  "stats": [
    {
      "file": "arch/ia64/kvm/kvm-ia64.c",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "arch/x86/kvm/i8254.c",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "arch/x86/kvm/lapic.c",
      "insertions": 4,
      "deletions": 0
    },
    {
      "file": "arch/x86/kvm/x86.c",
      "insertions": 9,
      "deletions": 10
    },
    {
      "file": "include/linux/kvm_host.h",
      "insertions": 2,
      "deletions": 1
    },
    {
      "file": "virt/kvm/eventfd.c",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "virt/kvm/irq_comm.c",
      "insertions": 28,
      "deletions": 6
    },
    {
      "file": "virt/kvm/kvm_main.c",
      "insertions": 9,
      "deletions": 7
    }
  ],
  "total_insertions": 58,
  "total_deletions": 30,
  "total_changes": 88,
  "parents": [
    "60eead79ad8750f80384cbe48fc44edcc78a0305"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v2.6.32",
    "v2.6.32-rc1",
    "v2.6.32-rc2",
    "v2.6.32-rc3",
    "v2.6.32-rc4",
    "v2.6.32-rc5",
    "v2.6.32-rc6",
    "v2.6.32-rc7",
    "v2.6.32-rc8",
    "v2.6.33"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/x86/kvm/lapic.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/ia64/kvm/kvm-ia64.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kvm/i8254.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "virt/kvm/irq_comm.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "virt/kvm/eventfd.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kvm/x86.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "virt/kvm/kvm_main.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/linux/kvm_host.h",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}