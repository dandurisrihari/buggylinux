{
  "hash": "851ae6424697d1c4f085cb878c88168923ebcad1",
  "hash_short": "851ae642",
  "subject": "migrate_pages_batch: fix statistics for longterm pin retry",
  "body": "In commit fd4a7ac32918 (\"mm: migrate: try again if THP split is failed due\nto page refcnt\"), if the THP splitting fails due to page reference count,\nwe will retry to improve migration successful rate.  But the failed\nsplitting is counted as migration failure and migration retry, which will\ncause duplicated failure counting.  So, in this patch, this is fixed via\nundoing the failure counting if we decide to retry.  The patch is tested\nvia failure injection.\n\nLink: https://lkml.kernel.org/r/20230416235929.1040194-1-ying.huang@intel.com\nFixes: fd4a7ac32918 (\"mm: migrate: try again if THP split is failed due to page refcnt\")\nSigned-off-by: \"Huang, Ying\" <ying.huang@intel.com>\nReviewed-by: Baolin Wang <baolin.wang@linux.alibaba.com>\nCc: Alistair Popple <apopple@nvidia.com>\nCc: David Hildenbrand <david@redhat.com>\nCc: Yang Shi <shy828301@gmail.com>\nCc: Zi Yan <ziy@nvidia.com>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>",
  "full_message": "migrate_pages_batch: fix statistics for longterm pin retry\n\nIn commit fd4a7ac32918 (\"mm: migrate: try again if THP split is failed due\nto page refcnt\"), if the THP splitting fails due to page reference count,\nwe will retry to improve migration successful rate.  But the failed\nsplitting is counted as migration failure and migration retry, which will\ncause duplicated failure counting.  So, in this patch, this is fixed via\nundoing the failure counting if we decide to retry.  The patch is tested\nvia failure injection.\n\nLink: https://lkml.kernel.org/r/20230416235929.1040194-1-ying.huang@intel.com\nFixes: fd4a7ac32918 (\"mm: migrate: try again if THP split is failed due to page refcnt\")\nSigned-off-by: \"Huang, Ying\" <ying.huang@intel.com>\nReviewed-by: Baolin Wang <baolin.wang@linux.alibaba.com>\nCc: Alistair Popple <apopple@nvidia.com>\nCc: David Hildenbrand <david@redhat.com>\nCc: Yang Shi <shy828301@gmail.com>\nCc: Zi Yan <ziy@nvidia.com>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>",
  "author_name": "Huang Ying",
  "author_email": "ying.huang@intel.com",
  "author_date": "Mon Apr 17 07:59:29 2023 +0800",
  "author_date_iso": "2023-04-17T07:59:29+08:00",
  "committer_name": "Andrew Morton",
  "committer_email": "akpm@linux-foundation.org",
  "committer_date": "Fri Apr 21 14:52:02 2023 -0700",
  "committer_date_iso": "2023-04-21T14:52:02-07:00",
  "files_changed": [
    "mm/migrate.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "mm/migrate.c",
      "insertions": 3,
      "deletions": 0
    }
  ],
  "total_insertions": 3,
  "total_deletions": 0,
  "total_changes": 3,
  "parents": [
    "686ea6e61da61e46ae7068f73167ca26e0c67efb"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "mm/migrate.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}