{
  "hash": "3a597f0d425b2160ce4278c3e1c8384bec8ccfb4",
  "hash_short": "3a597f0d",
  "subject": "ath11k: change management tx queue to avoid connection timed out",
  "body": "In the phase of wlan load, it has hw scan and 11d scan which sent to\nfirmware by ath11k, then hw scan and 11d scan will use about 14 seconds,\nand meanwhile ath11k_reg_update_chan_list() is running in workqueue of\nath11k_base, and wait for 11d scan/hw scan finished. When the hw scan\nfinished, mac80211 will start to connect and send management packet,\nat this moment, ath11k_reg_update_chan_list() is still waiting for 11d\nscan finished, so wmi_mgmt_tx_work of ath11k will not run and thus the\ntx management packet also not send out and lead authentication timed\nout.\n\nlog:\nINFO kernel: [  187.885322] wlan0: authenticate with 72:6c:57:43:9f:90\nINFO kernel: [  187.937266] wlan0: send auth to 72:6c:57:43:9f:90 (try 1/3)\nINFO kernel: [  188.626944] wlan0: send auth to 72:6c:57:43:9f:90 (try 2/3)\nINFO kernel: [  189.650999] wlan0: send auth to 72:6c:57:43:9f:90 (try 3/3)\nINFO kernel: [  190.651917] wlan0: authentication with 72:6c:57:43:9f:90 timed out\n\nChange wmi_mgmt_tx_work to another queue workqueue_aux of ath11k_base,\nthen connection success.\n\nTested-on: WCN6855 hw2.0 PCI WLAN.HSP.1.1-03125-QCAHSPSWPL_V1_V2_SILICONZ_LITE-3\n\nSigned-off-by: Wen Gong <quic_wgong@quicinc.com>\nSigned-off-by: Kalle Valo <quic_kvalo@quicinc.com>\nLink: https://lore.kernel.org/r/20220428023320.4007-1-quic_wgong@quicinc.com",
  "full_message": "ath11k: change management tx queue to avoid connection timed out\n\nIn the phase of wlan load, it has hw scan and 11d scan which sent to\nfirmware by ath11k, then hw scan and 11d scan will use about 14 seconds,\nand meanwhile ath11k_reg_update_chan_list() is running in workqueue of\nath11k_base, and wait for 11d scan/hw scan finished. When the hw scan\nfinished, mac80211 will start to connect and send management packet,\nat this moment, ath11k_reg_update_chan_list() is still waiting for 11d\nscan finished, so wmi_mgmt_tx_work of ath11k will not run and thus the\ntx management packet also not send out and lead authentication timed\nout.\n\nlog:\nINFO kernel: [  187.885322] wlan0: authenticate with 72:6c:57:43:9f:90\nINFO kernel: [  187.937266] wlan0: send auth to 72:6c:57:43:9f:90 (try 1/3)\nINFO kernel: [  188.626944] wlan0: send auth to 72:6c:57:43:9f:90 (try 2/3)\nINFO kernel: [  189.650999] wlan0: send auth to 72:6c:57:43:9f:90 (try 3/3)\nINFO kernel: [  190.651917] wlan0: authentication with 72:6c:57:43:9f:90 timed out\n\nChange wmi_mgmt_tx_work to another queue workqueue_aux of ath11k_base,\nthen connection success.\n\nTested-on: WCN6855 hw2.0 PCI WLAN.HSP.1.1-03125-QCAHSPSWPL_V1_V2_SILICONZ_LITE-3\n\nSigned-off-by: Wen Gong <quic_wgong@quicinc.com>\nSigned-off-by: Kalle Valo <quic_kvalo@quicinc.com>\nLink: https://lore.kernel.org/r/20220428023320.4007-1-quic_wgong@quicinc.com",
  "author_name": "Wen Gong",
  "author_email": "quic_wgong@quicinc.com",
  "author_date": "Fri Apr 29 16:15:02 2022 +0300",
  "author_date_iso": "2022-04-29T16:15:02+03:00",
  "committer_name": "Kalle Valo",
  "committer_email": "quic_kvalo@quicinc.com",
  "committer_date": "Mon May 2 16:57:35 2022 +0300",
  "committer_date_iso": "2022-05-02T16:57:35+03:00",
  "files_changed": [
    "drivers/net/wireless/ath/ath11k/mac.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/net/wireless/ath/ath11k/mac.c",
      "insertions": 1,
      "deletions": 1
    }
  ],
  "total_insertions": 1,
  "total_deletions": 1,
  "total_changes": 2,
  "parents": [
    "7330e1ec9748948177830c6e1a13379835d577f9"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "authentication"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/net/wireless/ath/ath11k/mac.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}