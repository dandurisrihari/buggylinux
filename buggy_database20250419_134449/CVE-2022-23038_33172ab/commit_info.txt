Commit Hash: 33172ab50a53578a95691310f49567c9266968b0
Subject: xen/scsifront: don't use gnttab_query_foreign_access() for mapped status

CVE Identifiers:
- CVE-2022-23038

Full commit message:
xen/scsifront: don't use gnttab_query_foreign_access() for mapped status

It isn't enough to check whether a grant is still being in use by
calling gnttab_query_foreign_access(), as a mapping could be realized
by the other side just after having called that function.

In case the call was done in preparation of revoking a grant it is
better to do so via gnttab_try_end_foreign_access() and check the
success of that operation instead.

This is CVE-2022-23038 / part of XSA-396.

Reported-by: Demi Marie Obenour <demi@invisiblethingslab.com>
Signed-off-by: Juergen Gross <jgross@suse.com>
Reviewed-by: Jan Beulich <jbeulich@suse.com>
---
V2:
- use gnttab_try_end_foreign_access()

Metadata:
Author: Juergen Gross <jgross@suse.com>
Author Date: Mon Mar 7 09:48:54 2022 +0100
Committer: Juergen Gross <jgross@suse.com>
Commit Date: Mon Mar 7 09:48:54 2022 +0100

Files Changed: 1
Lines Added: 1
Lines Removed: 2
Total Changes: 3
