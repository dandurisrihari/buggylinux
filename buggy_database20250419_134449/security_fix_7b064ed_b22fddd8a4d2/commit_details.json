{
  "hash": "7b064edae38d62d8587a8c574f93b53ce75ae749",
  "hash_short": "7b064eda",
  "subject": "Bluetooth: Fix authentication if acl data comes before remote feature evt",
  "body": "If remote device sends l2cap info request before read_remote_ext_feature\ncompletes then mgmt_connected will be sent in hci_acldata_packet() and\nremote name request wont be sent and eventually authentication wont happen\n\nHcidump log of the issue\n\n< HCI Command: Create Connection (0x01|0x0005) plen 13\n    bdaddr BC:85:1F:74:7F:29 ptype 0xcc18 rswitch 0x01 clkoffset 0x4bf7 (valid)\n    Packet type: DM1 DM3 DM5 DH1 DH3 DH5\n> HCI Event: Command Status (0x0f) plen 4\n    Create Connection (0x01|0x0005) status 0x00 ncmd 1\n> HCI Event: Connect Complete (0x03) plen 11\n    status 0x00 handle 12 bdaddr BC:85:1F:74:7F:29 type ACL encrypt 0x00\n< HCI Command: Read Remote Supported Features (0x01|0x001b) plen 2\n    handle 12\n> HCI Event: Command Status (0x0f) plen 4\n    Read Remote Supported Features (0x01|0x001b) status 0x00 ncmd 1\n> HCI Event: Read Remote Supported Features (0x0b) plen 11\n    status 0x00 handle 12\n    Features: 0xbf 0xfe 0xcf 0xfe 0xdb 0xff 0x7b 0x87\n> HCI Event: Max Slots Change (0x1b) plen 3\n    handle 12 slots 5\n< HCI Command: Read Remote Extended Features (0x01|0x001c) plen 3\n    handle 12 page 1\n> HCI Event: Command Status (0x0f) plen 4\n    Read Remote Extended Features (0x01|0x001c) status 0x00 ncmd 1\n> ACL data: handle 12 flags 0x02 dlen 10\n    L2CAP(s): Info req: type 2\n< ACL data: handle 12 flags 0x00 dlen 16\n    L2CAP(s): Info rsp: type 2 result 0\n      Extended feature mask 0x00b8\n        Enhanced Retransmission mode\n        Streaming mode\n        FCS Option\n        Fixed Channels\n> HCI Event: Read Remote Extended Features (0x23) plen 13\n    status 0x00 handle 12 page 1 max 1\n    Features: 0x01 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n> ACL data: handle 12 flags 0x02 dlen 10\n    L2CAP(s): Info req: type 3\n< ACL data: handle 12 flags 0x00 dlen 20\n    L2CAP(s): Info rsp: type 3 result 0\n      Fixed channel list 0x00000002\n        L2CAP Signalling Channel\n> HCI Event: Number of Completed Packets (0x13) plen 5\n    handle 12 packets 2\n\nThis patch moves sending mgmt_connected from hci_acldata_packet() to\nl2cap_connect_req() since this code is to handle the scenario remote\ndevice sends l2cap connect req too fast\n\nSigned-off-by: Jaganath Kanakkassery <jaganath.k@samsung.com>\nSigned-off-by: Gustavo Padovan <gustavo.padovan@collabora.co.uk>",
  "full_message": "Bluetooth: Fix authentication if acl data comes before remote feature evt\n\nIf remote device sends l2cap info request before read_remote_ext_feature\ncompletes then mgmt_connected will be sent in hci_acldata_packet() and\nremote name request wont be sent and eventually authentication wont happen\n\nHcidump log of the issue\n\n< HCI Command: Create Connection (0x01|0x0005) plen 13\n    bdaddr BC:85:1F:74:7F:29 ptype 0xcc18 rswitch 0x01 clkoffset 0x4bf7 (valid)\n    Packet type: DM1 DM3 DM5 DH1 DH3 DH5\n> HCI Event: Command Status (0x0f) plen 4\n    Create Connection (0x01|0x0005) status 0x00 ncmd 1\n> HCI Event: Connect Complete (0x03) plen 11\n    status 0x00 handle 12 bdaddr BC:85:1F:74:7F:29 type ACL encrypt 0x00\n< HCI Command: Read Remote Supported Features (0x01|0x001b) plen 2\n    handle 12\n> HCI Event: Command Status (0x0f) plen 4\n    Read Remote Supported Features (0x01|0x001b) status 0x00 ncmd 1\n> HCI Event: Read Remote Supported Features (0x0b) plen 11\n    status 0x00 handle 12\n    Features: 0xbf 0xfe 0xcf 0xfe 0xdb 0xff 0x7b 0x87\n> HCI Event: Max Slots Change (0x1b) plen 3\n    handle 12 slots 5\n< HCI Command: Read Remote Extended Features (0x01|0x001c) plen 3\n    handle 12 page 1\n> HCI Event: Command Status (0x0f) plen 4\n    Read Remote Extended Features (0x01|0x001c) status 0x00 ncmd 1\n> ACL data: handle 12 flags 0x02 dlen 10\n    L2CAP(s): Info req: type 2\n< ACL data: handle 12 flags 0x00 dlen 16\n    L2CAP(s): Info rsp: type 2 result 0\n      Extended feature mask 0x00b8\n        Enhanced Retransmission mode\n        Streaming mode\n        FCS Option\n        Fixed Channels\n> HCI Event: Read Remote Extended Features (0x23) plen 13\n    status 0x00 handle 12 page 1 max 1\n    Features: 0x01 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n> ACL data: handle 12 flags 0x02 dlen 10\n    L2CAP(s): Info req: type 3\n< ACL data: handle 12 flags 0x00 dlen 20\n    L2CAP(s): Info rsp: type 3 result 0\n      Fixed channel list 0x00000002\n        L2CAP Signalling Channel\n> HCI Event: Number of Completed Packets (0x13) plen 5\n    handle 12 packets 2\n\nThis patch moves sending mgmt_connected from hci_acldata_packet() to\nl2cap_connect_req() since this code is to handle the scenario remote\ndevice sends l2cap connect req too fast\n\nSigned-off-by: Jaganath Kanakkassery <jaganath.k@samsung.com>\nSigned-off-by: Gustavo Padovan <gustavo.padovan@collabora.co.uk>",
  "author_name": "Jaganath Kanakkassery",
  "author_email": "jaganath.k@samsung.com",
  "author_date": "Thu Jan 10 10:28:35 2013 +0530",
  "author_date_iso": "2013-01-10T10:28:35+05:30",
  "committer_name": "Gustavo Padovan",
  "committer_email": "gustavo.padovan@collabora.co.uk",
  "committer_date": "Thu Jan 10 03:26:18 2013 -0200",
  "committer_date_iso": "2013-01-10T03:26:18-02:00",
  "files_changed": [
    "net/bluetooth/hci_core.c",
    "net/bluetooth/l2cap_core.c"
  ],
  "files_changed_count": 2,
  "stats": [
    {
      "file": "net/bluetooth/hci_core.c",
      "insertions": 0,
      "deletions": 8
    },
    {
      "file": "net/bluetooth/l2cap_core.c",
      "insertions": 11,
      "deletions": 0
    }
  ],
  "total_insertions": 11,
  "total_deletions": 8,
  "total_changes": 19,
  "parents": [
    "f4d6f7dce71a5da93da50272ff1670bf2f1146b1"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v3.10",
    "v3.10-rc1",
    "v3.10-rc2",
    "v3.10-rc3",
    "v3.10-rc4",
    "v3.10-rc5",
    "v3.10-rc6",
    "v3.10-rc7",
    "v3.11",
    "v3.11-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "authentication"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "net/bluetooth/hci_core.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "net/bluetooth/l2cap_core.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}