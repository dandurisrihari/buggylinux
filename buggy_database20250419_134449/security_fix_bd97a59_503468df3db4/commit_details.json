{
  "hash": "bd97a59da6a866e3dee5d2a2d582ec71dbbc84cd",
  "hash_short": "bd97a59d",
  "subject": "nvme-auth: use workqueue dedicated to authentication",
  "body": "NVMe In-Band authentication uses two kinds of works: chap->auth_work and\nctrl->dhchap_auth_work. The latter work flushes or cancels the former\nwork. However, the both works are queued to the same workqueue nvme-wq.\nIt results in the lockdep WARNING as follows:\n\n WARNING: possible recursive locking detected\n 6.2.0-rc4+ #1 Not tainted\n --------------------------------------------\n kworker/u16:7/69 is trying to acquire lock:\n ffff902d52e65548 ((wq_completion)nvme-wq){+.+.}-{0:0}, at: start_flush_work+0x2c5/0x380\n\n but task is already holding lock:\n ffff902d52e65548 ((wq_completion)nvme-wq){+.+.}-{0:0}, at: process_one_work+0x210/0x410\n\nTo avoid the WARNING, introduce a new workqueue nvme-auth-wq dedicated\nto chap->auth_work.\n\nReported-by: Daniel Wagner <dwagner@suse.de>\nLink: https://lore.kernel.org/linux-nvme/20230130110802.paafkiipmitwtnwr@carbon.lan/\nFixes: f50fff73d620 (\"nvme: implement In-Band authentication\")\nSigned-off-by: Shin'ichiro Kawasaki <shinichiro.kawasaki@wdc.com>\nTested-by: Daniel Wagner <dwagner@suse.de>\nReviewed-by: Hannes Reinecke <hare@suse.de>\nSigned-off-by: Christoph Hellwig <hch@lst.de>",
  "full_message": "nvme-auth: use workqueue dedicated to authentication\n\nNVMe In-Band authentication uses two kinds of works: chap->auth_work and\nctrl->dhchap_auth_work. The latter work flushes or cancels the former\nwork. However, the both works are queued to the same workqueue nvme-wq.\nIt results in the lockdep WARNING as follows:\n\n WARNING: possible recursive locking detected\n 6.2.0-rc4+ #1 Not tainted\n --------------------------------------------\n kworker/u16:7/69 is trying to acquire lock:\n ffff902d52e65548 ((wq_completion)nvme-wq){+.+.}-{0:0}, at: start_flush_work+0x2c5/0x380\n\n but task is already holding lock:\n ffff902d52e65548 ((wq_completion)nvme-wq){+.+.}-{0:0}, at: process_one_work+0x210/0x410\n\nTo avoid the WARNING, introduce a new workqueue nvme-auth-wq dedicated\nto chap->auth_work.\n\nReported-by: Daniel Wagner <dwagner@suse.de>\nLink: https://lore.kernel.org/linux-nvme/20230130110802.paafkiipmitwtnwr@carbon.lan/\nFixes: f50fff73d620 (\"nvme: implement In-Band authentication\")\nSigned-off-by: Shin'ichiro Kawasaki <shinichiro.kawasaki@wdc.com>\nTested-by: Daniel Wagner <dwagner@suse.de>\nReviewed-by: Hannes Reinecke <hare@suse.de>\nSigned-off-by: Christoph Hellwig <hch@lst.de>",
  "author_name": "Shin'ichiro Kawasaki",
  "author_email": "shinichiro.kawasaki@wdc.com",
  "author_date": "Tue Jan 31 18:26:44 2023 +0900",
  "author_date_iso": "2023-01-31T18:26:44+09:00",
  "committer_name": "Christoph Hellwig",
  "committer_email": "hch@lst.de",
  "committer_date": "Wed Feb 1 16:11:20 2023 +0100",
  "committer_date_iso": "2023-02-01T16:11:20+01:00",
  "files_changed": [
    "drivers/nvme/host/auth.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/nvme/host/auth.c",
      "insertions": 12,
      "deletions": 2
    }
  ],
  "total_insertions": 12,
  "total_deletions": 2,
  "total_changes": 14,
  "parents": [
    "6fbf13c0e24fd86ab2e4477cd8484a485b687421"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "auth"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/nvme/host/auth.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}