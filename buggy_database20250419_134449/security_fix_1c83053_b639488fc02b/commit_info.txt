Commit Hash: 1c830532f6b44d10a1743ccd00e990c6b83396f5
Subject: md: fix possible raid1/raid10 deadlock on read error during resync


Security Keywords:
- injection

Full commit message:
md: fix possible raid1/raid10 deadlock on read error during resync

Thanks to K.Tanaka and the scsi fault injection framework, here is a fix for
another possible deadlock in raid1/raid10 error handing.

If a read request returns an error while a resync is happening and a resync
request is pending, the attempt to fix the error will block until the resync
progresses, and the resync will block until the read request completes.  Thus
a deadlock.

This patch fixes the problem.

Cc: "K.Tanaka" <k-tanaka@ce.jp.nec.com>
Signed-off-by: Neil Brown <neilb@suse.de>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

Metadata:
Author: NeilBrown <neilb@suse.de>
Author Date: Tue Mar 4 14:29:35 2008 -0800
Committer: Linus Torvalds <torvalds@woody.linux-foundation.org>
Commit Date: Tue Mar 4 16:35:18 2008 -0800

Files Changed: 2
Lines Added: 18
Lines Removed: 4
Total Changes: 22
