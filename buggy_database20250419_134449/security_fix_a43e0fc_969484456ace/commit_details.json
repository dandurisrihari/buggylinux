{
  "hash": "a43e0fc5e9134a46515de2f2f8d4100b74e50de3",
  "hash_short": "a43e0fc5",
  "subject": "pstore: inode: Only d_invalidate() is needed",
  "body": "Unloading a modular pstore backend with records in pstorefs would\ntrigger the dput() double-drop warning:\n\n  WARNING: CPU: 0 PID: 2569 at fs/dcache.c:762 dput.part.0+0x3f3/0x410\n\nUsing the combo of d_drop()/dput() (as mentioned in\nDocumentation/filesystems/vfs.rst) isn't the right approach here, and\nleads to the reference counting problem seen above. Use d_invalidate()\nand update the code to not bother checking for error codes that can\nnever happen.\n\nSuggested-by: Alexander Viro <viro@zeniv.linux.org.uk>\nFixes: 609e28bb139e (\"pstore: Remove filesystem records when backend is unregistered\")\nSigned-off-by: Kees Cook <keescook@chromium.org>\n---\nCc: \"Guilherme G. Piccoli\" <gpiccoli@igalia.com>\nCc: Tony Luck <tony.luck@intel.com>\nCc: linux-hardening@vger.kernel.org",
  "full_message": "pstore: inode: Only d_invalidate() is needed\n\nUnloading a modular pstore backend with records in pstorefs would\ntrigger the dput() double-drop warning:\n\n  WARNING: CPU: 0 PID: 2569 at fs/dcache.c:762 dput.part.0+0x3f3/0x410\n\nUsing the combo of d_drop()/dput() (as mentioned in\nDocumentation/filesystems/vfs.rst) isn't the right approach here, and\nleads to the reference counting problem seen above. Use d_invalidate()\nand update the code to not bother checking for error codes that can\nnever happen.\n\nSuggested-by: Alexander Viro <viro@zeniv.linux.org.uk>\nFixes: 609e28bb139e (\"pstore: Remove filesystem records when backend is unregistered\")\nSigned-off-by: Kees Cook <keescook@chromium.org>\n---\nCc: \"Guilherme G. Piccoli\" <gpiccoli@igalia.com>\nCc: Tony Luck <tony.luck@intel.com>\nCc: linux-hardening@vger.kernel.org",
  "author_name": "Kees Cook",
  "author_email": "keescook@chromium.org",
  "author_date": "Thu Feb 22 09:48:46 2024 -0800",
  "author_date_iso": "2024-02-22T09:48:46-08:00",
  "committer_name": "Kees Cook",
  "committer_email": "keescook@chromium.org",
  "committer_date": "Thu Feb 22 10:37:21 2024 -0800",
  "committer_date_iso": "2024-02-22T10:37:21-08:00",
  "files_changed": [
    "fs/pstore/inode.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "fs/pstore/inode.c",
      "insertions": 3,
      "deletions": 7
    }
  ],
  "total_insertions": 3,
  "total_deletions": 7,
  "total_changes": 10,
  "parents": [
    "41bccc98fb7931d63d03f326a746ac4d429c1dd3"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "hardening"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "fs/pstore/inode.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}