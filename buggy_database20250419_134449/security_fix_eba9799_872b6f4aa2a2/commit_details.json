{
  "hash": "eba9799b5a6efe2993cf92529608e4aa8163d73b",
  "hash_short": "eba9799b",
  "subject": "KVM: VMX: Drop bits 31:16 when shoving exception error code into VMCS",
  "body": "Deliberately truncate the exception error code when shoving it into the\nVMCS (VM-Entry field for vmcs01 and vmcs02, VM-Exit field for vmcs12).\nIntel CPUs are incapable of handling 32-bit error codes and will never\ngenerate an error code with bits 31:16, but userspace can provide an\narbitrary error code via KVM_SET_VCPU_EVENTS.  Failure to drop the bits\non exception injection results in failed VM-Entry, as VMX disallows\nsetting bits 31:16.  Setting the bits on VM-Exit would at best confuse\nL1, and at worse induce a nested VM-Entry failure, e.g. if L1 decided to\nreinject the exception back into L2.\n\nCc: stable@vger.kernel.org\nSigned-off-by: Sean Christopherson <seanjc@google.com>\nReviewed-by: Jim Mattson <jmattson@google.com>\nReviewed-by: Maxim Levitsky <mlevitsk@redhat.com>\nLink: https://lore.kernel.org/r/20220830231614.3580124-3-seanjc@google.com\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "full_message": "KVM: VMX: Drop bits 31:16 when shoving exception error code into VMCS\n\nDeliberately truncate the exception error code when shoving it into the\nVMCS (VM-Entry field for vmcs01 and vmcs02, VM-Exit field for vmcs12).\nIntel CPUs are incapable of handling 32-bit error codes and will never\ngenerate an error code with bits 31:16, but userspace can provide an\narbitrary error code via KVM_SET_VCPU_EVENTS.  Failure to drop the bits\non exception injection results in failed VM-Entry, as VMX disallows\nsetting bits 31:16.  Setting the bits on VM-Exit would at best confuse\nL1, and at worse induce a nested VM-Entry failure, e.g. if L1 decided to\nreinject the exception back into L2.\n\nCc: stable@vger.kernel.org\nSigned-off-by: Sean Christopherson <seanjc@google.com>\nReviewed-by: Jim Mattson <jmattson@google.com>\nReviewed-by: Maxim Levitsky <mlevitsk@redhat.com>\nLink: https://lore.kernel.org/r/20220830231614.3580124-3-seanjc@google.com\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "author_name": "Sean Christopherson",
  "author_email": "seanjc@google.com",
  "author_date": "Tue Aug 30 23:15:49 2022 +0000",
  "author_date_iso": "2022-08-30T23:15:49+00:00",
  "committer_name": "Paolo Bonzini",
  "committer_email": "pbonzini@redhat.com",
  "committer_date": "Mon Sep 26 12:03:04 2022 -0400",
  "committer_date_iso": "2022-09-26T12:03:04-04:00",
  "files_changed": [
    "arch/x86/kvm/vmx/nested.c",
    "arch/x86/kvm/vmx/vmx.c"
  ],
  "files_changed_count": 2,
  "stats": [
    {
      "file": "arch/x86/kvm/vmx/nested.c",
      "insertions": 10,
      "deletions": 1
    },
    {
      "file": "arch/x86/kvm/vmx/vmx.c",
      "insertions": 11,
      "deletions": 1
    }
  ],
  "total_insertions": 21,
  "total_deletions": 2,
  "total_changes": 23,
  "parents": [
    "d953540430c5af57f5de97ea9e36253908204027"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/x86/kvm/vmx/nested.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kvm/vmx/vmx.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}