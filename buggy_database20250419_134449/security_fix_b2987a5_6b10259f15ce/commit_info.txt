Commit Hash: b2987a5e05ec7a1af7ca42e5d5349d7a22753031
Subject: eCryptfs: Unlock keys needed by ecryptfsd


Security Keywords:
- authentication

Full commit message:
eCryptfs: Unlock keys needed by ecryptfsd

Fixes a regression caused by b5695d04634fa4ccca7dcbc05bb4a66522f02e0b

Kernel keyring keys containing eCryptfs authentication tokens should not
be write locked when calling out to ecryptfsd to wrap and unwrap file
encryption keys. The eCryptfs kernel code can not hold the key's write
lock because ecryptfsd needs to request the key after receiving such a
request from the kernel.

Without this fix, all file opens and creates will timeout and fail when
using the eCryptfs PKI infrastructure. This is not an issue when using
passphrase-based mount keys, which is the most widely deployed eCryptfs
configuration.

Signed-off-by: Tyler Hicks <tyhicks@linux.vnet.ibm.com>
Acked-by: Roberto Sassu <roberto.sassu@polito.it>
Tested-by: Roberto Sassu <roberto.sassu@polito.it>
Tested-by: Alexis Hafner1 <haf@zurich.ibm.com>
Cc: <stable@kernel.org> [2.6.39+]

Metadata:
Author: Tyler Hicks <tyhicks@linux.vnet.ibm.com>
Author Date: Tue Jul 26 19:47:08 2011 -0500
Committer: Tyler Hicks <tyhicks@linux.vnet.ibm.com>
Commit Date: Thu Jul 28 23:30:09 2011 -0500

Files Changed: 1
Lines Added: 25
Lines Removed: 22
Total Changes: 47
