{
  "hash": "d84ad2c0d80c3ee1b7d758e2c07d043fcf32d568",
  "hash_short": "d84ad2c0",
  "subject": "net: lan969x: add FDMA implementation",
  "body": "The lan969x switch device supports manual frame injection and extraction\nto and from the switch core, using a number of injection and extraction\nqueues.  This technique is currently supported, but delivers poor\nperformance compared to Frame DMA (FDMA).\n\nThis lan969x implementation of FDMA, hooks into the existing FDMA for\nSparx5, but requires its own RX and TX handling, as lan969x does not\nsupport the same native cache coherency that Sparx5 does. Effectively,\nthis means that we are going to use the DMA mapping API for mapping and\nunmapping TX buffers. The RX loop will utilize the page pool API for\nefficient RX handling. Other than that, the implementation is largely\nthe same, and utilizes the FDMA library for DCB and DB handling.\n\nSome numbers:\n\nManual injection/extraction (before this series):\n\n// iperf3 -c 1.0.1.1\n\n[ ID] Interval           Transfer     Bitrate\n[  5]   0.00-10.02  sec   345 MBytes   289 Mbits/sec  sender\n[  5]   0.00-10.06  sec   345 MBytes   288 Mbits/sec  receiver\n\nFDMA (after this series):\n\n// iperf3 -c 1.0.1.1\n\n[ ID] Interval           Transfer     Bitrate\n[  5]   0.00-10.03  sec  1.10 GBytes   940 Mbits/sec  sender\n[  5]   0.00-10.07  sec  1.10 GBytes   936 Mbits/sec  receiver\n\nReviewed-by: Steen Hegelund <Steen.Hegelund@microchip.com>\nSigned-off-by: Daniel Machon <daniel.machon@microchip.com>\nLink: https://patch.msgid.link/20250113-sparx5-lan969x-switch-driver-5-v2-5-c468f02fd623@microchip.com\nSigned-off-by: Jakub Kicinski <kuba@kernel.org>",
  "full_message": "net: lan969x: add FDMA implementation\n\nThe lan969x switch device supports manual frame injection and extraction\nto and from the switch core, using a number of injection and extraction\nqueues.  This technique is currently supported, but delivers poor\nperformance compared to Frame DMA (FDMA).\n\nThis lan969x implementation of FDMA, hooks into the existing FDMA for\nSparx5, but requires its own RX and TX handling, as lan969x does not\nsupport the same native cache coherency that Sparx5 does. Effectively,\nthis means that we are going to use the DMA mapping API for mapping and\nunmapping TX buffers. The RX loop will utilize the page pool API for\nefficient RX handling. Other than that, the implementation is largely\nthe same, and utilizes the FDMA library for DCB and DB handling.\n\nSome numbers:\n\nManual injection/extraction (before this series):\n\n// iperf3 -c 1.0.1.1\n\n[ ID] Interval           Transfer     Bitrate\n[  5]   0.00-10.02  sec   345 MBytes   289 Mbits/sec  sender\n[  5]   0.00-10.06  sec   345 MBytes   288 Mbits/sec  receiver\n\nFDMA (after this series):\n\n// iperf3 -c 1.0.1.1\n\n[ ID] Interval           Transfer     Bitrate\n[  5]   0.00-10.03  sec  1.10 GBytes   940 Mbits/sec  sender\n[  5]   0.00-10.07  sec  1.10 GBytes   936 Mbits/sec  receiver\n\nReviewed-by: Steen Hegelund <Steen.Hegelund@microchip.com>\nSigned-off-by: Daniel Machon <daniel.machon@microchip.com>\nLink: https://patch.msgid.link/20250113-sparx5-lan969x-switch-driver-5-v2-5-c468f02fd623@microchip.com\nSigned-off-by: Jakub Kicinski <kuba@kernel.org>",
  "author_name": "Daniel Machon",
  "author_email": "daniel.machon@microchip.com",
  "author_date": "Mon Jan 13 20:36:09 2025 +0100",
  "author_date_iso": "2025-01-13T20:36:09+01:00",
  "committer_name": "Jakub Kicinski",
  "committer_email": "kuba@kernel.org",
  "committer_date": "Wed Jan 15 14:13:33 2025 -0800",
  "committer_date_iso": "2025-01-15T14:13:33-08:00",
  "files_changed": [
    "drivers/net/ethernet/microchip/sparx5/Kconfig",
    "drivers/net/ethernet/microchip/sparx5/Makefile",
    "drivers/net/ethernet/microchip/sparx5/lan969x/lan969x.c",
    "drivers/net/ethernet/microchip/sparx5/lan969x/lan969x.h",
    "drivers/net/ethernet/microchip/sparx5/lan969x/lan969x_fdma.c",
    "drivers/net/ethernet/microchip/sparx5/sparx5_fdma.c",
    "drivers/net/ethernet/microchip/sparx5/sparx5_main.h",
    "drivers/net/ethernet/microchip/sparx5/sparx5_packet.c"
  ],
  "files_changed_count": 8,
  "stats": [
    {
      "file": "drivers/net/ethernet/microchip/sparx5/Kconfig",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "drivers/net/ethernet/microchip/sparx5/Makefile",
      "insertions": 2,
      "deletions": 1
    },
    {
      "file": "drivers/net/ethernet/microchip/sparx5/lan969x/lan969x.c",
      "insertions": 4,
      "deletions": 0
    },
    {
      "file": "drivers/net/ethernet/microchip/sparx5/lan969x/lan969x.h",
      "insertions": 7,
      "deletions": 0
    },
    {
      "file": "drivers/net/ethernet/microchip/sparx5/lan969x/lan969x_fdma.c",
      "insertions": 406,
      "deletions": 0
    },
    {
      "file": "drivers/net/ethernet/microchip/sparx5/sparx5_fdma.c",
      "insertions": 2,
      "deletions": 5
    },
    {
      "file": "drivers/net/ethernet/microchip/sparx5/sparx5_main.h",
      "insertions": 20,
      "deletions": 1
    },
    {
      "file": "drivers/net/ethernet/microchip/sparx5/sparx5_packet.c",
      "insertions": 6,
      "deletions": 0
    }
  ],
  "total_insertions": 448,
  "total_deletions": 7,
  "total_changes": 455,
  "parents": [
    "56143c52a342d0333a9b5ba12bc16dd071a1af5b"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/net/ethernet/microchip/sparx5/Makefile",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/ethernet/microchip/sparx5/Kconfig",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/ethernet/microchip/sparx5/lan969x/lan969x_fdma.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/ethernet/microchip/sparx5/lan969x/lan969x.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/ethernet/microchip/sparx5/sparx5_fdma.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/ethernet/microchip/sparx5/lan969x/lan969x.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/ethernet/microchip/sparx5/sparx5_main.h",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/ethernet/microchip/sparx5/sparx5_packet.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}