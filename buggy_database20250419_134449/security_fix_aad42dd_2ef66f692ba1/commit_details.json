{
  "hash": "aad42dd44db086c79ca3f470ad563d2ac4ac218d",
  "hash_short": "aad42dd4",
  "subject": "uprobes: Initialize uprobes earlier",
  "body": "In order to have a separate address space for text poking, we need to\nduplicate init_mm early during start_kernel(). This, however, introduces\na problem since uprobes functions are called from dup_mmap(), but\nuprobes is still not initialized in this early stage.\n\nSince uprobes initialization is necassary for fork, and since all the\ndependant initialization has been done when fork is initialized (percpu\nand vmalloc), move uprobes initialization to fork_init(). It does not\nseem uprobes introduces any security problem for the poking_mm.\n\nCrash and burn if uprobes initialization fails, similarly to other early\ninitializations. Change the init_probes() name to probes_init() to match\nother early initialization functions name convention.\n\nReported-by: kernel test robot <lkp@intel.com>\nSigned-off-by: Nadav Amit <namit@vmware.com>\nSigned-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>\nCc: Andy Lutomirski <luto@kernel.org>\nCc: Arnaldo Carvalho de Melo <acme@kernel.org>\nCc: Borislav Petkov <bp@alien8.de>\nCc: Dave Hansen <dave.hansen@linux.intel.com>\nCc: H. Peter Anvin <hpa@zytor.com>\nCc: Linus Torvalds <torvalds@linux-foundation.org>\nCc: Rick Edgecombe <rick.p.edgecombe@intel.com>\nCc: Rik van Riel <riel@surriel.com>\nCc: Thomas Gleixner <tglx@linutronix.de>\nCc: akpm@linux-foundation.org\nCc: ard.biesheuvel@linaro.org\nCc: deneen.t.dock@intel.com\nCc: kernel-hardening@lists.openwall.com\nCc: kristen@linux.intel.com\nCc: linux_dti@icloud.com\nCc: will.deacon@arm.com\nLink: https://lkml.kernel.org/r/20190426232303.28381-6-nadav.amit@gmail.com\nSigned-off-by: Ingo Molnar <mingo@kernel.org>",
  "full_message": "uprobes: Initialize uprobes earlier\n\nIn order to have a separate address space for text poking, we need to\nduplicate init_mm early during start_kernel(). This, however, introduces\na problem since uprobes functions are called from dup_mmap(), but\nuprobes is still not initialized in this early stage.\n\nSince uprobes initialization is necassary for fork, and since all the\ndependant initialization has been done when fork is initialized (percpu\nand vmalloc), move uprobes initialization to fork_init(). It does not\nseem uprobes introduces any security problem for the poking_mm.\n\nCrash and burn if uprobes initialization fails, similarly to other early\ninitializations. Change the init_probes() name to probes_init() to match\nother early initialization functions name convention.\n\nReported-by: kernel test robot <lkp@intel.com>\nSigned-off-by: Nadav Amit <namit@vmware.com>\nSigned-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>\nCc: Andy Lutomirski <luto@kernel.org>\nCc: Arnaldo Carvalho de Melo <acme@kernel.org>\nCc: Borislav Petkov <bp@alien8.de>\nCc: Dave Hansen <dave.hansen@linux.intel.com>\nCc: H. Peter Anvin <hpa@zytor.com>\nCc: Linus Torvalds <torvalds@linux-foundation.org>\nCc: Rick Edgecombe <rick.p.edgecombe@intel.com>\nCc: Rik van Riel <riel@surriel.com>\nCc: Thomas Gleixner <tglx@linutronix.de>\nCc: akpm@linux-foundation.org\nCc: ard.biesheuvel@linaro.org\nCc: deneen.t.dock@intel.com\nCc: kernel-hardening@lists.openwall.com\nCc: kristen@linux.intel.com\nCc: linux_dti@icloud.com\nCc: will.deacon@arm.com\nLink: https://lkml.kernel.org/r/20190426232303.28381-6-nadav.amit@gmail.com\nSigned-off-by: Ingo Molnar <mingo@kernel.org>",
  "author_name": "Nadav Amit",
  "author_email": "namit@vmware.com",
  "author_date": "Fri Apr 26 16:22:44 2019 -0700",
  "author_date_iso": "2019-04-26T16:22:44-07:00",
  "committer_name": "Ingo Molnar",
  "committer_email": "mingo@kernel.org",
  "committer_date": "Tue Apr 30 12:37:51 2019 +0200",
  "committer_date_iso": "2019-04-30T12:37:51+02:00",
  "files_changed": [
    "include/linux/uprobes.h",
    "kernel/events/uprobes.c",
    "kernel/fork.c"
  ],
  "files_changed_count": 3,
  "stats": [
    {
      "file": "include/linux/uprobes.h",
      "insertions": 5,
      "deletions": 0
    },
    {
      "file": "kernel/events/uprobes.c",
      "insertions": 3,
      "deletions": 5
    },
    {
      "file": "kernel/fork.c",
      "insertions": 1,
      "deletions": 0
    }
  ],
  "total_insertions": 9,
  "total_deletions": 5,
  "total_changes": 14,
  "parents": [
    "d97080ebed7811a53c931032a284166ee46b9565"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v5.2",
    "v5.2-rc1",
    "v5.2-rc2",
    "v5.2-rc3",
    "v5.2-rc4",
    "v5.2-rc5",
    "v5.2-rc6",
    "v5.2-rc7",
    "v5.3",
    "v5.3-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "hardening"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "include/linux/uprobes.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "kernel/events/uprobes.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "kernel/fork.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}