{
  "hash": "25c150ac103a4ebeed0319994c742a90634ddf18",
  "hash_short": "25c150ac",
  "subject": "bluetooth: Perform careful capability checks in hci_sock_ioctl()",
  "body": "Previously, capability was checked using capable(), which verified that the\ncaller of the ioctl system call had the required capability. In addition,\nthe result of the check would be stored in the HCI_SOCK_TRUSTED flag,\nmaking it persistent for the socket.\n\nHowever, malicious programs can abuse this approach by deliberately sharing\nan HCI socket with a privileged task. The HCI socket will be marked as\ntrusted when the privileged task occasionally makes an ioctl call.\n\nThis problem can be solved by using sk_capable() to check capability, which\nensures that not only the current task but also the socket opener has the\nspecified capability, thus reducing the risk of privilege escalation\nthrough the previously identified vulnerability.\n\nCc: stable@vger.kernel.org\nFixes: f81f5b2db869 (\"Bluetooth: Send control open and close messages for HCI raw sockets\")\nSigned-off-by: Ruihan Li <lrh2000@pku.edu.cn>\nSigned-off-by: Luiz Augusto von Dentz <luiz.von.dentz@intel.com>",
  "full_message": "bluetooth: Perform careful capability checks in hci_sock_ioctl()\n\nPreviously, capability was checked using capable(), which verified that the\ncaller of the ioctl system call had the required capability. In addition,\nthe result of the check would be stored in the HCI_SOCK_TRUSTED flag,\nmaking it persistent for the socket.\n\nHowever, malicious programs can abuse this approach by deliberately sharing\nan HCI socket with a privileged task. The HCI socket will be marked as\ntrusted when the privileged task occasionally makes an ioctl call.\n\nThis problem can be solved by using sk_capable() to check capability, which\nensures that not only the current task but also the socket opener has the\nspecified capability, thus reducing the risk of privilege escalation\nthrough the previously identified vulnerability.\n\nCc: stable@vger.kernel.org\nFixes: f81f5b2db869 (\"Bluetooth: Send control open and close messages for HCI raw sockets\")\nSigned-off-by: Ruihan Li <lrh2000@pku.edu.cn>\nSigned-off-by: Luiz Augusto von Dentz <luiz.von.dentz@intel.com>",
  "author_name": "Ruihan Li",
  "author_email": "lrh2000@pku.edu.cn",
  "author_date": "Sun Apr 16 16:14:04 2023 +0800",
  "author_date_iso": "2023-04-16T16:14:04+08:00",
  "committer_name": "Luiz Augusto von Dentz",
  "committer_email": "luiz.von.dentz@intel.com",
  "committer_date": "Sun Apr 23 22:05:39 2023 -0700",
  "committer_date_iso": "2023-04-23T22:05:39-07:00",
  "files_changed": [
    "net/bluetooth/hci_sock.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "net/bluetooth/hci_sock.c",
      "insertions": 8,
      "deletions": 1
    }
  ],
  "total_insertions": 8,
  "total_deletions": 1,
  "total_changes": 9,
  "parents": [
    "25e97f7b1866e6b8503be349eeea44bb52d661ce"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "privilege escalation",
      "vulnerability"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "net/bluetooth/hci_sock.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}