Commit Hash: 8b4ed8634f8b3f9aacfc42b4a872d30c36b9e255
Subject: tipc: eliminate race condition at dual link establishment


Security Keywords:
- bypass

Full commit message:
tipc: eliminate race condition at dual link establishment

Despite recent improvements, the establishment of dual parallel
links still has a small glitch where messages can bypass each
other. When the second link in a dual-link configuration is
established, part of the first link's traffic will be steered over
to the new link. Although we do have a mechanism to ensure that
packets sent before and after the establishment of the new link
arrive in sequence to the destination node, this is not enough.
The arriving messages will still be delivered upwards in different
threads, something entailing a risk of message disordering during
the transition phase.

To fix this, we introduce a synchronization mechanism between the
two parallel links, so that traffic arriving on the new link cannot
be added to its input queue until we are guaranteed that all
pre-establishment messages have been delivered on the old, parallel
link.

This problem seems to always have been around, but its occurrence is
so rare that it has not been noticed until recent intensive testing.

Reviewed-by: Ying Xue <ying.xue@windriver.com>
Reviewed-by: Erik Hugne <erik.hugne@ericsson.com>
Signed-off-by: Jon Maloy <jon.maloy@ericsson.com>
Signed-off-by: David S. Miller <davem@davemloft.net>

Metadata:
Author: Jon Paul Maloy <jon.maloy@ericsson.com>
Author Date: Wed Mar 25 12:07:26 2015 -0400
Committer: David S. Miller <davem@davemloft.net>
Commit Date: Wed Mar 25 14:05:56 2015 -0400

Files Changed: 3
Lines Added: 55
Lines Removed: 0
Total Changes: 55
