{
  "hash": "47894e0fa6a56a42be6a47c767e79cce8125489d",
  "hash_short": "47894e0f",
  "subject": "virt/sev-guest: Prevent IV reuse in the SNP guest driver",
  "body": "The AMD Secure Processor (ASP) and an SNP guest use a series of\nAES-GCM keys called VMPCKs to communicate securely with each other.\nThe IV to this scheme is a sequence number that both the ASP and the\nguest track.\n\nCurrently, this sequence number in a guest request must exactly match\nthe sequence number tracked by the ASP. This means that if the guest\nsees an error from the host during a request it can only retry that\nexact request or disable the VMPCK to prevent an IV reuse. AES-GCM\ncannot tolerate IV reuse, see: \"Authentication Failures in NIST version\nof GCM\" - Antoine Joux et al.\n\nIn order to address this, make handle_guest_request() delete the VMPCK\non any non successful return. To allow userspace querying the cert_data\nlength make handle_guest_request() save the number of pages required by\nthe host, then have handle_guest_request() retry the request without\nrequesting the extended data, then return the number of pages required\nback to userspace.\n\n  [ bp: Massage, incorporate Tom's review comments. ]\n\nFixes: fce96cf044308 (\"virt: Add SEV-SNP guest driver\")\nReported-by: Peter Gonda <pgonda@google.com>\nSigned-off-by: Peter Gonda <pgonda@google.com>\nSigned-off-by: Borislav Petkov <bp@suse.de>\nReviewed-by: Tom Lendacky <thomas.lendacky@amd.com>\nCc: stable@kernel.org\nLink: https://lore.kernel.org/r/20221116175558.2373112-1-pgonda@google.com",
  "full_message": "virt/sev-guest: Prevent IV reuse in the SNP guest driver\n\nThe AMD Secure Processor (ASP) and an SNP guest use a series of\nAES-GCM keys called VMPCKs to communicate securely with each other.\nThe IV to this scheme is a sequence number that both the ASP and the\nguest track.\n\nCurrently, this sequence number in a guest request must exactly match\nthe sequence number tracked by the ASP. This means that if the guest\nsees an error from the host during a request it can only retry that\nexact request or disable the VMPCK to prevent an IV reuse. AES-GCM\ncannot tolerate IV reuse, see: \"Authentication Failures in NIST version\nof GCM\" - Antoine Joux et al.\n\nIn order to address this, make handle_guest_request() delete the VMPCK\non any non successful return. To allow userspace querying the cert_data\nlength make handle_guest_request() save the number of pages required by\nthe host, then have handle_guest_request() retry the request without\nrequesting the extended data, then return the number of pages required\nback to userspace.\n\n  [ bp: Massage, incorporate Tom's review comments. ]\n\nFixes: fce96cf044308 (\"virt: Add SEV-SNP guest driver\")\nReported-by: Peter Gonda <pgonda@google.com>\nSigned-off-by: Peter Gonda <pgonda@google.com>\nSigned-off-by: Borislav Petkov <bp@suse.de>\nReviewed-by: Tom Lendacky <thomas.lendacky@amd.com>\nCc: stable@kernel.org\nLink: https://lore.kernel.org/r/20221116175558.2373112-1-pgonda@google.com",
  "author_name": "Peter Gonda",
  "author_email": "pgonda@google.com",
  "author_date": "Wed Nov 16 09:55:58 2022 -0800",
  "author_date_iso": "2022-11-16T09:55:58-08:00",
  "committer_name": "Borislav Petkov",
  "committer_email": "bp@suse.de",
  "committer_date": "Mon Nov 21 11:03:40 2022 +0100",
  "committer_date_iso": "2022-11-21T11:03:40+01:00",
  "files_changed": [
    "drivers/virt/coco/sev-guest/sev-guest.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/virt/coco/sev-guest/sev-guest.c",
      "insertions": 70,
      "deletions": 14
    }
  ],
  "total_insertions": 70,
  "total_deletions": 14,
  "total_changes": 84,
  "parents": [
    "eb7081409f94a9a8608593d0fb63a1aa3d6f95d8"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "Authentication"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/virt/coco/sev-guest/sev-guest.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}