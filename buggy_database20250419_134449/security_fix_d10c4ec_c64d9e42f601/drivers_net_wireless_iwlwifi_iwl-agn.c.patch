commit d10c4ec8b4bc02f3874c7ef3c3539e4e7e123969
Author: Stefanik Gábor <netrolller.3d@gmail.com>
Date:   Wed Sep 3 11:26:59 2008 +0800

    iwlwifi: enable packet injection for iwlagn
    
    Handle station IDs of transmitted packets when in monitor mode, and
    remove the various anti-injection checks from the iwl4965 driver.
    This makes injection work on iwl4965 and iwl5000. Tested on both cards.
    
    Note: To inject management frames with encryption, HW crypto support
    must be disabled using the "swcrypto=1" modparam (or "swcrypto50=1"
    for iwl5000). Otherwise most management frames won't be transmitted.
    
    Signed-off-by: Gábor Stefanik <netrolller.3d@gmail.com>
    Signed-off-by: Zhu Yi <yi.zhu@intel.com>
    Signed-off-by: John W. Linville <linville@tuxdriver.com>

diff --git a/drivers/net/wireless/iwlwifi/iwl-agn.c b/drivers/net/wireless/iwlwifi/iwl-agn.c
index ab92e19f0b6c..5cce894dc1f9 100644
--- a/drivers/net/wireless/iwlwifi/iwl-agn.c
+++ b/drivers/net/wireless/iwlwifi/iwl-agn.c
@@ -2722,12 +2722,6 @@ static int iwl4965_mac_tx(struct ieee80211_hw *hw, struct sk_buff *skb)
 
 	IWL_DEBUG_MACDUMP("enter\n");
 
-	if (priv->iw_mode == IEEE80211_IF_TYPE_MNTR) {
-		IWL_DEBUG_MAC80211("leave - monitor\n");
-		dev_kfree_skb_any(skb);
-		return 0;
-	}
-
 	IWL_DEBUG_TX("dev->xmit(%d bytes) at rate 0x%02x\n", skb->len,
 		     ieee80211_get_tx_rate(hw, IEEE80211_SKB_CB(skb))->bitrate);