{
  "hash": "378c6520e7d29280f400ef2ceaf155c86f05a71a",
  "hash_short": "378c6520",
  "subject": "fs/coredump: prevent fsuid=0 dumps into user-controlled directories",
  "body": "This commit fixes the following security hole affecting systems where\nall of the following conditions are fulfilled:\n\n - The fs.suid_dumpable sysctl is set to 2.\n - The kernel.core_pattern sysctl's value starts with \"/\". (Systems\n   where kernel.core_pattern starts with \"|/\" are not affected.)\n - Unprivileged user namespace creation is permitted. (This is\n   true on Linux >=3.8, but some distributions disallow it by\n   default using a distro patch.)\n\nUnder these conditions, if a program executes under secure exec rules,\ncausing it to run with the SUID_DUMP_ROOT flag, then unshares its user\nnamespace, changes its root directory and crashes, the coredump will be\nwritten using fsuid=0 and a path derived from kernel.core_pattern - but\nthis path is interpreted relative to the root directory of the process,\nallowing the attacker to control where a coredump will be written with\nroot privileges.\n\nTo fix the security issue, always interpret core_pattern for dumps that\nare written under SUID_DUMP_ROOT relative to the root directory of init.\n\nSigned-off-by: Jann Horn <jann@thejh.net>\nAcked-by: Kees Cook <keescook@chromium.org>\nCc: Al Viro <viro@zeniv.linux.org.uk>\nCc: \"Eric W. Biederman\" <ebiederm@xmission.com>\nCc: Andy Lutomirski <luto@kernel.org>\nCc: Oleg Nesterov <oleg@redhat.com>\nCc: <stable@vger.kernel.org>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
  "full_message": "fs/coredump: prevent fsuid=0 dumps into user-controlled directories\n\nThis commit fixes the following security hole affecting systems where\nall of the following conditions are fulfilled:\n\n - The fs.suid_dumpable sysctl is set to 2.\n - The kernel.core_pattern sysctl's value starts with \"/\". (Systems\n   where kernel.core_pattern starts with \"|/\" are not affected.)\n - Unprivileged user namespace creation is permitted. (This is\n   true on Linux >=3.8, but some distributions disallow it by\n   default using a distro patch.)\n\nUnder these conditions, if a program executes under secure exec rules,\ncausing it to run with the SUID_DUMP_ROOT flag, then unshares its user\nnamespace, changes its root directory and crashes, the coredump will be\nwritten using fsuid=0 and a path derived from kernel.core_pattern - but\nthis path is interpreted relative to the root directory of the process,\nallowing the attacker to control where a coredump will be written with\nroot privileges.\n\nTo fix the security issue, always interpret core_pattern for dumps that\nare written under SUID_DUMP_ROOT relative to the root directory of init.\n\nSigned-off-by: Jann Horn <jann@thejh.net>\nAcked-by: Kees Cook <keescook@chromium.org>\nCc: Al Viro <viro@zeniv.linux.org.uk>\nCc: \"Eric W. Biederman\" <ebiederm@xmission.com>\nCc: Andy Lutomirski <luto@kernel.org>\nCc: Oleg Nesterov <oleg@redhat.com>\nCc: <stable@vger.kernel.org>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
  "author_name": "Jann Horn",
  "author_email": "jann@thejh.net",
  "author_date": "Tue Mar 22 14:25:36 2016 -0700",
  "author_date_iso": "2016-03-22T14:25:36-07:00",
  "committer_name": "Linus Torvalds",
  "committer_email": "torvalds@linux-foundation.org",
  "committer_date": "Tue Mar 22 15:36:02 2016 -0700",
  "committer_date_iso": "2016-03-22T15:36:02-07:00",
  "files_changed": [
    "arch/um/drivers/mconsole_kern.c",
    "fs/coredump.c",
    "fs/fhandle.c",
    "fs/open.c",
    "include/linux/fs.h",
    "kernel/sysctl_binary.c"
  ],
  "files_changed_count": 6,
  "stats": [
    {
      "file": "arch/um/drivers/mconsole_kern.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "fs/coredump.c",
      "insertions": 26,
      "deletions": 4
    },
    {
      "file": "fs/fhandle.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "fs/open.c",
      "insertions": 2,
      "deletions": 4
    },
    {
      "file": "include/linux/fs.h",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "kernel/sysctl_binary.c",
      "insertions": 1,
      "deletions": 1
    }
  ],
  "total_insertions": 32,
  "total_deletions": 12,
  "total_changes": 44,
  "parents": [
    "1333ab03150478df8d6f5673a91df1e50dc6ab97"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.10",
    "v4.10-rc1",
    "v4.10-rc2",
    "v4.10-rc3",
    "v4.10-rc4",
    "v4.10-rc5",
    "v4.10-rc6",
    "v4.10-rc7",
    "v4.10-rc8",
    "v4.11"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "security issue",
      "security hole"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "fs/coredump.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "fs/fhandle.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/linux/fs.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "fs/open.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/um/drivers/mconsole_kern.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "kernel/sysctl_binary.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}