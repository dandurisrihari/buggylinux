Commit Hash: 8135cf8b092723dbfcc611fe6fdcb3a36c9951c5
Subject: xen/pciback: Save xen_pci_op commands before processing it


Security Keywords:
- vulnerability

Full commit message:
xen/pciback: Save xen_pci_op commands before processing it

Double fetch vulnerabilities that happen when a variable is
fetched twice from shared memory but a security check is only
performed the first time.

The xen_pcibk_do_op function performs a switch statements on the op->cmd
value which is stored in shared memory. Interestingly this can result
in a double fetch vulnerability depending on the performed compiler
optimization.

This patch fixes it by saving the xen_pci_op command before
processing it. We also use 'barrier' to make sure that the
compiler does not perform any optimization.

This is part of XSA155.

CC: stable@vger.kernel.org
Reviewed-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
Signed-off-by: Jan Beulich <JBeulich@suse.com>
Signed-off-by: David Vrabel <david.vrabel@citrix.com>
Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>

Metadata:
Author: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
Author Date: Mon Nov 16 12:40:48 2015 -0500
Committer: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
Commit Date: Fri Dec 18 10:00:47 2015 -0500

Files Changed: 2
Lines Added: 15
Lines Removed: 1
Total Changes: 16
