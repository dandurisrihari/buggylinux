Commit Hash: 1befd944e05050d76950014f3dc04ed47faba2c3
Subject: nvmet-auth: don't try to cancel a non-initialized work_struct


Security Keywords:
- auth

Full commit message:
nvmet-auth: don't try to cancel a non-initialized work_struct

Currently blktests nvme/002 trips up debugobjects if CONFIG_NVME_AUTH is
enabled, but authentication is not on a queue.  This is because
nvmet_auth_sq_free cancels sq->auth_expired_work unconditionaly, while
auth_expired_work is only ever initialized if authentication is enabled
for a given controller.

Fix this by calling most of what is nvmet_init_auth unconditionally
when initializing the SQ, and just do the setting of the result
field in the connect command handler.

Fixes: db1312dd9548 ("nvmet: implement basic In-Band Authentication")
Signed-off-by: Christoph Hellwig <hch@lst.de>
Reviewed-by: Sagi Grimberg <sagi@grimberg.me>
Reviewed-by: Hannes Reinecke <hare@suse.de>

Metadata:
Author: Christoph Hellwig <hch@lst.de>
Author Date: Tue Sep 20 15:37:18 2022 +0200
Committer: Christoph Hellwig <hch@lst.de>
Commit Date: Tue Sep 27 09:22:09 2022 +0200

Files Changed: 4
Lines Added: 13
Lines Removed: 14
Total Changes: 27
