{
  "hash": "d67790ddf0219aa0ad3e13b53ae0a7619b3425a2",
  "hash_short": "d67790dd",
  "subject": "overflow: Add struct_size_t() helper",
  "body": "While struct_size() is normally used in situations where the structure\ntype already has a pointer instance, there are places where no variable\nis available. In the past, this has been worked around by using a typed\nNULL first argument, but this is a bit ugly. Add a helper to do this,\nand replace the handful of instances of the code pattern with it.\n\nInstances were found with this Coccinelle script:\n\n@struct_size_t@\nidentifier STRUCT, MEMBER;\nexpression COUNT;\n@@\n\n-       struct_size((struct STRUCT *)\\(0\\|NULL\\),\n+       struct_size_t(struct STRUCT,\n                MEMBER, COUNT)\n\nSuggested-by: Christoph Hellwig <hch@infradead.org>\nCc: Jesse Brandeburg <jesse.brandeburg@intel.com>\nCc: Tony Nguyen <anthony.l.nguyen@intel.com>\nCc: \"David S. Miller\" <davem@davemloft.net>\nCc: Eric Dumazet <edumazet@google.com>\nCc: Paolo Abeni <pabeni@redhat.com>\nCc: James Smart <james.smart@broadcom.com>\nCc: Keith Busch <kbusch@kernel.org>\nCc: Jens Axboe <axboe@kernel.dk>\nCc: Sagi Grimberg <sagi@grimberg.me>\nCc: HighPoint Linux Team <linux@highpoint-tech.com>\nCc: \"James E.J. Bottomley\" <jejb@linux.ibm.com>\nCc: \"Martin K. Petersen\" <martin.petersen@oracle.com>\nCc: Kashyap Desai <kashyap.desai@broadcom.com>\nCc: Sumit Saxena <sumit.saxena@broadcom.com>\nCc: Shivasharan S <shivasharan.srikanteshwara@broadcom.com>\nCc: Don Brace <don.brace@microchip.com>\nCc: \"Darrick J. Wong\" <djwong@kernel.org>\nCc: Dave Chinner <dchinner@redhat.com>\nCc: Guo Xuenan <guoxuenan@huawei.com>\nCc: Gwan-gyeong Mun <gwan-gyeong.mun@intel.com>\nCc: Nick Desaulniers <ndesaulniers@google.com>\nCc: Daniel Latypov <dlatypov@google.com>\nCc: kernel test robot <lkp@intel.com>\nCc: intel-wired-lan@lists.osuosl.org\nCc: netdev@vger.kernel.org\nCc: linux-nvme@lists.infradead.org\nCc: linux-scsi@vger.kernel.org\nCc: megaraidlinux.pdl@broadcom.com\nCc: storagedev@microchip.com\nCc: linux-xfs@vger.kernel.org\nCc: linux-hardening@vger.kernel.org\nSigned-off-by: Kees Cook <keescook@chromium.org>\nAcked-by: Martin K. Petersen <martin.petersen@oracle.com>\nReviewed-by: Darrick J. Wong <djwong@kernel.org>\nReviewed-by: Gustavo A. R. Silva <gustavoars@kernel.org>\nReviewed-by: Christoph Hellwig <hch@lst.de>\nAcked-by: Jakub Kicinski <kuba@kernel.org>\nReviewed-by: Alexander Lobakin <aleksander.lobakin@intel.com>\nLink: https://lore.kernel.org/r/20230522211810.never.421-kees@kernel.org",
  "full_message": "overflow: Add struct_size_t() helper\n\nWhile struct_size() is normally used in situations where the structure\ntype already has a pointer instance, there are places where no variable\nis available. In the past, this has been worked around by using a typed\nNULL first argument, but this is a bit ugly. Add a helper to do this,\nand replace the handful of instances of the code pattern with it.\n\nInstances were found with this Coccinelle script:\n\n@struct_size_t@\nidentifier STRUCT, MEMBER;\nexpression COUNT;\n@@\n\n-       struct_size((struct STRUCT *)\\(0\\|NULL\\),\n+       struct_size_t(struct STRUCT,\n                MEMBER, COUNT)\n\nSuggested-by: Christoph Hellwig <hch@infradead.org>\nCc: Jesse Brandeburg <jesse.brandeburg@intel.com>\nCc: Tony Nguyen <anthony.l.nguyen@intel.com>\nCc: \"David S. Miller\" <davem@davemloft.net>\nCc: Eric Dumazet <edumazet@google.com>\nCc: Paolo Abeni <pabeni@redhat.com>\nCc: James Smart <james.smart@broadcom.com>\nCc: Keith Busch <kbusch@kernel.org>\nCc: Jens Axboe <axboe@kernel.dk>\nCc: Sagi Grimberg <sagi@grimberg.me>\nCc: HighPoint Linux Team <linux@highpoint-tech.com>\nCc: \"James E.J. Bottomley\" <jejb@linux.ibm.com>\nCc: \"Martin K. Petersen\" <martin.petersen@oracle.com>\nCc: Kashyap Desai <kashyap.desai@broadcom.com>\nCc: Sumit Saxena <sumit.saxena@broadcom.com>\nCc: Shivasharan S <shivasharan.srikanteshwara@broadcom.com>\nCc: Don Brace <don.brace@microchip.com>\nCc: \"Darrick J. Wong\" <djwong@kernel.org>\nCc: Dave Chinner <dchinner@redhat.com>\nCc: Guo Xuenan <guoxuenan@huawei.com>\nCc: Gwan-gyeong Mun <gwan-gyeong.mun@intel.com>\nCc: Nick Desaulniers <ndesaulniers@google.com>\nCc: Daniel Latypov <dlatypov@google.com>\nCc: kernel test robot <lkp@intel.com>\nCc: intel-wired-lan@lists.osuosl.org\nCc: netdev@vger.kernel.org\nCc: linux-nvme@lists.infradead.org\nCc: linux-scsi@vger.kernel.org\nCc: megaraidlinux.pdl@broadcom.com\nCc: storagedev@microchip.com\nCc: linux-xfs@vger.kernel.org\nCc: linux-hardening@vger.kernel.org\nSigned-off-by: Kees Cook <keescook@chromium.org>\nAcked-by: Martin K. Petersen <martin.petersen@oracle.com>\nReviewed-by: Darrick J. Wong <djwong@kernel.org>\nReviewed-by: Gustavo A. R. Silva <gustavoars@kernel.org>\nReviewed-by: Christoph Hellwig <hch@lst.de>\nAcked-by: Jakub Kicinski <kuba@kernel.org>\nReviewed-by: Alexander Lobakin <aleksander.lobakin@intel.com>\nLink: https://lore.kernel.org/r/20230522211810.never.421-kees@kernel.org",
  "author_name": "Kees Cook",
  "author_email": "keescook@chromium.org",
  "author_date": "Mon May 22 14:18:13 2023 -0700",
  "author_date_iso": "2023-05-22T14:18:13-07:00",
  "committer_name": "Kees Cook",
  "committer_email": "keescook@chromium.org",
  "committer_date": "Fri May 26 13:52:19 2023 -0700",
  "committer_date_iso": "2023-05-26T13:52:19-07:00",
  "files_changed": [
    "drivers/net/ethernet/intel/ice/ice_ddp.h",
    "drivers/nvme/host/fc.c",
    "drivers/scsi/hptiop.c",
    "drivers/scsi/megaraid/megaraid_sas_base.c",
    "drivers/scsi/megaraid/megaraid_sas_fp.c",
    "drivers/scsi/smartpqi/smartpqi_init.c",
    "fs/xfs/libxfs/xfs_btree.h",
    "fs/xfs/scrub/btree.h",
    "include/linux/overflow.h",
    "lib/overflow_kunit.c"
  ],
  "files_changed_count": 10,
  "stats": [
    {
      "file": "drivers/net/ethernet/intel/ice/ice_ddp.h",
      "insertions": 4,
      "deletions": 5
    },
    {
      "file": "drivers/nvme/host/fc.c",
      "insertions": 4,
      "deletions": 4
    },
    {
      "file": "drivers/scsi/hptiop.c",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "drivers/scsi/megaraid/megaraid_sas_base.c",
      "insertions": 6,
      "deletions": 6
    },
    {
      "file": "drivers/scsi/megaraid/megaraid_sas_fp.c",
      "insertions": 3,
      "deletions": 3
    },
    {
      "file": "drivers/scsi/smartpqi/smartpqi_init.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "fs/xfs/libxfs/xfs_btree.h",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "fs/xfs/scrub/btree.h",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "include/linux/overflow.h",
      "insertions": 17,
      "deletions": 1
    },
    {
      "file": "lib/overflow_kunit.c",
      "insertions": 1,
      "deletions": 1
    }
  ],
  "total_insertions": 40,
  "total_deletions": 25,
  "total_changes": 65,
  "parents": [
    "7f09a3a09fb7e8a809a2eeef2b6b0c3e4f54cd52"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "hardening"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/net/ethernet/intel/ice/ice_ddp.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/scsi/hptiop.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/scsi/megaraid/megaraid_sas_fp.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "fs/xfs/libxfs/xfs_btree.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "fs/xfs/scrub/btree.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/nvme/host/fc.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/scsi/smartpqi/smartpqi_init.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/linux/overflow.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/scsi/megaraid/megaraid_sas_base.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "lib/overflow_kunit.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}