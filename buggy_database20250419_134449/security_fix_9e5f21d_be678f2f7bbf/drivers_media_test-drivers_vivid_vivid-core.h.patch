commit 9e5f21d656cbf0407189114f0d418b095271a36e
Author: Hans Verkuil <hverkuil@xs4all.nl>
Date:   Tue Dec 1 13:44:40 2020 +0100

    media: vivid: fix 'disconnect' error injection
    
    The 'disconnect' error injection functionality suffered from bit rot.
    
    New device nodes were added without updating vivid_user_gen_s_ctrl(), so
    that function had to be updated for the new device nodes.
    
    Also, vivid didn't check if specific device nodes were actually ever
    created, so the vivid_is_last_user() would fail on that (it would return
    true instead of false in that case).
    
    Finally, selecting Disconnect, then unbind the vivid driver would fail
    since the remove() would think that the device nodes were already
    unregistered. Keep track of whether disconnect was pressed and re-register
    the device nodes in remove() before doing the real unregister.
    
    [hverkuil: unsigned uses -> unsigned int uses]
    
    Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
    Signed-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>

diff --git a/drivers/media/test-drivers/vivid/vivid-core.h b/drivers/media/test-drivers/vivid/vivid-core.h
index 99e69b8f770f..9c2d1470b597 100644
--- a/drivers/media/test-drivers/vivid/vivid-core.h
+++ b/drivers/media/test-drivers/vivid/vivid-core.h
@@ -303,6 +303,7 @@ struct vivid_dev {
 	struct fb_fix_screeninfo	fb_fix;
 
 	/* Error injection */
+	bool				disconnect_error;
 	bool				queue_setup_error;
 	bool				buf_prepare_error;
 	bool				start_streaming_error;