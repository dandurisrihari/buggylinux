Commit Hash: 9e5f21d656cbf0407189114f0d418b095271a36e
Subject: media: vivid: fix 'disconnect' error injection


Security Keywords:
- injection

Full commit message:
media: vivid: fix 'disconnect' error injection

The 'disconnect' error injection functionality suffered from bit rot.

New device nodes were added without updating vivid_user_gen_s_ctrl(), so
that function had to be updated for the new device nodes.

Also, vivid didn't check if specific device nodes were actually ever
created, so the vivid_is_last_user() would fail on that (it would return
true instead of false in that case).

Finally, selecting Disconnect, then unbind the vivid driver would fail
since the remove() would think that the device nodes were already
unregistered. Keep track of whether disconnect was pressed and re-register
the device nodes in remove() before doing the real unregister.

[hverkuil: unsigned uses -> unsigned int uses]

Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Signed-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>

Metadata:
Author: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Author Date: Tue Dec 1 13:44:40 2020 +0100
Committer: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>
Commit Date: Mon Dec 7 15:07:51 2020 +0100

Files Changed: 3
Lines Added: 66
Lines Removed: 30
Total Changes: 96
