{
  "hash": "9e5f21d656cbf0407189114f0d418b095271a36e",
  "hash_short": "9e5f21d6",
  "subject": "media: vivid: fix 'disconnect' error injection",
  "body": "The 'disconnect' error injection functionality suffered from bit rot.\n\nNew device nodes were added without updating vivid_user_gen_s_ctrl(), so\nthat function had to be updated for the new device nodes.\n\nAlso, vivid didn't check if specific device nodes were actually ever\ncreated, so the vivid_is_last_user() would fail on that (it would return\ntrue instead of false in that case).\n\nFinally, selecting Disconnect, then unbind the vivid driver would fail\nsince the remove() would think that the device nodes were already\nunregistered. Keep track of whether disconnect was pressed and re-register\nthe device nodes in remove() before doing the real unregister.\n\n[hverkuil: unsigned uses -> unsigned int uses]\n\nSigned-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>\nSigned-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>",
  "full_message": "media: vivid: fix 'disconnect' error injection\n\nThe 'disconnect' error injection functionality suffered from bit rot.\n\nNew device nodes were added without updating vivid_user_gen_s_ctrl(), so\nthat function had to be updated for the new device nodes.\n\nAlso, vivid didn't check if specific device nodes were actually ever\ncreated, so the vivid_is_last_user() would fail on that (it would return\ntrue instead of false in that case).\n\nFinally, selecting Disconnect, then unbind the vivid driver would fail\nsince the remove() would think that the device nodes were already\nunregistered. Keep track of whether disconnect was pressed and re-register\nthe device nodes in remove() before doing the real unregister.\n\n[hverkuil: unsigned uses -> unsigned int uses]\n\nSigned-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>\nSigned-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>",
  "author_name": "Hans Verkuil",
  "author_email": "hverkuil-cisco@xs4all.nl",
  "author_date": "Tue Dec 1 13:44:40 2020 +0100",
  "author_date_iso": "2020-12-01T13:44:40+01:00",
  "committer_name": "Mauro Carvalho Chehab",
  "committer_email": "mchehab+huawei@kernel.org",
  "committer_date": "Mon Dec 7 15:07:51 2020 +0100",
  "committer_date_iso": "2020-12-07T15:07:51+01:00",
  "files_changed": [
    "drivers/media/test-drivers/vivid/vivid-core.c",
    "drivers/media/test-drivers/vivid/vivid-core.h",
    "drivers/media/test-drivers/vivid/vivid-ctrls.c"
  ],
  "files_changed_count": 3,
  "stats": [
    {
      "file": "drivers/media/test-drivers/vivid/vivid-core.c",
      "insertions": 44,
      "deletions": 22
    },
    {
      "file": "drivers/media/test-drivers/vivid/vivid-core.h",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "drivers/media/test-drivers/vivid/vivid-ctrls.c",
      "insertions": 21,
      "deletions": 8
    }
  ],
  "total_insertions": 66,
  "total_deletions": 30,
  "total_changes": 96,
  "parents": [
    "fb25ca37317200fa97ea6b8952e07958f06da7a6"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/media/test-drivers/vivid/vivid-core.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/media/test-drivers/vivid/vivid-core.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/media/test-drivers/vivid/vivid-ctrls.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}