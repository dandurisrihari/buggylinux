{
  "hash": "db4efbbeb457b6f9f4d8c4b090d1170d12f026e1",
  "hash_short": "db4efbbe",
  "subject": "brcmfmac: obtain platform data upon module initialization",
  "body": "The driver uses platform_driver_probe() to obtain platform data\nif any. However, that function is placed in the .init section so\nit must be called upon driver module initialization.\n\nThe problem was reported by Fenguang Wu resulting in a kernel\noops because the .init section was already freed.\n\n[   48.966342] Switched to clocksource tsc\n[   48.970002] kernel tried to execute NX-protected page - exploit attempt? (uid: 0)\n[   48.970851] BUG: unable to handle kernel paging request at ffffffff82196446\n[   48.970957] IP: [<ffffffff82196446>] classes_init+0x26/0x26\n[   48.970957] PGD 1e76067 PUD 1e77063 PMD f388063 PTE 8000000002196163\n[   48.970957] Oops: 0011 [#1]\n[   48.970957] CPU: 0 PID: 17 Comm: kworker/0:1 Not tainted 3.11.0-rc7-00444-gc52dd7f #23\n[   48.970957] Workqueue: events brcmf_driver_init\n[   48.970957] task: ffff8800001d2000 ti: ffff8800001d4000 task.ti: ffff8800001d4000\n[   48.970957] RIP: 0010:[<ffffffff82196446>]  [<ffffffff82196446>] classes_init+0x26/0x26\n[   48.970957] RSP: 0000:ffff8800001d5d40  EFLAGS: 00000286\n[   48.970957] RAX: 0000000000000001 RBX: ffffffff820c5620 RCX: 0000000000000000\n[   48.970957] RDX: 0000000000000001 RSI: ffffffff816f7380 RDI: ffffffff820c56c0\n[   48.970957] RBP: ffff8800001d5d50 R08: ffff8800001d2508 R09: 0000000000000002\n[   48.970957] R10: 0000000000000000 R11: 0001f7ce298c5620 R12: ffff8800001c76b0\n[   48.970957] R13: ffffffff81e91d40 R14: 0000000000000000 R15: ffff88000e0ce300\n[   48.970957] FS:  0000000000000000(0000) GS:ffffffff81e84000(0000) knlGS:0000000000000000\n[   48.970957] CS:  0010 DS: 0000 ES: 0000 CR0: 000000008005003b\n[   48.970957] CR2: ffffffff82196446 CR3: 0000000001e75000 CR4: 00000000000006b0\n[   48.970957] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\n[   48.970957] DR3: 0000000000000000 DR6: 0000000000000000 DR7: 0000000000000000\n[   48.970957] Stack:\n[   48.970957]  ffffffff816f7df8 ffffffff820c5620 ffff8800001d5d60 ffffffff816eeec9\n[   48.970957]  ffff8800001d5de0 ffffffff81073dc5 ffffffff81073d68 ffff8800001d5db8\n[   48.970957]  0000000000000086 ffffffff820c5620 ffffffff824f7fd0 0000000000000000\n[   48.970957] Call Trace:\n[   48.970957]  [<ffffffff816f7df8>] ? brcmf_sdio_init+0x18/0x70\n[   48.970957]  [<ffffffff816eeec9>] brcmf_driver_init+0x9/0x10\n[   48.970957]  [<ffffffff81073dc5>] process_one_work+0x1d5/0x480\n[   48.970957]  [<ffffffff81073d68>] ? process_one_work+0x178/0x480\n[   48.970957]  [<ffffffff81074188>] worker_thread+0x118/0x3a0\n[   48.970957]  [<ffffffff81074070>] ? process_one_work+0x480/0x480\n[   48.970957]  [<ffffffff8107aa17>] kthread+0xe7/0xf0\n[   48.970957]  [<ffffffff810829f7>] ? finish_task_switch.constprop.57+0x37/0xd0\n[   48.970957]  [<ffffffff8107a930>] ? __kthread_parkme+0x80/0x80\n[   48.970957]  [<ffffffff81a6923a>] ret_from_fork+0x7a/0xb0\n[   48.970957]  [<ffffffff8107a930>] ? __kthread_parkme+0x80/0x80\n[   48.970957] Code: cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc\ncc cc cc cc cc cc <cc> cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc\n[   48.970957] RIP  [<ffffffff82196446>] classes_init+0x26/0x26\n[   48.970957]  RSP <ffff8800001d5d40>\n[   48.970957] CR2: ffffffff82196446\n[   48.970957] ---[ end trace 62980817cd525f14 ]---\n\nCc: <stable@vger.kernel.org> # 3.10.x, 3.11.x\nReported-by: Fengguang Wu <fengguang.wu@intel.com>\nReviewed-by: Hante Meuleman <meuleman@broadcom.com>\nReviewed-by: Pieter-Paul Giesberts <pieterpg@broadcom.com>\nTested-by: Fengguang Wu <fengguang.wu@intel.com>\nSigned-off-by: Arend van Spriel <arend@broadcom.com>\nSigned-off-by: John W. Linville <linville@tuxdriver.com>",
  "full_message": "brcmfmac: obtain platform data upon module initialization\n\nThe driver uses platform_driver_probe() to obtain platform data\nif any. However, that function is placed in the .init section so\nit must be called upon driver module initialization.\n\nThe problem was reported by Fenguang Wu resulting in a kernel\noops because the .init section was already freed.\n\n[   48.966342] Switched to clocksource tsc\n[   48.970002] kernel tried to execute NX-protected page - exploit attempt? (uid: 0)\n[   48.970851] BUG: unable to handle kernel paging request at ffffffff82196446\n[   48.970957] IP: [<ffffffff82196446>] classes_init+0x26/0x26\n[   48.970957] PGD 1e76067 PUD 1e77063 PMD f388063 PTE 8000000002196163\n[   48.970957] Oops: 0011 [#1]\n[   48.970957] CPU: 0 PID: 17 Comm: kworker/0:1 Not tainted 3.11.0-rc7-00444-gc52dd7f #23\n[   48.970957] Workqueue: events brcmf_driver_init\n[   48.970957] task: ffff8800001d2000 ti: ffff8800001d4000 task.ti: ffff8800001d4000\n[   48.970957] RIP: 0010:[<ffffffff82196446>]  [<ffffffff82196446>] classes_init+0x26/0x26\n[   48.970957] RSP: 0000:ffff8800001d5d40  EFLAGS: 00000286\n[   48.970957] RAX: 0000000000000001 RBX: ffffffff820c5620 RCX: 0000000000000000\n[   48.970957] RDX: 0000000000000001 RSI: ffffffff816f7380 RDI: ffffffff820c56c0\n[   48.970957] RBP: ffff8800001d5d50 R08: ffff8800001d2508 R09: 0000000000000002\n[   48.970957] R10: 0000000000000000 R11: 0001f7ce298c5620 R12: ffff8800001c76b0\n[   48.970957] R13: ffffffff81e91d40 R14: 0000000000000000 R15: ffff88000e0ce300\n[   48.970957] FS:  0000000000000000(0000) GS:ffffffff81e84000(0000) knlGS:0000000000000000\n[   48.970957] CS:  0010 DS: 0000 ES: 0000 CR0: 000000008005003b\n[   48.970957] CR2: ffffffff82196446 CR3: 0000000001e75000 CR4: 00000000000006b0\n[   48.970957] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\n[   48.970957] DR3: 0000000000000000 DR6: 0000000000000000 DR7: 0000000000000000\n[   48.970957] Stack:\n[   48.970957]  ffffffff816f7df8 ffffffff820c5620 ffff8800001d5d60 ffffffff816eeec9\n[   48.970957]  ffff8800001d5de0 ffffffff81073dc5 ffffffff81073d68 ffff8800001d5db8\n[   48.970957]  0000000000000086 ffffffff820c5620 ffffffff824f7fd0 0000000000000000\n[   48.970957] Call Trace:\n[   48.970957]  [<ffffffff816f7df8>] ? brcmf_sdio_init+0x18/0x70\n[   48.970957]  [<ffffffff816eeec9>] brcmf_driver_init+0x9/0x10\n[   48.970957]  [<ffffffff81073dc5>] process_one_work+0x1d5/0x480\n[   48.970957]  [<ffffffff81073d68>] ? process_one_work+0x178/0x480\n[   48.970957]  [<ffffffff81074188>] worker_thread+0x118/0x3a0\n[   48.970957]  [<ffffffff81074070>] ? process_one_work+0x480/0x480\n[   48.970957]  [<ffffffff8107aa17>] kthread+0xe7/0xf0\n[   48.970957]  [<ffffffff810829f7>] ? finish_task_switch.constprop.57+0x37/0xd0\n[   48.970957]  [<ffffffff8107a930>] ? __kthread_parkme+0x80/0x80\n[   48.970957]  [<ffffffff81a6923a>] ret_from_fork+0x7a/0xb0\n[   48.970957]  [<ffffffff8107a930>] ? __kthread_parkme+0x80/0x80\n[   48.970957] Code: cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc\ncc cc cc cc cc cc <cc> cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc cc\n[   48.970957] RIP  [<ffffffff82196446>] classes_init+0x26/0x26\n[   48.970957]  RSP <ffff8800001d5d40>\n[   48.970957] CR2: ffffffff82196446\n[   48.970957] ---[ end trace 62980817cd525f14 ]---\n\nCc: <stable@vger.kernel.org> # 3.10.x, 3.11.x\nReported-by: Fengguang Wu <fengguang.wu@intel.com>\nReviewed-by: Hante Meuleman <meuleman@broadcom.com>\nReviewed-by: Pieter-Paul Giesberts <pieterpg@broadcom.com>\nTested-by: Fengguang Wu <fengguang.wu@intel.com>\nSigned-off-by: Arend van Spriel <arend@broadcom.com>\nSigned-off-by: John W. Linville <linville@tuxdriver.com>",
  "author_name": "Arend van Spriel",
  "author_email": "arend@broadcom.com",
  "author_date": "Wed Sep 25 12:11:01 2013 +0200",
  "author_date_iso": "2013-09-25T12:11:01+02:00",
  "committer_name": "John W. Linville",
  "committer_email": "linville@tuxdriver.com",
  "committer_date": "Thu Sep 26 14:02:33 2013 -0400",
  "committer_date_iso": "2013-09-26T14:02:33-04:00",
  "files_changed": [
    "drivers/net/wireless/brcm80211/brcmfmac/bcmsdh_sdmmc.c",
    "drivers/net/wireless/brcm80211/brcmfmac/dhd_bus.h",
    "drivers/net/wireless/brcm80211/brcmfmac/dhd_linux.c",
    "drivers/net/wireless/brcm80211/brcmfmac/usb.c"
  ],
  "files_changed_count": 4,
  "stats": [
    {
      "file": "drivers/net/wireless/brcm80211/brcmfmac/bcmsdh_sdmmc.c",
      "insertions": 13,
      "deletions": 15
    },
    {
      "file": "drivers/net/wireless/brcm80211/brcmfmac/dhd_bus.h",
      "insertions": 2,
      "deletions": 1
    },
    {
      "file": "drivers/net/wireless/brcm80211/brcmfmac/dhd_linux.c",
      "insertions": 8,
      "deletions": 6
    },
    {
      "file": "drivers/net/wireless/brcm80211/brcmfmac/usb.c",
      "insertions": 1,
      "deletions": 1
    }
  ],
  "total_insertions": 24,
  "total_deletions": 23,
  "total_changes": 47,
  "parents": [
    "346ece0b7ba2730b4d633b9e371fe55488803102"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v3.12",
    "v3.12-rc4",
    "v3.12-rc5",
    "v3.12-rc6",
    "v3.12-rc7",
    "v3.13",
    "v3.13-rc1",
    "v3.13-rc2",
    "v3.13-rc3",
    "v3.13-rc4"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "exploit"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/net/wireless/brcm80211/brcmfmac/bcmsdh_sdmmc.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/wireless/brcm80211/brcmfmac/dhd_bus.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/wireless/brcm80211/brcmfmac/dhd_linux.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/wireless/brcm80211/brcmfmac/usb.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}