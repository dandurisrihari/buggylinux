{
  "hash": "4b848f20eda5974020f043ca14bacf7a7e634fc8",
  "hash_short": "4b848f20",
  "subject": "drm/vgem: Close use-after-free race in vgem_gem_create",
  "body": "There's two references floating around here (for the object reference,\nnot the handle_count reference, that's a different thing):\n\n- The temporary reference held by vgem_gem_create, acquired by\n  creating the object and released by calling\n  drm_gem_object_put_unlocked.\n\n- The reference held by the object handle, created by\n  drm_gem_handle_create. This one generally outlives the function,\n  except if a 2nd thread races with a GEM_CLOSE ioctl call.\n\nSo usually everything is correct, except in that race case, where the\naccess to gem_object->size could be looking at freed data already.\nWhich again isn't a real problem (userspace shot its feet off already\nwith the race, we could return garbage), but maybe someone can exploit\nthis as an information leak.\n\nCc: Dan Carpenter <dan.carpenter@oracle.com>\nCc: Hillf Danton <hdanton@sina.com>\nReported-by: syzbot+0dc4444774d419e916c8@syzkaller.appspotmail.com\nCc: stable@vger.kernel.org\nCc: Emil Velikov <emil.velikov@collabora.com>\nCc: Daniel Vetter <daniel.vetter@ffwll.ch>\nCc: Sean Paul <seanpaul@chromium.org>\nCc: Chris Wilson <chris@chris-wilson.co.uk>\nCc: Eric Anholt <eric@anholt.net>\nCc: Sam Ravnborg <sam@ravnborg.org>\nCc: Rob Clark <robdclark@chromium.org>\nReviewed-by: Chris Wilson <chris@chris-wilson.co.uk>\nSigned-off-by: Daniel Vetter <daniel.vetter@intel.com>\nLink: https://patchwork.freedesktop.org/patch/msgid/20200202132133.1891846-1-daniel.vetter@ffwll.ch",
  "full_message": "drm/vgem: Close use-after-free race in vgem_gem_create\n\nThere's two references floating around here (for the object reference,\nnot the handle_count reference, that's a different thing):\n\n- The temporary reference held by vgem_gem_create, acquired by\n  creating the object and released by calling\n  drm_gem_object_put_unlocked.\n\n- The reference held by the object handle, created by\n  drm_gem_handle_create. This one generally outlives the function,\n  except if a 2nd thread races with a GEM_CLOSE ioctl call.\n\nSo usually everything is correct, except in that race case, where the\naccess to gem_object->size could be looking at freed data already.\nWhich again isn't a real problem (userspace shot its feet off already\nwith the race, we could return garbage), but maybe someone can exploit\nthis as an information leak.\n\nCc: Dan Carpenter <dan.carpenter@oracle.com>\nCc: Hillf Danton <hdanton@sina.com>\nReported-by: syzbot+0dc4444774d419e916c8@syzkaller.appspotmail.com\nCc: stable@vger.kernel.org\nCc: Emil Velikov <emil.velikov@collabora.com>\nCc: Daniel Vetter <daniel.vetter@ffwll.ch>\nCc: Sean Paul <seanpaul@chromium.org>\nCc: Chris Wilson <chris@chris-wilson.co.uk>\nCc: Eric Anholt <eric@anholt.net>\nCc: Sam Ravnborg <sam@ravnborg.org>\nCc: Rob Clark <robdclark@chromium.org>\nReviewed-by: Chris Wilson <chris@chris-wilson.co.uk>\nSigned-off-by: Daniel Vetter <daniel.vetter@intel.com>\nLink: https://patchwork.freedesktop.org/patch/msgid/20200202132133.1891846-1-daniel.vetter@ffwll.ch",
  "author_name": "Daniel Vetter",
  "author_email": "daniel.vetter@ffwll.ch",
  "author_date": "Sun Feb 2 14:21:33 2020 +0100",
  "author_date_iso": "2020-02-02T14:21:33+01:00",
  "committer_name": "Daniel Vetter",
  "committer_email": "daniel.vetter@ffwll.ch",
  "committer_date": "Thu Feb 6 19:04:41 2020 +0100",
  "committer_date_iso": "2020-02-06T19:04:41+01:00",
  "files_changed": [
    "drivers/gpu/drm/vgem/vgem_drv.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/gpu/drm/vgem/vgem_drv.c",
      "insertions": 6,
      "deletions": 3
    }
  ],
  "total_insertions": 6,
  "total_deletions": 3,
  "total_changes": 9,
  "parents": [
    "db735fc4036bbe1fbe606819b5f0ff26cc76cdff"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v5.6",
    "v5.6-rc2",
    "v5.6-rc3",
    "v5.6-rc4",
    "v5.6-rc5",
    "v5.6-rc6",
    "v5.6-rc7",
    "v5.7-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "exploit"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/gpu/drm/vgem/vgem_drv.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}