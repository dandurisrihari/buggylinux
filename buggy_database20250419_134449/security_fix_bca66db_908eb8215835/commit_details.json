{
  "hash": "bca66dbcd28a41c669921ff7ca066f71e6f3e72e",
  "hash_short": "bca66dbc",
  "subject": "KVM: x86: Check for pending interrupts when APICv is getting disabled",
  "body": "When APICv is active, interrupt injection doesn't raise KVM_REQ_EVENT\nrequest (see __apic_accept_irq()) as the required work is done by hardware.\nIn case KVM_REQ_APICV_UPDATE collides with such injection, the interrupt\nmay never get delivered.\n\nCurrently, the described situation is hardly possible: all\nkvm_request_apicv_update() calls normally happen upon VM creation when\nno interrupts are pending. We are, however, going to move unconditional\nkvm_request_apicv_update() call from kvm_hv_activate_synic() to\nsynic_update_vector() and without this fix 'hyperv_connections' test from\nkvm-unit-tests gets stuck on IPI delivery attempt right after configuring\na SynIC route which triggers APICv disablement.\n\nSigned-off-by: Vitaly Kuznetsov <vkuznets@redhat.com>\nMessage-Id: <20210609150911.1471882-4-vkuznets@redhat.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "full_message": "KVM: x86: Check for pending interrupts when APICv is getting disabled\n\nWhen APICv is active, interrupt injection doesn't raise KVM_REQ_EVENT\nrequest (see __apic_accept_irq()) as the required work is done by hardware.\nIn case KVM_REQ_APICV_UPDATE collides with such injection, the interrupt\nmay never get delivered.\n\nCurrently, the described situation is hardly possible: all\nkvm_request_apicv_update() calls normally happen upon VM creation when\nno interrupts are pending. We are, however, going to move unconditional\nkvm_request_apicv_update() call from kvm_hv_activate_synic() to\nsynic_update_vector() and without this fix 'hyperv_connections' test from\nkvm-unit-tests gets stuck on IPI delivery attempt right after configuring\na SynIC route which triggers APICv disablement.\n\nSigned-off-by: Vitaly Kuznetsov <vkuznets@redhat.com>\nMessage-Id: <20210609150911.1471882-4-vkuznets@redhat.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "author_name": "Vitaly Kuznetsov",
  "author_email": "vkuznets@redhat.com",
  "author_date": "Wed Jun 9 17:09:10 2021 +0200",
  "author_date_iso": "2021-06-09T17:09:10+02:00",
  "committer_name": "Paolo Bonzini",
  "committer_email": "pbonzini@redhat.com",
  "committer_date": "Thu Jun 17 13:09:55 2021 -0400",
  "committer_date_iso": "2021-06-17T13:09:55-04:00",
  "files_changed": [
    "arch/x86/kvm/x86.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "arch/x86/kvm/x86.c",
      "insertions": 9,
      "deletions": 0
    }
  ],
  "total_insertions": 9,
  "total_deletions": 0,
  "total_changes": 9,
  "parents": [
    "c5ffd408cdc951ba153aea267d96d7cc62c6a97c"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/x86/kvm/x86.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}