commit c8349639324a79f60106126c8193bd2fcd574fe8
Author: Horatiu Vultur <horatiu.vultur@microchip.com>
Date:   Fri Apr 8 09:03:56 2022 +0200

    net: lan966x: Add FDMA functionality
    
    Ethernet frames can be extracted or injected to or from the device's
    DDR memory. There is one channel for injection and one channel for
    extraction. Each of these channels contain a linked list of DCBs which
    contains DB. The DCB contains only 1 DB for both the injection and
    extraction. Each DB contains a frame. Every time when a frame is received
    or transmitted an interrupt is generated.
    
    It is not possible to use both the FDMA and the manual
    injection/extraction of the frames. Therefore the FDMA has priority over
    the manual because of better performance values.
    
    FDMA:
    iperf -c 192.168.1.1
    [  5]   0.00-10.02  sec   420 MBytes   352 Mbits/sec    0 sender
    [  5]   0.00-10.03  sec   420 MBytes   351 Mbits/sec      receiver
    
    iperf -c 192.168.1.1 -R
    [  5]   0.00-10.01  sec   528 MBytes   442 Mbits/sec    0 sender
    [  5]   0.00-10.00  sec   524 MBytes   440 Mbits/sec      receiver
    
    Manual:
    iperf -c 192.168.1.1
    [  5]   0.00-10.02  sec  93.8 MBytes  78.5 Mbits/sec    0 sender
    [  5]   0.00-10.03  sec  93.8 MBytes  78.4 Mbits/sec      receiver
    
    ipers -c 192.168.1.1 -R
    [  5]   0.00-10.03  sec   121 MBytes   101 Mbits/sec    0 sender
    [  5]   0.00-10.01  sec   118 MBytes  99.0 Mbits/sec      receiver
    
    Signed-off-by: Horatiu Vultur <horatiu.vultur@microchip.com>
    Signed-off-by: Jakub Kicinski <kuba@kernel.org>

diff --git a/drivers/net/ethernet/microchip/lan966x/lan966x_port.c b/drivers/net/ethernet/microchip/lan966x/lan966x_port.c
index 237555845a52..f141644e4372 100644
--- a/drivers/net/ethernet/microchip/lan966x/lan966x_port.c
+++ b/drivers/net/ethernet/microchip/lan966x/lan966x_port.c
@@ -393,6 +393,9 @@ void lan966x_port_init(struct lan966x_port *port)
 
 	lan966x_port_config_down(port);
 
+	if (lan966x->fdma)
+		lan966x_fdma_netdev_init(lan966x, port->dev);
+
 	if (config->portmode != PHY_INTERFACE_MODE_QSGMII)
 		return;