{
  "hash": "2d369359f1e0fa13852404ff2f8063235a27d8a7",
  "hash_short": "2d369359",
  "subject": "Bluetooth: Send a configuration request after security confirmation",
  "body": "Sometimes an ACL link must be raised to a higher security level after\nan L2CAP connection is requested, but before a connection response is\nsent.  In this case, a connection response sent by L2CAP was not\nimmediately followed by a configuration request.  Other code paths do\nsend this configuration request right away.  It was possible for the\nconnection to stall while L2CAP waited for the remote device (like\nPTS) to trigger the configuration process.\n\nHere is an abbreviated hcidump of the failure case with PTS:\n\n1337806446.051982 > ACL data: handle 43 flags 0x02 dlen 10\n    L2CAP(s): Info req: type 2\n1337806446.052050 < ACL data: handle 43 flags 0x00 dlen 16\n    L2CAP(s): Info rsp: type 2 result 0\n      Extended feature mask 0x000000b8\n1337806446.595320 > ACL data: handle 43 flags 0x02 dlen 12\n    L2CAP(s): Connect req: psm 4097 scid 0x0041\n1337806446.595673 < ACL data: handle 43 flags 0x00 dlen 16\n    L2CAP(s): Connect rsp: dcid 0x0040 scid 0x0041 result 1 status 0\n1337806446.595679 < ACL data: handle 43 flags 0x00 dlen 10\n    L2CAP(s): Info req: type 2\n1337806446.669835 > ACL data: handle 43 flags 0x02 dlen 16\n    L2CAP(s): Info rsp: type 2 result 0\n      Extended feature mask 0x00000028\n1337806446.669899 < HCI Command: Authentication Requested (0x01|0x0011) plen 2\n1337806446.669906 < ACL data: handle 43 flags 0x00 dlen 16\n    L2CAP(s): Connect rsp: dcid 0x0040 scid 0x0041 result 1 status 1\n<security setup here>\n1337806446.769888 < ACL data: handle 43 flags 0x00 dlen 16\n    L2CAP(s): Connect rsp: dcid 0x0040 scid 0x0041 result 0 status 0\n\nAt this point, the connection stalls and no further messages are sent\non the L2CAP signaling channel.  No data is received either.\n\nIf we immediately send a configuration request after a successful connect\nresponse, the connection completes:\n\n1337724090.041162 > ACL data: handle 43 flags 0x02 dlen 10\n    L2CAP(s): Info req: type 2\n1337724090.041236 < ACL data: handle 43 flags 0x00 dlen 16\n    L2CAP(s): Info rsp: type 2 result 0\n      Extended feature mask 0x000000b8\n1337724090.597128 > ACL data: handle 43 flags 0x02 dlen 12\n    L2CAP(s): Connect req: psm 4097 scid 0x0041\n1337724090.597236 < ACL data: handle 43 flags 0x00 dlen 16\n    L2CAP(s): Connect rsp: dcid 0x0040 scid 0x0041 result 1 status 0\n1337724090.597244 < ACL data: handle 43 flags 0x00 dlen 10\n    L2CAP(s): Info req: type 2\n1337724090.660842 > ACL data: handle 43 flags 0x02 dlen 16\n    L2CAP(s): Info rsp: type 2 result 0\n      Extended feature mask 0x00000028\n1337724090.660926 < HCI Command: Authentication Requested (0x01|0x0011) plen 2\n1337724090.660934 < ACL data: handle 43 flags 0x00 dlen 16\n    L2CAP(s): Connect rsp: dcid 0x0040 scid 0x0041 result 1 status 1\n<security setup here>\n1337724090.755162 < ACL data: handle 43 flags 0x00 dlen 16\n    L2CAP(s): Connect rsp: dcid 0x0040 scid 0x0041 result 0 status 0\n1337724090.755171 < ACL data: handle 43 flags 0x00 dlen 23\n    L2CAP(s): Config req: dcid 0x0041 flags 0x00 clen 11\n1337724091.361847 > ACL data: handle 43 flags 0x02 dlen 29\n    L2CAP(s): Config rsp: scid 0x0040 flags 0x00 result 0 clen 15\n1337724091.863808 > ACL data: handle 43 flags 0x02 dlen 23\n    L2CAP(s): Config req: dcid 0x0040 flags 0x00 clen 11\n1337724091.863882 < ACL data: handle 43 flags 0x00 dlen 29\n    L2CAP(s): Config rsp: scid 0x0041 flags 0x00 result 0 clen 15\n1337724092.683745 > ACL data: handle 43 flags 0x02 dlen 12\n    L2CAP(d): cid 0x0040 len 8 [psm 4097]\n      0000: 00 00 11 22 33 44 34 2f                           ...\"3D4/\n\nSigned-off-by: Mat Martineau <mathewm@codeaurora.org>\nSigned-off-by: Marcel Holtmann <marcel@holtmann.org>",
  "full_message": "Bluetooth: Send a configuration request after security confirmation\n\nSometimes an ACL link must be raised to a higher security level after\nan L2CAP connection is requested, but before a connection response is\nsent.  In this case, a connection response sent by L2CAP was not\nimmediately followed by a configuration request.  Other code paths do\nsend this configuration request right away.  It was possible for the\nconnection to stall while L2CAP waited for the remote device (like\nPTS) to trigger the configuration process.\n\nHere is an abbreviated hcidump of the failure case with PTS:\n\n1337806446.051982 > ACL data: handle 43 flags 0x02 dlen 10\n    L2CAP(s): Info req: type 2\n1337806446.052050 < ACL data: handle 43 flags 0x00 dlen 16\n    L2CAP(s): Info rsp: type 2 result 0\n      Extended feature mask 0x000000b8\n1337806446.595320 > ACL data: handle 43 flags 0x02 dlen 12\n    L2CAP(s): Connect req: psm 4097 scid 0x0041\n1337806446.595673 < ACL data: handle 43 flags 0x00 dlen 16\n    L2CAP(s): Connect rsp: dcid 0x0040 scid 0x0041 result 1 status 0\n1337806446.595679 < ACL data: handle 43 flags 0x00 dlen 10\n    L2CAP(s): Info req: type 2\n1337806446.669835 > ACL data: handle 43 flags 0x02 dlen 16\n    L2CAP(s): Info rsp: type 2 result 0\n      Extended feature mask 0x00000028\n1337806446.669899 < HCI Command: Authentication Requested (0x01|0x0011) plen 2\n1337806446.669906 < ACL data: handle 43 flags 0x00 dlen 16\n    L2CAP(s): Connect rsp: dcid 0x0040 scid 0x0041 result 1 status 1\n<security setup here>\n1337806446.769888 < ACL data: handle 43 flags 0x00 dlen 16\n    L2CAP(s): Connect rsp: dcid 0x0040 scid 0x0041 result 0 status 0\n\nAt this point, the connection stalls and no further messages are sent\non the L2CAP signaling channel.  No data is received either.\n\nIf we immediately send a configuration request after a successful connect\nresponse, the connection completes:\n\n1337724090.041162 > ACL data: handle 43 flags 0x02 dlen 10\n    L2CAP(s): Info req: type 2\n1337724090.041236 < ACL data: handle 43 flags 0x00 dlen 16\n    L2CAP(s): Info rsp: type 2 result 0\n      Extended feature mask 0x000000b8\n1337724090.597128 > ACL data: handle 43 flags 0x02 dlen 12\n    L2CAP(s): Connect req: psm 4097 scid 0x0041\n1337724090.597236 < ACL data: handle 43 flags 0x00 dlen 16\n    L2CAP(s): Connect rsp: dcid 0x0040 scid 0x0041 result 1 status 0\n1337724090.597244 < ACL data: handle 43 flags 0x00 dlen 10\n    L2CAP(s): Info req: type 2\n1337724090.660842 > ACL data: handle 43 flags 0x02 dlen 16\n    L2CAP(s): Info rsp: type 2 result 0\n      Extended feature mask 0x00000028\n1337724090.660926 < HCI Command: Authentication Requested (0x01|0x0011) plen 2\n1337724090.660934 < ACL data: handle 43 flags 0x00 dlen 16\n    L2CAP(s): Connect rsp: dcid 0x0040 scid 0x0041 result 1 status 1\n<security setup here>\n1337724090.755162 < ACL data: handle 43 flags 0x00 dlen 16\n    L2CAP(s): Connect rsp: dcid 0x0040 scid 0x0041 result 0 status 0\n1337724090.755171 < ACL data: handle 43 flags 0x00 dlen 23\n    L2CAP(s): Config req: dcid 0x0041 flags 0x00 clen 11\n1337724091.361847 > ACL data: handle 43 flags 0x02 dlen 29\n    L2CAP(s): Config rsp: scid 0x0040 flags 0x00 result 0 clen 15\n1337724091.863808 > ACL data: handle 43 flags 0x02 dlen 23\n    L2CAP(s): Config req: dcid 0x0040 flags 0x00 clen 11\n1337724091.863882 < ACL data: handle 43 flags 0x00 dlen 29\n    L2CAP(s): Config rsp: scid 0x0041 flags 0x00 result 0 clen 15\n1337724092.683745 > ACL data: handle 43 flags 0x02 dlen 12\n    L2CAP(d): cid 0x0040 len 8 [psm 4097]\n      0000: 00 00 11 22 33 44 34 2f                           ...\"3D4/\n\nSigned-off-by: Mat Martineau <mathewm@codeaurora.org>\nSigned-off-by: Marcel Holtmann <marcel@holtmann.org>",
  "author_name": "Mat Martineau",
  "author_email": "mathewm@codeaurora.org",
  "author_date": "Wed May 23 14:59:30 2012 -0700",
  "author_date_iso": "2012-05-23T14:59:30-07:00",
  "committer_name": "Johan Hedberg",
  "committer_email": "johan.hedberg@intel.com",
  "committer_date": "Tue Jun 5 06:34:08 2012 +0300",
  "committer_date_iso": "2012-06-05T06:34:08+03:00",
  "files_changed": [
    "net/bluetooth/l2cap_core.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "net/bluetooth/l2cap_core.c",
      "insertions": 11,
      "deletions": 0
    }
  ],
  "total_insertions": 11,
  "total_deletions": 0,
  "total_changes": 11,
  "parents": [
    "59e54bd15d63f102c71c3ce695bca5ed90926e46"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v3.10",
    "v3.10-rc1",
    "v3.10-rc2",
    "v3.10-rc3",
    "v3.10-rc4",
    "v3.10-rc5",
    "v3.10-rc6",
    "v3.10-rc7",
    "v3.11",
    "v3.11-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "Authentication"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "net/bluetooth/l2cap_core.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}