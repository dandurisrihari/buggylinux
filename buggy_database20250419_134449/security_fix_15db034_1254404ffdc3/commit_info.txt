Commit Hash: 15db034733e4df3ca8ab4bf0a593a8a9b4860541
Subject: KVM: arm64: nv: Reinject PAC exceptions caused by HCR_EL2.API==0


Security Keywords:
- injection

Full commit message:
KVM: arm64: nv: Reinject PAC exceptions caused by HCR_EL2.API==0

In order for a L1 hypervisor to correctly handle PAuth instructions,
it must observe traps caused by a L1 PAuth instruction when
HCR_EL2.API==0. Since we already handle the case for API==1 as
a fixup, only the exception injection case needs to be handled.

Rework the kvm_handle_ptrauth() callback to reinject the trap
in this case. Note that APK==0 is already handled by the exising
triage_sysreg_trap() helper.

Reviewed-by: Oliver Upton <oliver.upton@linux.dev>
Link: https://lore.kernel.org/r/20240419102935.1935571-11-maz@kernel.org
Signed-off-by: Marc Zyngier <maz@kernel.org>

Metadata:
Author: Marc Zyngier <maz@kernel.org>
Author Date: Fri Apr 19 11:29:30 2024 +0100
Committer: Marc Zyngier <maz@kernel.org>
Commit Date: Sat Apr 20 12:42:51 2024 +0100

Files Changed: 1
Lines Added: 25
Lines Removed: 3
Total Changes: 28
