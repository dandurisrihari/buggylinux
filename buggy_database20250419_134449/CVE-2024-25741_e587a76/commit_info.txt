Commit Hash: e587a7633dfee8987a999cf253f7c52a8e09276c
Subject: usb: gadget: printer: fix races against disable

CVE Identifiers:
- CVE-2024-25741

Full commit message:
usb: gadget: printer: fix races against disable

printer_read() and printer_write() guard against the race
against disable() by checking the dev->interface flag,
which in turn is guarded by a spinlock.
These functions, however, drop the lock on multiple occasions.
This means that the test has to be redone after reacquiring
the lock and before doing IO.

Add the tests.

This also addresses CVE-2024-25741

Fixes: 7f2ca14d2f9b9 ("usb: gadget: function: printer: Interface is disabled and returns error")
Cc: stable <stable@kernel.org>
Signed-off-by: Oliver Neukum <oneukum@suse.com>
Link: https://lore.kernel.org/r/20240620114039.5767-1-oneukum@suse.com
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

Metadata:
Author: Oliver Neukum <oneukum@suse.com>
Author Date: Thu Jun 20 13:40:26 2024 +0200
Committer: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Commit Date: Thu Jun 20 19:33:22 2024 +0200

Files Changed: 1
Lines Added: 29
Lines Removed: 10
Total Changes: 39
