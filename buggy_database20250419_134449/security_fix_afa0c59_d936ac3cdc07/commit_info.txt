Commit Hash: afa0c5904ba16d59b0454f7ee4c807dae350f432
Subject: s390/qeth: fix use-after-free in error path


Security Keywords:
- exploit

Full commit message:
s390/qeth: fix use-after-free in error path

The error path in qeth_alloc_qdio_buffers() that takes care of
cleaning up the Output Queues is buggy. It first frees the queue, but
then calls qeth_clear_outq_buffers() with that very queue struct.

Make the call to qeth_clear_outq_buffers() part of the free action
(in the correct order), and while at it fix the naming of the helper.

Fixes: 0da9581ddb0f ("qeth: exploit asynchronous delivery of storage blocks")
Signed-off-by: Julian Wiedmann <jwi@linux.ibm.com>
Reviewed-by: Alexandra Winter <wintera@linux.ibm.com>
Signed-off-by: David S. Miller <davem@davemloft.net>

Metadata:
Author: Julian Wiedmann <jwi@linux.ibm.com>
Author Date: Mon Feb 4 17:40:07 2019 +0100
Committer: David S. Miller <davem@davemloft.net>
Commit Date: Mon Feb 4 09:43:48 2019 -0800

Files Changed: 1
Lines Added: 6
Lines Removed: 9
Total Changes: 15
