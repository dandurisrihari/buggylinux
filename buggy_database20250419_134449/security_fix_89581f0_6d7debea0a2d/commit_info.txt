Commit Hash: 89581f06b2bc225f0c9822fa52e714aa2e3810dd
Subject: arm64: KVM: Set cpsr before spsr on fault injection


Security Keywords:
- injection

Full commit message:
arm64: KVM: Set cpsr before spsr on fault injection

We need to set cpsr before determining the spsr bank, as the bank
depends on the target exception level of the injection, not the
current mode of the vcpu. Normally this is one in the same (EL1),
but not when we manage to trap an EL0 fault. It still doesn't really
matter for the 64-bit EL0 case though, as vcpu_spsr() unconditionally
uses the EL1 bank for that. However the 32-bit EL0 case gets fun, as
that path will lead to the BUG() in vcpu_spsr32().

This patch fixes the assignment order and also modifies some white
space in order to better group pairs of lines that have strict order.

Cc: stable@vger.kernel.org # v4.5
Signed-off-by: Andrew Jones <drjones@redhat.com>
Signed-off-by: Marc Zyngier <marc.zyngier@arm.com>

Metadata:
Author: Andrew Jones <drjones@redhat.com>
Author Date: Fri Jul 22 10:38:46 2016 -0400
Committer: Marc Zyngier <marc.zyngier@arm.com>
Commit Date: Mon Aug 1 15:09:47 2016 +0100

Files Changed: 1
Lines Added: 5
Lines Removed: 7
Total Changes: 12
