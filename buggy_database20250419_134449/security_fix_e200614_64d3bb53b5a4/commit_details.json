{
  "hash": "e2006140ad2e01a02ed0aff49cc2ae3ceeb11f8d",
  "hash_short": "e2006140",
  "subject": "thunderbolt: Mark XDomain as unplugged when router is removed",
  "body": "I noticed that when we do discrete host router NVM upgrade and it gets\nhot-removed from the PCIe side as a result of NVM firmware authentication,\nif there is another host connected with enabled paths we hang in tearing\nthem down. This is due to fact that the Thunderbolt networking driver\nalso tries to cleanup the paths and ends up blocking in\ntb_disconnect_xdomain_paths() waiting for the domain lock.\n\nHowever, at this point we already cleaned the paths in tb_stop() so\nthere is really no need for tb_disconnect_xdomain_paths() to do that\nanymore. Furthermore it already checks if the XDomain is unplugged and\nbails out early so take advantage of that and mark the XDomain as\nunplugged when we remove the parent router.\n\nCc: stable@vger.kernel.org\nSigned-off-by: Mika Westerberg <mika.westerberg@linux.intel.com>",
  "full_message": "thunderbolt: Mark XDomain as unplugged when router is removed\n\nI noticed that when we do discrete host router NVM upgrade and it gets\nhot-removed from the PCIe side as a result of NVM firmware authentication,\nif there is another host connected with enabled paths we hang in tearing\nthem down. This is due to fact that the Thunderbolt networking driver\nalso tries to cleanup the paths and ends up blocking in\ntb_disconnect_xdomain_paths() waiting for the domain lock.\n\nHowever, at this point we already cleaned the paths in tb_stop() so\nthere is really no need for tb_disconnect_xdomain_paths() to do that\nanymore. Furthermore it already checks if the XDomain is unplugged and\nbails out early so take advantage of that and mark the XDomain as\nunplugged when we remove the parent router.\n\nCc: stable@vger.kernel.org\nSigned-off-by: Mika Westerberg <mika.westerberg@linux.intel.com>",
  "author_name": "Mika Westerberg",
  "author_email": "mika.westerberg@linux.intel.com",
  "author_date": "Thu Jun 13 15:05:03 2024 +0300",
  "author_date_iso": "2024-06-13T15:05:03+03:00",
  "committer_name": "Mika Westerberg",
  "committer_email": "mika.westerberg@linux.intel.com",
  "committer_date": "Tue Aug 6 08:01:10 2024 +0300",
  "committer_date_iso": "2024-08-06T08:01:10+03:00",
  "files_changed": [
    "drivers/thunderbolt/switch.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/thunderbolt/switch.c",
      "insertions": 1,
      "deletions": 0
    }
  ],
  "total_insertions": 1,
  "total_deletions": 0,
  "total_changes": 1,
  "parents": [
    "ab3de2c7ec91db6a3cf5fc07765852c81ca7d6ef"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "authentication"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/thunderbolt/switch.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}