{
  "hash": "bfe298745afc9548ad9344a9a3f26c81fd1a76c4",
  "hash_short": "bfe29874",
  "subject": "arm64: entry-common: don't touch daif before bp-hardening",
  "body": "The previous patches mechanically transformed the assembly version of\nentry.S to entry-common.c for synchronous exceptions.\n\nThe C version of local_daif_restore() doesn't quite do the same thing\nas the assembly versions if pseudo-NMI is in use. In particular,\n| local_daif_restore(DAIF_PROCCTX_NOIRQ)\nwill still allow pNMI to be delivered. This is not the behaviour\ndo_el0_ia_bp_hardening() and do_sp_pc_abort() want as it should not\nbe possible for the PMU handler to run as an NMI until the bp-hardening\nsequence has run.\n\nThe bp-hardening calls were placed where they are because this was the\nfirst C code to run after the relevant exceptions. As we've now moved\nthat point earlier, move the checks and calls earlier too.\n\nThis makes it clearer that this stuff runs before any kind of exception,\nand saves modifying PSTATE twice.\n\nSigned-off-by: James Morse <james.morse@arm.com>\nReviewed-by: Mark Rutland <mark.rutland@arm.com>\nCc: Julien Thierry <julien.thierry.kdev@gmail.com>\nSigned-off-by: Catalin Marinas <catalin.marinas@arm.com>",
  "full_message": "arm64: entry-common: don't touch daif before bp-hardening\n\nThe previous patches mechanically transformed the assembly version of\nentry.S to entry-common.c for synchronous exceptions.\n\nThe C version of local_daif_restore() doesn't quite do the same thing\nas the assembly versions if pseudo-NMI is in use. In particular,\n| local_daif_restore(DAIF_PROCCTX_NOIRQ)\nwill still allow pNMI to be delivered. This is not the behaviour\ndo_el0_ia_bp_hardening() and do_sp_pc_abort() want as it should not\nbe possible for the PMU handler to run as an NMI until the bp-hardening\nsequence has run.\n\nThe bp-hardening calls were placed where they are because this was the\nfirst C code to run after the relevant exceptions. As we've now moved\nthat point earlier, move the checks and calls earlier too.\n\nThis makes it clearer that this stuff runs before any kind of exception,\nand saves modifying PSTATE twice.\n\nSigned-off-by: James Morse <james.morse@arm.com>\nReviewed-by: Mark Rutland <mark.rutland@arm.com>\nCc: Julien Thierry <julien.thierry.kdev@gmail.com>\nSigned-off-by: Catalin Marinas <catalin.marinas@arm.com>",
  "author_name": "James Morse",
  "author_email": "james.morse@arm.com",
  "author_date": "Fri Oct 25 17:42:16 2019 +0100",
  "author_date_iso": "2019-10-25T17:42:16+01:00",
  "committer_name": "Catalin Marinas",
  "committer_email": "catalin.marinas@arm.com",
  "committer_date": "Mon Oct 28 11:22:54 2019 +0000",
  "committer_date_iso": "2019-10-28T11:22:54+00:00",
  "files_changed": [
    "arch/arm64/include/asm/processor.h",
    "arch/arm64/kernel/entry-common.c",
    "arch/arm64/mm/fault.c"
  ],
  "files_changed_count": 3,
  "stats": [
    {
      "file": "arch/arm64/include/asm/processor.h",
      "insertions": 14,
      "deletions": 0
    },
    {
      "file": "arch/arm64/kernel/entry-common.c",
      "insertions": 15,
      "deletions": 3
    },
    {
      "file": "arch/arm64/mm/fault.c",
      "insertions": 1,
      "deletions": 35
    }
  ],
  "total_insertions": 30,
  "total_deletions": 38,
  "total_changes": 68,
  "parents": [
    "afa7c0e5b965cdb945ad8a2e2973c6d7e19969f9"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v5.5",
    "v5.5-rc1",
    "v5.5-rc2",
    "v5.5-rc3",
    "v5.5-rc4",
    "v5.5-rc5",
    "v5.5-rc6",
    "v5.5-rc7",
    "v5.6",
    "v5.6-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "hardening"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/arm64/include/asm/processor.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/arm64/kernel/entry-common.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/arm64/mm/fault.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}