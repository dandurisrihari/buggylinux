commit 51c18bf7fdbe3c0546e86cb0fa5866fee07c5261
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Sat Jun 9 12:10:58 2018 +0100

    drm/i915: Squash GEM load failure message (again)
    
    Due to a silent conflict (silent because we are trying to fix the CI
    test that is meant to exercising these failures!) between commit
    51e645b6652c ("drm/i915: Mark the GPU as wedged without error on fault
    injection") and commit 8571a05a9dd0 ("drm/i915: Use GEM suspend when
    aborting initialisation"), we failed to actually squash the error
    message after injecting the load failure.
    
    Rearrange the code to export i915_load_failure() for better logging of
    real errors (and quiet logging of injected errors).
    
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    Cc: Michał Winiarski <michal.winiarski@intel.com>
    Reviewed-by: Michał Winiarski <michal.winiarski@intel.com>
    Link: https://patchwork.freedesktop.org/patch/msgid/20180609111058.2660-1-chris@chris-wilson.co.uk

diff --git a/drivers/gpu/drm/i915/i915_drv.h b/drivers/gpu/drm/i915/i915_drv.h
index 71651ca7a8b1..6104d7115054 100644
--- a/drivers/gpu/drm/i915/i915_drv.h
+++ b/drivers/gpu/drm/i915/i915_drv.h
@@ -108,13 +108,24 @@
 	I915_STATE_WARN((x), "%s", "WARN_ON(" __stringify(x) ")")
 
 #if IS_ENABLED(CONFIG_DRM_I915_DEBUG)
+
 bool __i915_inject_load_failure(const char *func, int line);
 #define i915_inject_load_failure() \
 	__i915_inject_load_failure(__func__, __LINE__)
+
+bool i915_error_injected(void);
+
 #else
+
 #define i915_inject_load_failure() false
+#define i915_error_injected() false
+
 #endif
 
+#define i915_load_error(i915, fmt, ...)					 \
+	__i915_printk(i915, i915_error_injected() ? KERN_DEBUG : KERN_ERR, \
+		      fmt, ##__VA_ARGS__)
+
 typedef struct {
 	uint32_t val;
 } uint_fixed_16_16_t;