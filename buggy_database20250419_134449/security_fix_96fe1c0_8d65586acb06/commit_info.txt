Commit Hash: 96fe1c0237224b24a0dfaaee6467a5767902ba4a
Subject: [IPSEC] AH4: Update IPv4 options handling to conform to RFC 4302.


Security Keywords:
- authentication

Full commit message:
[IPSEC] AH4: Update IPv4 options handling to conform to RFC 4302.

In testing our ESP/AH offload hardware, I discovered an issue with how
AH handles mutable fields in IPv4.  RFC 4302 (AH) states the following
on the subject:

        For IPv4, the entire option is viewed as a unit; so even
        though the type and length fields within most options are immutable
        in transit, if an option is classified as mutable, the entire option
        is zeroed for ICV computation purposes.

The current implementation does not zero the type and length fields,
resulting in authentication failures when communicating with hosts
that do (i.e. FreeBSD).

I have tested record route and timestamp options (ping -R and ping -T)
on a small network involving Windows XP, FreeBSD 6.2, and Linux hosts,
with one router.  In the presence of these options, the FreeBSD and
Linux hosts (with the patch or with the hardware) can communicate.
The Windows XP host simply fails to accept these packets with or
without the patch.

I have also been trying to test source routing options (using
traceroute -g), but haven't had much luck getting this option to work
*without* AH, let alone with.

Signed-off-by: Nick Bowler <nbowler@ellipticsemi.com>
Signed-off-by: David S. Miller <davem@davemloft.net>

Metadata:
Author: Nick Bowler <nbowler@ellipticsemi.com>
Author Date: Wed Aug 22 12:33:51 2007 -0700
Committer: David S. Miller <davem@sunset.davemloft.net>
Commit Date: Sun Aug 26 18:35:33 2007 -0700

Files Changed: 1
Lines Added: 1
Lines Removed: 1
Total Changes: 2
