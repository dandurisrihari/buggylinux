Commit Hash: b5109b60ee4fcb2f2bb24f589575e10cc5283ad4
Subject: net: seeq: Fix use after free vulnerability in ether3 Driver Due to Race Condition


Security Keywords:
- vulnerability

Full commit message:
net: seeq: Fix use after free vulnerability in ether3 Driver Due to Race Condition

In the ether3_probe function, a timer is initialized with a callback
function ether3_ledoff, bound to &prev(dev)->timer. Once the timer is
started, there is a risk of a race condition if the module or device
is removed, triggering the ether3_remove function to perform cleanup.
The sequence of operations that may lead to a UAF bug is as follows:

CPU0                                    CPU1

                      |  ether3_ledoff
ether3_remove         |
  free_netdev(dev);   |
  put_devic           |
  kfree(dev);         |
 |  ether3_outw(priv(dev)->regs.config2 |= CFG2_CTRLO, REG_CONFIG2);
                      | // use dev

Fix it by ensuring that the timer is canceled before proceeding with
the cleanup in ether3_remove.

Fixes: 6fd9c53f7186 ("net: seeq: Convert timers to use timer_setup()")
Signed-off-by: Kaixin Wang <kxwang23@m.fudan.edu.cn>
Link: https://patch.msgid.link/20240915144045.451-1-kxwang23@m.fudan.edu.cn
Signed-off-by: Paolo Abeni <pabeni@redhat.com>

Metadata:
Author: Kaixin Wang <kxwang23@m.fudan.edu.cn>
Author Date: Sun Sep 15 22:40:46 2024 +0800
Committer: Paolo Abeni <pabeni@redhat.com>
Commit Date: Thu Sep 19 15:17:30 2024 +0200

Files Changed: 1
Lines Added: 2
Lines Removed: 0
Total Changes: 2
