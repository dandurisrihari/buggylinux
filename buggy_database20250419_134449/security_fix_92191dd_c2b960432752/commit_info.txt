Commit Hash: 92191dd1073088753821b862b791dcc83e558e07
Subject: net: ipv6: fix dst ref loops in rpl, seg6 and ioam6 lwtunnels


Security Keywords:
- injection

Full commit message:
net: ipv6: fix dst ref loops in rpl, seg6 and ioam6 lwtunnels

Some lwtunnels have a dst cache for post-transformation dst.
If the packet destination did not change we may end up recording
a reference to the lwtunnel in its own cache, and the lwtunnel
state will never be freed.

Discovered by the ioam6.sh test, kmemleak was recently fixed
to catch per-cpu memory leaks. I'm not sure if rpl and seg6
can actually hit this, but in principle I don't see why not.

Fixes: 8cb3bf8bff3c ("ipv6: ioam: Add support for the ip6ip6 encapsulation")
Fixes: 6c8702c60b88 ("ipv6: sr: add support for SRH encapsulation and injection with lwtunnels")
Fixes: a7a29f9c361f ("net: ipv6: add rpl sr tunnel")
Reviewed-by: Simon Horman <horms@kernel.org>
Link: https://patch.msgid.link/20250130031519.2716843-2-kuba@kernel.org
Signed-off-by: Jakub Kicinski <kuba@kernel.org>

Metadata:
Author: Jakub Kicinski <kuba@kernel.org>
Author Date: Wed Jan 29 19:15:19 2025 -0800
Committer: Jakub Kicinski <kuba@kernel.org>
Commit Date: Sat Feb 1 16:55:44 2025 -0800

Files Changed: 3
Lines Added: 18
Lines Removed: 9
Total Changes: 27
