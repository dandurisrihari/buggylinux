{
  "hash": "10cb8e617560fc050a759a897a2dde07a5fe04cb",
  "hash_short": "10cb8e61",
  "subject": "mac80211: enable QoS support for nl80211 ctrl port",
  "body": "This patch unifies sending control port frames\nover nl80211 and AF_PACKET sockets a little more.\n\nBefore this patch, EAPOL frames got QoS prioritization\nonly when using AF_PACKET sockets.\n\n__ieee80211_select_queue only selects a QoS-enabled queue\nfor control port frames, when the control port protocol\nis set correctly on the skb. For the AF_PACKET path this\nworks, but the nl80211 path used ETH_P_802_3.\n\nAnother check for injected frames in wme.c then prevented\nthe QoS TID to be copied in the frame.\n\nIn order to fix this, get rid of the frame injection marking\nfor nl80211 ctrl port and set the correct ethernet protocol.\n\nPlease note:\nAn erlier version of this path tried to prevent\nframe aggregation for control port frames in order to speed up\nthe initial connection setup a little. This seemed to cause\nissues on my older Intel dvm-based hardware, and was therefore\nremoved again. Future commits which try to reintroduce this\nhave to check carefully how hw behaves with aggregated and\nnon-aggregated traffic for the same TID.\nMy NIC: Intel(R) Centrino(R) Ultimate-N 6300 AGN, REV=0x74\n\nReported-by: kernel test robot <lkp@intel.com>\nSigned-off-by: Markus Theil <markus.theil@tu-ilmenau.de>\nLink: https://lore.kernel.org/r/20210206115112.567881-1-markus.theil@tu-ilmenau.de\nSigned-off-by: Johannes Berg <johannes.berg@intel.com>",
  "full_message": "mac80211: enable QoS support for nl80211 ctrl port\n\nThis patch unifies sending control port frames\nover nl80211 and AF_PACKET sockets a little more.\n\nBefore this patch, EAPOL frames got QoS prioritization\nonly when using AF_PACKET sockets.\n\n__ieee80211_select_queue only selects a QoS-enabled queue\nfor control port frames, when the control port protocol\nis set correctly on the skb. For the AF_PACKET path this\nworks, but the nl80211 path used ETH_P_802_3.\n\nAnother check for injected frames in wme.c then prevented\nthe QoS TID to be copied in the frame.\n\nIn order to fix this, get rid of the frame injection marking\nfor nl80211 ctrl port and set the correct ethernet protocol.\n\nPlease note:\nAn erlier version of this path tried to prevent\nframe aggregation for control port frames in order to speed up\nthe initial connection setup a little. This seemed to cause\nissues on my older Intel dvm-based hardware, and was therefore\nremoved again. Future commits which try to reintroduce this\nhave to check carefully how hw behaves with aggregated and\nnon-aggregated traffic for the same TID.\nMy NIC: Intel(R) Centrino(R) Ultimate-N 6300 AGN, REV=0x74\n\nReported-by: kernel test robot <lkp@intel.com>\nSigned-off-by: Markus Theil <markus.theil@tu-ilmenau.de>\nLink: https://lore.kernel.org/r/20210206115112.567881-1-markus.theil@tu-ilmenau.de\nSigned-off-by: Johannes Berg <johannes.berg@intel.com>",
  "author_name": "Markus Theil",
  "author_email": "markus.theil@tu-ilmenau.de",
  "author_date": "Sat Feb 6 12:51:12 2021 +0100",
  "author_date_iso": "2021-02-06T12:51:12+01:00",
  "committer_name": "Johannes Berg",
  "committer_email": "johannes.berg@intel.com",
  "committer_date": "Fri Feb 12 08:52:48 2021 +0100",
  "committer_date_iso": "2021-02-12T08:52:48+01:00",
  "files_changed": [
    "net/mac80211/status.c",
    "net/mac80211/tx.c"
  ],
  "files_changed_count": 2,
  "stats": [
    {
      "file": "net/mac80211/status.c",
      "insertions": 2,
      "deletions": 6
    },
    {
      "file": "net/mac80211/tx.c",
      "insertions": 19,
      "deletions": 6
    }
  ],
  "total_insertions": 21,
  "total_deletions": 12,
  "total_changes": 33,
  "parents": [
    "258afa78661178d16288537ffe8ef863c7e5918a"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "net/mac80211/status.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "net/mac80211/tx.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}