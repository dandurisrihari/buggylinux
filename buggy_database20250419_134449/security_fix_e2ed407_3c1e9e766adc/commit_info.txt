Commit Hash: e2ed4078a6ef3ddf4063329298852e24c36d46c8
Subject: kvm: i8254: Deactivate APICv when using in-kernel PIT re-injection mode.


Security Keywords:
- injection

Full commit message:
kvm: i8254: Deactivate APICv when using in-kernel PIT re-injection mode.

AMD SVM AVIC accelerates EOI write and does not trap. This causes
in-kernel PIT re-injection mode to fail since it relies on irq-ack
notifier mechanism. So, APICv is activated only when in-kernel PIT
is in discard mode e.g. w/ qemu option:

  -global kvm-pit.lost_tick_policy=discard

Also, introduce APICV_INHIBIT_REASON_PIT_REINJ bit to be used for this
reason.

Suggested-by: Paolo Bonzini <pbonzini@redhat.com>
Signed-off-by: Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

Metadata:
Author: Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>
Author Date: Thu Nov 14 14:15:16 2019 -0600
Committer: Paolo Bonzini <pbonzini@redhat.com>
Commit Date: Wed Feb 5 15:17:44 2020 +0100

Files Changed: 3
Lines Added: 22
Lines Removed: 2
Total Changes: 24
