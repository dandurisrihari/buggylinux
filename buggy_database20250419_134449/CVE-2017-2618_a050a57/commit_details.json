{
  "hash": "a050a570db0190164e7250013214e29a5a9803ee",
  "hash_short": "a050a570",
  "subject": "selinux: fix off-by-one in setprocattr",
  "body": "SELinux tries to support setting/clearing of /proc/pid/attr attributes\nfrom the shell by ignoring terminating newlines and treating an\nattribute value that begins with a NUL or newline as an attempt to\nclear the attribute.  However, the test for clearing attributes has\nalways been wrong; it has an off-by-one error, and this could further\nlead to reading past the end of the allocated buffer since commit\nbb646cdb12e75d82258c2f2e7746d5952d3e321a (\"proc_pid_attr_write():\nswitch to memdup_user()\").  Fix the off-by-one error.\n\nEven with this fix, setting and clearing /proc/pid/attr attributes\nfrom the shell is not straightforward since the interface does not\nsupport multiple write() calls (so shells that write the value and\nnewline separately will set and then immediately clear the attribute,\nrequiring use of echo -n to set the attribute), whereas trying to use\necho -n \"\" to clear the attribute causes the shell to skip the\nwrite() call altogether since POSIX says that a zero-length write\ncauses no side effects. Thus, one must use echo -n to set and echo\nwithout -n to clear, as in the following example:\n$ echo -n unconfined_u:object_r:user_home_t:s0 > /proc/$$/attr/fscreate\n$ cat /proc/$$/attr/fscreate\nunconfined_u:object_r:user_home_t:s0\n$ echo \"\" > /proc/$$/attr/fscreate\n$ cat /proc/$$/attr/fscreate\n\nNote the use of /proc/$$ rather than /proc/self, as otherwise\nthe cat command will read its own attribute value, not that of the shell.\n\nThere are no users of this facility to my knowledge; possibly we\nshould just get rid of it.\n\nUPDATE: Upon further investigation it appears that a local process\nwith the process:setfscreate permission can cause a kernel panic as a\nresult of this bug.  This patch fixes CVE-2017-2618.\n\nSigned-off-by: Stephen Smalley <sds@tycho.nsa.gov>\n[PM: added the update about CVE-2017-2618 to the commit description]\nCc: stable@vger.kernel.org # 3.5: d6ea83ec6864e\nSigned-off-by: Paul Moore <paul@paul-moore.com>",
  "full_message": "selinux: fix off-by-one in setprocattr\n\nSELinux tries to support setting/clearing of /proc/pid/attr attributes\nfrom the shell by ignoring terminating newlines and treating an\nattribute value that begins with a NUL or newline as an attempt to\nclear the attribute.  However, the test for clearing attributes has\nalways been wrong; it has an off-by-one error, and this could further\nlead to reading past the end of the allocated buffer since commit\nbb646cdb12e75d82258c2f2e7746d5952d3e321a (\"proc_pid_attr_write():\nswitch to memdup_user()\").  Fix the off-by-one error.\n\nEven with this fix, setting and clearing /proc/pid/attr attributes\nfrom the shell is not straightforward since the interface does not\nsupport multiple write() calls (so shells that write the value and\nnewline separately will set and then immediately clear the attribute,\nrequiring use of echo -n to set the attribute), whereas trying to use\necho -n \"\" to clear the attribute causes the shell to skip the\nwrite() call altogether since POSIX says that a zero-length write\ncauses no side effects. Thus, one must use echo -n to set and echo\nwithout -n to clear, as in the following example:\n$ echo -n unconfined_u:object_r:user_home_t:s0 > /proc/$$/attr/fscreate\n$ cat /proc/$$/attr/fscreate\nunconfined_u:object_r:user_home_t:s0\n$ echo \"\" > /proc/$$/attr/fscreate\n$ cat /proc/$$/attr/fscreate\n\nNote the use of /proc/$$ rather than /proc/self, as otherwise\nthe cat command will read its own attribute value, not that of the shell.\n\nThere are no users of this facility to my knowledge; possibly we\nshould just get rid of it.\n\nUPDATE: Upon further investigation it appears that a local process\nwith the process:setfscreate permission can cause a kernel panic as a\nresult of this bug.  This patch fixes CVE-2017-2618.\n\nSigned-off-by: Stephen Smalley <sds@tycho.nsa.gov>\n[PM: added the update about CVE-2017-2618 to the commit description]\nCc: stable@vger.kernel.org # 3.5: d6ea83ec6864e\nSigned-off-by: Paul Moore <paul@paul-moore.com>",
  "author_name": "Stephen Smalley",
  "author_email": "sds@tycho.nsa.gov",
  "author_date": "Tue Jan 31 11:54:04 2017 -0500",
  "author_date_iso": "2017-01-31T11:54:04-05:00",
  "committer_name": "Paul Moore",
  "committer_email": "paul@paul-moore.com",
  "committer_date": "Tue Feb 7 17:31:38 2017 -0500",
  "committer_date_iso": "2017-02-07T17:31:38-05:00",
  "files_changed": [
    "security/selinux/hooks.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "security/selinux/hooks.c",
      "insertions": 1,
      "deletions": 1
    }
  ],
  "total_insertions": 1,
  "total_deletions": 1,
  "total_changes": 2,
  "parents": [
    "bfc5e3a6af397dcf9c99a6c1872458e7867c4680"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.11",
    "v4.11-rc1",
    "v4.11-rc2",
    "v4.11-rc3",
    "v4.11-rc4",
    "v4.11-rc5",
    "v4.11-rc6",
    "v4.11-rc7",
    "v4.11-rc8",
    "v4.12"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [
      "CVE-2017-2618",
      "CVE-2017-2618"
    ],
    "security_keywords": []
  },
  "fix_type": "cve",
  "file_results": [
    {
      "file": "security/selinux/hooks.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}