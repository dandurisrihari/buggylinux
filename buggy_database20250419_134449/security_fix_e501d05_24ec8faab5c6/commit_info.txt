Commit Hash: e501d0553a7580fcc6654d7f58a5f061d31d00af
Subject: Bluetooth: Check L2CAP pending status before sending connect request


Security Keywords:
- Auth

Full commit message:
Bluetooth: Check L2CAP pending status before sending connect request

Due to race condition in L2CAP state machine L2CAP Connection Request
may be sent twice for SDP with the same source channel id. Problems
reported connecting to Apple products, some carkit, Blackberry phones.

...
2010-06-07 21:18:03.651031 < ACL data: handle 1 flags 0x02 dlen 12
    L2CAP(s): Connect req: psm 1 scid 0x0040
2010-06-07 21:18:03.653473 > HCI Event: Number of Completed Packets (0x13) plen 5
    handle 1 packets 1
2010-06-07 21:18:03.653808 > HCI Event: Auth Complete (0x06) plen 3
    status 0x00 handle 1
2010-06-07 21:18:03.653869 < ACL data: handle 1 flags 0x02 dlen 12
    L2CAP(s): Connect req: psm 1 scid 0x0040
...

Patch uses L2CAP_CONF_CONNECT_PEND flag to mark that L2CAP Connection
Request has been sent already.

Modified version of patch from Ville Tervo.

Signed-off-by: Andrei Emeltchenko <andrei.emeltchenko@nokia.com>
Signed-off-by: Marcel Holtmann <marcel@holtmann.org>

Metadata:
Author: Andrei Emeltchenko <andrei.emeltchenko@nokia.com>
Author Date: Thu Jul 8 12:14:41 2010 +0300
Committer: Marcel Holtmann <marcel@holtmann.org>
Commit Date: Thu Jul 8 20:35:23 2010 -0300

Files Changed: 1
Lines Added: 11
Lines Removed: 3
Total Changes: 14
