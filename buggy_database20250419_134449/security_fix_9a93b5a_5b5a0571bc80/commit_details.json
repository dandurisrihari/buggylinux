{
  "hash": "9a93b5a35388aabb061212e906221a540ffdb965",
  "hash_short": "9a93b5a3",
  "subject": "btrfs: abort the transaction if we get an error during snapshot drop",
  "body": "We were seeing weird errors when we were testing our btrfs backports\nbefore we had the incorrect level check fix.  These errors appeared to\nbe improper error handling, but error injection testing uncovered that\nthe errors were a result of corruption that occurred from improper error\nhandling during snapshot delete.\n\nWith snapshot delete if we encounter any errors during walk_down or\nwalk_up we'll simply return an error, we won't abort the transaction.\nThis is problematic because we will be dropping references for nodes and\nleaves along the way, and if we fail in the middle we will leave the\nfile system corrupt because we don't know where we left off in the drop.\n\nFix this by making sure we abort if we hit any errors during the walk\ndown or walk up operations, as we have no idea what operations could\nhave been left half done at this point.\n\nSigned-off-by: Josef Bacik <josef@toxicpanda.com>\nReviewed-by: David Sterba <dsterba@suse.com>\nSigned-off-by: David Sterba <dsterba@suse.com>",
  "full_message": "btrfs: abort the transaction if we get an error during snapshot drop\n\nWe were seeing weird errors when we were testing our btrfs backports\nbefore we had the incorrect level check fix.  These errors appeared to\nbe improper error handling, but error injection testing uncovered that\nthe errors were a result of corruption that occurred from improper error\nhandling during snapshot delete.\n\nWith snapshot delete if we encounter any errors during walk_down or\nwalk_up we'll simply return an error, we won't abort the transaction.\nThis is problematic because we will be dropping references for nodes and\nleaves along the way, and if we fail in the middle we will leave the\nfile system corrupt because we don't know where we left off in the drop.\n\nFix this by making sure we abort if we hit any errors during the walk\ndown or walk up operations, as we have no idea what operations could\nhave been left half done at this point.\n\nSigned-off-by: Josef Bacik <josef@toxicpanda.com>\nReviewed-by: David Sterba <dsterba@suse.com>\nSigned-off-by: David Sterba <dsterba@suse.com>",
  "author_name": "Josef Bacik",
  "author_email": "josef@toxicpanda.com",
  "author_date": "Tue Feb 7 11:57:25 2023 -0500",
  "author_date_iso": "2023-02-07T11:57:25-05:00",
  "committer_name": "David Sterba",
  "committer_email": "dsterba@suse.com",
  "committer_date": "Mon Apr 17 18:01:13 2023 +0200",
  "committer_date_iso": "2023-04-17T18:01:13+02:00",
  "files_changed": [
    "fs/btrfs/extent-tree.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "fs/btrfs/extent-tree.c",
      "insertions": 2,
      "deletions": 0
    }
  ],
  "total_insertions": 2,
  "total_deletions": 0,
  "total_changes": 2,
  "parents": [
    "4e19438400ce6d4a6251829ac045ba680ad48bb4"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "fs/btrfs/extent-tree.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}