Commit Hash: 9915672d41273f5b77f1b3c29b391ffb7732b84b
Subject: af_unix: limit unix_tot_inflight


Security Keywords:
- exploit

Full commit message:
af_unix: limit unix_tot_inflight

Vegard Nossum found a unix socket OOM was possible, posting an exploit
program.

My analysis is we can eat all LOWMEM memory before unix_gc() being
called from unix_release_sock(). Moreover, the thread blocked in
unix_gc() can consume huge amount of time to perform cleanup because of
huge working set.

One way to handle this is to have a sensible limit on unix_tot_inflight,
tested from wait_for_unix_gc() and to force a call to unix_gc() if this
limit is hit.

This solves the OOM and also reduce overall latencies, and should not
slowdown normal workloads.

Reported-by: Vegard Nossum <vegard.nossum@gmail.com>
Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com>
Signed-off-by: David S. Miller <davem@davemloft.net>

Metadata:
Author: Eric Dumazet <eric.dumazet@gmail.com>
Author Date: Wed Nov 24 09:15:27 2010 -0800
Committer: David S. Miller <davem@davemloft.net>
Commit Date: Wed Nov 24 09:15:27 2010 -0800

Files Changed: 1
Lines Added: 7
Lines Removed: 0
Total Changes: 7
