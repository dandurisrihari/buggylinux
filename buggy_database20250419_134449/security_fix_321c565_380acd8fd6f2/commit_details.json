{
  "hash": "321c5658c5e9192dea0d58ab67cf1791e45b2b26",
  "hash_short": "321c5658",
  "subject": "KVM: x86: Inject pending interrupt even if pending nmi exist",
  "body": "Non maskable interrupts (NMI) are preferred to interrupts in current\nimplementation. If a NMI is pending and NMI is blocked by the result\nof nmi_allowed(), pending interrupt is not injected and\nenable_irq_window() is not executed, even if interrupts injection is\nallowed.\n\nIn old kernel (e.g. 2.6.32), schedule() is often called in NMI context.\nIn this case, interrupts are needed to execute iret that intends end\nof NMI. The flag of blocking new NMI is not cleared until the guest\nexecute the iret, and interrupts are blocked by pending NMI. Due to\nthis, iret can't be invoked in the guest, and the guest is starved\nuntil block is cleared by some events (e.g. canceling injection).\n\nThis patch injects pending interrupts, when it's allowed, even if NMI\nis blocked. And, If an interrupts is pending after executing\ninject_pending_event(), enable_irq_window() is executed regardless of\nNMI pending counter.\n\nCc: stable@vger.kernel.org\nSigned-off-by: Yuki Shibuya <shibuya.yk@ncos.nec.co.jp>\nSuggested-by: Paolo Bonzini <pbonzini@redhat.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "full_message": "KVM: x86: Inject pending interrupt even if pending nmi exist\n\nNon maskable interrupts (NMI) are preferred to interrupts in current\nimplementation. If a NMI is pending and NMI is blocked by the result\nof nmi_allowed(), pending interrupt is not injected and\nenable_irq_window() is not executed, even if interrupts injection is\nallowed.\n\nIn old kernel (e.g. 2.6.32), schedule() is often called in NMI context.\nIn this case, interrupts are needed to execute iret that intends end\nof NMI. The flag of blocking new NMI is not cleared until the guest\nexecute the iret, and interrupts are blocked by pending NMI. Due to\nthis, iret can't be invoked in the guest, and the guest is starved\nuntil block is cleared by some events (e.g. canceling injection).\n\nThis patch injects pending interrupts, when it's allowed, even if NMI\nis blocked. And, If an interrupts is pending after executing\ninject_pending_event(), enable_irq_window() is executed regardless of\nNMI pending counter.\n\nCc: stable@vger.kernel.org\nSigned-off-by: Yuki Shibuya <shibuya.yk@ncos.nec.co.jp>\nSuggested-by: Paolo Bonzini <pbonzini@redhat.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "author_name": "Yuki Shibuya",
  "author_email": "shibuya.yk@ncos.nec.co.jp",
  "author_date": "Thu Mar 24 05:17:03 2016 +0000",
  "author_date_iso": "2016-03-24T05:17:03+00:00",
  "committer_name": "Paolo Bonzini",
  "committer_email": "pbonzini@redhat.com",
  "committer_date": "Fri Apr 1 12:10:09 2016 +0200",
  "committer_date_iso": "2016-04-01T12:10:09+02:00",
  "files_changed": [
    "arch/x86/kvm/x86.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "arch/x86/kvm/x86.c",
      "insertions": 10,
      "deletions": 10
    }
  ],
  "total_insertions": 10,
  "total_deletions": 10,
  "total_changes": 20,
  "parents": [
    "c26e5f303a1e10a76dab81cd4c93dfec3a8bff6b"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.10",
    "v4.10-rc1",
    "v4.10-rc2",
    "v4.10-rc3",
    "v4.10-rc4",
    "v4.10-rc5",
    "v4.10-rc6",
    "v4.10-rc7",
    "v4.10-rc8",
    "v4.11"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "Inject"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/x86/kvm/x86.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}