Commit Hash: 9beccca0984022a844850e32f0d7dd80d4a225de
Subject: scs: add support for dynamic shadow call stacks


Security Keywords:
- authentication

Full commit message:
scs: add support for dynamic shadow call stacks

In order to allow arches to use code patching to conditionally emit the
shadow stack pushes and pops, rather than always taking the performance
hit even on CPUs that implement alternatives such as stack pointer
authentication on arm64, add a Kconfig symbol that can be set by the
arch to omit the SCS codegen itself, without otherwise affecting how
support code for SCS and compiler options (for register reservation, for
instance) are emitted.

Also, add a static key and some plumbing to omit the allocation of
shadow call stack for dynamic SCS configurations if SCS is disabled at
runtime.

Signed-off-by: Ard Biesheuvel <ardb@kernel.org>
Reviewed-by: Nick Desaulniers <ndesaulniers@google.com>
Reviewed-by: Kees Cook <keescook@chromium.org>
Reviewed-by: Sami Tolvanen <samitolvanen@google.com>
Tested-by: Sami Tolvanen <samitolvanen@google.com>
Link: https://lore.kernel.org/r/20221027155908.1940624-3-ardb@kernel.org
Signed-off-by: Will Deacon <will@kernel.org>

Metadata:
Author: Ard Biesheuvel <ardb@kernel.org>
Author Date: Thu Oct 27 17:59:07 2022 +0200
Committer: Will Deacon <will@kernel.org>
Commit Date: Wed Nov 9 18:06:35 2022 +0000

Files Changed: 4
Lines Added: 39
Lines Removed: 2
Total Changes: 41
