commit a284e43852380ab71eeb996389e01992d74a8dde
Author: Kees Cook <kees@kernel.org>
Date:   Wed May 1 12:37:12 2024 -0700

    hardening: Enable KCFI and some other options
    
    Add some stuff that got missed along the way:
    
    - CONFIG_UNWIND_PATCH_PAC_INTO_SCS=y so SCS vs PAC is hardware
      selectable.
    
    - CONFIG_X86_KERNEL_IBT=y while a default, just be sure.
    
    - CONFIG_CFI_CLANG=y globally.
    
    - CONFIG_PAGE_TABLE_CHECK=y for userspace mapping sanity.
    
    Reviewed-by: Nathan Chancellor <nathan@kernel.org>
    Link: https://lore.kernel.org/r/20240501193709.make.982-kees@kernel.org
    Signed-off-by: Kees Cook <keescook@chromium.org>

diff --git a/arch/x86/configs/hardening.config b/arch/x86/configs/hardening.config
index 7b497f3b7bc3..de319852a1e9 100644
--- a/arch/x86/configs/hardening.config
+++ b/arch/x86/configs/hardening.config
@@ -10,5 +10,8 @@ CONFIG_INTEL_IOMMU_DEFAULT_ON=y
 CONFIG_INTEL_IOMMU_SVM=y
 CONFIG_AMD_IOMMU=y
 
+# Enforce CET Indirect Branch Tracking in the kernel.
+CONFIG_X86_KERNEL_IBT=y
+
 # Enable CET Shadow Stack for userspace.
 CONFIG_X86_USER_SHADOW_STACK=y