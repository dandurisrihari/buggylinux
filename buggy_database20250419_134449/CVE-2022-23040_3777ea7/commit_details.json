{
  "hash": "3777ea7bac3113005b7180e6b9dadf16d19a5827",
  "hash_short": "3777ea7b",
  "subject": "xen/xenbus: don't let xenbus_grant_ring() remove grants in error case",
  "body": "Letting xenbus_grant_ring() tear down grants in the error case is\nproblematic, as the other side could already have used these grants.\nCalling gnttab_end_foreign_access_ref() without checking success is\nresulting in an unclear situation for any caller of xenbus_grant_ring()\nas in the error case the memory pages of the ring page might be\npartially mapped. Freeing them would risk unwanted foreign access to\nthem, while not freeing them would leak memory.\n\nIn order to remove the need to undo any gnttab_grant_foreign_access()\ncalls, use gnttab_alloc_grant_references() to make sure no further\nerror can occur in the loop granting access to the ring pages.\n\nIt should be noted that this way of handling removes leaking of\ngrant entries in the error case, too.\n\nThis is CVE-2022-23040 / part of XSA-396.\n\nReported-by: Demi Marie Obenour <demi@invisiblethingslab.com>\nSigned-off-by: Juergen Gross <jgross@suse.com>\nReviewed-by: Jan Beulich <jbeulich@suse.com>",
  "full_message": "xen/xenbus: don't let xenbus_grant_ring() remove grants in error case\n\nLetting xenbus_grant_ring() tear down grants in the error case is\nproblematic, as the other side could already have used these grants.\nCalling gnttab_end_foreign_access_ref() without checking success is\nresulting in an unclear situation for any caller of xenbus_grant_ring()\nas in the error case the memory pages of the ring page might be\npartially mapped. Freeing them would risk unwanted foreign access to\nthem, while not freeing them would leak memory.\n\nIn order to remove the need to undo any gnttab_grant_foreign_access()\ncalls, use gnttab_alloc_grant_references() to make sure no further\nerror can occur in the loop granting access to the ring pages.\n\nIt should be noted that this way of handling removes leaking of\ngrant entries in the error case, too.\n\nThis is CVE-2022-23040 / part of XSA-396.\n\nReported-by: Demi Marie Obenour <demi@invisiblethingslab.com>\nSigned-off-by: Juergen Gross <jgross@suse.com>\nReviewed-by: Jan Beulich <jbeulich@suse.com>",
  "author_name": "Juergen Gross",
  "author_email": "jgross@suse.com",
  "author_date": "Mon Mar 7 09:48:54 2022 +0100",
  "author_date_iso": "2022-03-07T09:48:54+01:00",
  "committer_name": "Juergen Gross",
  "committer_email": "jgross@suse.com",
  "committer_date": "Mon Mar 7 09:48:54 2022 +0100",
  "committer_date_iso": "2022-03-07T09:48:54+01:00",
  "files_changed": [
    "drivers/xen/xenbus/xenbus_client.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/xen/xenbus/xenbus_client.c",
      "insertions": 11,
      "deletions": 13
    }
  ],
  "total_insertions": 11,
  "total_deletions": 13,
  "total_changes": 24,
  "parents": [
    "ffb217a13a2eaf6d5bd974fc83036a53ca69f1e2"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [
      "CVE-2022-23040"
    ],
    "security_keywords": []
  },
  "fix_type": "cve",
  "file_results": [
    {
      "file": "drivers/xen/xenbus/xenbus_client.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}