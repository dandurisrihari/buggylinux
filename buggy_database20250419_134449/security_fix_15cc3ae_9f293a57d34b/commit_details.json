{
  "hash": "15cc3ae001873845b5d842e212478a6570c7d938",
  "hash_short": "15cc3ae0",
  "subject": "EDAC, sb_edac: Don't create a second memory controller if HA1 is not present",
  "body": "Yi Zhang reported the following failure on a 2-socket Haswell (E5-2603v3)\nserver (DELL PowerEdge 730xd):\n\n  EDAC sbridge: Some needed devices are missing\n  EDAC MC: Removed device 0 for sb_edac.c Haswell SrcID#0_Ha#0: DEV 0000:7f:12.0\n  EDAC MC: Removed device 1 for sb_edac.c Haswell SrcID#1_Ha#0: DEV 0000:ff:12.0\n  EDAC sbridge: Couldn't find mci handler\n  EDAC sbridge: Couldn't find mci handler\n  EDAC sbridge: Failed to register device with error -19.\n\nThe refactored sb_edac driver creates the IMC1 (the 2nd memory\ncontroller) if any IMC1 device is present. In this case only\nHA1_TA of IMC1 was present, but the driver expected to find\nHA1/HA1_TM/HA1_TAD[0-3] devices too, leading to the above failure.\n\nThe document [1] says the 'E5-2603 v3' CPU has 4 memory channels max. Yi\nZhang inserted one DIMM per channel for each CPU, and did random error\naddress injection test with this patch:\n\n      4024  addresses fell in TOLM hole area\n     12715  addresses fell in CPU_SrcID#0_Ha#0_Chan#0_DIMM#0\n     12774  addresses fell in CPU_SrcID#0_Ha#0_Chan#1_DIMM#0\n     12798  addresses fell in CPU_SrcID#0_Ha#0_Chan#2_DIMM#0\n     12913  addresses fell in CPU_SrcID#0_Ha#0_Chan#3_DIMM#0\n     12674  addresses fell in CPU_SrcID#1_Ha#0_Chan#0_DIMM#0\n     12686  addresses fell in CPU_SrcID#1_Ha#0_Chan#1_DIMM#0\n     12882  addresses fell in CPU_SrcID#1_Ha#0_Chan#2_DIMM#0\n     12934  addresses fell in CPU_SrcID#1_Ha#0_Chan#3_DIMM#0\n    106400  addresses were injected totally.\n\nThe test result shows that all the 4 channels belong to IMC0 per CPU, so\nthe server really only has one IMC per CPU.\n\nIn the 1st page of chapter 2 in datasheet [2], it also says 'E5-2600 v3'\nimplements either one or two IMCs. For CPUs with one IMC, IMC1 is not\nused and should be ignored.\n\nThus, do not create a second memory controller if the key HA1 is absent.\n\n[1] http://ark.intel.com/products/83349/Intel-Xeon-Processor-E5-2603-v3-15M-Cache-1_60-GHz\n[2] https://www.intel.com/content/dam/www/public/us/en/documents/datasheets/xeon-e5-v3-datasheet-vol-2.pdf\n\nReported-and-tested-by: Yi Zhang <yizhan@redhat.com>\nSigned-off-by: Qiuxu Zhuo <qiuxu.zhuo@intel.com>\nCc: Tony Luck <tony.luck@intel.com>\nCc: linux-edac <linux-edac@vger.kernel.org>\nFixes: e2f747b1f42a (\"EDAC, sb_edac: Assign EDAC memory controller per h/w controller\")\nLink: http://lkml.kernel.org/r/20170913104214.7325-1-qiuxu.zhuo@intel.com\n[ Massage commit message. ]\nSigned-off-by: Borislav Petkov <bp@suse.de>",
  "full_message": "EDAC, sb_edac: Don't create a second memory controller if HA1 is not present\n\nYi Zhang reported the following failure on a 2-socket Haswell (E5-2603v3)\nserver (DELL PowerEdge 730xd):\n\n  EDAC sbridge: Some needed devices are missing\n  EDAC MC: Removed device 0 for sb_edac.c Haswell SrcID#0_Ha#0: DEV 0000:7f:12.0\n  EDAC MC: Removed device 1 for sb_edac.c Haswell SrcID#1_Ha#0: DEV 0000:ff:12.0\n  EDAC sbridge: Couldn't find mci handler\n  EDAC sbridge: Couldn't find mci handler\n  EDAC sbridge: Failed to register device with error -19.\n\nThe refactored sb_edac driver creates the IMC1 (the 2nd memory\ncontroller) if any IMC1 device is present. In this case only\nHA1_TA of IMC1 was present, but the driver expected to find\nHA1/HA1_TM/HA1_TAD[0-3] devices too, leading to the above failure.\n\nThe document [1] says the 'E5-2603 v3' CPU has 4 memory channels max. Yi\nZhang inserted one DIMM per channel for each CPU, and did random error\naddress injection test with this patch:\n\n      4024  addresses fell in TOLM hole area\n     12715  addresses fell in CPU_SrcID#0_Ha#0_Chan#0_DIMM#0\n     12774  addresses fell in CPU_SrcID#0_Ha#0_Chan#1_DIMM#0\n     12798  addresses fell in CPU_SrcID#0_Ha#0_Chan#2_DIMM#0\n     12913  addresses fell in CPU_SrcID#0_Ha#0_Chan#3_DIMM#0\n     12674  addresses fell in CPU_SrcID#1_Ha#0_Chan#0_DIMM#0\n     12686  addresses fell in CPU_SrcID#1_Ha#0_Chan#1_DIMM#0\n     12882  addresses fell in CPU_SrcID#1_Ha#0_Chan#2_DIMM#0\n     12934  addresses fell in CPU_SrcID#1_Ha#0_Chan#3_DIMM#0\n    106400  addresses were injected totally.\n\nThe test result shows that all the 4 channels belong to IMC0 per CPU, so\nthe server really only has one IMC per CPU.\n\nIn the 1st page of chapter 2 in datasheet [2], it also says 'E5-2600 v3'\nimplements either one or two IMCs. For CPUs with one IMC, IMC1 is not\nused and should be ignored.\n\nThus, do not create a second memory controller if the key HA1 is absent.\n\n[1] http://ark.intel.com/products/83349/Intel-Xeon-Processor-E5-2603-v3-15M-Cache-1_60-GHz\n[2] https://www.intel.com/content/dam/www/public/us/en/documents/datasheets/xeon-e5-v3-datasheet-vol-2.pdf\n\nReported-and-tested-by: Yi Zhang <yizhan@redhat.com>\nSigned-off-by: Qiuxu Zhuo <qiuxu.zhuo@intel.com>\nCc: Tony Luck <tony.luck@intel.com>\nCc: linux-edac <linux-edac@vger.kernel.org>\nFixes: e2f747b1f42a (\"EDAC, sb_edac: Assign EDAC memory controller per h/w controller\")\nLink: http://lkml.kernel.org/r/20170913104214.7325-1-qiuxu.zhuo@intel.com\n[ Massage commit message. ]\nSigned-off-by: Borislav Petkov <bp@suse.de>",
  "author_name": "Qiuxu Zhuo",
  "author_email": "qiuxu.zhuo@intel.com",
  "author_date": "Wed Sep 13 18:42:14 2017 +0800",
  "author_date_iso": "2017-09-13T18:42:14+08:00",
  "committer_name": "Borislav Petkov",
  "committer_email": "bp@suse.de",
  "committer_date": "Wed Sep 27 12:15:43 2017 +0200",
  "committer_date_iso": "2017-09-27T12:15:43+02:00",
  "files_changed": [
    "drivers/edac/sb_edac.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/edac/sb_edac.c",
      "insertions": 8,
      "deletions": 1
    }
  ],
  "total_insertions": 8,
  "total_deletions": 1,
  "total_changes": 9,
  "parents": [
    "301375e764324b8048704eaf2c46fe1ee290830e"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.15",
    "v4.15-rc1",
    "v4.15-rc2",
    "v4.15-rc3",
    "v4.15-rc4",
    "v4.15-rc5",
    "v4.15-rc6",
    "v4.15-rc7",
    "v4.15-rc8",
    "v4.15-rc9"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/edac/sb_edac.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}