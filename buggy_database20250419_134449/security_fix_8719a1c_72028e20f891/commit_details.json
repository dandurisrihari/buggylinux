{
  "hash": "8719a1c30d3a1b4f347afca8e78be201d66d5c49",
  "hash_short": "8719a1c3",
  "subject": "bna: Avoid clashing function prototypes",
  "body": "When built with Control Flow Integrity, function prototypes between\ncaller and function declaration must match. These mismatches are visible\nat compile time with the new -Wcast-function-type-strict in Clang[1].\n\nFix a total of 227 warnings like these:\n\ndrivers/net/ethernet/brocade/bna/bna_enet.c:519:3: warning: cast from 'void (*)(struct bna_ethport *, enum bna_ethport_event)' to 'bfa_fsm_t' (aka 'void (*)(void *, int)') converts to incompatible function type [-Wcast-function-type-strict]\n                bfa_fsm_set_state(ethport, bna_ethport_sm_down);\n                ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\nThe bna state machine code heavily overloads its state machine functions,\nso these have been separated into their own sets of structs, enums,\ntypedefs, and helper functions. There are almost zero binary code changes,\nall seem to be related to header file line numbers changing, or the\naddition of the new stats helper.\n\nImportant to mention is that while I was manually implementing this changes\nI was staring at this[2] patch from Kees Cook. Thanks, Kees. :)\n\nLink: https://github.com/KSPP/linux/issues/240\n[1] https://reviews.llvm.org/D134831\n[2] https://lore.kernel.org/linux-hardening/20220929230334.2109344-1-keescook@chromium.org/\nReviewed-by: Kees Cook <keescook@chromium.org>\nSigned-off-by: Gustavo A. R. Silva <gustavoars@kernel.org>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
  "full_message": "bna: Avoid clashing function prototypes\n\nWhen built with Control Flow Integrity, function prototypes between\ncaller and function declaration must match. These mismatches are visible\nat compile time with the new -Wcast-function-type-strict in Clang[1].\n\nFix a total of 227 warnings like these:\n\ndrivers/net/ethernet/brocade/bna/bna_enet.c:519:3: warning: cast from 'void (*)(struct bna_ethport *, enum bna_ethport_event)' to 'bfa_fsm_t' (aka 'void (*)(void *, int)') converts to incompatible function type [-Wcast-function-type-strict]\n                bfa_fsm_set_state(ethport, bna_ethport_sm_down);\n                ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\nThe bna state machine code heavily overloads its state machine functions,\nso these have been separated into their own sets of structs, enums,\ntypedefs, and helper functions. There are almost zero binary code changes,\nall seem to be related to header file line numbers changing, or the\naddition of the new stats helper.\n\nImportant to mention is that while I was manually implementing this changes\nI was staring at this[2] patch from Kees Cook. Thanks, Kees. :)\n\nLink: https://github.com/KSPP/linux/issues/240\n[1] https://reviews.llvm.org/D134831\n[2] https://lore.kernel.org/linux-hardening/20220929230334.2109344-1-keescook@chromium.org/\nReviewed-by: Kees Cook <keescook@chromium.org>\nSigned-off-by: Gustavo A. R. Silva <gustavoars@kernel.org>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
  "author_name": "Gustavo A. R. Silva",
  "author_email": "gustavoars@kernel.org",
  "author_date": "Wed Nov 16 10:59:44 2022 -0600",
  "author_date_iso": "2022-11-16T10:59:44-06:00",
  "committer_name": "David S. Miller",
  "committer_email": "davem@davemloft.net",
  "committer_date": "Mon Nov 21 08:17:59 2022 +0000",
  "committer_date_iso": "2022-11-21T08:17:59+00:00",
  "files_changed": [
    "drivers/net/ethernet/brocade/bna/bfa_cs.h",
    "drivers/net/ethernet/brocade/bna/bfa_ioc.c",
    "drivers/net/ethernet/brocade/bna/bfa_ioc.h",
    "drivers/net/ethernet/brocade/bna/bfa_msgq.h",
    "drivers/net/ethernet/brocade/bna/bna_enet.c",
    "drivers/net/ethernet/brocade/bna/bna_tx_rx.c",
    "drivers/net/ethernet/brocade/bna/bna_types.h"
  ],
  "files_changed_count": 7,
  "stats": [
    {
      "file": "drivers/net/ethernet/brocade/bna/bfa_cs.h",
      "insertions": 38,
      "deletions": 22
    },
    {
      "file": "drivers/net/ethernet/brocade/bna/bfa_ioc.c",
      "insertions": 5,
      "deletions": 5
    },
    {
      "file": "drivers/net/ethernet/brocade/bna/bfa_ioc.h",
      "insertions": 6,
      "deletions": 2
    },
    {
      "file": "drivers/net/ethernet/brocade/bna/bfa_msgq.h",
      "insertions": 6,
      "deletions": 2
    },
    {
      "file": "drivers/net/ethernet/brocade/bna/bna_enet.c",
      "insertions": 3,
      "deletions": 3
    },
    {
      "file": "drivers/net/ethernet/brocade/bna/bna_tx_rx.c",
      "insertions": 3,
      "deletions": 3
    },
    {
      "file": "drivers/net/ethernet/brocade/bna/bna_types.h",
      "insertions": 21,
      "deletions": 6
    }
  ],
  "total_insertions": 82,
  "total_deletions": 43,
  "total_changes": 125,
  "parents": [
    "8bd8dcc5e47f0f9dc40187c3b8b42d992181eee1"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "hardening"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/net/ethernet/brocade/bna/bfa_cs.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/ethernet/brocade/bna/bfa_ioc.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/ethernet/brocade/bna/bna_types.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/ethernet/brocade/bna/bfa_msgq.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/ethernet/brocade/bna/bfa_ioc.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/ethernet/brocade/bna/bna_enet.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/ethernet/brocade/bna/bna_tx_rx.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}