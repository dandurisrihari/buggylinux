Commit Hash: 4c91307ce9387519836e17482906ef0f698ea7d9
Subject: i2c: uniphier: avoid WARN_ON() of clk_disable() in failure path


Security Keywords:
- exploit

Full commit message:
i2c: uniphier: avoid WARN_ON() of clk_disable() in failure path

If clk_prepare_enable() fails, clk_disable_unprepare() is called in
the failure path, where the enable_count is still zero, so it hits
WARN_ON(core->enable_count == 0) in the clk_core_disable().

To fix this, make the clock setting more linear in the probe function
so that it can exploit "goto err" in case of error.

Signed-off-by: Masahiro Yamada <yamada.masahiro@socionext.com>
Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

Metadata:
Author: Masahiro Yamada <yamada.masahiro@socionext.com>
Author Date: Thu Sep 1 20:46:28 2016 +0900
Committer: Wolfram Sang <wsa@the-dreams.de>
Commit Date: Thu Sep 8 22:40:32 2016 +0200

Files Changed: 1
Lines Added: 31
Lines Removed: 42
Total Changes: 73
