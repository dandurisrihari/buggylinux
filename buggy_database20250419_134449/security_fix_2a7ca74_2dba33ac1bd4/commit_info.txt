Commit Hash: 2a7ca7459d905febf519163bd9e3eed894de6bb7
Subject: Bluetooth: cmtp: fix possible panic when cmtp_init_sockets() fails


Security Keywords:
- injection

Full commit message:
Bluetooth: cmtp: fix possible panic when cmtp_init_sockets() fails

I got a kernel BUG report when doing fault injection test:

------------[ cut here ]------------
kernel BUG at lib/list_debug.c:45!
...
RIP: 0010:__list_del_entry_valid.cold+0x12/0x4d
...
Call Trace:
 proto_unregister+0x83/0x220
 cmtp_cleanup_sockets+0x37/0x40 [cmtp]
 cmtp_exit+0xe/0x1f [cmtp]
 do_syscall_64+0x35/0xb0
 entry_SYSCALL_64_after_hwframe+0x44/0xae

If cmtp_init_sockets() in cmtp_init() fails, cmtp_init() still returns
success. This will cause a kernel bug when accessing uncreated ctmp
related data when the module exits.

Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Reported-by: Hulk Robot <hulkci@huawei.com>
Signed-off-by: Wang Hai <wanghai38@huawei.com>
Signed-off-by: Marcel Holtmann <marcel@holtmann.org>

Metadata:
Author: Wang Hai <wanghai38@huawei.com>
Author Date: Mon Oct 25 21:10:12 2021 +0800
Committer: Marcel Holtmann <marcel@holtmann.org>
Commit Date: Mon Oct 25 15:02:04 2021 +0200

Files Changed: 1
Lines Added: 1
Lines Removed: 3
Total Changes: 4
