{
  "hash": "8d1b43f6a6df7bcea20982ad376a000d90906b42",
  "hash_short": "8d1b43f6",
  "subject": "tty: Restrict access to TIOCLINUX' copy-and-paste subcommands",
  "body": "TIOCLINUX can be used for privilege escalation on virtual terminals when\ncode is executed via tools like su/sudo and sandboxing tools.\n\nBy abusing the selection features, a lower-privileged application can\nwrite content to the console, select and copy/paste that content and\nthereby executing code on the privileged account. See also the poc\nhere:\n\n  https://www.openwall.com/lists/oss-security/2023/03/14/3\n\nSelection is usually used by tools like gpm that provide mouse features\non the virtual console. gpm already runs as root (due to earlier\nchanges that restrict access to a user on the current TTY), therefore\nit will still work with this change.\n\nWith this change, the following TIOCLINUX subcommands require\nCAP_SYS_ADMIN:\n\n * TIOCL_SETSEL - setting the selected region on the terminal\n * TIOCL_PASTESEL - pasting the contents of the selected region into\n   the input buffer\n * TIOCL_SELLOADLUT - changing word-by-word selection behaviour\n\nThe security problem mitigated is similar to the security risks caused\nby TIOCSTI, which, since kernel 6.2, can be disabled with\nCONFIG_LEGACY_TIOCSTI=n.\n\nSigned-off-by: Hanno B\u00f6ck <hanno@hboeck.de>\nSigned-off-by: G\u00fcnther Noack <gnoack@google.com>\nTested-by: G\u00fcnther Noack <gnoack@google.com>\nLink: https://lore.kernel.org/r/20230828164117.3608812-2-gnoack@google.com\nSigned-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>",
  "full_message": "tty: Restrict access to TIOCLINUX' copy-and-paste subcommands\n\nTIOCLINUX can be used for privilege escalation on virtual terminals when\ncode is executed via tools like su/sudo and sandboxing tools.\n\nBy abusing the selection features, a lower-privileged application can\nwrite content to the console, select and copy/paste that content and\nthereby executing code on the privileged account. See also the poc\nhere:\n\n  https://www.openwall.com/lists/oss-security/2023/03/14/3\n\nSelection is usually used by tools like gpm that provide mouse features\non the virtual console. gpm already runs as root (due to earlier\nchanges that restrict access to a user on the current TTY), therefore\nit will still work with this change.\n\nWith this change, the following TIOCLINUX subcommands require\nCAP_SYS_ADMIN:\n\n * TIOCL_SETSEL - setting the selected region on the terminal\n * TIOCL_PASTESEL - pasting the contents of the selected region into\n   the input buffer\n * TIOCL_SELLOADLUT - changing word-by-word selection behaviour\n\nThe security problem mitigated is similar to the security risks caused\nby TIOCSTI, which, since kernel 6.2, can be disabled with\nCONFIG_LEGACY_TIOCSTI=n.\n\nSigned-off-by: Hanno B\u00f6ck <hanno@hboeck.de>\nSigned-off-by: G\u00fcnther Noack <gnoack@google.com>\nTested-by: G\u00fcnther Noack <gnoack@google.com>\nLink: https://lore.kernel.org/r/20230828164117.3608812-2-gnoack@google.com\nSigned-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>",
  "author_name": "Hanno B\u00f6ck",
  "author_email": "hanno@hboeck.de",
  "author_date": "Mon Aug 28 18:41:17 2023 +0200",
  "author_date_iso": "2023-08-28T18:41:17+02:00",
  "committer_name": "Greg Kroah-Hartman",
  "committer_email": "gregkh@linuxfoundation.org",
  "committer_date": "Thu Oct 5 11:24:43 2023 +0200",
  "committer_date_iso": "2023-10-05T11:24:43+02:00",
  "files_changed": [
    "drivers/tty/vt/vt.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/tty/vt/vt.c",
      "insertions": 6,
      "deletions": 0
    }
  ],
  "total_insertions": 6,
  "total_deletions": 0,
  "total_changes": 6,
  "parents": [
    "7cda0b9eb6eb9e761f452e2ef4e81eca20b19938"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "privilege escalation"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/tty/vt/vt.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}