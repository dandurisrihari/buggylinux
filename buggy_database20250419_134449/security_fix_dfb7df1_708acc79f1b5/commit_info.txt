Commit Hash: dfb7df1ddb29c89662e84b2c82c1ff7943358ae0
Subject: scsi: target: Replace deprecated strncpy() with strscpy()


Security Keywords:
- hardening

Full commit message:
scsi: target: Replace deprecated strncpy() with strscpy()

strncpy() is deprecated for NUL-terminated destination buffers; use
strscpy() instead. The destination buffer db_root is only used with "%s"
format strings and must therefore be NUL-terminated, but not NUL-padded.

Use scnprintf() because snprintf() could return a value >= DB_ROOT_LEN
and lead to an out-of-bounds access. This doesn't happen because count
is explicitly checked against DB_ROOT_LEN before. However, scnprintf()
always returns the number of characters actually written to the string
buffer, which is always within the bounds of db_root_stage, and should
be preferred over snprintf().

The size parameter of strscpy() is optional and since DB_ROOT_LEN is the
size of the destination buffer, it can be removed. Remove it to simplify
the code.

Compile-tested only.

Link: https://github.com/KSPP/linux/issues/90
Link: https://github.com/KSPP/linux/issues/105
Cc: linux-hardening@vger.kernel.org
Signed-off-by: Thorsten Blum <thorsten.blum@linux.dev>
Link: https://lore.kernel.org/r/20250302225641.245127-2-thorsten.blum@linux.dev
Reviewed-by: Kees Cook <kees@kernel.org>
Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>

Metadata:
Author: Thorsten Blum <thorsten.blum@linux.dev>
Author Date: Sun Mar 2 23:56:41 2025 +0100
Committer: Martin K. Petersen <martin.petersen@oracle.com>
Commit Date: Mon Mar 3 22:11:48 2025 -0500

Files Changed: 1
Lines Added: 3
Lines Removed: 3
Total Changes: 6
