{
  "hash": "45888b40d2a6221d46bb69959e2600ddba71cc1f",
  "hash_short": "45888b40",
  "subject": "rslib: Allocate decoder buffers to avoid VLAs",
  "body": "To get rid of the variable length arrays on stack in the RS decoder it's\nnecessary to allocate the decoder buffers per control structure instance.\n\nAll usage sites have been checked for potential parallel decoder usage and\nfixed where necessary. Kees confirmed that the pstore decoding is strictly\nsingle threaded so there should be no surprises.\n\nAllocate them in the rs control structure sized depending on the number of\nroots for the chosen codec and adapt the decoder code to make use of them.\n\nDocument the fact that decode operations based on a particular rs control\ninstance cannot run in parallel and the caller has to ensure that as it's\nnot possible to provide a proper locking construct which fits all use\ncases.\n\nSigned-off-by: Thomas Gleixner <tglx@linutronix.de>\nAcked-by: Kees Cook <keescook@chromium.org>\nCc: Boris Brezillon <boris.brezillon@free-electrons.com>\nCc: Tony Luck <tony.luck@intel.com>\nCc: Segher Boessenkool <segher@kernel.crashing.org>\nCc: Kernel Hardening <kernel-hardening@lists.openwall.com>\nCc: Richard Weinberger <richard@nod.at>\nCc: Mike Snitzer <snitzer@redhat.com>\nCc: Anton Vorontsov <anton@enomsg.org>\nCc: Colin Cross <ccross@android.com>\nCc: Andrew Morton <akpm@linuxfoundation.org>\nCc: David Woodhouse <dwmw2@infradead.org>\nCc: Alasdair Kergon <agk@redhat.com>\nSigned-off-by: Kees Cook <keescook@chromium.org>",
  "full_message": "rslib: Allocate decoder buffers to avoid VLAs\n\nTo get rid of the variable length arrays on stack in the RS decoder it's\nnecessary to allocate the decoder buffers per control structure instance.\n\nAll usage sites have been checked for potential parallel decoder usage and\nfixed where necessary. Kees confirmed that the pstore decoding is strictly\nsingle threaded so there should be no surprises.\n\nAllocate them in the rs control structure sized depending on the number of\nroots for the chosen codec and adapt the decoder code to make use of them.\n\nDocument the fact that decode operations based on a particular rs control\ninstance cannot run in parallel and the caller has to ensure that as it's\nnot possible to provide a proper locking construct which fits all use\ncases.\n\nSigned-off-by: Thomas Gleixner <tglx@linutronix.de>\nAcked-by: Kees Cook <keescook@chromium.org>\nCc: Boris Brezillon <boris.brezillon@free-electrons.com>\nCc: Tony Luck <tony.luck@intel.com>\nCc: Segher Boessenkool <segher@kernel.crashing.org>\nCc: Kernel Hardening <kernel-hardening@lists.openwall.com>\nCc: Richard Weinberger <richard@nod.at>\nCc: Mike Snitzer <snitzer@redhat.com>\nCc: Anton Vorontsov <anton@enomsg.org>\nCc: Colin Cross <ccross@android.com>\nCc: Andrew Morton <akpm@linuxfoundation.org>\nCc: David Woodhouse <dwmw2@infradead.org>\nCc: Alasdair Kergon <agk@redhat.com>\nSigned-off-by: Kees Cook <keescook@chromium.org>",
  "author_name": "Thomas Gleixner",
  "author_email": "tglx@linutronix.de",
  "author_date": "Sun Apr 22 18:23:55 2018 +0200",
  "author_date_iso": "2018-04-22T18:23:55+02:00",
  "committer_name": "Kees Cook",
  "committer_email": "keescook@chromium.org",
  "committer_date": "Tue Apr 24 19:50:10 2018 -0700",
  "committer_date_iso": "2018-04-24T19:50:10-07:00",
  "files_changed": [
    "include/linux/rslib.h",
    "lib/reed_solomon/decode_rs.c",
    "lib/reed_solomon/reed_solomon.c"
  ],
  "files_changed_count": 3,
  "stats": [
    {
      "file": "include/linux/rslib.h",
      "insertions": 2,
      "deletions": 0
    },
    {
      "file": "lib/reed_solomon/decode_rs.c",
      "insertions": 13,
      "deletions": 7
    },
    {
      "file": "lib/reed_solomon/reed_solomon.c",
      "insertions": 30,
      "deletions": 1
    }
  ],
  "total_insertions": 45,
  "total_deletions": 8,
  "total_changes": 53,
  "parents": [
    "964dfce9c2b323a9a9d0bd6764e0f530b40104e4"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.18",
    "v4.18-rc1",
    "v4.18-rc2",
    "v4.18-rc3",
    "v4.18-rc4",
    "v4.18-rc5",
    "v4.18-rc6",
    "v4.18-rc7",
    "v4.18-rc8",
    "v4.19"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "Hardening"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "include/linux/rslib.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "lib/reed_solomon/decode_rs.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "lib/reed_solomon/reed_solomon.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}