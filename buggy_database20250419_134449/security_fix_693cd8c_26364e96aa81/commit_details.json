{
  "hash": "693cd8ce3f882524a5d06f7800dd8492411877b3",
  "hash_short": "693cd8ce",
  "subject": "Bluetooth: Fix regression with minimum encryption key size alignment",
  "body": "When trying to align the minimum encryption key size requirement for\nBluetooth connections, it turns out doing this in a central location in\nthe HCI connection handling code is not possible.\n\nOriginal Bluetooth version up to 2.0 used a security model where the\nL2CAP service would enforce authentication and encryption.  Starting\nwith Bluetooth 2.1 and Secure Simple Pairing that model has changed into\nthat the connection initiator is responsible for providing an encrypted\nACL link before any L2CAP communication can happen.\n\nNow connecting Bluetooth 2.1 or later devices with Bluetooth 2.0 and\nbefore devices are causing a regression.  The encryption key size check\nneeds to be moved out of the HCI connection handling into the L2CAP\nchannel setup.\n\nTo achieve this, the current check inside hci_conn_security() has been\nmoved into l2cap_check_enc_key_size() helper function and then called\nfrom four decisions point inside L2CAP to cover all combinations of\nSecure Simple Pairing enabled devices and device using legacy pairing\nand legacy service security model.\n\nFixes: d5bb334a8e17 (\"Bluetooth: Align minimum encryption key size for LE and BR/EDR connections\")\nBugzilla: https://bugzilla.kernel.org/show_bug.cgi?id=203643\nSigned-off-by: Marcel Holtmann <marcel@holtmann.org>\nCc: stable@vger.kernel.org\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
  "full_message": "Bluetooth: Fix regression with minimum encryption key size alignment\n\nWhen trying to align the minimum encryption key size requirement for\nBluetooth connections, it turns out doing this in a central location in\nthe HCI connection handling code is not possible.\n\nOriginal Bluetooth version up to 2.0 used a security model where the\nL2CAP service would enforce authentication and encryption.  Starting\nwith Bluetooth 2.1 and Secure Simple Pairing that model has changed into\nthat the connection initiator is responsible for providing an encrypted\nACL link before any L2CAP communication can happen.\n\nNow connecting Bluetooth 2.1 or later devices with Bluetooth 2.0 and\nbefore devices are causing a regression.  The encryption key size check\nneeds to be moved out of the HCI connection handling into the L2CAP\nchannel setup.\n\nTo achieve this, the current check inside hci_conn_security() has been\nmoved into l2cap_check_enc_key_size() helper function and then called\nfrom four decisions point inside L2CAP to cover all combinations of\nSecure Simple Pairing enabled devices and device using legacy pairing\nand legacy service security model.\n\nFixes: d5bb334a8e17 (\"Bluetooth: Align minimum encryption key size for LE and BR/EDR connections\")\nBugzilla: https://bugzilla.kernel.org/show_bug.cgi?id=203643\nSigned-off-by: Marcel Holtmann <marcel@holtmann.org>\nCc: stable@vger.kernel.org\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
  "author_name": "Marcel Holtmann",
  "author_email": "marcel@holtmann.org",
  "author_date": "Sat Jun 22 15:47:01 2019 +0200",
  "author_date_iso": "2019-06-22T15:47:01+02:00",
  "committer_name": "Linus Torvalds",
  "committer_email": "torvalds@linux-foundation.org",
  "committer_date": "Sat Jun 22 09:07:39 2019 -0700",
  "committer_date_iso": "2019-06-22T09:07:39-07:00",
  "files_changed": [
    "net/bluetooth/hci_conn.c",
    "net/bluetooth/l2cap_core.c"
  ],
  "files_changed_count": 2,
  "stats": [
    {
      "file": "net/bluetooth/hci_conn.c",
      "insertions": 9,
      "deletions": 9
    },
    {
      "file": "net/bluetooth/l2cap_core.c",
      "insertions": 28,
      "deletions": 5
    }
  ],
  "total_insertions": 37,
  "total_deletions": 14,
  "total_changes": 51,
  "parents": [
    "c356dc4b540edd6c02b409dd8cf3208ba2804c38"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v5.2",
    "v5.2-rc6",
    "v5.2-rc7",
    "v5.3",
    "v5.3-rc1",
    "v5.3-rc2",
    "v5.3-rc3",
    "v5.3-rc4",
    "v5.3-rc5",
    "v5.3-rc6"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "authentication"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "net/bluetooth/hci_conn.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "net/bluetooth/l2cap_core.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}