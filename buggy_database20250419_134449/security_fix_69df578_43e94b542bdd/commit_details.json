{
  "hash": "69df578c5f4b1f9d9b649e5fb06b5d337c25d27f",
  "hash_short": "69df578c",
  "subject": "net: mscc: ocelot: eliminate confusion between CPU and NPI port",
  "body": "Ocelot has the concept of a CPU port. The CPU port is represented in the\nforwarding and the queueing system, but it is not a physical device. The\nCPU port can either be accessed via register-based injection/extraction\n(which is the case of Ocelot), via Frame-DMA (similar to the first one),\nor \"connected\" to a physical Ethernet port (called NPI in the datasheet)\nwhich is the case of the Felix DSA switch.\n\nIn Ocelot the CPU port is at index 11.\nIn Felix the CPU port is at index 6.\n\nThe CPU bit is treated special in the forwarding, as it is never cleared\nfrom the forwarding port mask (once added to it). Other than that, it is\ntreated the same as a normal front port.\n\nBoth Felix and Ocelot should use the CPU port in the same way. This\nmeans that Felix should not use the NPI port directly when forwarding to\nthe CPU, but instead use the CPU port.\n\nThis patch is fixing this such that Felix will use port 6 as its CPU\nport, and just use the NPI port to carry the traffic.\n\nTherefore, eliminate the \"ocelot->cpu\" variable which was holding the\nindex of the NPI port for Felix, and the index of the CPU port module\nfor Ocelot, so the variable was actually configuring different things\nfor different drivers and causing at least part of the confusion.\n\nAlso remove the \"ocelot->num_cpu_ports\" variable, which is the result of\nanother confusion. The 2 CPU ports mentioned in the datasheet are\nbecause there are two frame extraction channels (register based or DMA\nbased). This is of no relevance to the driver at the moment, and\ninvisible to the analyzer module.\n\nSigned-off-by: Vladimir Oltean <vladimir.oltean@nxp.com>\nSuggested-by: Allan W. Nielsen <allan.nielsen@microchip.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
  "full_message": "net: mscc: ocelot: eliminate confusion between CPU and NPI port\n\nOcelot has the concept of a CPU port. The CPU port is represented in the\nforwarding and the queueing system, but it is not a physical device. The\nCPU port can either be accessed via register-based injection/extraction\n(which is the case of Ocelot), via Frame-DMA (similar to the first one),\nor \"connected\" to a physical Ethernet port (called NPI in the datasheet)\nwhich is the case of the Felix DSA switch.\n\nIn Ocelot the CPU port is at index 11.\nIn Felix the CPU port is at index 6.\n\nThe CPU bit is treated special in the forwarding, as it is never cleared\nfrom the forwarding port mask (once added to it). Other than that, it is\ntreated the same as a normal front port.\n\nBoth Felix and Ocelot should use the CPU port in the same way. This\nmeans that Felix should not use the NPI port directly when forwarding to\nthe CPU, but instead use the CPU port.\n\nThis patch is fixing this such that Felix will use port 6 as its CPU\nport, and just use the NPI port to carry the traffic.\n\nTherefore, eliminate the \"ocelot->cpu\" variable which was holding the\nindex of the NPI port for Felix, and the index of the CPU port module\nfor Ocelot, so the variable was actually configuring different things\nfor different drivers and causing at least part of the confusion.\n\nAlso remove the \"ocelot->num_cpu_ports\" variable, which is the result of\nanother confusion. The 2 CPU ports mentioned in the datasheet are\nbecause there are two frame extraction channels (register based or DMA\nbased). This is of no relevance to the driver at the moment, and\ninvisible to the analyzer module.\n\nSigned-off-by: Vladimir Oltean <vladimir.oltean@nxp.com>\nSuggested-by: Allan W. Nielsen <allan.nielsen@microchip.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
  "author_name": "Vladimir Oltean",
  "author_email": "vladimir.oltean@nxp.com",
  "author_date": "Sat Feb 29 16:50:02 2020 +0200",
  "author_date_iso": "2020-02-29T16:50:02+02:00",
  "committer_name": "David S. Miller",
  "committer_email": "davem@davemloft.net",
  "committer_date": "Wed Mar 4 14:19:00 2020 -0800",
  "committer_date_iso": "2020-03-04T14:19:00-08:00",
  "files_changed": [
    "drivers/net/dsa/ocelot/felix.c",
    "drivers/net/ethernet/mscc/ocelot.c",
    "drivers/net/ethernet/mscc/ocelot_board.c",
    "include/soc/mscc/ocelot.h",
    "net/dsa/tag_ocelot.c"
  ],
  "files_changed_count": 5,
  "stats": [
    {
      "file": "drivers/net/dsa/ocelot/felix.c",
      "insertions": 4,
      "deletions": 3
    },
    {
      "file": "drivers/net/ethernet/mscc/ocelot.c",
      "insertions": 36,
      "deletions": 26
    },
    {
      "file": "drivers/net/ethernet/mscc/ocelot_board.c",
      "insertions": 3,
      "deletions": 4
    },
    {
      "file": "include/soc/mscc/ocelot.h",
      "insertions": 7,
      "deletions": 5
    },
    {
      "file": "net/dsa/tag_ocelot.c",
      "insertions": 2,
      "deletions": 1
    }
  ],
  "total_insertions": 52,
  "total_deletions": 39,
  "total_changes": 91,
  "parents": [
    "f6f8ef9a8691c8709f67beefdaff2807a949f25f"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v5.7-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/net/dsa/ocelot/felix.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/ethernet/mscc/ocelot.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/ethernet/mscc/ocelot_board.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/soc/mscc/ocelot.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "net/dsa/tag_ocelot.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}