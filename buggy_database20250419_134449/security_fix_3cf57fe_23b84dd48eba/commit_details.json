{
  "hash": "3cf57fed216e2c1b6fdfeccb792650bab72a350a",
  "hash_short": "3cf57fed",
  "subject": "KVM: PIT: fix injection logic and count",
  "body": "The PIT injection logic is problematic under the following cases:\n\n1) If there is a higher priority vector to be delivered by the time\nkvm_pit_timer_intr_post is invoked ps->inject_pending won't be set.\nThis opens the possibility for missing many PIT event injections (say if\nguest executes hlt at this point).\n\n2) ps->inject_pending is racy with more than two vcpus. Since there's no locking\naround read/dec of pt->pending, two vcpu's can inject two interrupts for a single\npt->pending count.\n\nFix 1 by using an irq ack notifier: only reinject when the previous irq\nhas been acked. Fix 2 with appropriate locking around manipulation of\npending count and irq_ack by the injection / ack paths.\n\nSigned-off-by: Marcelo Tosatti <mtosatti@redhat.com>\nSigned-off-by: Avi Kivity <avi@qumranet.com>",
  "full_message": "KVM: PIT: fix injection logic and count\n\nThe PIT injection logic is problematic under the following cases:\n\n1) If there is a higher priority vector to be delivered by the time\nkvm_pit_timer_intr_post is invoked ps->inject_pending won't be set.\nThis opens the possibility for missing many PIT event injections (say if\nguest executes hlt at this point).\n\n2) ps->inject_pending is racy with more than two vcpus. Since there's no locking\naround read/dec of pt->pending, two vcpu's can inject two interrupts for a single\npt->pending count.\n\nFix 1 by using an irq ack notifier: only reinject when the previous irq\nhas been acked. Fix 2 with appropriate locking around manipulation of\npending count and irq_ack by the injection / ack paths.\n\nSigned-off-by: Marcelo Tosatti <mtosatti@redhat.com>\nSigned-off-by: Avi Kivity <avi@qumranet.com>",
  "author_name": "Marcelo Tosatti",
  "author_email": "mtosatti@redhat.com",
  "author_date": "Sat Jul 26 17:01:01 2008 -0300",
  "author_date_iso": "2008-07-26T17:01:01-03:00",
  "committer_name": "Avi Kivity",
  "committer_email": "avi@qumranet.com",
  "committer_date": "Wed Oct 15 10:15:17 2008 +0200",
  "committer_date_iso": "2008-10-15T10:15:17+02:00",
  "files_changed": [
    "arch/x86/kvm/i8254.c",
    "arch/x86/kvm/i8254.h",
    "arch/x86/kvm/irq.c"
  ],
  "files_changed_count": 3,
  "stats": [
    {
      "file": "arch/x86/kvm/i8254.c",
      "insertions": 35,
      "deletions": 35
    },
    {
      "file": "arch/x86/kvm/i8254.h",
      "insertions": 3,
      "deletions": 4
    },
    {
      "file": "arch/x86/kvm/irq.c",
      "insertions": 0,
      "deletions": 1
    }
  ],
  "total_insertions": 38,
  "total_deletions": 40,
  "total_changes": 78,
  "parents": [
    "f52447261bc8c21dfd4635196e32d2da1352f589"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v2.6.28",
    "v2.6.28-rc1",
    "v2.6.28-rc2",
    "v2.6.28-rc3",
    "v2.6.28-rc4",
    "v2.6.28-rc5",
    "v2.6.28-rc6",
    "v2.6.28-rc7",
    "v2.6.28-rc8",
    "v2.6.28-rc9"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/x86/kvm/i8254.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kvm/i8254.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kvm/irq.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}