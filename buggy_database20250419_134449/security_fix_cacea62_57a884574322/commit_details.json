{
  "hash": "cacea62fcdda5656cb5b8104e73a00e043b61730",
  "hash_short": "cacea62f",
  "subject": "net: mscc: ocelot: don't use NPI tag prefix for the CPU port module",
  "body": "Context: Ocelot switches put the injection/extraction frame header in\nfront of the Ethernet header. When used in NPI mode, a DSA master would\nsee junk instead of the destination MAC address, and it would most\nlikely drop the packets. So the Ocelot frame header can have an optional\nprefix, which is just \"ff:ff:ff:ff:ff:fe > ff:ff:ff:ff:ff:ff\" padding\nput before the actual tag (still before the real Ethernet header) such\nthat the DSA master thinks it's looking at a broadcast frame with a\nstrange EtherType.\n\nUnfortunately, a lesson learned in commit 69df578c5f4b (\"net: mscc:\nocelot: eliminate confusion between CPU and NPI port\") seems to have\nbeen forgotten in the meanwhile.\n\nThe CPU port module and the NPI port have independent settings for the\nlength of the tag prefix. However, the driver is using the same variable\nto program both of them.\n\nThere is no reason really to use any tag prefix with the CPU port\nmodule, since that is not connected to any Ethernet port. So this patch\nmakes the inj_prefix and xtr_prefix variables apply only to the NPI\nport (which the switchdev ocelot_vsc7514 driver does not use).\n\nSigned-off-by: Vladimir Oltean <vladimir.oltean@nxp.com>\nReviewed-by: Florian Fainelli <f.fainelli@gmail.com>\nSigned-off-by: Jakub Kicinski <kuba@kernel.org>",
  "full_message": "net: mscc: ocelot: don't use NPI tag prefix for the CPU port module\n\nContext: Ocelot switches put the injection/extraction frame header in\nfront of the Ethernet header. When used in NPI mode, a DSA master would\nsee junk instead of the destination MAC address, and it would most\nlikely drop the packets. So the Ocelot frame header can have an optional\nprefix, which is just \"ff:ff:ff:ff:ff:fe > ff:ff:ff:ff:ff:ff\" padding\nput before the actual tag (still before the real Ethernet header) such\nthat the DSA master thinks it's looking at a broadcast frame with a\nstrange EtherType.\n\nUnfortunately, a lesson learned in commit 69df578c5f4b (\"net: mscc:\nocelot: eliminate confusion between CPU and NPI port\") seems to have\nbeen forgotten in the meanwhile.\n\nThe CPU port module and the NPI port have independent settings for the\nlength of the tag prefix. However, the driver is using the same variable\nto program both of them.\n\nThere is no reason really to use any tag prefix with the CPU port\nmodule, since that is not connected to any Ethernet port. So this patch\nmakes the inj_prefix and xtr_prefix variables apply only to the NPI\nport (which the switchdev ocelot_vsc7514 driver does not use).\n\nSigned-off-by: Vladimir Oltean <vladimir.oltean@nxp.com>\nReviewed-by: Florian Fainelli <f.fainelli@gmail.com>\nSigned-off-by: Jakub Kicinski <kuba@kernel.org>",
  "author_name": "Vladimir Oltean",
  "author_email": "vladimir.oltean@nxp.com",
  "author_date": "Fri Jan 29 03:00:03 2021 +0200",
  "author_date_iso": "2021-01-29T03:00:03+02:00",
  "committer_name": "Jakub Kicinski",
  "committer_email": "kuba@kernel.org",
  "committer_date": "Fri Jan 29 21:24:30 2021 -0800",
  "committer_date_iso": "2021-01-29T21:24:30-08:00",
  "files_changed": [
    "drivers/net/dsa/ocelot/felix.c",
    "drivers/net/ethernet/mscc/ocelot.c",
    "drivers/net/ethernet/mscc/ocelot_vsc7514.c",
    "include/soc/mscc/ocelot.h"
  ],
  "files_changed_count": 4,
  "stats": [
    {
      "file": "drivers/net/dsa/ocelot/felix.c",
      "insertions": 4,
      "deletions": 4
    },
    {
      "file": "drivers/net/ethernet/mscc/ocelot.c",
      "insertions": 6,
      "deletions": 6
    },
    {
      "file": "drivers/net/ethernet/mscc/ocelot_vsc7514.c",
      "insertions": 0,
      "deletions": 2
    },
    {
      "file": "include/soc/mscc/ocelot.h",
      "insertions": 2,
      "deletions": 2
    }
  ],
  "total_insertions": 12,
  "total_deletions": 14,
  "total_changes": 26,
  "parents": [
    "9b521250bff4dd04592651bb8fab07ecfcd2fb64"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/net/dsa/ocelot/felix.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/ethernet/mscc/ocelot.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/ethernet/mscc/ocelot_vsc7514.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/soc/mscc/ocelot.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}