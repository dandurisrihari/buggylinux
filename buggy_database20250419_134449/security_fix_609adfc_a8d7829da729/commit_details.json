{
  "hash": "609adfc2ed5ba16700f125da0b656248bd9d4316",
  "hash_short": "609adfc2",
  "subject": "xfs: debug mode log record crc error injection",
  "body": "XFS now uses CRC verification over a limited section of the log to\ndetect torn writes prior to a crash. This is difficult to test directly\ndue to the timing and hardware requirements to cause a short write.\n\nAdd a mechanism to inject CRC errors into log records to facilitate\ntesting torn write detection during log recovery. This mechanism is\ndangerous and can result in filesystem corruption. Thus, it is only\navailable in DEBUG mode for testing/development purposes. Set a non-zero\nvalue to the following sysfs entry to enable error injection:\n\n\t/sys/fs/xfs/<dev>/log/log_badcrc_factor\n\nOnce enabled, XFS intentionally writes an invalid CRC to a log record at\nsome random point in the future based on the provided frequency. The\nfilesystem immediately shuts down once the record has been written to\nthe physical log to prevent metadata writeback (e.g., AIL insertion)\nonce the log write completes. This helps reasonably simulate a torn\nwrite to the log as the affected record must be safe to discard. The\nnext mount after the intentional shutdown requires log recovery and\nshould detect and recover from the torn write.\n\nNote again that this _will_ result in data loss or worse. For testing\nand development purposes only!\n\nSigned-off-by: Brian Foster <bfoster@redhat.com>\nReviewed-by: Dave Chinner <dchinner@redhat.com>\nSigned-off-by: Dave Chinner <david@fromorbit.com>",
  "full_message": "xfs: debug mode log record crc error injection\n\nXFS now uses CRC verification over a limited section of the log to\ndetect torn writes prior to a crash. This is difficult to test directly\ndue to the timing and hardware requirements to cause a short write.\n\nAdd a mechanism to inject CRC errors into log records to facilitate\ntesting torn write detection during log recovery. This mechanism is\ndangerous and can result in filesystem corruption. Thus, it is only\navailable in DEBUG mode for testing/development purposes. Set a non-zero\nvalue to the following sysfs entry to enable error injection:\n\n\t/sys/fs/xfs/<dev>/log/log_badcrc_factor\n\nOnce enabled, XFS intentionally writes an invalid CRC to a log record at\nsome random point in the future based on the provided frequency. The\nfilesystem immediately shuts down once the record has been written to\nthe physical log to prevent metadata writeback (e.g., AIL insertion)\nonce the log write completes. This helps reasonably simulate a torn\nwrite to the log as the affected record must be safe to discard. The\nnext mount after the intentional shutdown requires log recovery and\nshould detect and recover from the torn write.\n\nNote again that this _will_ result in data loss or worse. For testing\nand development purposes only!\n\nSigned-off-by: Brian Foster <bfoster@redhat.com>\nReviewed-by: Dave Chinner <dchinner@redhat.com>\nSigned-off-by: Dave Chinner <david@fromorbit.com>",
  "author_name": "Brian Foster",
  "author_email": "bfoster@redhat.com",
  "author_date": "Tue Jan 5 07:41:16 2016 +1100",
  "author_date_iso": "2016-01-05T07:41:16+11:00",
  "committer_name": "Dave Chinner",
  "committer_email": "david@fromorbit.com",
  "committer_date": "Tue Jan 5 07:41:16 2016 +1100",
  "committer_date_iso": "2016-01-05T07:41:16+11:00",
  "files_changed": [
    "fs/xfs/xfs_log.c",
    "fs/xfs/xfs_log_priv.h",
    "fs/xfs/xfs_sysfs.c"
  ],
  "files_changed_count": 3,
  "stats": [
    {
      "file": "fs/xfs/xfs_log.c",
      "insertions": 38,
      "deletions": 7
    },
    {
      "file": "fs/xfs/xfs_log_priv.h",
      "insertions": 3,
      "deletions": 0
    },
    {
      "file": "fs/xfs/xfs_sysfs.c",
      "insertions": 36,
      "deletions": 0
    }
  ],
  "total_insertions": 77,
  "total_deletions": 7,
  "total_changes": 84,
  "parents": [
    "7088c4136fa1cba26531fde40bdcfcf3d2ccd533"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.10",
    "v4.10-rc1",
    "v4.10-rc2",
    "v4.10-rc3",
    "v4.10-rc4",
    "v4.10-rc5",
    "v4.10-rc6",
    "v4.10-rc7",
    "v4.10-rc8",
    "v4.11"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "fs/xfs/xfs_log.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "fs/xfs/xfs_log_priv.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "fs/xfs/xfs_sysfs.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}