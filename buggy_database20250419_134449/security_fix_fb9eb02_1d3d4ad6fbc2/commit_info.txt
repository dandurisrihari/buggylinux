Commit Hash: fb9eb027fbc90e21cbda18379d85f8603e1f28b9
Subject: net: lan966x: Improve the CPU TX bitrate.


Security Keywords:
- injection

Full commit message:
net: lan966x: Improve the CPU TX bitrate.

When doing manual injection of the frame, it is required to check if the
TX FIFO is ready to accept the next word of the frame. For this we are
using 'readx_poll_timeout_atomic', the only problem is that before it
actually checks the status, is determining the time when to finish polling
the status. Which seems to be an expensive operation.
Therefore check the status of the TX FIFO before calling
'readx_poll_timeout_atomic'.
Doing this will improve the TX bitrate by ~70%. Because 99% the FIFO is
ready by that time. The measurements were done using iperf3.

Before:
[ ID] Interval           Transfer     Bitrate         Retr
[  5]   0.00-10.03  sec  55.2 MBytes  46.2 Mbits/sec    0 sender
[  5]   0.00-10.04  sec  53.8 MBytes  45.0 Mbits/sec      receiver

After:
[ ID] Interval           Transfer     Bitrate         Retr
[  5]   0.00-10.10  sec  95.0 MBytes  78.9 Mbits/sec    0 sender
[  5]   0.00-10.11  sec  95.0 MBytes  78.8 Mbits/sec      receiver

Signed-off-by: Horatiu Vultur <horatiu.vultur@microchip.com>
Reviewed-by: Andrew Lunn <andrew@lunn.ch>
Signed-off-by: David S. Miller <davem@davemloft.net>

Metadata:
Author: Horatiu Vultur <horatiu.vultur@microchip.com>
Author Date: Thu Mar 10 09:40:05 2022 +0100
Committer: David S. Miller <davem@davemloft.net>
Commit Date: Fri Mar 11 11:13:09 2022 +0000

Files Changed: 1
Lines Added: 3
Lines Removed: 0
Total Changes: 3
