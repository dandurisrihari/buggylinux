{
  "hash": "fb9eb027fbc90e21cbda18379d85f8603e1f28b9",
  "hash_short": "fb9eb027",
  "subject": "net: lan966x: Improve the CPU TX bitrate.",
  "body": "When doing manual injection of the frame, it is required to check if the\nTX FIFO is ready to accept the next word of the frame. For this we are\nusing 'readx_poll_timeout_atomic', the only problem is that before it\nactually checks the status, is determining the time when to finish polling\nthe status. Which seems to be an expensive operation.\nTherefore check the status of the TX FIFO before calling\n'readx_poll_timeout_atomic'.\nDoing this will improve the TX bitrate by ~70%. Because 99% the FIFO is\nready by that time. The measurements were done using iperf3.\n\nBefore:\n[ ID] Interval           Transfer     Bitrate         Retr\n[  5]   0.00-10.03  sec  55.2 MBytes  46.2 Mbits/sec    0 sender\n[  5]   0.00-10.04  sec  53.8 MBytes  45.0 Mbits/sec      receiver\n\nAfter:\n[ ID] Interval           Transfer     Bitrate         Retr\n[  5]   0.00-10.10  sec  95.0 MBytes  78.9 Mbits/sec    0 sender\n[  5]   0.00-10.11  sec  95.0 MBytes  78.8 Mbits/sec      receiver\n\nSigned-off-by: Horatiu Vultur <horatiu.vultur@microchip.com>\nReviewed-by: Andrew Lunn <andrew@lunn.ch>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
  "full_message": "net: lan966x: Improve the CPU TX bitrate.\n\nWhen doing manual injection of the frame, it is required to check if the\nTX FIFO is ready to accept the next word of the frame. For this we are\nusing 'readx_poll_timeout_atomic', the only problem is that before it\nactually checks the status, is determining the time when to finish polling\nthe status. Which seems to be an expensive operation.\nTherefore check the status of the TX FIFO before calling\n'readx_poll_timeout_atomic'.\nDoing this will improve the TX bitrate by ~70%. Because 99% the FIFO is\nready by that time. The measurements were done using iperf3.\n\nBefore:\n[ ID] Interval           Transfer     Bitrate         Retr\n[  5]   0.00-10.03  sec  55.2 MBytes  46.2 Mbits/sec    0 sender\n[  5]   0.00-10.04  sec  53.8 MBytes  45.0 Mbits/sec      receiver\n\nAfter:\n[ ID] Interval           Transfer     Bitrate         Retr\n[  5]   0.00-10.10  sec  95.0 MBytes  78.9 Mbits/sec    0 sender\n[  5]   0.00-10.11  sec  95.0 MBytes  78.8 Mbits/sec      receiver\n\nSigned-off-by: Horatiu Vultur <horatiu.vultur@microchip.com>\nReviewed-by: Andrew Lunn <andrew@lunn.ch>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
  "author_name": "Horatiu Vultur",
  "author_email": "horatiu.vultur@microchip.com",
  "author_date": "Thu Mar 10 09:40:05 2022 +0100",
  "author_date_iso": "2022-03-10T09:40:05+01:00",
  "committer_name": "David S. Miller",
  "committer_email": "davem@davemloft.net",
  "committer_date": "Fri Mar 11 11:13:09 2022 +0000",
  "committer_date_iso": "2022-03-11T11:13:09+00:00",
  "files_changed": [
    "drivers/net/ethernet/microchip/lan966x/lan966x_main.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/net/ethernet/microchip/lan966x/lan966x_main.c",
      "insertions": 3,
      "deletions": 0
    }
  ],
  "total_insertions": 3,
  "total_deletions": 0,
  "total_changes": 3,
  "parents": [
    "89ff05d5953bfd838c5ab27d38154f0f119c97fd"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/net/ethernet/microchip/lan966x/lan966x_main.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}