Commit Hash: b06b8103ae3e05ef9a638a5973c75bd6962733db
Subject: drm/i915/gt: Add arbitration check before semaphore wait


Security Keywords:
- injection

Full commit message:
drm/i915/gt: Add arbitration check before semaphore wait

Similar to commit 49b20dbf7497 ("drm/i915/gt: Perform an arbitration
check before busywaiting"), also add a check prior to the busywait
on gen8+, as we have now seen (because we added a selftest to add fault
injection into the engine resets) the same engine reset failure leading
to an indefinite wait on the ring-stop semaphore. So not a Tigerlake
specific bug after all, though it still seems odd behaviour for the
busywait as we do get the arbitration point elsewhere on a miss.

Testcase: igt_reset_fail_engine
Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
Cc: Tvrtko Ursulin <tvrtko.ursulin@intel.com>
Reviewed-by: Tvrtko Ursulin <tvrtko.ursulin@intel.com>
Link: https://patchwork.freedesktop.org/patch/msgid/20210117110418.3361-1-chris@chris-wilson.co.uk

Metadata:
Author: Chris Wilson <chris@chris-wilson.co.uk>
Author Date: Sun Jan 17 11:04:18 2021 +0000
Committer: Chris Wilson <chris@chris-wilson.co.uk>
Commit Date: Mon Jan 18 12:37:20 2021 +0000

Files Changed: 1
Lines Added: 2
Lines Removed: 0
Total Changes: 2
