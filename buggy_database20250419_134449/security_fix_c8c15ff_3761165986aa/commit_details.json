{
  "hash": "c8c15ff1e90bfc4a2db1ba77a01b3b2783e723fc",
  "hash_short": "c8c15ff1",
  "subject": "drm/radeon: r6xx/r7xx possible security issue, system ram access",
  "body": "This patch workaround a possible security issue which can allow\nuser to abuse drm on r6xx/r7xx hw to access any system ram memory.\nThis patch doesn't break userspace, it detect \"valid\" old use of\nCB_COLOR[0-7]_FRAG & CB_COLOR[0-7]_TILE registers and overwritte\nthe address these registers are pointing to with the one of the\nlast color buffer. This workaround will work for old mesa &\nxf86-video-ati and any old user which did use similar register\nprogramming pattern as those (we expect that there is no others\nuser of those ioctl except possibly a malicious one). This patch\nadd a warning if it detects such usage, warning encourage people\nto update their mesa & xf86-video-ati. New userspace will submit\nproper relocation.\n\nFix for xf86-video-ati / mesa (this kernel patch is enough to\nprevent abuse, fix for userspace are to set proper cs stream and\navoid kernel warning) :\nhttp://cgit.freedesktop.org/xorg/driver/xf86-video-ati/commit/?id=95d63e408cc88b6934bec84a0b1ef94dfe8bee7b\nhttp://cgit.freedesktop.org/mesa/mesa/commit/?id=46dc6fd3ed5ef96cda53641a97bc68c3bc104a9f\n\nAbusing this register to perform system ram memory is not easy,\nhere is outline on how it could be achieve. First attacker must\nhave access to the drm device and be able to submit command stream\nthrought cs ioctl. Then attacker must build a proper command stream\nfor r6xx/r7xx hw which will abuse the FRAG or TILE buffer to\noverwrite the GPU GART which is in VRAM. To achieve so attacker\nas to setup CB_COLOR[0-7]_FRAG or CB_COLOR[0-7]_TILE to point\nto the GPU GART, then it has to find a way to write predictable\nvalue into those buffer (with little cleverness i believe this\ncan be done but this is an hard task). Once attacker have such\nprogram it can overwritte GPU GART to program GPU gart to point\nanywhere in system memory. It then can reusse same method as he\nused to reprogram GART to overwritte the system ram through the\nGART mapping. In the process the attacker has to be carefull to\nnot overwritte any sensitive area of the GART table, like ring\nor IB gart entry as it will more then likely lead to GPU lockup.\nBottom line is that i think it's very hard to use this flaw\nto get system ram access but in theory one can achieve so.\n\nSide note: I am not aware of anyone ever using the GPU as an\nattack vector, nevertheless we take great care in the opensource\ndriver to try to detect and forbid malicious use of GPU. I don't\nthink the closed source driver are as cautious as we are.\n\nSigned-off-by: Jerome Glisse <jglisse@redhat.com>\nSigned-off-by: Dave Airlie <airlied@linux.ie>",
  "full_message": "drm/radeon: r6xx/r7xx possible security issue, system ram access\n\nThis patch workaround a possible security issue which can allow\nuser to abuse drm on r6xx/r7xx hw to access any system ram memory.\nThis patch doesn't break userspace, it detect \"valid\" old use of\nCB_COLOR[0-7]_FRAG & CB_COLOR[0-7]_TILE registers and overwritte\nthe address these registers are pointing to with the one of the\nlast color buffer. This workaround will work for old mesa &\nxf86-video-ati and any old user which did use similar register\nprogramming pattern as those (we expect that there is no others\nuser of those ioctl except possibly a malicious one). This patch\nadd a warning if it detects such usage, warning encourage people\nto update their mesa & xf86-video-ati. New userspace will submit\nproper relocation.\n\nFix for xf86-video-ati / mesa (this kernel patch is enough to\nprevent abuse, fix for userspace are to set proper cs stream and\navoid kernel warning) :\nhttp://cgit.freedesktop.org/xorg/driver/xf86-video-ati/commit/?id=95d63e408cc88b6934bec84a0b1ef94dfe8bee7b\nhttp://cgit.freedesktop.org/mesa/mesa/commit/?id=46dc6fd3ed5ef96cda53641a97bc68c3bc104a9f\n\nAbusing this register to perform system ram memory is not easy,\nhere is outline on how it could be achieve. First attacker must\nhave access to the drm device and be able to submit command stream\nthrought cs ioctl. Then attacker must build a proper command stream\nfor r6xx/r7xx hw which will abuse the FRAG or TILE buffer to\noverwrite the GPU GART which is in VRAM. To achieve so attacker\nas to setup CB_COLOR[0-7]_FRAG or CB_COLOR[0-7]_TILE to point\nto the GPU GART, then it has to find a way to write predictable\nvalue into those buffer (with little cleverness i believe this\ncan be done but this is an hard task). Once attacker have such\nprogram it can overwritte GPU GART to program GPU gart to point\nanywhere in system memory. It then can reusse same method as he\nused to reprogram GART to overwritte the system ram through the\nGART mapping. In the process the attacker has to be carefull to\nnot overwritte any sensitive area of the GART table, like ring\nor IB gart entry as it will more then likely lead to GPU lockup.\nBottom line is that i think it's very hard to use this flaw\nto get system ram access but in theory one can achieve so.\n\nSide note: I am not aware of anyone ever using the GPU as an\nattack vector, nevertheless we take great care in the opensource\ndriver to try to detect and forbid malicious use of GPU. I don't\nthink the closed source driver are as cautious as we are.\n\nSigned-off-by: Jerome Glisse <jglisse@redhat.com>\nSigned-off-by: Dave Airlie <airlied@linux.ie>",
  "author_name": "Jerome Glisse",
  "author_email": "jglisse@redhat.com",
  "author_date": "Mon Jan 18 13:01:36 2010 +0100",
  "author_date_iso": "2010-01-18T13:01:36+01:00",
  "committer_name": "Dave Airlie",
  "committer_email": "airlied@linux.ie",
  "committer_date": "Thu Jan 21 08:49:32 2010 +1000",
  "committer_date_iso": "2010-01-21T08:49:32+10:00",
  "files_changed": [
    "drivers/gpu/drm/radeon/r600_cs.c",
    "drivers/gpu/drm/radeon/r600d.h",
    "drivers/gpu/drm/radeon/radeon.h",
    "drivers/gpu/drm/radeon/radeon_cs.c"
  ],
  "files_changed_count": 4,
  "stats": [
    {
      "file": "drivers/gpu/drm/radeon/r600_cs.c",
      "insertions": 83,
      "deletions": 0
    },
    {
      "file": "drivers/gpu/drm/radeon/r600d.h",
      "insertions": 25,
      "deletions": 0
    },
    {
      "file": "drivers/gpu/drm/radeon/radeon.h",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "drivers/gpu/drm/radeon/radeon_cs.c",
      "insertions": 1,
      "deletions": 0
    }
  ],
  "total_insertions": 110,
  "total_deletions": 0,
  "total_changes": 110,
  "parents": [
    "db96380ea26fcc31ab37189aedeabd12894b1431"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v2.6.33",
    "v2.6.33-rc6",
    "v2.6.33-rc7",
    "v2.6.33-rc8",
    "v2.6.34",
    "v2.6.34-rc1",
    "v2.6.34-rc2",
    "v2.6.34-rc3",
    "v2.6.34-rc4",
    "v2.6.34-rc5"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "security issue"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/gpu/drm/radeon/r600_cs.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/gpu/drm/radeon/r600d.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/gpu/drm/radeon/radeon.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/gpu/drm/radeon/radeon_cs.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}