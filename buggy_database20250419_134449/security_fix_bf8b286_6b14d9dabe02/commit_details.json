{
  "hash": "bf8b286f86fcc66d138fd992acfa37839340218d",
  "hash_short": "bf8b286f",
  "subject": "iwlwifi: mvm: defer setting IWL_MVM_STATUS_IN_HW_RESTART",
  "body": "A hardware/firmware error may happen at any point in time. In\nparticular, it might happen while mac80211 is in the middle of\na flow. We observed the following situation:\n * mac80211 is in authentication flow, in ieee80211_prep_connection()\n * iwlwifi firmware crashes, but no error can be reported at this\n   precise point (mostly because the driver method is void, but even\n   if it wasn't we'd just shift to a race condition)\n * mac80211 continues the flow, trying to add the AP station\n * iwlwifi has already set its internal restart flag, and so thinks\n   that adding the station is part of the restart and already set up,\n   so it uses the information that's supposed to already be in the\n   struct\n\nThis can happen with any flow in mac80211 and with any information\nwe try to preserve across hardware restarts.\n\nTo fix this, only set a new HW_RESTART_REQUESTED flag and translate\nthat to IN_HW_RESTART once mac80211 actually starts the restart by\ncalling our start() method. As a consequence, any mac80211 flow in\nprogress at the time of the restart will properly finish (certainly\nwith errors), before the restart is attempted.\n\nThis fixes https://bugzilla.kernel.org/show_bug.cgi?id=195299.\n\nReported-by: djagoo <dev@djagoo.io>\nReported-by: \u0141ukasz Siudut <lsiudut@gmail.com>\nSigned-off-by: Johannes Berg <johannes.berg@intel.com>\nSigned-off-by: Luca Coelho <luciano.coelho@intel.com>",
  "full_message": "iwlwifi: mvm: defer setting IWL_MVM_STATUS_IN_HW_RESTART\n\nA hardware/firmware error may happen at any point in time. In\nparticular, it might happen while mac80211 is in the middle of\na flow. We observed the following situation:\n * mac80211 is in authentication flow, in ieee80211_prep_connection()\n * iwlwifi firmware crashes, but no error can be reported at this\n   precise point (mostly because the driver method is void, but even\n   if it wasn't we'd just shift to a race condition)\n * mac80211 continues the flow, trying to add the AP station\n * iwlwifi has already set its internal restart flag, and so thinks\n   that adding the station is part of the restart and already set up,\n   so it uses the information that's supposed to already be in the\n   struct\n\nThis can happen with any flow in mac80211 and with any information\nwe try to preserve across hardware restarts.\n\nTo fix this, only set a new HW_RESTART_REQUESTED flag and translate\nthat to IN_HW_RESTART once mac80211 actually starts the restart by\ncalling our start() method. As a consequence, any mac80211 flow in\nprogress at the time of the restart will properly finish (certainly\nwith errors), before the restart is attempted.\n\nThis fixes https://bugzilla.kernel.org/show_bug.cgi?id=195299.\n\nReported-by: djagoo <dev@djagoo.io>\nReported-by: \u0141ukasz Siudut <lsiudut@gmail.com>\nSigned-off-by: Johannes Berg <johannes.berg@intel.com>\nSigned-off-by: Luca Coelho <luciano.coelho@intel.com>",
  "author_name": "Johannes Berg",
  "author_email": "johannes.berg@intel.com",
  "author_date": "Fri Jun 30 10:48:28 2017 +0200",
  "author_date_iso": "2017-06-30T10:48:28+02:00",
  "committer_name": "Luca Coelho",
  "committer_email": "luciano.coelho@intel.com",
  "committer_date": "Fri Jul 21 12:26:39 2017 +0300",
  "committer_date_iso": "2017-07-21T12:26:39+03:00",
  "files_changed": [
    "drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c",
    "drivers/net/wireless/intel/iwlwifi/mvm/mvm.h",
    "drivers/net/wireless/intel/iwlwifi/mvm/ops.c"
  ],
  "files_changed_count": 3,
  "stats": [
    {
      "file": "drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c",
      "insertions": 7,
      "deletions": 1
    },
    {
      "file": "drivers/net/wireless/intel/iwlwifi/mvm/mvm.h",
      "insertions": 2,
      "deletions": 0
    },
    {
      "file": "drivers/net/wireless/intel/iwlwifi/mvm/ops.c",
      "insertions": 3,
      "deletions": 3
    }
  ],
  "total_insertions": 12,
  "total_deletions": 4,
  "total_changes": 16,
  "parents": [
    "7b758a111819006ba64dd23aa016d42a20ba8557"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.13",
    "v4.13-rc4",
    "v4.13-rc5",
    "v4.13-rc6",
    "v4.13-rc7",
    "v4.14",
    "v4.14-rc1",
    "v4.14-rc2",
    "v4.14-rc3",
    "v4.14-rc4"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "authentication"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/net/wireless/intel/iwlwifi/mvm/mac80211.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/wireless/intel/iwlwifi/mvm/mvm.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/wireless/intel/iwlwifi/mvm/ops.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}