Commit Hash: ccf61486fe1e1a48e18c638d1813cda77b3c0737
Subject: procfs: block chmod on /proc/thread-self/comm


Security Keywords:
- exploit

Full commit message:
procfs: block chmod on /proc/thread-self/comm

Due to an oversight in commit 1b3044e39a89 ("procfs: fix pthread
cross-thread naming if !PR_DUMPABLE") in switching from REG to NOD,
chmod operations on /proc/thread-self/comm were no longer blocked as
they are on almost all other procfs files.

A very similar situation with /proc/self/environ was used to as a root
exploit a long time ago, but procfs has SB_I_NOEXEC so this is simply a
correctness issue.

Ref: https://lwn.net/Articles/191954/
Ref: 6d76fa58b050 ("Don't allow chmod() on the /proc/<pid>/ files")
Fixes: 1b3044e39a89 ("procfs: fix pthread cross-thread naming if !PR_DUMPABLE")
Cc: stable@vger.kernel.org # v4.7+
Signed-off-by: Aleksa Sarai <cyphar@cyphar.com>
Message-Id: <20230713141001.27046-1-cyphar@cyphar.com>
Signed-off-by: Christian Brauner <brauner@kernel.org>

Metadata:
Author: Aleksa Sarai <cyphar@cyphar.com>
Author Date: Fri Jul 14 00:09:58 2023 +1000
Committer: Christian Brauner <brauner@kernel.org>
Commit Date: Thu Jul 13 16:30:52 2023 +0200

Files Changed: 1
Lines Added: 2
Lines Removed: 1
Total Changes: 3
