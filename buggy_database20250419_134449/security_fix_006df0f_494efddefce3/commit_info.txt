Commit Hash: 006df0f34930e18d0aa52f05705bdfe1fc565943
Subject: KVM: arm/arm64: Support calling vgic_update_irq_pending from irq context


Security Keywords:
- injection

Full commit message:
KVM: arm/arm64: Support calling vgic_update_irq_pending from irq context

We are about to optimize our timer handling logic which involves
injecting irqs to the vgic directly from the irq handler.

Unfortunately, the injection path can take any AP list lock and irq lock
and we must therefore make sure to use spin_lock_irqsave where ever
interrupts are enabled and we are taking any of those locks, to avoid
deadlocking between process context and the ISR.

This changes a lot of the VGIC code, but the good news are that the
changes are mostly mechanical.

Acked-by: Marc Zyngier <marc,zyngier@arm.com>
Signed-off-by: Christoffer Dall <cdall@linaro.org>

Metadata:
Author: Christoffer Dall <cdall@linaro.org>
Author Date: Sun Oct 16 22:19:11 2016 +0200
Committer: Christoffer Dall <christoffer.dall@linaro.org>
Commit Date: Mon Nov 6 16:23:10 2017 +0100

Files Changed: 8
Lines Added: 107
Lines Removed: 72
Total Changes: 179
