{
  "hash": "0f7352557a35ab7888bc7831411ec8a3cbe20d78",
  "hash_short": "0f735255",
  "subject": "wifi: brcmfmac: Fix use-after-free bug in brcmf_cfg80211_detach",
  "body": "This is the candidate patch of CVE-2023-47233 :\nhttps://nvd.nist.gov/vuln/detail/CVE-2023-47233\n\nIn brcm80211 driver,it starts with the following invoking chain\nto start init a timeout worker:\n\n->brcmf_usb_probe\n  ->brcmf_usb_probe_cb\n    ->brcmf_attach\n      ->brcmf_bus_started\n        ->brcmf_cfg80211_attach\n          ->wl_init_priv\n            ->brcmf_init_escan\n              ->INIT_WORK(&cfg->escan_timeout_work,\n\t\t  brcmf_cfg80211_escan_timeout_worker);\n\nIf we disconnect the USB by hotplug, it will call\nbrcmf_usb_disconnect to make cleanup. The invoking chain is :\n\nbrcmf_usb_disconnect\n  ->brcmf_usb_disconnect_cb\n    ->brcmf_detach\n      ->brcmf_cfg80211_detach\n        ->kfree(cfg);\n\nWhile the timeout woker may still be running. This will cause\na use-after-free bug on cfg in brcmf_cfg80211_escan_timeout_worker.\n\nFix it by deleting the timer and canceling the worker in\nbrcmf_cfg80211_detach.\n\nFixes: e756af5b30b0 (\"brcmfmac: add e-scan support.\")\nSigned-off-by: Zheng Wang <zyytlz.wz@163.com>\nCc: stable@vger.kernel.org\n[arend.vanspriel@broadcom.com: keep timer delete as is and cancel work just before free]\nSigned-off-by: Arend van Spriel <arend.vanspriel@broadcom.com>\nSigned-off-by: Kalle Valo <kvalo@kernel.org>\nLink: https://msgid.link/20240107072504.392713-1-arend.vanspriel@broadcom.com",
  "full_message": "wifi: brcmfmac: Fix use-after-free bug in brcmf_cfg80211_detach\n\nThis is the candidate patch of CVE-2023-47233 :\nhttps://nvd.nist.gov/vuln/detail/CVE-2023-47233\n\nIn brcm80211 driver,it starts with the following invoking chain\nto start init a timeout worker:\n\n->brcmf_usb_probe\n  ->brcmf_usb_probe_cb\n    ->brcmf_attach\n      ->brcmf_bus_started\n        ->brcmf_cfg80211_attach\n          ->wl_init_priv\n            ->brcmf_init_escan\n              ->INIT_WORK(&cfg->escan_timeout_work,\n\t\t  brcmf_cfg80211_escan_timeout_worker);\n\nIf we disconnect the USB by hotplug, it will call\nbrcmf_usb_disconnect to make cleanup. The invoking chain is :\n\nbrcmf_usb_disconnect\n  ->brcmf_usb_disconnect_cb\n    ->brcmf_detach\n      ->brcmf_cfg80211_detach\n        ->kfree(cfg);\n\nWhile the timeout woker may still be running. This will cause\na use-after-free bug on cfg in brcmf_cfg80211_escan_timeout_worker.\n\nFix it by deleting the timer and canceling the worker in\nbrcmf_cfg80211_detach.\n\nFixes: e756af5b30b0 (\"brcmfmac: add e-scan support.\")\nSigned-off-by: Zheng Wang <zyytlz.wz@163.com>\nCc: stable@vger.kernel.org\n[arend.vanspriel@broadcom.com: keep timer delete as is and cancel work just before free]\nSigned-off-by: Arend van Spriel <arend.vanspriel@broadcom.com>\nSigned-off-by: Kalle Valo <kvalo@kernel.org>\nLink: https://msgid.link/20240107072504.392713-1-arend.vanspriel@broadcom.com",
  "author_name": "Zheng Wang",
  "author_email": "zyytlz.wz@163.com",
  "author_date": "Sun Jan 7 08:25:04 2024 +0100",
  "author_date_iso": "2024-01-07T08:25:04+01:00",
  "committer_name": "Kalle Valo",
  "committer_email": "kvalo@kernel.org",
  "committer_date": "Thu Jan 18 15:17:33 2024 +0200",
  "committer_date_iso": "2024-01-18T15:17:33+02:00",
  "files_changed": [
    "drivers/net/wireless/broadcom/brcm80211/brcmfmac/cfg80211.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/net/wireless/broadcom/brcm80211/brcmfmac/cfg80211.c",
      "insertions": 2,
      "deletions": 2
    }
  ],
  "total_insertions": 2,
  "total_deletions": 2,
  "total_changes": 4,
  "parents": [
    "173b0fb47c3dbd1e489cb449422c1037076a66d7"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [
      "CVE-2023-47233",
      "CVE-2023-47233"
    ],
    "security_keywords": []
  },
  "fix_type": "cve",
  "file_results": [
    {
      "file": "drivers/net/wireless/broadcom/brcm80211/brcmfmac/cfg80211.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}