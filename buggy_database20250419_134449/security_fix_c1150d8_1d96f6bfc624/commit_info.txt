Commit Hash: c1150d8cf9e9d2b356fab52d79f2366985e5511b
Subject: [PATCH] KVM: Improve interrupt response


Security Keywords:
- injection

Full commit message:
[PATCH] KVM: Improve interrupt response

The current interrupt injection mechanism might delay an interrupt under
the following circumstances:

 - if injection fails because the guest is not interruptible (rflags.IF clear,
   or after a 'mov ss' or 'sti' instruction).  Userspace can check rflags,
   but the other cases or not testable under the current API.
 - if injection fails because of a fault during delivery.  This probably
   never happens under normal guests.
 - if injection fails due to a physical interrupt causing a vmexit so that
   it can be handled by the host.

In all cases the guest proceeds without processing the interrupt, reducing
the interactive feel and interrupt throughput of the guest.

This patch fixes the situation by allowing userspace to request an exit
when the 'interrupt window' opens, so that it can re-inject the interrupt
at the right time.  Guest interactivity is very visibly improved.

Signed-off-by: Dor Laor <dor.laor@qumranet.com>
Signed-off-by: Avi Kivity <avi@qumranet.com>
Acked-by: Ingo Molnar <mingo@elte.hu>
Signed-off-by: Andrew Morton <akpm@osdl.org>
Signed-off-by: Linus Torvalds <torvalds@osdl.org>

Metadata:
Author: Dor Laor <dor.laor@qumranet.com>
Author Date: Fri Jan 5 16:36:24 2007 -0800
Committer: Linus Torvalds <torvalds@woody.osdl.org>
Commit Date: Fri Jan 5 23:55:22 2007 -0800

Files Changed: 5
Lines Added: 180
Lines Removed: 28
Total Changes: 208
