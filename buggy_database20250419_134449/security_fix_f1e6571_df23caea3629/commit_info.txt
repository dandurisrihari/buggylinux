Commit Hash: f1e65718ec1855263c349997dc294e186e55d67a
Subject: ACPI: APEI: EINJ: warn on invalid argument when explicitly indicated by platform


Security Keywords:
- injection

Full commit message:
ACPI: APEI: EINJ: warn on invalid argument when explicitly indicated by platform

OSPM executes an EXECUTE_OPERATION action to instruct the platform to begin
the injection operation, then executes a GET_COMMAND_STATUS action to
determine the status of the completed operation. The ACPI Specification
documented error codes[1] are:

	0 = Success (Linux #define EINJ_STATUS_SUCCESS)
	1 = Unknown failure (Linux #define EINJ_STATUS_FAIL)
	2 = Invalid Access (Linux #define EINJ_STATUS_INVAL)

The original code report -EBUSY for both "Unknown Failure" and "Invalid
Access" cases. Actually, firmware could do some platform dependent sanity
checks and returns different error codes, e.g. "Invalid Access" to indicate
to the user that the parameters they supplied cannot be used for injection.

To this end, fix to return -EINVAL in the __einj_error_inject() error
handling case instead of always -EBUSY, when explicitly indicated by the
platform in the status of the completed operation.

[1] ACPI Specification 6.5 18.6.1. Error Injection Table

Signed-off-by: Shuai Xue <xueshuai@linux.alibaba.com>
Reviewed-by: Tony Luck <tony.luck@intel.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>

Metadata:
Author: Shuai Xue <xueshuai@linux.alibaba.com>
Author Date: Thu Mar 23 09:53:57 2023 +0800
Committer: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
Commit Date: Mon Mar 27 20:46:08 2023 +0200

Files Changed: 1
Lines Added: 7
Lines Removed: 1
Total Changes: 8
