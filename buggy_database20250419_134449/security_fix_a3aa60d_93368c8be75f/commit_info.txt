Commit Hash: a3aa60d511746bd6c0d0366d4eb90a7998bcde8b
Subject: ALSA: hda - Handle kzalloc() failure in snd_hda_attach_pcm_stream()


Security Keywords:
- injection

Full commit message:
ALSA: hda - Handle kzalloc() failure in snd_hda_attach_pcm_stream()

When 'kzalloc()' fails in 'snd_hda_attach_pcm_stream()', a new pcm instance is
created without setting its operators via 'snd_pcm_set_ops()'. Following
operations on the new pcm instance can trigger kernel null pointer dereferences
and cause kernel oops.

This bug was found with my work on building a gray-box fault-injection tool for
linux-kernel-module binaries. A kernel null pointer dereference was confirmed
from line 'substream->ops->open()' in function 'snd_pcm_open_substream()' in
file 'sound/core/pcm_native.c'.

This patch fixes the bug by calling 'snd_device_free()' in the error handling
path of 'kzalloc()', which removes the new pcm instance from the snd card before
returns with an error code.

Signed-off-by: Bo Chen <chenbo@pdx.edu>
Cc: <stable@vger.kernel.org>
Signed-off-by: Takashi Iwai <tiwai@suse.de>

Metadata:
Author: Bo Chen <chenbo@pdx.edu>
Author Date: Thu May 31 15:35:18 2018 -0700
Committer: Takashi Iwai <tiwai@suse.de>
Commit Date: Fri Jun 1 09:38:54 2018 +0200

Files Changed: 1
Lines Added: 3
Lines Removed: 1
Total Changes: 4
