{
  "hash": "e813e65038389b66d2f8dd87588694caf8dc2923",
  "hash_short": "e813e650",
  "subject": "Merge tag 'kvm-5.6-1' of git://git.kernel.org/pub/scm/virt/kvm/kvm",
  "body": "Pull KVM updates from Paolo Bonzini:\n \"This is the first batch of KVM changes.\n\n  ARM:\n   - cleanups and corner case fixes.\n\n  PPC:\n   - Bugfixes\n\n  x86:\n   - Support for mapping DAX areas with large nested page table entries.\n\n   - Cleanups and bugfixes here too. A particularly important one is a\n     fix for FPU load when the thread has TIF_NEED_FPU_LOAD. There is\n     also a race condition which could be used in guest userspace to\n     exploit the guest kernel, for which the embargo expired today.\n\n   - Fast path for IPI delivery vmexits, shaving about 200 clock cycles\n     from IPI latency.\n\n   - Protect against \"Spectre-v1/L1TF\" (bring data in the cache via\n     speculative out of bound accesses, use L1TF on the sibling\n     hyperthread to read it), which unfortunately is an even bigger\n     whack-a-mole game than SpectreV1.\n\n  Sean continues his mission to rewrite KVM. In addition to a sizable\n  number of x86 patches, this time he contributed a pretty large\n  refactoring of vCPU creation that affects all architectures but should\n  not have any visible effect.\n\n  s390 will come next week together with some more x86 patches\"\n\n* tag 'kvm-5.6-1' of git://git.kernel.org/pub/scm/virt/kvm/kvm: (204 commits)\n  x86/KVM: Clean up host's steal time structure\n  x86/KVM: Make sure KVM_VCPU_FLUSH_TLB flag is not missed\n  x86/kvm: Cache gfn to pfn translation\n  x86/kvm: Introduce kvm_(un)map_gfn()\n  x86/kvm: Be careful not to clear KVM_VCPU_FLUSH_TLB bit\n  KVM: PPC: Book3S PR: Fix -Werror=return-type build failure\n  KVM: PPC: Book3S HV: Release lock on page-out failure path\n  KVM: arm64: Treat emulated TVAL TimerValue as a signed 32-bit integer\n  KVM: arm64: pmu: Only handle supported event counters\n  KVM: arm64: pmu: Fix chained SW_INCR counters\n  KVM: arm64: pmu: Don't mark a counter as chained if the odd one is disabled\n  KVM: arm64: pmu: Don't increment SW_INCR if PMCR.E is unset\n  KVM: x86: Use a typedef for fastop functions\n  KVM: X86: Add 'else' to unify fastop and execute call path\n  KVM: x86: inline memslot_valid_for_gpte\n  KVM: x86/mmu: Use huge pages for DAX-backed files\n  KVM: x86/mmu: Remove lpage_is_disallowed() check from set_spte()\n  KVM: x86/mmu: Fold max_mapping_level() into kvm_mmu_hugepage_adjust()\n  KVM: x86/mmu: Zap any compound page when collapsing sptes\n  KVM: x86/mmu: Remove obsolete gfn restoration in FNAME(fetch)\n  ...",
  "full_message": "Merge tag 'kvm-5.6-1' of git://git.kernel.org/pub/scm/virt/kvm/kvm\n\nPull KVM updates from Paolo Bonzini:\n \"This is the first batch of KVM changes.\n\n  ARM:\n   - cleanups and corner case fixes.\n\n  PPC:\n   - Bugfixes\n\n  x86:\n   - Support for mapping DAX areas with large nested page table entries.\n\n   - Cleanups and bugfixes here too. A particularly important one is a\n     fix for FPU load when the thread has TIF_NEED_FPU_LOAD. There is\n     also a race condition which could be used in guest userspace to\n     exploit the guest kernel, for which the embargo expired today.\n\n   - Fast path for IPI delivery vmexits, shaving about 200 clock cycles\n     from IPI latency.\n\n   - Protect against \"Spectre-v1/L1TF\" (bring data in the cache via\n     speculative out of bound accesses, use L1TF on the sibling\n     hyperthread to read it), which unfortunately is an even bigger\n     whack-a-mole game than SpectreV1.\n\n  Sean continues his mission to rewrite KVM. In addition to a sizable\n  number of x86 patches, this time he contributed a pretty large\n  refactoring of vCPU creation that affects all architectures but should\n  not have any visible effect.\n\n  s390 will come next week together with some more x86 patches\"\n\n* tag 'kvm-5.6-1' of git://git.kernel.org/pub/scm/virt/kvm/kvm: (204 commits)\n  x86/KVM: Clean up host's steal time structure\n  x86/KVM: Make sure KVM_VCPU_FLUSH_TLB flag is not missed\n  x86/kvm: Cache gfn to pfn translation\n  x86/kvm: Introduce kvm_(un)map_gfn()\n  x86/kvm: Be careful not to clear KVM_VCPU_FLUSH_TLB bit\n  KVM: PPC: Book3S PR: Fix -Werror=return-type build failure\n  KVM: PPC: Book3S HV: Release lock on page-out failure path\n  KVM: arm64: Treat emulated TVAL TimerValue as a signed 32-bit integer\n  KVM: arm64: pmu: Only handle supported event counters\n  KVM: arm64: pmu: Fix chained SW_INCR counters\n  KVM: arm64: pmu: Don't mark a counter as chained if the odd one is disabled\n  KVM: arm64: pmu: Don't increment SW_INCR if PMCR.E is unset\n  KVM: x86: Use a typedef for fastop functions\n  KVM: X86: Add 'else' to unify fastop and execute call path\n  KVM: x86: inline memslot_valid_for_gpte\n  KVM: x86/mmu: Use huge pages for DAX-backed files\n  KVM: x86/mmu: Remove lpage_is_disallowed() check from set_spte()\n  KVM: x86/mmu: Fold max_mapping_level() into kvm_mmu_hugepage_adjust()\n  KVM: x86/mmu: Zap any compound page when collapsing sptes\n  KVM: x86/mmu: Remove obsolete gfn restoration in FNAME(fetch)\n  ...",
  "author_name": "Linus Torvalds",
  "author_email": "torvalds@linux-foundation.org",
  "author_date": "Fri Jan 31 09:30:41 2020 -0800",
  "author_date_iso": "2020-01-31T09:30:41-08:00",
  "committer_name": "Linus Torvalds",
  "committer_email": "torvalds@linux-foundation.org",
  "committer_date": "Fri Jan 31 09:30:41 2020 -0800",
  "committer_date_iso": "2020-01-31T09:30:41-08:00",
  "files_changed": [
    "arch/arm64/include/asm/kvm_host.h",
    "arch/arm64/kvm/hyp/entry.S",
    "arch/x86/include/asm/pgtable_types.h",
    "arch/x86/include/asm/vmx.h",
    "arch/x86/kvm/mmu/mmu.c",
    "arch/x86/kvm/vmx/nested.c",
    "arch/x86/kvm/vmx/vmx.c",
    "arch/x86/kvm/x86.c",
    "arch/x86/mm/pat/set_memory.c",
    "mm/huge_memory.c"
  ],
  "files_changed_count": 10,
  "stats": [
    {
      "file": "Documentation/powerpc/ultravisor.rst",
      "insertions": 60,
      "deletions": 0
    },
    {
      "file": "Documentation/virt/kvm/api.txt",
      "insertions": 9,
      "deletions": 0
    },
    {
      "file": "arch/arm/include/asm/kvm_emulate.h",
      "insertions": 24,
      "deletions": 3
    },
    {
      "file": "arch/arm/include/asm/kvm_host.h",
      "insertions": 9,
      "deletions": 7
    },
    {
      "file": "arch/arm/include/asm/kvm_hyp.h",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/arm/include/asm/kvm_mmio.h",
      "insertions": 0,
      "deletions": 26
    },
    {
      "file": "arch/arm/kvm/guest.c",
      "insertions": 0,
      "deletions": 5
    },
    {
      "file": "arch/arm64/include/asm/kvm_emulate.h",
      "insertions": 38,
      "deletions": 2
    },
    {
      "file": "arch/arm64/include/asm/kvm_host.h",
      "insertions": 9,
      "deletions": 7
    },
    {
      "file": "arch/arm64/include/asm/kvm_mmio.h",
      "insertions": 0,
      "deletions": 29
    },
    {
      "file": "arch/arm64/include/asm/ptrace.h",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/arm64/include/uapi/asm/kvm.h",
      "insertions": 10,
      "deletions": 2
    },
    {
      "file": "arch/arm64/include/uapi/asm/ptrace.h",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/arm64/kvm/guest.c",
      "insertions": 0,
      "deletions": 5
    },
    {
      "file": "arch/arm64/kvm/hyp/entry.S",
      "insertions": 3,
      "deletions": 4
    },
    {
      "file": "arch/arm64/kvm/inject_fault.c",
      "insertions": 65,
      "deletions": 5
    },
    {
      "file": "arch/arm64/kvm/reset.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/arm64/kvm/va_layout.c",
      "insertions": 25,
      "deletions": 31
    },
    {
      "file": "arch/mips/kvm/mips.c",
      "insertions": 28,
      "deletions": 56
    },
    {
      "file": "arch/powerpc/include/asm/hvcall.h",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/powerpc/include/asm/kvm_book3s_uvmem.h",
      "insertions": 8,
      "deletions": 2
    },
    {
      "file": "arch/powerpc/include/asm/kvm_host.h",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/powerpc/include/asm/kvm_ppc.h",
      "insertions": 2,
      "deletions": 3
    },
    {
      "file": "arch/powerpc/kvm/book3s.c",
      "insertions": 2,
      "deletions": 7
    },
    {
      "file": "arch/powerpc/kvm/book3s_64_mmu_hv.c",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "arch/powerpc/kvm/book3s_64_mmu_radix.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/powerpc/kvm/book3s_64_vio.c",
      "insertions": 6,
      "deletions": 4
    },
    {
      "file": "arch/powerpc/kvm/book3s_hv.c",
      "insertions": 16,
      "deletions": 26
    },
    {
      "file": "arch/powerpc/kvm/book3s_hv_uvmem.c",
      "insertions": 31,
      "deletions": 3
    },
    {
      "file": "arch/powerpc/kvm/book3s_pr.c",
      "insertions": 11,
      "deletions": 23
    },
    {
      "file": "arch/powerpc/kvm/book3s_xive_native.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/powerpc/kvm/booke.c",
      "insertions": 34,
      "deletions": 33
    },
    {
      "file": "arch/powerpc/kvm/e500.c",
      "insertions": 7,
      "deletions": 29
    },
    {
      "file": "arch/powerpc/kvm/e500mc.c",
      "insertions": 6,
      "deletions": 24
    },
    {
      "file": "arch/powerpc/kvm/emulate_loadstore.c",
      "insertions": 0,
      "deletions": 5
    },
    {
      "file": "arch/powerpc/kvm/powerpc.c",
      "insertions": 44,
      "deletions": 44
    },
    {
      "file": "arch/s390/include/asm/kvm_host.h",
      "insertions": 0,
      "deletions": 1
    },
    {
      "file": "arch/s390/kvm/kvm-s390.c",
      "insertions": 55,
      "deletions": 63
    },
    {
      "file": "arch/x86/include/asm/kvm_emulate.h",
      "insertions": 4,
      "deletions": 0
    },
    {
      "file": "arch/x86/include/asm/kvm_host.h",
      "insertions": 23,
      "deletions": 11
    },
    {
      "file": "arch/x86/include/asm/pgtable_types.h",
      "insertions": 4,
      "deletions": 0
    },
    {
      "file": "arch/x86/include/asm/vmx.h",
      "insertions": 3,
      "deletions": 3
    },
    {
      "file": "arch/x86/include/uapi/asm/vmx.h",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "arch/x86/kvm/cpuid.c",
      "insertions": 6,
      "deletions": 3
    },
    {
      "file": "arch/x86/kvm/cpuid.h",
      "insertions": 36,
      "deletions": 9
    },
    {
      "file": "arch/x86/kvm/emulate.c",
      "insertions": 85,
      "deletions": 48
    },
    {
      "file": "arch/x86/kvm/hyperv.c",
      "insertions": 10,
      "deletions": 7
    },
    {
      "file": "arch/x86/kvm/i8259.c",
      "insertions": 5,
      "deletions": 1
    },
    {
      "file": "arch/x86/kvm/ioapic.c",
      "insertions": 25,
      "deletions": 16
    },
    {
      "file": "arch/x86/kvm/ioapic.h",
      "insertions": 0,
      "deletions": 6
    },
    {
      "file": "arch/x86/kvm/irq.h",
      "insertions": 3,
      "deletions": 0
    },
    {
      "file": "arch/x86/kvm/irq_comm.c",
      "insertions": 10,
      "deletions": 8
    },
    {
      "file": "arch/x86/kvm/lapic.c",
      "insertions": 19,
      "deletions": 18
    },
    {
      "file": "arch/x86/kvm/lapic.h",
      "insertions": 5,
      "deletions": 4
    },
    {
      "file": "arch/x86/kvm/mmu/mmu.c",
      "insertions": 246,
      "deletions": 359
    },
    {
      "file": "arch/x86/kvm/mmu/paging_tmpl.h",
      "insertions": 49,
      "deletions": 39
    },
    {
      "file": "arch/x86/kvm/mmutrace.h",
      "insertions": 6,
      "deletions": 6
    },
    {
      "file": "arch/x86/kvm/mtrr.c",
      "insertions": 6,
      "deletions": 2
    },
    {
      "file": "arch/x86/kvm/pmu.h",
      "insertions": 14,
      "deletions": 4
    },
    {
      "file": "arch/x86/kvm/svm.c",
      "insertions": 75,
      "deletions": 59
    },
    {
      "file": "arch/x86/kvm/vmx/capabilities.h",
      "insertions": 5,
      "deletions": 0
    },
    {
      "file": "arch/x86/kvm/vmx/evmcs.c",
      "insertions": 0,
      "deletions": 5
    },
    {
      "file": "arch/x86/kvm/vmx/nested.c",
      "insertions": 85,
      "deletions": 104
    },
    {
      "file": "arch/x86/kvm/vmx/pmu_intel.c",
      "insertions": 16,
      "deletions": 8
    },
    {
      "file": "arch/x86/kvm/vmx/vmcs_shadow_fields.h",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "arch/x86/kvm/vmx/vmx.c",
      "insertions": 139,
      "deletions": 155
    },
    {
      "file": "arch/x86/kvm/x86.c",
      "insertions": 352,
      "deletions": 217
    },
    {
      "file": "arch/x86/kvm/x86.h",
      "insertions": 9,
      "deletions": 14
    },
    {
      "file": "arch/x86/mm/pat/set_memory.c",
      "insertions": 11,
      "deletions": 0
    },
    {
      "file": "include/linux/context_tracking.h",
      "insertions": 0,
      "deletions": 9
    },
    {
      "file": "include/linux/huge_mm.h",
      "insertions": 6,
      "deletions": 0
    },
    {
      "file": "include/linux/kvm_host.h",
      "insertions": 21,
      "deletions": 19
    },
    {
      "file": "include/linux/kvm_types.h",
      "insertions": 8,
      "deletions": 1
    },
    {
      "file": "mm/huge_memory.c",
      "insertions": 11,
      "deletions": 0
    },
    {
      "file": "tools/arch/x86/include/uapi/asm/vmx.h",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "tools/kvm/kvm_stat/kvm_stat",
      "insertions": 6,
      "deletions": 2
    },
    {
      "file": "tools/testing/selftests/kvm/include/x86_64/vmx.h",
      "insertions": 4,
      "deletions": 4
    },
    {
      "file": "tools/testing/selftests/kvm/x86_64/vmx_tsc_adjust_test.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "virt/kvm/arm/aarch32.c",
      "insertions": 114,
      "deletions": 17
    },
    {
      "file": "virt/kvm/arm/arch_timer.c",
      "insertions": 3,
      "deletions": 2
    },
    {
      "file": "virt/kvm/arm/arm.c",
      "insertions": 28,
      "deletions": 85
    },
    {
      "file": "virt/kvm/arm/mmio.c",
      "insertions": 24,
      "deletions": 44
    },
    {
      "file": "virt/kvm/arm/mmu.c",
      "insertions": 12,
      "deletions": 20
    },
    {
      "file": "virt/kvm/arm/perf.c",
      "insertions": 3,
      "deletions": 3
    },
    {
      "file": "virt/kvm/arm/pmu.c",
      "insertions": 69,
      "deletions": 45
    },
    {
      "file": "virt/kvm/arm/vgic/vgic-its.c",
      "insertions": 3,
      "deletions": 3
    },
    {
      "file": "virt/kvm/arm/vgic/vgic-mmio-v3.c",
      "insertions": 4,
      "deletions": 1
    },
    {
      "file": "virt/kvm/arm/vgic/vgic-mmio.c",
      "insertions": 3,
      "deletions": 12
    },
    {
      "file": "virt/kvm/arm/vgic/vgic-mmio.h",
      "insertions": 0,
      "deletions": 5
    },
    {
      "file": "virt/kvm/async_pf.c",
      "insertions": 9,
      "deletions": 22
    },
    {
      "file": "virt/kvm/kvm_main.c",
      "insertions": 269,
      "deletions": 166
    },
    {
      "file": "virt/lib/irqbypass.c",
      "insertions": 20,
      "deletions": 18
    }
  ],
  "total_insertions": 2387,
  "total_deletions": 2045,
  "total_changes": 4432,
  "parents": [
    "ccaaaf6fe5a5e1fffca5cca0f3fc4ec84d7ae752",
    "4cbc418a44d5067133271bb6eeac2382f2bf94f7"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v5.6",
    "v5.6-rc1",
    "v5.6-rc2",
    "v5.6-rc3",
    "v5.6-rc4",
    "v5.6-rc5",
    "v5.6-rc6",
    "v5.6-rc7",
    "v5.7-rc1"
  ],
  "is_merge": true,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "exploit"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/x86/include/asm/vmx.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/arm64/kvm/hyp/entry.S",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/arm64/include/asm/kvm_host.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/include/asm/pgtable_types.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kvm/vmx/vmx.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "mm/huge_memory.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kvm/mmu/mmu.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/mm/pat/set_memory.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kvm/vmx/nested.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kvm/x86.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}