Commit Hash: 0ad3bed6c5ec6dbb093a26802c85088a85fb9757
Subject: kvm: nVMX: move nested events check to kvm_vcpu_running


Security Keywords:
- injection

Full commit message:
kvm: nVMX: move nested events check to kvm_vcpu_running

vcpu_run calls kvm_vcpu_running, not kvm_arch_vcpu_runnable,
and the former does not call check_nested_events.

Once KVM_REQ_EVENT is removed from the APICv interrupt injection
path, however, this would leave no place to trigger a vmexit
from L2 to L1, causing a missed interrupt delivery while in guest
mode.  This is caught by the "ack interrupt on exit" test in
vmx.flat.

[This does not change the calls to check_nested_events in
 inject_pending_event.  That is material for a separate cleanup.]

Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

Metadata:
Author: Paolo Bonzini <pbonzini@redhat.com>
Author Date: Mon Dec 19 15:23:54 2016 +0100
Committer: Paolo Bonzini <pbonzini@redhat.com>
Commit Date: Wed Feb 15 14:54:33 2017 +0100

Files Changed: 1
Lines Added: 3
Lines Removed: 3
Total Changes: 6
