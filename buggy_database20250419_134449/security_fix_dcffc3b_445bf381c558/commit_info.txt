Commit Hash: dcffc3b1ae3251d796a25c673f614e3099ca83d3
Subject: bcachefs: Split up bch_dev.io_ref


Security Keywords:
- hardening

Full commit message:
bcachefs: Split up bch_dev.io_ref

We now have separate per device io_refs for read and write access.

This fixes a device removal bug where the discard workers were still
running while we're removing alloc info for that device.

It's also a bit of hardening; we no longer allow writes to devices that
are read-only.

Signed-off-by: Kent Overstreet <kent.overstreet@linux.dev>

Metadata:
Author: Kent Overstreet <kent.overstreet@linux.dev>
Author Date: Sat Mar 29 23:11:08 2025 -0400
Committer: Kent Overstreet <kent.overstreet@linux.dev>
Commit Date: Wed Apr 2 10:24:34 2025 -0400

Files Changed: 19
Lines Added: 142
Lines Removed: 87
Total Changes: 229
