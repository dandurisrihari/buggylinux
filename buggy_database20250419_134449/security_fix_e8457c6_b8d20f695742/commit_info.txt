Commit Hash: e8457c67a4ec1268ec616bd8be1d9f1cc20f1493
Subject: KVM: nVMX: Fix conditions for interrupt injection


Security Keywords:
- injection

Full commit message:
KVM: nVMX: Fix conditions for interrupt injection

If we are entering guest mode, we do not want L0 to interrupt this
vmentry with all its side effects on the vmcs. Therefore, injection
shall be disallowed during L1->L2 transitions, as in the previous
version. However, this check is conceptually independent of
nested_exit_on_intr, so decouple it.

If L1 traps external interrupts, we can kick the guest from L2 to L1,
also just like the previous code worked. But we no longer need to
consider L1's idt_vectoring_info_field. It will always be empty at this
point. Instead, if L2 has pending events, those are now found in the
architectural queues and will, thus, prevent vmx_interrupt_allowed from
being called at all.

Signed-off-by: Jan Kiszka <jan.kiszka@siemens.com>
Signed-off-by: Gleb Natapov <gleb@redhat.com>

Metadata:
Author: Jan Kiszka <jan.kiszka@siemens.com>
Author Date: Sun Apr 14 12:12:48 2013 +0200
Committer: Gleb Natapov <gleb@redhat.com>
Commit Date: Sun Apr 14 18:27:09 2013 +0300

Files Changed: 1
Lines Added: 12
Lines Removed: 8
Total Changes: 20
