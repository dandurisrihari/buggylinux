Commit Hash: 7638e0bfaed1b653d3ca663e560e9ffb44bb1030
Subject: SUNRPC: Move fault injection call sites


Security Keywords:
- injection

Full commit message:
SUNRPC: Move fault injection call sites

I've hit some crashes that occur in the xprt_rdma_inject_disconnect
path. It appears that, for some provides, rdma_disconnect() can
take so long that the transport can disconnect and release its
hardware resources while rdma_disconnect() is still running,
resulting in a UAF in the provider.

The transport's fault injection method may depend on the stability
of transport data structures. That means it needs to be invoked
only from contexts that hold the transport write lock.

Fixes: 4a0682583988 ("SUNRPC: Transport fault injection")
Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
Signed-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>

Metadata:
Author: Chuck Lever <chuck.lever@oracle.com>
Author Date: Wed Mar 31 13:22:14 2021 -0400
Committer: Trond Myklebust <trond.myklebust@hammerspace.com>
Commit Date: Wed Apr 14 09:36:29 2021 -0400

Files Changed: 3
Lines Added: 8
Lines Removed: 5
Total Changes: 13
