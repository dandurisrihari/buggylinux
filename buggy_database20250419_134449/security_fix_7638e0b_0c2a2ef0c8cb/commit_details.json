{
  "hash": "7638e0bfaed1b653d3ca663e560e9ffb44bb1030",
  "hash_short": "7638e0bf",
  "subject": "SUNRPC: Move fault injection call sites",
  "body": "I've hit some crashes that occur in the xprt_rdma_inject_disconnect\npath. It appears that, for some provides, rdma_disconnect() can\ntake so long that the transport can disconnect and release its\nhardware resources while rdma_disconnect() is still running,\nresulting in a UAF in the provider.\n\nThe transport's fault injection method may depend on the stability\nof transport data structures. That means it needs to be invoked\nonly from contexts that hold the transport write lock.\n\nFixes: 4a0682583988 (\"SUNRPC: Transport fault injection\")\nSigned-off-by: Chuck Lever <chuck.lever@oracle.com>\nSigned-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>",
  "full_message": "SUNRPC: Move fault injection call sites\n\nI've hit some crashes that occur in the xprt_rdma_inject_disconnect\npath. It appears that, for some provides, rdma_disconnect() can\ntake so long that the transport can disconnect and release its\nhardware resources while rdma_disconnect() is still running,\nresulting in a UAF in the provider.\n\nThe transport's fault injection method may depend on the stability\nof transport data structures. That means it needs to be invoked\nonly from contexts that hold the transport write lock.\n\nFixes: 4a0682583988 (\"SUNRPC: Transport fault injection\")\nSigned-off-by: Chuck Lever <chuck.lever@oracle.com>\nSigned-off-by: Trond Myklebust <trond.myklebust@hammerspace.com>",
  "author_name": "Chuck Lever",
  "author_email": "chuck.lever@oracle.com",
  "author_date": "Wed Mar 31 13:22:14 2021 -0400",
  "author_date_iso": "2021-03-31T13:22:14-04:00",
  "committer_name": "Trond Myklebust",
  "committer_email": "trond.myklebust@hammerspace.com",
  "committer_date": "Wed Apr 14 09:36:29 2021 -0400",
  "committer_date_iso": "2021-04-14T09:36:29-04:00",
  "files_changed": [
    "net/sunrpc/clnt.c",
    "net/sunrpc/xprt.c",
    "net/sunrpc/xprtrdma/transport.c"
  ],
  "files_changed_count": 3,
  "stats": [
    {
      "file": "net/sunrpc/clnt.c",
      "insertions": 0,
      "deletions": 1
    },
    {
      "file": "net/sunrpc/xprt.c",
      "insertions": 4,
      "deletions": 2
    },
    {
      "file": "net/sunrpc/xprtrdma/transport.c",
      "insertions": 4,
      "deletions": 2
    }
  ],
  "total_insertions": 8,
  "total_deletions": 5,
  "total_changes": 13,
  "parents": [
    "73f5c88f521a630ea1628beb9c2d48a2e777a419"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "net/sunrpc/clnt.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "net/sunrpc/xprt.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "net/sunrpc/xprtrdma/transport.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}