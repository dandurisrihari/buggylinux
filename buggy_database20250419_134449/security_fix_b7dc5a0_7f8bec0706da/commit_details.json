{
  "hash": "b7dc5a071ddf69c0350396b203cba32fe5bab510",
  "hash_short": "b7dc5a07",
  "subject": "parisc: Fix ptrace syscall number modification",
  "body": "Commit 910cd32e552e (\"parisc: Fix and enable seccomp filter support\")\nintroduced a regression in ptrace-based syscall tampering: when tracer\nchanges syscall number to -1, the kernel fails to initialize %r28 with\n-ENOSYS and subsequently fails to return the error code of the failed\nsyscall to userspace.\n\nThis erroneous behaviour could be observed with a simple strace syscall\nfault injection command which is expected to print something like this:\n\n$ strace -a0 -ewrite -einject=write:error=enospc echo hello\nwrite(1, \"hello\\n\", 6) = -1 ENOSPC (No space left on device) (INJECTED)\nwrite(2, \"echo: \", 6) = -1 ENOSPC (No space left on device) (INJECTED)\nwrite(2, \"write error\", 11) = -1 ENOSPC (No space left on device) (INJECTED)\nwrite(2, \"\\n\", 1) = -1 ENOSPC (No space left on device) (INJECTED)\n+++ exited with 1 +++\n\nAfter commit 910cd32e552ea09caa89cdbe328e468979b030dd it loops printing\nsomething like this instead:\n\nwrite(1, \"hello\\n\", 6../strace: Failed to tamper with process 12345: unexpectedly got no error (return value 0, error 0)\n) = 0 (INJECTED)\n\nThis bug was found by strace test suite.\n\nFixes: 910cd32e552e (\"parisc: Fix and enable seccomp filter support\")\nCc: stable@vger.kernel.org # v4.5+\nSigned-off-by: Dmitry V. Levin <ldv@altlinux.org>\nTested-by: Helge Deller <deller@gmx.de>\nSigned-off-by: Helge Deller <deller@gmx.de>",
  "full_message": "parisc: Fix ptrace syscall number modification\n\nCommit 910cd32e552e (\"parisc: Fix and enable seccomp filter support\")\nintroduced a regression in ptrace-based syscall tampering: when tracer\nchanges syscall number to -1, the kernel fails to initialize %r28 with\n-ENOSYS and subsequently fails to return the error code of the failed\nsyscall to userspace.\n\nThis erroneous behaviour could be observed with a simple strace syscall\nfault injection command which is expected to print something like this:\n\n$ strace -a0 -ewrite -einject=write:error=enospc echo hello\nwrite(1, \"hello\\n\", 6) = -1 ENOSPC (No space left on device) (INJECTED)\nwrite(2, \"echo: \", 6) = -1 ENOSPC (No space left on device) (INJECTED)\nwrite(2, \"write error\", 11) = -1 ENOSPC (No space left on device) (INJECTED)\nwrite(2, \"\\n\", 1) = -1 ENOSPC (No space left on device) (INJECTED)\n+++ exited with 1 +++\n\nAfter commit 910cd32e552ea09caa89cdbe328e468979b030dd it loops printing\nsomething like this instead:\n\nwrite(1, \"hello\\n\", 6../strace: Failed to tamper with process 12345: unexpectedly got no error (return value 0, error 0)\n) = 0 (INJECTED)\n\nThis bug was found by strace test suite.\n\nFixes: 910cd32e552e (\"parisc: Fix and enable seccomp filter support\")\nCc: stable@vger.kernel.org # v4.5+\nSigned-off-by: Dmitry V. Levin <ldv@altlinux.org>\nTested-by: Helge Deller <deller@gmx.de>\nSigned-off-by: Helge Deller <deller@gmx.de>",
  "author_name": "Dmitry V. Levin",
  "author_email": "ldv@altlinux.org",
  "author_date": "Sat Feb 16 16:10:39 2019 +0300",
  "author_date_iso": "2019-02-16T16:10:39+03:00",
  "committer_name": "Helge Deller",
  "committer_email": "deller@gmx.de",
  "committer_date": "Thu Feb 21 20:10:46 2019 +0100",
  "committer_date_iso": "2019-02-21T20:10:46+01:00",
  "files_changed": [
    "arch/parisc/kernel/ptrace.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "arch/parisc/kernel/ptrace.c",
      "insertions": 21,
      "deletions": 8
    }
  ],
  "total_insertions": 21,
  "total_deletions": 8,
  "total_changes": 29,
  "parents": [
    "f6163d67cc31b8f2a946c4df82be3c6dd918412d"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v5.0",
    "v5.0-rc8",
    "v5.1",
    "v5.1-rc1",
    "v5.1-rc2",
    "v5.1-rc3",
    "v5.1-rc4",
    "v5.1-rc5",
    "v5.1-rc6",
    "v5.1-rc7"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/parisc/kernel/ptrace.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}