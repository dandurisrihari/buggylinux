{
  "hash": "543ce63b664e2c2f9533d089a4664b559c3e6b5b",
  "hash_short": "543ce63b",
  "subject": "lockdown: Fix kexec lockdown bypass with ima policy",
  "body": "The lockdown LSM is primarily used in conjunction with UEFI Secure Boot.\nThis LSM may also be used on machines without UEFI.  It can also be\nenabled when UEFI Secure Boot is disabled.  One of lockdown's features\nis to prevent kexec from loading untrusted kernels.  Lockdown can be\nenabled through a bootparam or after the kernel has booted through\nsecurityfs.\n\nIf IMA appraisal is used with the \"ima_appraise=log\" boot param,\nlockdown can be defeated with kexec on any machine when Secure Boot is\ndisabled or unavailable.  IMA prevents setting \"ima_appraise=log\" from\nthe boot param when Secure Boot is enabled, but this does not cover\ncases where lockdown is used without Secure Boot.\n\nTo defeat lockdown, boot without Secure Boot and add ima_appraise=log to\nthe kernel command line; then:\n\n  $ echo \"integrity\" > /sys/kernel/security/lockdown\n  $ echo \"appraise func=KEXEC_KERNEL_CHECK appraise_type=imasig\" > \\\n    /sys/kernel/security/ima/policy\n  $ kexec -ls unsigned-kernel\n\nAdd a call to verify ima appraisal is set to \"enforce\" whenever lockdown\nis enabled.  This fixes CVE-2022-21505.\n\nCc: stable@vger.kernel.org\nFixes: 29d3c1c8dfe7 (\"kexec: Allow kexec_file() with appropriate IMA policy when locked down\")\nSigned-off-by: Eric Snowberg <eric.snowberg@oracle.com>\nAcked-by: Mimi Zohar <zohar@linux.ibm.com>\nReviewed-by: John Haxby <john.haxby@oracle.com>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
  "full_message": "lockdown: Fix kexec lockdown bypass with ima policy\n\nThe lockdown LSM is primarily used in conjunction with UEFI Secure Boot.\nThis LSM may also be used on machines without UEFI.  It can also be\nenabled when UEFI Secure Boot is disabled.  One of lockdown's features\nis to prevent kexec from loading untrusted kernels.  Lockdown can be\nenabled through a bootparam or after the kernel has booted through\nsecurityfs.\n\nIf IMA appraisal is used with the \"ima_appraise=log\" boot param,\nlockdown can be defeated with kexec on any machine when Secure Boot is\ndisabled or unavailable.  IMA prevents setting \"ima_appraise=log\" from\nthe boot param when Secure Boot is enabled, but this does not cover\ncases where lockdown is used without Secure Boot.\n\nTo defeat lockdown, boot without Secure Boot and add ima_appraise=log to\nthe kernel command line; then:\n\n  $ echo \"integrity\" > /sys/kernel/security/lockdown\n  $ echo \"appraise func=KEXEC_KERNEL_CHECK appraise_type=imasig\" > \\\n    /sys/kernel/security/ima/policy\n  $ kexec -ls unsigned-kernel\n\nAdd a call to verify ima appraisal is set to \"enforce\" whenever lockdown\nis enabled.  This fixes CVE-2022-21505.\n\nCc: stable@vger.kernel.org\nFixes: 29d3c1c8dfe7 (\"kexec: Allow kexec_file() with appropriate IMA policy when locked down\")\nSigned-off-by: Eric Snowberg <eric.snowberg@oracle.com>\nAcked-by: Mimi Zohar <zohar@linux.ibm.com>\nReviewed-by: John Haxby <john.haxby@oracle.com>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
  "author_name": "Eric Snowberg",
  "author_email": "eric.snowberg@oracle.com",
  "author_date": "Wed Jul 20 12:40:27 2022 -0400",
  "author_date_iso": "2022-07-20T12:40:27-04:00",
  "committer_name": "Linus Torvalds",
  "committer_email": "torvalds@linux-foundation.org",
  "committer_date": "Wed Jul 20 09:56:48 2022 -0700",
  "committer_date_iso": "2022-07-20T09:56:48-07:00",
  "files_changed": [
    "security/integrity/ima/ima_policy.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "security/integrity/ima/ima_policy.c",
      "insertions": 4,
      "deletions": 0
    }
  ],
  "total_insertions": 4,
  "total_deletions": 0,
  "total_changes": 4,
  "parents": [
    "ca85855bdcae8f84f1512e88b4c75009ea17ea2f"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [
      "CVE-2022-21505"
    ],
    "security_keywords": [
      "bypass"
    ]
  },
  "fix_type": "cve",
  "file_results": [
    {
      "file": "security/integrity/ima/ima_policy.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}