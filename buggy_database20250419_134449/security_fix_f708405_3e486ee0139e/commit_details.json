{
  "hash": "f7084059a9cb9e56a186e1677b1dcffd76c2cd24",
  "hash_short": "f7084059",
  "subject": "bnx2x: Improve reliability in case of nested PCI errors",
  "body": "While in recovery process of PCI error (called EEH on PowerPC arch),\nanother PCI transaction could be corrupted causing a situation of\nnested PCI errors. Also, this scenario could be reproduced with\nerror injection mechanisms (for debug purposes).\n\nWe observe that in case of nested PCI errors, bnx2x might attempt to\ninitialize its shmem and cause a kernel crash due to bad addresses\nread from MCP. Multiple different stack traces were observed depending\non the point the second PCI error happens.\n\nThis patch avoids the crashes by:\n\n * failing PCI recovery in case of nested errors (since multiple\n PCI errors in a row are not expected to lead to a functional\n adapter anyway), and by,\n\n * preventing access to adapter FW when MCP is failed (we mark it as\n failed when shmem cannot get initialized properly).\n\nReported-by: Abdul Haleem <abdhalee@linux.vnet.ibm.com>\nSigned-off-by: Guilherme G. Piccoli <gpiccoli@linux.vnet.ibm.com>\nAcked-by: Shahed Shaikh <Shahed.Shaikh@cavium.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
  "full_message": "bnx2x: Improve reliability in case of nested PCI errors\n\nWhile in recovery process of PCI error (called EEH on PowerPC arch),\nanother PCI transaction could be corrupted causing a situation of\nnested PCI errors. Also, this scenario could be reproduced with\nerror injection mechanisms (for debug purposes).\n\nWe observe that in case of nested PCI errors, bnx2x might attempt to\ninitialize its shmem and cause a kernel crash due to bad addresses\nread from MCP. Multiple different stack traces were observed depending\non the point the second PCI error happens.\n\nThis patch avoids the crashes by:\n\n * failing PCI recovery in case of nested errors (since multiple\n PCI errors in a row are not expected to lead to a functional\n adapter anyway), and by,\n\n * preventing access to adapter FW when MCP is failed (we mark it as\n failed when shmem cannot get initialized properly).\n\nReported-by: Abdul Haleem <abdhalee@linux.vnet.ibm.com>\nSigned-off-by: Guilherme G. Piccoli <gpiccoli@linux.vnet.ibm.com>\nAcked-by: Shahed Shaikh <Shahed.Shaikh@cavium.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
  "author_name": "Guilherme G. Piccoli",
  "author_email": "gpiccoli@linux.vnet.ibm.com",
  "author_date": "Fri Dec 22 13:01:39 2017 -0200",
  "author_date_iso": "2017-12-22T13:01:39-02:00",
  "committer_name": "David S. Miller",
  "committer_email": "davem@davemloft.net",
  "committer_date": "Wed Dec 27 12:13:32 2017 -0500",
  "committer_date_iso": "2017-12-27T12:13:32-05:00",
  "files_changed": [
    "drivers/net/ethernet/broadcom/bnx2x/bnx2x_cmn.c",
    "drivers/net/ethernet/broadcom/bnx2x/bnx2x_main.c"
  ],
  "files_changed_count": 2,
  "stats": [
    {
      "file": "drivers/net/ethernet/broadcom/bnx2x/bnx2x_cmn.c",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "drivers/net/ethernet/broadcom/bnx2x/bnx2x_main.c",
      "insertions": 13,
      "deletions": 1
    }
  ],
  "total_insertions": 15,
  "total_deletions": 3,
  "total_changes": 18,
  "parents": [
    "6753879073d61ba74b011f102838e7c8bb1a1887"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.15",
    "v4.15-rc6",
    "v4.15-rc7",
    "v4.15-rc8",
    "v4.15-rc9",
    "v4.16",
    "v4.16-rc1",
    "v4.16-rc2",
    "v4.16-rc3",
    "v4.16-rc4"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/net/ethernet/broadcom/bnx2x/bnx2x_cmn.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/ethernet/broadcom/bnx2x/bnx2x_main.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}