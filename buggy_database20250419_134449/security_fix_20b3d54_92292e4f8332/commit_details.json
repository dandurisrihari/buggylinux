{
  "hash": "20b3d54ecba51c5fe476eea94ffdc463559c5c85",
  "hash_short": "20b3d54e",
  "subject": "irqchip/gic-v3-its: Add device proxy for VPE management if !DirectLpi",
  "body": "When we don't have the DirectLPI feature, we must work around the\narchitecture shortcomings to be able to perform the required\nmaintenance (interrupt masking, clearing and injection).\n\nFor this, we create a fake device whose sole purpose is to\nprovide a way to issue commands as if we were dealing with LPIs\ncoming from that device (while they actually originate from\nthe ITS). This fake device doesn't have LPIs allocated to it,\nbut instead uses the VPE LPIs.\n\nOf course, this could be a real bottleneck, and a naive\nimplementation would require 6 commands to issue an invalidation.\n\nInstead, let's allocate at least one event per physical CPU\n(rounded up to the next power of 2), and opportunistically\nmap the VPE doorbell to an event. This doorbell will be mapped\nuntil we roll over and need to reallocate this slot.\n\nThis ensures that most of the time, we only need 2 commands\nto issue an INV, INT or CLEAR, making the performance a lot\nbetter, given that we always issue a CLEAR on entry, and\nan INV on each side of a trapped WFI.\n\nSigned-off-by: Marc Zyngier <marc.zyngier@arm.com>",
  "full_message": "irqchip/gic-v3-its: Add device proxy for VPE management if !DirectLpi\n\nWhen we don't have the DirectLPI feature, we must work around the\narchitecture shortcomings to be able to perform the required\nmaintenance (interrupt masking, clearing and injection).\n\nFor this, we create a fake device whose sole purpose is to\nprovide a way to issue commands as if we were dealing with LPIs\ncoming from that device (while they actually originate from\nthe ITS). This fake device doesn't have LPIs allocated to it,\nbut instead uses the VPE LPIs.\n\nOf course, this could be a real bottleneck, and a naive\nimplementation would require 6 commands to issue an invalidation.\n\nInstead, let's allocate at least one event per physical CPU\n(rounded up to the next power of 2), and opportunistically\nmap the VPE doorbell to an event. This doorbell will be mapped\nuntil we roll over and need to reallocate this slot.\n\nThis ensures that most of the time, we only need 2 commands\nto issue an INV, INT or CLEAR, making the performance a lot\nbetter, given that we always issue a CLEAR on entry, and\nan INV on each side of a trapped WFI.\n\nSigned-off-by: Marc Zyngier <marc.zyngier@arm.com>",
  "author_name": "Marc Zyngier",
  "author_email": "marc.zyngier@arm.com",
  "author_date": "Tue Dec 20 15:23:22 2016 +0000",
  "author_date_iso": "2016-12-20T15:23:22+00:00",
  "committer_name": "Marc Zyngier",
  "committer_email": "marc.zyngier@arm.com",
  "committer_date": "Thu Aug 31 15:31:39 2017 +0100",
  "committer_date_iso": "2017-08-31T15:31:39+01:00",
  "files_changed": [
    "drivers/irqchip/irq-gic-v3-its.c",
    "include/linux/irqchip/arm-gic-v4.h"
  ],
  "files_changed_count": 2,
  "stats": [
    {
      "file": "drivers/irqchip/irq-gic-v3-its.c",
      "insertions": 145,
      "deletions": 6
    },
    {
      "file": "include/linux/irqchip/arm-gic-v4.h",
      "insertions": 2,
      "deletions": 0
    }
  ],
  "total_insertions": 147,
  "total_deletions": 6,
  "total_changes": 153,
  "parents": [
    "93f94ea0548c2628efe7d57e0989f06a14cedb53"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.14",
    "v4.14-rc1",
    "v4.14-rc2",
    "v4.14-rc3",
    "v4.14-rc4",
    "v4.14-rc5",
    "v4.14-rc6",
    "v4.14-rc7",
    "v4.14-rc8",
    "v4.15"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/irqchip/irq-gic-v3-its.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/linux/irqchip/arm-gic-v4.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}