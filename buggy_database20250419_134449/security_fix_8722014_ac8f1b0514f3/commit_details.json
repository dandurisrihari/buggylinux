{
  "hash": "8722014311e613244f33952354956a82fa4b0472",
  "hash_short": "87220143",
  "subject": "rxrpc: Fix use of Don't Fragment flag",
  "body": "rxrpc normally has the Don't Fragment flag set on the UDP packets it\ntransmits, except when it has decided that DATA packets aren't getting\nthrough - in which case it turns it off just for the DATA transmissions.\nThis can be a problem, however, for RESPONSE packets that convey\nauthentication and crypto data from the client to the server as ticket may\nbe larger than can fit in the MTU.\n\nIn such a case, rxrpc gets itself into an infinite loop as the sendmsg\nreturns an error (EMSGSIZE), which causes rxkad_send_response() to return\n-EAGAIN - and the CHALLENGE packet is put back on the Rx queue to retry,\nleading to the I/O thread endlessly attempting to perform the transmission.\n\nFix this by disabling DF on RESPONSE packets for now.  The use of DF and\nbest data MTU determination needs reconsidering at some point in the\nfuture.\n\nFixes: 17926a79320a (\"[AF_RXRPC]: Provide secure RxRPC sockets for use by userspace and kernel both\")\nReported-by: Marc Dionne <marc.dionne@auristor.com>\nSigned-off-by: David Howells <dhowells@redhat.com>\ncc: linux-afs@lists.infradead.org\nAcked-by: Paolo Abeni <pabeni@redhat.com>\nLink: https://lore.kernel.org/r/1581852.1704813048@warthog.procyon.org.uk\nSigned-off-by: Jakub Kicinski <kuba@kernel.org>",
  "full_message": "rxrpc: Fix use of Don't Fragment flag\n\nrxrpc normally has the Don't Fragment flag set on the UDP packets it\ntransmits, except when it has decided that DATA packets aren't getting\nthrough - in which case it turns it off just for the DATA transmissions.\nThis can be a problem, however, for RESPONSE packets that convey\nauthentication and crypto data from the client to the server as ticket may\nbe larger than can fit in the MTU.\n\nIn such a case, rxrpc gets itself into an infinite loop as the sendmsg\nreturns an error (EMSGSIZE), which causes rxkad_send_response() to return\n-EAGAIN - and the CHALLENGE packet is put back on the Rx queue to retry,\nleading to the I/O thread endlessly attempting to perform the transmission.\n\nFix this by disabling DF on RESPONSE packets for now.  The use of DF and\nbest data MTU determination needs reconsidering at some point in the\nfuture.\n\nFixes: 17926a79320a (\"[AF_RXRPC]: Provide secure RxRPC sockets for use by userspace and kernel both\")\nReported-by: Marc Dionne <marc.dionne@auristor.com>\nSigned-off-by: David Howells <dhowells@redhat.com>\ncc: linux-afs@lists.infradead.org\nAcked-by: Paolo Abeni <pabeni@redhat.com>\nLink: https://lore.kernel.org/r/1581852.1704813048@warthog.procyon.org.uk\nSigned-off-by: Jakub Kicinski <kuba@kernel.org>",
  "author_name": "David Howells",
  "author_email": "dhowells@redhat.com",
  "author_date": "Tue Jan 9 15:10:48 2024 +0000",
  "author_date_iso": "2024-01-09T15:10:48+00:00",
  "committer_name": "Jakub Kicinski",
  "committer_email": "kuba@kernel.org",
  "committer_date": "Thu Jan 11 16:41:41 2024 -0800",
  "committer_date_iso": "2024-01-11T16:41:41-08:00",
  "files_changed": [
    "net/rxrpc/ar-internal.h",
    "net/rxrpc/local_object.c",
    "net/rxrpc/output.c",
    "net/rxrpc/rxkad.c"
  ],
  "files_changed_count": 4,
  "stats": [
    {
      "file": "net/rxrpc/ar-internal.h",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "net/rxrpc/local_object.c",
      "insertions": 12,
      "deletions": 1
    },
    {
      "file": "net/rxrpc/output.c",
      "insertions": 2,
      "deletions": 4
    },
    {
      "file": "net/rxrpc/rxkad.c",
      "insertions": 2,
      "deletions": 0
    }
  ],
  "total_insertions": 17,
  "total_deletions": 5,
  "total_changes": 22,
  "parents": [
    "844f104790bd69c2e4dbb9ee3eba46fde1fcea7b"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "authentication"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "net/rxrpc/ar-internal.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "net/rxrpc/local_object.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "net/rxrpc/output.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "net/rxrpc/rxkad.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}