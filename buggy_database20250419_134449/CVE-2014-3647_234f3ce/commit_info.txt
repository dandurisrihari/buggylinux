Commit Hash: 234f3ce485d54017f15cf5e0699cff4100121601
Subject: KVM: x86: Emulator fixes for eip canonical checks on near branches

CVE Identifiers:
- CVE-2014-3647

Full commit message:
KVM: x86: Emulator fixes for eip canonical checks on near branches

Before changing rip (during jmp, call, ret, etc.) the target should be asserted
to be canonical one, as real CPUs do.  During sysret, both target rsp and rip
should be canonical. If any of these values is noncanonical, a #GP exception
should occur.  The exception to this rule are syscall and sysenter instructions
in which the assigned rip is checked during the assignment to the relevant
MSRs.

This patch fixes the emulator to behave as real CPUs do for near branches.
Far branches are handled by the next patch.

This fixes CVE-2014-3647.

Cc: stable@vger.kernel.org
Signed-off-by: Nadav Amit <namit@cs.technion.ac.il>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

Metadata:
Author: Nadav Amit <namit@cs.technion.ac.il>
Author Date: Thu Sep 18 22:39:38 2014 +0300
Committer: Paolo Bonzini <pbonzini@redhat.com>
Commit Date: Fri Oct 24 13:21:16 2014 +0200

Files Changed: 1
Lines Added: 54
Lines Removed: 24
Total Changes: 78
