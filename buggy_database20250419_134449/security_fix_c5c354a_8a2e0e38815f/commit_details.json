{
  "hash": "c5c354a3a4728045e1342166394c615d75d45377",
  "hash_short": "c5c354a3",
  "subject": "drm/udl: Fix inconsistent urbs.count value during udl_free_urb_list()",
  "body": "In the current design, udl_get_urb() may be called asynchronously\nduring the driver freeing its URL list via udl_free_urb_list().\nThe problem is that the sync is determined by comparing the urbs.count\nand urbs.available fields, while we clear urbs.count field only once\nafter udl_free_urb_list() finishes, i.e. during udl_free_urb_list(),\nthe state becomes inconsistent.\n\nFor fixing this inconsistency and also for hardening the locking\nscheme, this patch does a slight refactoring of the code around\nudl_get_urb() and udl_free_urb_list().  Now urbs.count is updated in\nthe same spinlock at extracting a URB from the list in\nudl_free_url_list().\n\nAcked-by: Thomas Zimmermann <tzimmermann@suse.de>\nSigned-off-by: Takashi Iwai <tiwai@suse.de>\nSigned-off-by: Thomas Zimmermann <tzimmermann@suse.de>\nLink: https://patchwork.freedesktop.org/patch/msgid/20220908095115.23396-11-tiwai@suse.de",
  "full_message": "drm/udl: Fix inconsistent urbs.count value during udl_free_urb_list()\n\nIn the current design, udl_get_urb() may be called asynchronously\nduring the driver freeing its URL list via udl_free_urb_list().\nThe problem is that the sync is determined by comparing the urbs.count\nand urbs.available fields, while we clear urbs.count field only once\nafter udl_free_urb_list() finishes, i.e. during udl_free_urb_list(),\nthe state becomes inconsistent.\n\nFor fixing this inconsistency and also for hardening the locking\nscheme, this patch does a slight refactoring of the code around\nudl_get_urb() and udl_free_urb_list().  Now urbs.count is updated in\nthe same spinlock at extracting a URB from the list in\nudl_free_url_list().\n\nAcked-by: Thomas Zimmermann <tzimmermann@suse.de>\nSigned-off-by: Takashi Iwai <tiwai@suse.de>\nSigned-off-by: Thomas Zimmermann <tzimmermann@suse.de>\nLink: https://patchwork.freedesktop.org/patch/msgid/20220908095115.23396-11-tiwai@suse.de",
  "author_name": "Takashi Iwai",
  "author_email": "tiwai@suse.de",
  "author_date": "Thu Sep 8 11:51:13 2022 +0200",
  "author_date_iso": "2022-09-08T11:51:13+02:00",
  "committer_name": "Thomas Zimmermann",
  "committer_email": "tzimmermann@suse.de",
  "committer_date": "Sat Sep 10 21:45:52 2022 +0200",
  "committer_date_iso": "2022-09-10T21:45:52+02:00",
  "files_changed": [
    "drivers/gpu/drm/udl/udl_drv.h",
    "drivers/gpu/drm/udl/udl_main.c"
  ],
  "files_changed_count": 2,
  "stats": [
    {
      "file": "drivers/gpu/drm/udl/udl_drv.h",
      "insertions": 1,
      "deletions": 7
    },
    {
      "file": "drivers/gpu/drm/udl/udl_main.c",
      "insertions": 29,
      "deletions": 13
    }
  ],
  "total_insertions": 30,
  "total_deletions": 20,
  "total_changes": 50,
  "parents": [
    "046f4f0af7fd1fad06793d863d288c6b2cd84e99"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "hardening"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/gpu/drm/udl/udl_drv.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/gpu/drm/udl/udl_main.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}