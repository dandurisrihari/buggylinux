commit 33dfafa90285c0873a24d633877d505ab8e3fc20
Author: Kent Overstreet <kent.overstreet@linux.dev>
Date:   Wed Jun 19 09:55:48 2024 -0400

    bcachefs: Fix safe errors by default
    
    i.e. the start of automatic self healing:
    
    If errors=continue or fix_safe, we now automatically fix simple errors
    without user intervention.
    
    New error action option: fix_safe
    
    This replaces the existing errors=ro option, which gets a new slot, i.e.
    existing errors=ro users now get errors=fix_safe.
    
    This is currently only enabled for a limited set of errors - initially
    just disk accounting; errors we would never not want to fix, and we
    don't want to require user intervention (i.e. to make sure a bug report
    gets filed).
    
    Errors will still be counted in the superblock, so we (developers) will
    still know they've been occuring if a bug report gets filed (as bug
    reports typically include the errors superblock section).
    
    Eventually we'll be enabling this for a much wider set of errors, after
    we've done thorough error injection testing.
    
    Signed-off-by: Kent Overstreet <kent.overstreet@linux.dev>

diff --git a/fs/bcachefs/opts.h b/fs/bcachefs/opts.h
index 25530e0bb2f3..b197ec90d4cb 100644
--- a/fs/bcachefs/opts.h
+++ b/fs/bcachefs/opts.h
@@ -137,7 +137,7 @@ enum fsck_err_opts {
 	x(errors,			u8,				\
 	  OPT_FS|OPT_FORMAT|OPT_MOUNT|OPT_RUNTIME,			\
 	  OPT_STR(bch2_error_actions),					\
-	  BCH_SB_ERROR_ACTION,		BCH_ON_ERROR_ro,		\
+	  BCH_SB_ERROR_ACTION,		BCH_ON_ERROR_fix_safe,		\
 	  NULL,		"Action to take on filesystem error")		\
 	x(metadata_replicas,		u8,				\
 	  OPT_FS|OPT_FORMAT|OPT_MOUNT|OPT_RUNTIME,			\