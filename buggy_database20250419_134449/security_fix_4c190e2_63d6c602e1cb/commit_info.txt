Commit Hash: 4c190e2f913f038c9c91ee63b59cd037260ba353
Subject: sunrpc: trim off trailing checksum before returning decrypted or integrity authenticated buffer


Security Keywords:
- authentication

Full commit message:
sunrpc: trim off trailing checksum before returning decrypted or integrity authenticated buffer

When GSSAPI integrity signatures are in use, or when we're using GSSAPI
privacy with the v2 token format, there is a trailing checksum on the
xdr_buf that is returned.

It's checked during the authentication stage, and afterward nothing
cares about it. Ordinarily, it's not a problem since the XDR code
generally ignores it, but it will be when we try to compute a checksum
over the buffer to help prevent XID collisions in the duplicate reply
cache.

Fix the code to trim off the checksums after verifying them. Note that
in unwrap_integ_data, we must avoid trying to reverify the checksum if
the request was deferred since it will no longer be present when it's
revisited.

Signed-off-by: Jeff Layton <jlayton@redhat.com>

Metadata:
Author: Jeff Layton <jlayton@redhat.com>
Author Date: Wed Feb 6 08:28:55 2013 -0500
Committer: J. Bruce Fields <bfields@redhat.com>
Commit Date: Fri Feb 8 15:19:10 2013 -0500

Files Changed: 4
Lines Added: 52
Lines Removed: 2
Total Changes: 54
