Commit Hash: 835745a377a4519decd1a36d6b926e369b3033e2
Subject: nouveau/dmem: Fix vulnerability in migrate_to_ram upon copy error


Security Keywords:
- security vulnerability
- vulnerability

Full commit message:
nouveau/dmem: Fix vulnerability in migrate_to_ram upon copy error

The `nouveau_dmem_copy_one` function ensures that the copy push command is
sent to the device firmware but does not track whether it was executed
successfully.

In the case of a copy error (e.g., firmware or hardware failure), the
copy push command will be sent via the firmware channel, and
`nouveau_dmem_copy_one` will likely report success, leading to the
`migrate_to_ram` function returning a dirty HIGH_USER page to the user.

This can result in a security vulnerability, as a HIGH_USER page that may
contain sensitive or corrupted data could be returned to the user.

To prevent this vulnerability, we allocate a zero page. Thus, in case of
an error, a non-dirty (zero) page will be returned to the user.

Fixes: 5be73b690875 ("drm/nouveau/dmem: device memory helpers for SVM")
Signed-off-by: Yonatan Maman <Ymaman@Nvidia.com>
Co-developed-by: Gal Shalom <GalShalom@Nvidia.com>
Signed-off-by: Gal Shalom <GalShalom@Nvidia.com>
Reviewed-by: Ben Skeggs <bskeggs@nvidia.com>
Cc: stable@vger.kernel.org
Signed-off-by: Danilo Krummrich <dakr@kernel.org>
Link: https://patchwork.freedesktop.org/patch/msgid/20241008115943.990286-3-ymaman@nvidia.com

Metadata:
Author: Yonatan Maman <Ymaman@Nvidia.com>
Author Date: Tue Oct 8 14:59:43 2024 +0300
Committer: Danilo Krummrich <dakr@kernel.org>
Commit Date: Tue Oct 8 14:23:38 2024 +0200

Files Changed: 1
Lines Added: 1
Lines Removed: 1
Total Changes: 2
