{
  "hash": "04cb8453a91c7c22f60ddadb6cef0d19abb33bb5",
  "hash_short": "04cb8453",
  "subject": "bpftool: JIT limited misreported as negative value on aarch64",
  "body": "On aarch64, \"bpftool feature\" reports an incorrect BPF JIT limit:\n\n$ sudo /sbin/bpftool feature\nScanning system configuration...\nbpf() syscall restricted to privileged users\nJIT compiler is enabled\nJIT compiler hardening is disabled\nJIT compiler kallsyms exports are enabled for root\nskipping kernel config, can't open file: No such file or directory\nGlobal memory limit for JIT compiler for unprivileged users is -201326592 bytes\n\nThis is because /proc/sys/net/core/bpf_jit_limit reports\n\n$ sudo cat /proc/sys/net/core/bpf_jit_limit\n68169519595520\n\n...and an int is assumed in read_procfs().  Change read_procfs()\nto return a long to avoid negative value reporting.\n\nFixes: 7a4522bbef0c (\"tools: bpftool: add probes for /proc/ eBPF parameters\")\nReported-by: Nicky Veitch <nicky.veitch@oracle.com>\nSigned-off-by: Alan Maguire <alan.maguire@oracle.com>\nSigned-off-by: Daniel Borkmann <daniel@iogearbox.net>\nAcked-by: Jiri Olsa <jolsa@kernel.org>\nAcked-by: Quentin Monnet <quentin@isovalent.com>\nLink: https://lore.kernel.org/bpf/20230512113134.58996-1-alan.maguire@oracle.com",
  "full_message": "bpftool: JIT limited misreported as negative value on aarch64\n\nOn aarch64, \"bpftool feature\" reports an incorrect BPF JIT limit:\n\n$ sudo /sbin/bpftool feature\nScanning system configuration...\nbpf() syscall restricted to privileged users\nJIT compiler is enabled\nJIT compiler hardening is disabled\nJIT compiler kallsyms exports are enabled for root\nskipping kernel config, can't open file: No such file or directory\nGlobal memory limit for JIT compiler for unprivileged users is -201326592 bytes\n\nThis is because /proc/sys/net/core/bpf_jit_limit reports\n\n$ sudo cat /proc/sys/net/core/bpf_jit_limit\n68169519595520\n\n...and an int is assumed in read_procfs().  Change read_procfs()\nto return a long to avoid negative value reporting.\n\nFixes: 7a4522bbef0c (\"tools: bpftool: add probes for /proc/ eBPF parameters\")\nReported-by: Nicky Veitch <nicky.veitch@oracle.com>\nSigned-off-by: Alan Maguire <alan.maguire@oracle.com>\nSigned-off-by: Daniel Borkmann <daniel@iogearbox.net>\nAcked-by: Jiri Olsa <jolsa@kernel.org>\nAcked-by: Quentin Monnet <quentin@isovalent.com>\nLink: https://lore.kernel.org/bpf/20230512113134.58996-1-alan.maguire@oracle.com",
  "author_name": "Alan Maguire",
  "author_email": "alan.maguire@oracle.com",
  "author_date": "Fri May 12 12:31:34 2023 +0100",
  "author_date_iso": "2023-05-12T12:31:34+01:00",
  "committer_name": "Daniel Borkmann",
  "committer_email": "daniel@iogearbox.net",
  "committer_date": "Mon May 15 21:14:48 2023 +0200",
  "committer_date_iso": "2023-05-15T21:14:48+02:00",
  "files_changed": [
    "tools/bpf/bpftool/feature.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "tools/bpf/bpftool/feature.c",
      "insertions": 12,
      "deletions": 12
    }
  ],
  "total_insertions": 12,
  "total_deletions": 12,
  "total_changes": 24,
  "parents": [
    "d84b1a6708eec06b6cd9d33c5e0177bbd6ba4813"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "hardening"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "tools/bpf/bpftool/feature.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}