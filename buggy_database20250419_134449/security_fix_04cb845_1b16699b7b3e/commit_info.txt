Commit Hash: 04cb8453a91c7c22f60ddadb6cef0d19abb33bb5
Subject: bpftool: JIT limited misreported as negative value on aarch64


Security Keywords:
- hardening

Full commit message:
bpftool: JIT limited misreported as negative value on aarch64

On aarch64, "bpftool feature" reports an incorrect BPF JIT limit:

$ sudo /sbin/bpftool feature
Scanning system configuration...
bpf() syscall restricted to privileged users
JIT compiler is enabled
JIT compiler hardening is disabled
JIT compiler kallsyms exports are enabled for root
skipping kernel config, can't open file: No such file or directory
Global memory limit for JIT compiler for unprivileged users is -201326592 bytes

This is because /proc/sys/net/core/bpf_jit_limit reports

$ sudo cat /proc/sys/net/core/bpf_jit_limit
68169519595520

...and an int is assumed in read_procfs().  Change read_procfs()
to return a long to avoid negative value reporting.

Fixes: 7a4522bbef0c ("tools: bpftool: add probes for /proc/ eBPF parameters")
Reported-by: Nicky Veitch <nicky.veitch@oracle.com>
Signed-off-by: Alan Maguire <alan.maguire@oracle.com>
Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
Acked-by: Jiri Olsa <jolsa@kernel.org>
Acked-by: Quentin Monnet <quentin@isovalent.com>
Link: https://lore.kernel.org/bpf/20230512113134.58996-1-alan.maguire@oracle.com

Metadata:
Author: Alan Maguire <alan.maguire@oracle.com>
Author Date: Fri May 12 12:31:34 2023 +0100
Committer: Daniel Borkmann <daniel@iogearbox.net>
Commit Date: Mon May 15 21:14:48 2023 +0200

Files Changed: 1
Lines Added: 12
Lines Removed: 12
Total Changes: 24
