commit 4bf97069239bcfca9840936313c7ac35a6e04488
Author: Charlie Jenkins <charlie@rivosinc.com>
Date:   Wed Nov 13 18:21:20 2024 -0800

    riscv: Add ghostwrite vulnerability
    
    Follow the patterns of the other architectures that use
    GENERIC_CPU_VULNERABILITIES for riscv to introduce the ghostwrite
    vulnerability and mitigation. The mitigation is to disable all vector
    which is accomplished by clearing the bit from the cpufeature field.
    
    Ghostwrite only affects thead c9xx CPUs that impelment xtheadvector, so
    the vulerability will only be mitigated on these CPUs.
    
    Signed-off-by: Charlie Jenkins <charlie@rivosinc.com>
    Tested-by: Yangyu Chen <cyy@cyyself.name>
    Link: https://lore.kernel.org/r/20241113-xtheadvector-v11-14-236c22791ef9@rivosinc.com
    Signed-off-by: Palmer Dabbelt <palmer@rivosinc.com>

diff --git a/arch/riscv/Kconfig.errata b/arch/riscv/Kconfig.errata
index 2acc7d876e1f..e318119d570d 100644
--- a/arch/riscv/Kconfig.errata
+++ b/arch/riscv/Kconfig.errata
@@ -119,4 +119,15 @@ config ERRATA_THEAD_PMU
 
 	  If you don't know what to do here, say "Y".
 
+config ERRATA_THEAD_GHOSTWRITE
+	bool "Apply T-Head Ghostwrite errata"
+	depends on ERRATA_THEAD && RISCV_ISA_XTHEADVECTOR
+	default y
+	help
+	  The T-Head C9xx cores have a vulnerability in the xtheadvector
+	  instruction set. When this errata is enabled, the CPUs will be probed
+	  to determine if they are vulnerable and disable xtheadvector.
+
+	  If you don't know what to do here, say "Y".
+
 endmenu # "CPU errata selection"