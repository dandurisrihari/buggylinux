Commit Hash: da0b93d65e5bba6d4381f9dc99c547b60582e7a7
Subject: KVM: nSVM: Pull CS.Base from actual VMCB12 for soft int/ex re-injection


Security Keywords:
- injection

Full commit message:
KVM: nSVM: Pull CS.Base from actual VMCB12 for soft int/ex re-injection

enter_svm_guest_mode() first calls nested_vmcb02_prepare_control() to copy
control fields from VMCB12 to the current VMCB, then
nested_vmcb02_prepare_save() to perform a similar copy of the save area.

This means that nested_vmcb02_prepare_control() still runs with the
previous save area values in the current VMCB so it shouldn't take the L2
guest CS.Base from this area.

Explicitly pull CS.Base from the actual VMCB12 instead in
enter_svm_guest_mode().

Granted, having a non-zero CS.Base is a very rare thing (and even
impossible in 64-bit mode), having it change between nested VMRUNs is
probably even rarer, but if it happens it would create a really subtle bug
so it's better to fix it upfront.

Fixes: 6ef88d6e36c2 ("KVM: SVM: Re-inject INT3/INTO instead of retrying the instruction")
Signed-off-by: Maciej S. Szmigiero <maciej.szmigiero@oracle.com>
Message-Id: <4caa0f67589ae3c22c311ee0e6139496902f2edc.1658159083.git.maciej.szmigiero@oracle.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

Metadata:
Author: Maciej S. Szmigiero <maciej.szmigiero@oracle.com>
Author Date: Mon Jul 18 17:47:13 2022 +0200
Committer: Paolo Bonzini <pbonzini@redhat.com>
Commit Date: Thu Jul 28 13:22:14 2022 -0400

Files Changed: 1
Lines Added: 5
Lines Removed: 4
Total Changes: 9
