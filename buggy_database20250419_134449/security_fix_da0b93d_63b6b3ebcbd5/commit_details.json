{
  "hash": "da0b93d65e5bba6d4381f9dc99c547b60582e7a7",
  "hash_short": "da0b93d6",
  "subject": "KVM: nSVM: Pull CS.Base from actual VMCB12 for soft int/ex re-injection",
  "body": "enter_svm_guest_mode() first calls nested_vmcb02_prepare_control() to copy\ncontrol fields from VMCB12 to the current VMCB, then\nnested_vmcb02_prepare_save() to perform a similar copy of the save area.\n\nThis means that nested_vmcb02_prepare_control() still runs with the\nprevious save area values in the current VMCB so it shouldn't take the L2\nguest CS.Base from this area.\n\nExplicitly pull CS.Base from the actual VMCB12 instead in\nenter_svm_guest_mode().\n\nGranted, having a non-zero CS.Base is a very rare thing (and even\nimpossible in 64-bit mode), having it change between nested VMRUNs is\nprobably even rarer, but if it happens it would create a really subtle bug\nso it's better to fix it upfront.\n\nFixes: 6ef88d6e36c2 (\"KVM: SVM: Re-inject INT3/INTO instead of retrying the instruction\")\nSigned-off-by: Maciej S. Szmigiero <maciej.szmigiero@oracle.com>\nMessage-Id: <4caa0f67589ae3c22c311ee0e6139496902f2edc.1658159083.git.maciej.szmigiero@oracle.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "full_message": "KVM: nSVM: Pull CS.Base from actual VMCB12 for soft int/ex re-injection\n\nenter_svm_guest_mode() first calls nested_vmcb02_prepare_control() to copy\ncontrol fields from VMCB12 to the current VMCB, then\nnested_vmcb02_prepare_save() to perform a similar copy of the save area.\n\nThis means that nested_vmcb02_prepare_control() still runs with the\nprevious save area values in the current VMCB so it shouldn't take the L2\nguest CS.Base from this area.\n\nExplicitly pull CS.Base from the actual VMCB12 instead in\nenter_svm_guest_mode().\n\nGranted, having a non-zero CS.Base is a very rare thing (and even\nimpossible in 64-bit mode), having it change between nested VMRUNs is\nprobably even rarer, but if it happens it would create a really subtle bug\nso it's better to fix it upfront.\n\nFixes: 6ef88d6e36c2 (\"KVM: SVM: Re-inject INT3/INTO instead of retrying the instruction\")\nSigned-off-by: Maciej S. Szmigiero <maciej.szmigiero@oracle.com>\nMessage-Id: <4caa0f67589ae3c22c311ee0e6139496902f2edc.1658159083.git.maciej.szmigiero@oracle.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "author_name": "Maciej S. Szmigiero",
  "author_email": "maciej.szmigiero@oracle.com",
  "author_date": "Mon Jul 18 17:47:13 2022 +0200",
  "author_date_iso": "2022-07-18T17:47:13+02:00",
  "committer_name": "Paolo Bonzini",
  "committer_email": "pbonzini@redhat.com",
  "committer_date": "Thu Jul 28 13:22:14 2022 -0400",
  "committer_date_iso": "2022-07-28T13:22:14-04:00",
  "files_changed": [
    "arch/x86/kvm/svm/nested.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "arch/x86/kvm/svm/nested.c",
      "insertions": 5,
      "deletions": 4
    }
  ],
  "total_insertions": 5,
  "total_deletions": 4,
  "total_changes": 9,
  "parents": [
    "a4850b5590d01bf3fb19fda3fc5d433f7382a974"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/x86/kvm/svm/nested.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}