{
  "hash": "8081ad06b68a728e676d3b08e9ab70ce4039747b",
  "hash_short": "8081ad06",
  "subject": "KVM: x86: Set KVM_REQ_EVENT if run is canceled with req_immediate_exit set",
  "body": "Re-request KVM_REQ_EVENT if vcpu_enter_guest() bails after processing\npending requests and an immediate exit was requested.  This fixes a bug\nwhere a pending event, e.g. VMX preemption timer, is delayed and/or lost\nif the exit was deferred due to something other than a higher priority\n_injected_ event, e.g. due to a pending nested VM-Enter.  This bug only\naffects the !injected case as kvm_x86_ops.cancel_injection() sets\nKVM_REQ_EVENT to redo the injection, but that's purely serendipitous\nbehavior with respect to the deferred event.\n\nNote, emulated preemption timer isn't the only event that can be\naffected, it simply happens to be the only event where not re-requesting\nKVM_REQ_EVENT is blatantly visible to the guest.\n\nFixes: f4124500c2c13 (\"KVM: nVMX: Fully emulate preemption timer\")\nSigned-off-by: Sean Christopherson <sean.j.christopherson@intel.com>\nMessage-Id: <20200423022550.15113-4-sean.j.christopherson@intel.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "full_message": "KVM: x86: Set KVM_REQ_EVENT if run is canceled with req_immediate_exit set\n\nRe-request KVM_REQ_EVENT if vcpu_enter_guest() bails after processing\npending requests and an immediate exit was requested.  This fixes a bug\nwhere a pending event, e.g. VMX preemption timer, is delayed and/or lost\nif the exit was deferred due to something other than a higher priority\n_injected_ event, e.g. due to a pending nested VM-Enter.  This bug only\naffects the !injected case as kvm_x86_ops.cancel_injection() sets\nKVM_REQ_EVENT to redo the injection, but that's purely serendipitous\nbehavior with respect to the deferred event.\n\nNote, emulated preemption timer isn't the only event that can be\naffected, it simply happens to be the only event where not re-requesting\nKVM_REQ_EVENT is blatantly visible to the guest.\n\nFixes: f4124500c2c13 (\"KVM: nVMX: Fully emulate preemption timer\")\nSigned-off-by: Sean Christopherson <sean.j.christopherson@intel.com>\nMessage-Id: <20200423022550.15113-4-sean.j.christopherson@intel.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "author_name": "Sean Christopherson",
  "author_email": "sean.j.christopherson@intel.com",
  "author_date": "Wed Apr 22 19:25:40 2020 -0700",
  "author_date_iso": "2020-04-22T19:25:40-07:00",
  "committer_name": "Paolo Bonzini",
  "committer_email": "pbonzini@redhat.com",
  "committer_date": "Wed May 13 12:14:28 2020 -0400",
  "committer_date_iso": "2020-05-13T12:14:28-04:00",
  "files_changed": [
    "arch/x86/kvm/x86.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "arch/x86/kvm/x86.c",
      "insertions": 2,
      "deletions": 0
    }
  ],
  "total_insertions": 2,
  "total_deletions": 0,
  "total_changes": 2,
  "parents": [
    "d2060bd42e4482b15c35f961a294ee57f369027d"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/x86/kvm/x86.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}