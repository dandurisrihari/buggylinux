{
  "hash": "b3fd8e83ada0d51b71a84297480187e2d40e5ded",
  "hash_short": "b3fd8e83",
  "subject": "x86/alternatives: Use temporary mm for text poking",
  "body": "text_poke() can potentially compromise security as it sets temporary\nPTEs in the fixmap. These PTEs might be used to rewrite the kernel code\nfrom other cores accidentally or maliciously, if an attacker gains the\nability to write onto kernel memory.\n\nMoreover, since remote TLBs are not flushed after the temporary PTEs are\nremoved, the time-window in which the code is writable is not limited if\nthe fixmap PTEs - maliciously or accidentally - are cached in the TLB.\nTo address these potential security hazards, use a temporary mm for\npatching the code.\n\nFinally, text_poke() is also not conservative enough when mapping pages,\nas it always tries to map 2 pages, even when a single one is sufficient.\nSo try to be more conservative, and do not map more than needed.\n\nSigned-off-by: Nadav Amit <namit@vmware.com>\nSigned-off-by: Rick Edgecombe <rick.p.edgecombe@intel.com>\nSigned-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>\nCc: <akpm@linux-foundation.org>\nCc: <ard.biesheuvel@linaro.org>\nCc: <deneen.t.dock@intel.com>\nCc: <kernel-hardening@lists.openwall.com>\nCc: <kristen@linux.intel.com>\nCc: <linux_dti@icloud.com>\nCc: <will.deacon@arm.com>\nCc: Andy Lutomirski <luto@kernel.org>\nCc: Borislav Petkov <bp@alien8.de>\nCc: Dave Hansen <dave.hansen@intel.com>\nCc: H. Peter Anvin <hpa@zytor.com>\nCc: Kees Cook <keescook@chromium.org>\nCc: Linus Torvalds <torvalds@linux-foundation.org>\nCc: Masami Hiramatsu <mhiramat@kernel.org>\nCc: Rik van Riel <riel@surriel.com>\nCc: Thomas Gleixner <tglx@linutronix.de>\nLink: https://lkml.kernel.org/r/20190426001143.4983-8-namit@vmware.com\nSigned-off-by: Ingo Molnar <mingo@kernel.org>",
  "full_message": "x86/alternatives: Use temporary mm for text poking\n\ntext_poke() can potentially compromise security as it sets temporary\nPTEs in the fixmap. These PTEs might be used to rewrite the kernel code\nfrom other cores accidentally or maliciously, if an attacker gains the\nability to write onto kernel memory.\n\nMoreover, since remote TLBs are not flushed after the temporary PTEs are\nremoved, the time-window in which the code is writable is not limited if\nthe fixmap PTEs - maliciously or accidentally - are cached in the TLB.\nTo address these potential security hazards, use a temporary mm for\npatching the code.\n\nFinally, text_poke() is also not conservative enough when mapping pages,\nas it always tries to map 2 pages, even when a single one is sufficient.\nSo try to be more conservative, and do not map more than needed.\n\nSigned-off-by: Nadav Amit <namit@vmware.com>\nSigned-off-by: Rick Edgecombe <rick.p.edgecombe@intel.com>\nSigned-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>\nCc: <akpm@linux-foundation.org>\nCc: <ard.biesheuvel@linaro.org>\nCc: <deneen.t.dock@intel.com>\nCc: <kernel-hardening@lists.openwall.com>\nCc: <kristen@linux.intel.com>\nCc: <linux_dti@icloud.com>\nCc: <will.deacon@arm.com>\nCc: Andy Lutomirski <luto@kernel.org>\nCc: Borislav Petkov <bp@alien8.de>\nCc: Dave Hansen <dave.hansen@intel.com>\nCc: H. Peter Anvin <hpa@zytor.com>\nCc: Kees Cook <keescook@chromium.org>\nCc: Linus Torvalds <torvalds@linux-foundation.org>\nCc: Masami Hiramatsu <mhiramat@kernel.org>\nCc: Rik van Riel <riel@surriel.com>\nCc: Thomas Gleixner <tglx@linutronix.de>\nLink: https://lkml.kernel.org/r/20190426001143.4983-8-namit@vmware.com\nSigned-off-by: Ingo Molnar <mingo@kernel.org>",
  "author_name": "Nadav Amit",
  "author_email": "namit@vmware.com",
  "author_date": "Thu Apr 25 17:11:27 2019 -0700",
  "author_date_iso": "2019-04-25T17:11:27-07:00",
  "committer_name": "Ingo Molnar",
  "committer_email": "mingo@kernel.org",
  "committer_date": "Tue Apr 30 12:37:52 2019 +0200",
  "committer_date_iso": "2019-04-30T12:37:52+02:00",
  "files_changed": [
    "arch/x86/include/asm/fixmap.h",
    "arch/x86/kernel/alternative.c",
    "arch/x86/xen/mmu_pv.c"
  ],
  "files_changed_count": 3,
  "stats": [
    {
      "file": "arch/x86/include/asm/fixmap.h",
      "insertions": 0,
      "deletions": 2
    },
    {
      "file": "arch/x86/kernel/alternative.c",
      "insertions": 86,
      "deletions": 22
    },
    {
      "file": "arch/x86/xen/mmu_pv.c",
      "insertions": 0,
      "deletions": 2
    }
  ],
  "total_insertions": 86,
  "total_deletions": 26,
  "total_changes": 112,
  "parents": [
    "4fc19708b165c1c152fa1f12f6600e66184b7786"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v5.2",
    "v5.2-rc1",
    "v5.2-rc2",
    "v5.2-rc3",
    "v5.2-rc4",
    "v5.2-rc5",
    "v5.2-rc6",
    "v5.2-rc7",
    "v5.3",
    "v5.3-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "hardening"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/x86/include/asm/fixmap.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kernel/alternative.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/xen/mmu_pv.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}