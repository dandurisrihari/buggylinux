{
  "hash": "33ab91103b3415e12457e3104f0e4517ce12d0f3",
  "hash_short": "33ab9110",
  "subject": "KVM: x86: fix emulation of \"MOV SS, null selector\"",
  "body": "This is CVE-2017-2583.  On Intel this causes a failed vmentry because\nSS's type is neither 3 nor 7 (even though the manual says this check is\nonly done for usable SS, and the dmesg splat says that SS is unusable!).\nOn AMD it's worse: svm.c is confused and sets CPL to 0 in the vmcb.\n\nThe fix fabricates a data segment descriptor when SS is set to a null\nselector, so that CPL and SS.DPL are set correctly in the VMCS/vmcb.\nFurthermore, only allow setting SS to a NULL selector if SS.RPL < 3;\nthis in turn ensures CPL < 3 because RPL must be equal to CPL.\n\nThanks to Andy Lutomirski and Willy Tarreau for help in analyzing\nthe bug and deciphering the manuals.\n\nReported-by: Xiaohan Zhang <zhangxiaohan1@huawei.com>\nFixes: 79d5b4c3cd809c770d4bf9812635647016c56011\nCc: stable@nongnu.org\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "full_message": "KVM: x86: fix emulation of \"MOV SS, null selector\"\n\nThis is CVE-2017-2583.  On Intel this causes a failed vmentry because\nSS's type is neither 3 nor 7 (even though the manual says this check is\nonly done for usable SS, and the dmesg splat says that SS is unusable!).\nOn AMD it's worse: svm.c is confused and sets CPL to 0 in the vmcb.\n\nThe fix fabricates a data segment descriptor when SS is set to a null\nselector, so that CPL and SS.DPL are set correctly in the VMCS/vmcb.\nFurthermore, only allow setting SS to a NULL selector if SS.RPL < 3;\nthis in turn ensures CPL < 3 because RPL must be equal to CPL.\n\nThanks to Andy Lutomirski and Willy Tarreau for help in analyzing\nthe bug and deciphering the manuals.\n\nReported-by: Xiaohan Zhang <zhangxiaohan1@huawei.com>\nFixes: 79d5b4c3cd809c770d4bf9812635647016c56011\nCc: stable@nongnu.org\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "author_name": "Paolo Bonzini",
  "author_email": "pbonzini@redhat.com",
  "author_date": "Thu Jan 12 15:02:32 2017 +0100",
  "author_date_iso": "2017-01-12T15:02:32+01:00",
  "committer_name": "Paolo Bonzini",
  "committer_email": "pbonzini@redhat.com",
  "committer_date": "Thu Jan 12 15:17:13 2017 +0100",
  "committer_date_iso": "2017-01-12T15:17:13+01:00",
  "files_changed": [
    "arch/x86/kvm/emulate.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "arch/x86/kvm/emulate.c",
      "insertions": 38,
      "deletions": 10
    }
  ],
  "total_insertions": 38,
  "total_deletions": 10,
  "total_changes": 48,
  "parents": [
    "546d87e5c903a7f3ee7b9f998949a94729fbc65b"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.10",
    "v4.10-rc4",
    "v4.10-rc5",
    "v4.10-rc6",
    "v4.10-rc7",
    "v4.10-rc8",
    "v4.11",
    "v4.11-rc1",
    "v4.11-rc2",
    "v4.11-rc3"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [
      "CVE-2017-2583"
    ],
    "security_keywords": []
  },
  "fix_type": "cve",
  "file_results": [
    {
      "file": "arch/x86/kvm/emulate.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}