Commit Hash: d6d142cb7f79bec6051c5ecf744b7a5309c5a0ee
Subject: IB/iser: Fix login with authentication


Security Keywords:
- authentication

Full commit message:
IB/iser: Fix login with authentication

The iSER Initiator uses two types of receive buffers:

  - one big login buffer posted by iser_post_recvl();
  - several small message buffers posted by iser_post_recvm().

The login buffer is used at the login phase and full feature phase in
the discovery session. It may take a few requests and responses to
complete the login phase. The message buffers are only used in the
normal operational session at the full feature phase.

After the commit referred in the fixes line, the login operation fails
if the authentication is enabled. That happens because the Initiator
posts a small receive buffer after the first response from Target. So,
the next send operation fails because Target's second response does not
fit into the small receive buffer.

This commit adds additional checks to prevent posting small receive
buffers until the full feature phase.

Fixes: 39b169ea0d36 ("IB/iser: Fix RNR errors")
Link: https://lore.kernel.org/r/20220805060135.18493-1-sergeygo@nvidia.com
Signed-off-by: Sergey Gorenko <sergeygo@nvidia.com>
Reviewed-by: Max Gurtovoy <mgurtovoy@nvidia.com>
Signed-off-by: Leon Romanovsky <leon@kernel.org>

Metadata:
Author: Sergey Gorenko <sergeygo@nvidia.com>
Author Date: Fri Aug 5 09:01:35 2022 +0300
Committer: Leon Romanovsky <leonro@nvidia.com>
Commit Date: Tue Aug 16 15:56:33 2022 +0300

Files Changed: 1
Lines Added: 6
Lines Removed: 1
Total Changes: 7
