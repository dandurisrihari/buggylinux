{
  "hash": "64badcb6d6459cc6f7b46f7d45e44c95ab874337",
  "hash_short": "64badcb6",
  "subject": "ath10k: workaround fw beaconing bug",
  "body": "Some firmware revisions don't wait for beacon tx\ncompletion before sending another SWBA event. This\ncould lead to hardware using old (freed) beacon\ndata in some cases, e.g. tx credit starvation\ncombined with missed TBTT. This is very very rare.\n\nOn non-IOMMU-enabled hosts this could be a\npossible security issue because hw could beacon\nsome random data on the air.  On IOMMU-enabled\nhosts DMAR faults would occur in most cases and\ntarget device would crash.\n\nSince there are no beacon tx completions (implicit\nnor explicit) propagated to host the only\nworkaround for this is to allocate a DMA-coherent\nbuffer for a lifetime of a vif and use it for all\nbeacon tx commands. Worst case for this approach\nis some beacons may become corrupted, e.g. garbled\nIEs or out-of-date TIM bitmap.\n\nKeep the original beacon-related code as-is in\ncase future firmware revisions solve this problem\nso that the old path can be easily re-enabled with\na fw_feature flag.\n\nSigned-off-by: Michal Kazior <michal.kazior@tieto.com>\nSigned-off-by: Kalle Valo <kvalo@qca.qualcomm.com>",
  "full_message": "ath10k: workaround fw beaconing bug\n\nSome firmware revisions don't wait for beacon tx\ncompletion before sending another SWBA event. This\ncould lead to hardware using old (freed) beacon\ndata in some cases, e.g. tx credit starvation\ncombined with missed TBTT. This is very very rare.\n\nOn non-IOMMU-enabled hosts this could be a\npossible security issue because hw could beacon\nsome random data on the air.  On IOMMU-enabled\nhosts DMAR faults would occur in most cases and\ntarget device would crash.\n\nSince there are no beacon tx completions (implicit\nnor explicit) propagated to host the only\nworkaround for this is to allocate a DMA-coherent\nbuffer for a lifetime of a vif and use it for all\nbeacon tx commands. Worst case for this approach\nis some beacons may become corrupted, e.g. garbled\nIEs or out-of-date TIM bitmap.\n\nKeep the original beacon-related code as-is in\ncase future firmware revisions solve this problem\nso that the old path can be easily re-enabled with\na fw_feature flag.\n\nSigned-off-by: Michal Kazior <michal.kazior@tieto.com>\nSigned-off-by: Kalle Valo <kvalo@qca.qualcomm.com>",
  "author_name": "Michal Kazior",
  "author_email": "michal.kazior@tieto.com",
  "author_date": "Thu Sep 18 11:18:02 2014 +0300",
  "author_date_iso": "2014-09-18T11:18:02+03:00",
  "committer_name": "Kalle Valo",
  "committer_email": "kvalo@qca.qualcomm.com",
  "committer_date": "Tue Sep 23 12:28:52 2014 +0300",
  "committer_date_iso": "2014-09-23T12:28:52+03:00",
  "files_changed": [
    "drivers/net/wireless/ath/ath10k/core.h",
    "drivers/net/wireless/ath/ath10k/mac.c",
    "drivers/net/wireless/ath/ath10k/mac.h",
    "drivers/net/wireless/ath/ath10k/wmi.c"
  ],
  "files_changed_count": 4,
  "stats": [
    {
      "file": "drivers/net/wireless/ath/ath10k/core.h",
      "insertions": 2,
      "deletions": 0
    },
    {
      "file": "drivers/net/wireless/ath/ath10k/mac.c",
      "insertions": 77,
      "deletions": 29
    },
    {
      "file": "drivers/net/wireless/ath/ath10k/mac.h",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "drivers/net/wireless/ath/ath10k/wmi.c",
      "insertions": 22,
      "deletions": 14
    }
  ],
  "total_insertions": 102,
  "total_deletions": 43,
  "total_changes": 145,
  "parents": [
    "b25f32cb02155d68c690255ba846796a1c248fd3"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v3.19",
    "v3.19-rc1",
    "v3.19-rc2",
    "v3.19-rc3",
    "v3.19-rc4",
    "v3.19-rc5",
    "v3.19-rc6",
    "v3.19-rc7",
    "v4.0",
    "v4.0-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "security issue"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/net/wireless/ath/ath10k/core.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/wireless/ath/ath10k/mac.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/wireless/ath/ath10k/mac.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/wireless/ath/ath10k/wmi.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}