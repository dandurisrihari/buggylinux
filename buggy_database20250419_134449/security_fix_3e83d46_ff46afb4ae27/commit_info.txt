Commit Hash: 3e83d467a08e25b27c44c885f511624a71c84f7c
Subject: s390/qeth: schedule TX NAPI on QAOB completion


Security Keywords:
- exploit

Full commit message:
s390/qeth: schedule TX NAPI on QAOB completion

When a QAOB notifies us that a pending TX buffer has been delivered, the
actual TX completion processing by qeth_tx_complete_pending_bufs()
is done within the context of a TX NAPI instance. We shouldn't rely on
this instance being scheduled by some other TX event, but just do it
ourselves.

qeth_qdio_handle_aob() is called from qeth_poll(), ie. our main NAPI
instance. To avoid touching the TX queue's NAPI instance
before/after it is (un-)registered, reorder the code in qeth_open()
and qeth_stop() accordingly.

Fixes: 0da9581ddb0f ("qeth: exploit asynchronous delivery of storage blocks")
Signed-off-by: Julian Wiedmann <jwi@linux.ibm.com>
Signed-off-by: David S. Miller <davem@davemloft.net>

Metadata:
Author: Julian Wiedmann <jwi@linux.ibm.com>
Author Date: Tue Mar 9 17:52:20 2021 +0100
Committer: David S. Miller <davem@davemloft.net>
Commit Date: Tue Mar 9 16:14:54 2021 -0800

Files Changed: 1
Lines Added: 12
Lines Removed: 6
Total Changes: 18
