{
  "hash": "33d4a5a7a5b4d02915d765064b2319e90a11cbde",
  "hash_short": "33d4a5a7",
  "subject": "cpu/hotplug: Fix out-of-bounds read when setting fail state",
  "body": "Setting invalid value to /sys/devices/system/cpu/cpuX/hotplug/fail\ncan control `struct cpuhp_step *sp` address, results in the following\nglobal-out-of-bounds read.\n\nReproducer:\n\n  # echo -2 > /sys/devices/system/cpu/cpu0/hotplug/fail\n\nKASAN report:\n\n  BUG: KASAN: global-out-of-bounds in write_cpuhp_fail+0x2cd/0x2e0\n  Read of size 8 at addr ffffffff89734438 by task bash/1941\n\n  CPU: 0 PID: 1941 Comm: bash Not tainted 5.2.0-rc6+ #31\n  Call Trace:\n   write_cpuhp_fail+0x2cd/0x2e0\n   dev_attr_store+0x58/0x80\n   sysfs_kf_write+0x13d/0x1a0\n   kernfs_fop_write+0x2bc/0x460\n   vfs_write+0x1e1/0x560\n   ksys_write+0x126/0x250\n   do_syscall_64+0xc1/0x390\n   entry_SYSCALL_64_after_hwframe+0x49/0xbe\n  RIP: 0033:0x7f05e4f4c970\n\n  The buggy address belongs to the variable:\n   cpu_hotplug_lock+0x98/0xa0\n\n  Memory state around the buggy address:\n   ffffffff89734300: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00\n   ffffffff89734380: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00\n  >ffffffff89734400: 00 00 00 00 fa fa fa fa 00 00 00 00 fa fa fa fa\n                                          ^\n   ffffffff89734480: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n   ffffffff89734500: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n\nAdd a sanity check for the value written from user space.\n\nFixes: 1db49484f21ed (\"smp/hotplug: Hotplug state fail injection\")\nSigned-off-by: Eiichi Tsukata <devel@etsukata.com>\nSigned-off-by: Thomas Gleixner <tglx@linutronix.de>\nCc: peterz@infradead.org\nLink: https://lkml.kernel.org/r/20190627024732.31672-1-devel@etsukata.com",
  "full_message": "cpu/hotplug: Fix out-of-bounds read when setting fail state\n\nSetting invalid value to /sys/devices/system/cpu/cpuX/hotplug/fail\ncan control `struct cpuhp_step *sp` address, results in the following\nglobal-out-of-bounds read.\n\nReproducer:\n\n  # echo -2 > /sys/devices/system/cpu/cpu0/hotplug/fail\n\nKASAN report:\n\n  BUG: KASAN: global-out-of-bounds in write_cpuhp_fail+0x2cd/0x2e0\n  Read of size 8 at addr ffffffff89734438 by task bash/1941\n\n  CPU: 0 PID: 1941 Comm: bash Not tainted 5.2.0-rc6+ #31\n  Call Trace:\n   write_cpuhp_fail+0x2cd/0x2e0\n   dev_attr_store+0x58/0x80\n   sysfs_kf_write+0x13d/0x1a0\n   kernfs_fop_write+0x2bc/0x460\n   vfs_write+0x1e1/0x560\n   ksys_write+0x126/0x250\n   do_syscall_64+0xc1/0x390\n   entry_SYSCALL_64_after_hwframe+0x49/0xbe\n  RIP: 0033:0x7f05e4f4c970\n\n  The buggy address belongs to the variable:\n   cpu_hotplug_lock+0x98/0xa0\n\n  Memory state around the buggy address:\n   ffffffff89734300: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00\n   ffffffff89734380: fa fa fa fa 00 00 00 00 00 00 00 00 00 00 00 00\n  >ffffffff89734400: 00 00 00 00 fa fa fa fa 00 00 00 00 fa fa fa fa\n                                          ^\n   ffffffff89734480: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n   ffffffff89734500: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n\nAdd a sanity check for the value written from user space.\n\nFixes: 1db49484f21ed (\"smp/hotplug: Hotplug state fail injection\")\nSigned-off-by: Eiichi Tsukata <devel@etsukata.com>\nSigned-off-by: Thomas Gleixner <tglx@linutronix.de>\nCc: peterz@infradead.org\nLink: https://lkml.kernel.org/r/20190627024732.31672-1-devel@etsukata.com",
  "author_name": "Eiichi Tsukata",
  "author_email": "devel@etsukata.com",
  "author_date": "Thu Jun 27 11:47:32 2019 +0900",
  "author_date_iso": "2019-06-27T11:47:32+09:00",
  "committer_name": "Thomas Gleixner",
  "committer_email": "tglx@linutronix.de",
  "committer_date": "Thu Jun 27 09:34:04 2019 +0200",
  "committer_date_iso": "2019-06-27T09:34:04+02:00",
  "files_changed": [
    "kernel/cpu.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "kernel/cpu.c",
      "insertions": 3,
      "deletions": 0
    }
  ],
  "total_insertions": 3,
  "total_deletions": 0,
  "total_changes": 3,
  "parents": [
    "1bf72720281770162c87990697eae1ba2f1d917a"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v5.2",
    "v5.2-rc7",
    "v5.3",
    "v5.3-rc1",
    "v5.3-rc2",
    "v5.3-rc3",
    "v5.3-rc4",
    "v5.3-rc5",
    "v5.3-rc6",
    "v5.3-rc7"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "kernel/cpu.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}