commit bbefd4fc8f590e765b455ef0a4deb6c105fee305
Author: Paolo Bonzini <pbonzini@redhat.com>
Date:   Mon Dec 14 07:49:54 2020 -0500

    KVM: x86: move kvm_inject_gp up from kvm_set_xcr to callers
    
    Push the injection of #GP up to the callers, so that they can just use
    kvm_complete_insn_gp.
    
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

diff --git a/arch/x86/kvm/svm/svm.c b/arch/x86/kvm/svm/svm.c
index 30681633193e..fdea0994e94f 100644
--- a/arch/x86/kvm/svm/svm.c
+++ b/arch/x86/kvm/svm/svm.c
@@ -2357,11 +2357,8 @@ static int xsetbv_interception(struct vcpu_svm *svm)
 	u64 new_bv = kvm_read_edx_eax(&svm->vcpu);
 	u32 index = kvm_rcx_read(&svm->vcpu);
 
-	if (kvm_set_xcr(&svm->vcpu, index, new_bv) == 0) {
-		return kvm_skip_emulated_instruction(&svm->vcpu);
-	}
-
-	return 1;
+	int err = kvm_set_xcr(&svm->vcpu, index, new_bv);
+	return kvm_complete_insn_gp(&svm->vcpu, err);
 }
 
 static int rdpru_interception(struct vcpu_svm *svm)