{
  "hash": "1db49484f21ed0fcdadd0635a3669f5f386546fa",
  "hash_short": "1db49484",
  "subject": "smp/hotplug: Hotplug state fail injection",
  "body": "Add a sysfs file to one-time fail a specific state. This can be used\nto test the state rollback code paths.\n\nSomething like this (hotplug-up.sh):\n\n  #!/bin/bash\n\n  echo 0 > /debug/sched_debug\n  echo 1 > /debug/tracing/events/cpuhp/enable\n\n  ALL_STATES=`cat /sys/devices/system/cpu/hotplug/states | cut -d':' -f1`\n  STATES=${1:-$ALL_STATES}\n\n  for state in $STATES\n  do\n\t  echo 0 > /sys/devices/system/cpu/cpu1/online\n\t  echo 0 > /debug/tracing/trace\n\t  echo Fail state: $state\n\t  echo $state > /sys/devices/system/cpu/cpu1/hotplug/fail\n\t  cat /sys/devices/system/cpu/cpu1/hotplug/fail\n\t  echo 1 > /sys/devices/system/cpu/cpu1/online\n\n\t  cat /debug/tracing/trace > hotfail-${state}.trace\n\n\t  sleep 1\n  done\n\nCan be used to test for all possible rollback (barring multi-instance)\nscenarios on CPU-up, CPU-down is a trivial modification of the above.\n\nSigned-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>\nSigned-off-by: Thomas Gleixner <tglx@linutronix.de>\nCc: bigeasy@linutronix.de\nCc: efault@gmx.de\nCc: rostedt@goodmis.org\nCc: max.byungchul.park@gmail.com\nLink: https://lkml.kernel.org/r/20170920170546.972581715@infradead.org",
  "full_message": "smp/hotplug: Hotplug state fail injection\n\nAdd a sysfs file to one-time fail a specific state. This can be used\nto test the state rollback code paths.\n\nSomething like this (hotplug-up.sh):\n\n  #!/bin/bash\n\n  echo 0 > /debug/sched_debug\n  echo 1 > /debug/tracing/events/cpuhp/enable\n\n  ALL_STATES=`cat /sys/devices/system/cpu/hotplug/states | cut -d':' -f1`\n  STATES=${1:-$ALL_STATES}\n\n  for state in $STATES\n  do\n\t  echo 0 > /sys/devices/system/cpu/cpu1/online\n\t  echo 0 > /debug/tracing/trace\n\t  echo Fail state: $state\n\t  echo $state > /sys/devices/system/cpu/cpu1/hotplug/fail\n\t  cat /sys/devices/system/cpu/cpu1/hotplug/fail\n\t  echo 1 > /sys/devices/system/cpu/cpu1/online\n\n\t  cat /debug/tracing/trace > hotfail-${state}.trace\n\n\t  sleep 1\n  done\n\nCan be used to test for all possible rollback (barring multi-instance)\nscenarios on CPU-up, CPU-down is a trivial modification of the above.\n\nSigned-off-by: Peter Zijlstra (Intel) <peterz@infradead.org>\nSigned-off-by: Thomas Gleixner <tglx@linutronix.de>\nCc: bigeasy@linutronix.de\nCc: efault@gmx.de\nCc: rostedt@goodmis.org\nCc: max.byungchul.park@gmail.com\nLink: https://lkml.kernel.org/r/20170920170546.972581715@infradead.org",
  "author_name": "Peter Zijlstra",
  "author_email": "peterz@infradead.org",
  "author_date": "Wed Sep 20 19:00:21 2017 +0200",
  "author_date_iso": "2017-09-20T19:00:21+02:00",
  "committer_name": "Thomas Gleixner",
  "committer_email": "tglx@linutronix.de",
  "committer_date": "Mon Sep 25 22:11:44 2017 +0200",
  "committer_date_iso": "2017-09-25T22:11:44+02:00",
  "files_changed": [
    "include/linux/cpuhotplug.h",
    "kernel/cpu.c"
  ],
  "files_changed_count": 2,
  "stats": [
    {
      "file": "include/linux/cpuhotplug.h",
      "insertions": 2,
      "deletions": 1
    },
    {
      "file": "kernel/cpu.c",
      "insertions": 59,
      "deletions": 1
    }
  ],
  "total_insertions": 61,
  "total_deletions": 2,
  "total_changes": 63,
  "parents": [
    "5ebe7742fff8be5f1359bc50f5d43fb6ff7bd060"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.14",
    "v4.14-rc3",
    "v4.14-rc4",
    "v4.14-rc5",
    "v4.14-rc6",
    "v4.14-rc7",
    "v4.14-rc8",
    "v4.15",
    "v4.15-rc1",
    "v4.15-rc2"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "include/linux/cpuhotplug.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "kernel/cpu.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}