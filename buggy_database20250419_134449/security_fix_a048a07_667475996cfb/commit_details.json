{
  "hash": "a048a07d7f4535baa4cbad6bc024f175317ab938",
  "hash_short": "a048a07d",
  "subject": "powerpc/64s: Add support for a store forwarding barrier at kernel entry/exit",
  "body": "On some CPUs we can prevent a vulnerability related to store-to-load\nforwarding by preventing store forwarding between privilege domains,\nby inserting a barrier in kernel entry and exit paths.\n\nThis is known to be the case on at least Power7, Power8 and Power9\npowerpc CPUs.\n\nBarriers must be inserted generally before the first load after moving\nto a higher privilege, and after the last store before moving to a\nlower privilege, HV and PR privilege transitions must be protected.\n\nBarriers are added as patch sections, with all kernel/hypervisor entry\npoints patched, and the exit points to lower privilge levels patched\nsimilarly to the RFI flush patching.\n\nFirmware advertisement is not implemented yet, so CPU flush types\nare hard coded.\n\nThanks to Michal Such\u00e1nek for bug fixes and review.\n\nSigned-off-by: Nicholas Piggin <npiggin@gmail.com>\nSigned-off-by: Mauricio Faria de Oliveira <mauricfo@linux.vnet.ibm.com>\nSigned-off-by: Michael Neuling <mikey@neuling.org>\nSigned-off-by: Michal Such\u00e1nek <msuchanek@suse.de>\nSigned-off-by: Michael Ellerman <mpe@ellerman.id.au>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
  "full_message": "powerpc/64s: Add support for a store forwarding barrier at kernel entry/exit\n\nOn some CPUs we can prevent a vulnerability related to store-to-load\nforwarding by preventing store forwarding between privilege domains,\nby inserting a barrier in kernel entry and exit paths.\n\nThis is known to be the case on at least Power7, Power8 and Power9\npowerpc CPUs.\n\nBarriers must be inserted generally before the first load after moving\nto a higher privilege, and after the last store before moving to a\nlower privilege, HV and PR privilege transitions must be protected.\n\nBarriers are added as patch sections, with all kernel/hypervisor entry\npoints patched, and the exit points to lower privilge levels patched\nsimilarly to the RFI flush patching.\n\nFirmware advertisement is not implemented yet, so CPU flush types\nare hard coded.\n\nThanks to Michal Such\u00e1nek for bug fixes and review.\n\nSigned-off-by: Nicholas Piggin <npiggin@gmail.com>\nSigned-off-by: Mauricio Faria de Oliveira <mauricfo@linux.vnet.ibm.com>\nSigned-off-by: Michael Neuling <mikey@neuling.org>\nSigned-off-by: Michal Such\u00e1nek <msuchanek@suse.de>\nSigned-off-by: Michael Ellerman <mpe@ellerman.id.au>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
  "author_name": "Nicholas Piggin",
  "author_email": "npiggin@gmail.com",
  "author_date": "Tue May 22 09:00:00 2018 +1000",
  "author_date_iso": "2018-05-22T09:00:00+10:00",
  "committer_name": "Linus Torvalds",
  "committer_email": "torvalds@linux-foundation.org",
  "committer_date": "Mon May 21 20:45:31 2018 -0700",
  "committer_date_iso": "2018-05-21T20:45:31-07:00",
  "files_changed": [
    "arch/powerpc/include/asm/exception-64s.h",
    "arch/powerpc/include/asm/feature-fixups.h",
    "arch/powerpc/include/asm/security_features.h",
    "arch/powerpc/kernel/exceptions-64s.S",
    "arch/powerpc/kernel/security.c",
    "arch/powerpc/kernel/vmlinux.lds.S",
    "arch/powerpc/lib/feature-fixups.c",
    "arch/powerpc/platforms/powernv/setup.c",
    "arch/powerpc/platforms/pseries/setup.c"
  ],
  "files_changed_count": 9,
  "stats": [
    {
      "file": "arch/powerpc/include/asm/exception-64s.h",
      "insertions": 29,
      "deletions": 0
    },
    {
      "file": "arch/powerpc/include/asm/feature-fixups.h",
      "insertions": 19,
      "deletions": 0
    },
    {
      "file": "arch/powerpc/include/asm/security_features.h",
      "insertions": 11,
      "deletions": 0
    },
    {
      "file": "arch/powerpc/kernel/exceptions-64s.S",
      "insertions": 17,
      "deletions": 2
    },
    {
      "file": "arch/powerpc/kernel/security.c",
      "insertions": 149,
      "deletions": 0
    },
    {
      "file": "arch/powerpc/kernel/vmlinux.lds.S",
      "insertions": 14,
      "deletions": 0
    },
    {
      "file": "arch/powerpc/lib/feature-fixups.c",
      "insertions": 115,
      "deletions": 0
    },
    {
      "file": "arch/powerpc/platforms/powernv/setup.c",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/powerpc/platforms/pseries/setup.c",
      "insertions": 1,
      "deletions": 0
    }
  ],
  "total_insertions": 356,
  "total_deletions": 2,
  "total_changes": 358,
  "parents": [
    "c85061e6e0ee07e131b929e6a17bb2e20d19b321"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.17",
    "v4.17-rc7",
    "v4.18",
    "v4.18-rc1",
    "v4.18-rc2",
    "v4.18-rc3",
    "v4.18-rc4",
    "v4.18-rc5",
    "v4.18-rc6",
    "v4.18-rc7"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "vulnerability"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/powerpc/kernel/exceptions-64s.S",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/powerpc/kernel/security.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/powerpc/include/asm/feature-fixups.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/powerpc/kernel/vmlinux.lds.S",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/powerpc/include/asm/exception-64s.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/powerpc/platforms/pseries/setup.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/powerpc/include/asm/security_features.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/powerpc/lib/feature-fixups.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/powerpc/platforms/powernv/setup.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}