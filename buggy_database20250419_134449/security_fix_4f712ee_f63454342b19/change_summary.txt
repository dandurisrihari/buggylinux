Files changed: 35
Insertions: 6663
Deletions: 2718
Total changes: 9381

File-specific changes:
Documentation/virt/kvm/api.rst: +41 -12
arch/arm64/Kconfig: +0 -1
arch/arm64/include/asm/cpu.h: +1 -0
arch/arm64/include/asm/cpufeature.h: +1 -0
arch/arm64/include/asm/kvm_arm.h: +1 -3
arch/arm64/include/asm/kvm_emulate.h: +2 -1
arch/arm64/include/asm/kvm_host.h: +98 -1
arch/arm64/include/asm/kvm_hyp.h: +1 -1
arch/arm64/include/asm/kvm_mmu.h: +20 -26
arch/arm64/include/asm/kvm_nested.h: +0 -1
arch/arm64/include/asm/kvm_pgtable.h: +2 -0
arch/arm64/include/asm/memory.h: +2 -0
arch/arm64/include/asm/sysreg.h: +4 -1
arch/arm64/include/uapi/asm/kvm.h: +9 -6
arch/arm64/kernel/cpufeature.c: +95 -10
arch/arm64/kernel/cpuinfo.c: +1 -0
arch/arm64/kernel/head.S: +15 -8
arch/arm64/kvm/Kconfig: +12 -3
arch/arm64/kvm/arch_timer.c: +1 -1
arch/arm64/kvm/arm.c: +13 -1
arch/arm64/kvm/check-res-bits.h: +125 -0
arch/arm64/kvm/debug.c: +2 -1
arch/arm64/kvm/emulate-nested.c: +176 -55
arch/arm64/kvm/fpsimd.c: +1 -1
arch/arm64/kvm/guest.c: +5 -2
arch/arm64/kvm/hyp/aarch32.c: +2 -2
arch/arm64/kvm/hyp/include/hyp/switch.h: +68 -62
arch/arm64/kvm/hyp/include/hyp/sysreg-sr.h: +21 -3
arch/arm64/kvm/hyp/nvhe/debug-sr.c: +6 -6
arch/arm64/kvm/hyp/nvhe/host.S: +1 -1
arch/arm64/kvm/hyp/nvhe/mm.c: +2 -2
arch/arm64/kvm/hyp/pgtable.c: +19 -5
arch/arm64/kvm/hyp/vhe/sysreg-sr.c: +1 -1
arch/arm64/kvm/inject_fault.c: +1 -1
arch/arm64/kvm/mmu.c: +11 -5
arch/arm64/kvm/nested.c: +273 -1
arch/arm64/kvm/pmu-emul.c: +8 -7
arch/arm64/kvm/sys_regs.c: +224 -42
arch/arm64/kvm/sys_regs.h: +2 -0
arch/arm64/kvm/vgic/vgic-debug.c: +1 -1
arch/arm64/kvm/vgic/vgic-init.c: +7 -3
arch/arm64/kvm/vgic/vgic-its.c: +40 -23
arch/arm64/kvm/vgic/vgic-v3.c: +2 -1
arch/arm64/kvm/vgic/vgic.c: +22 -40
arch/arm64/kvm/vgic/vgic.h: +11 -4
arch/arm64/tools/cpucaps: +1 -0
arch/arm64/tools/sysreg: +44 -1
arch/loongarch/Kconfig: +0 -1
arch/loongarch/include/uapi/asm/kvm.h: +0 -2
arch/loongarch/kvm/Kconfig: +1 -1
arch/loongarch/kvm/switch.S: +0 -6
arch/loongarch/kvm/timer.c: +10 -33
arch/loongarch/kvm/vcpu.c: +26 -7
arch/mips/Kconfig: +9 -9
arch/mips/include/uapi/asm/kvm.h: +0 -2
arch/mips/kvm/Kconfig: +2 -1
arch/powerpc/include/uapi/asm/kvm.h: +44 -1
arch/powerpc/kvm/Kconfig: +0 -1
arch/powerpc/kvm/powerpc.c: +1 -2
arch/riscv/include/uapi/asm/kvm.h: +2 -1
arch/riscv/kvm/Kconfig: +1 -0
arch/riscv/kvm/vcpu_insn.c: +13 -0
arch/riscv/kvm/vcpu_onereg.c: +4 -0
arch/s390/Kconfig: +0 -1
arch/s390/include/uapi/asm/kvm.h: +314 -1
arch/s390/kvm/Kconfig: +0 -1
arch/s390/kvm/diag.c: +1 -1
arch/s390/kvm/gaccess.c: +7 -7
arch/s390/kvm/interrupt.c: +2 -2
arch/s390/kvm/kvm-s390.c: +3 -3
arch/s390/kvm/priv.c: +2 -2
arch/s390/kvm/sigp.c: +1 -1
arch/x86/Kconfig: +0 -1
arch/x86/include/asm/hardirq.h: +1 -1
arch/x86/include/asm/idtentry.h: +1 -1
arch/x86/include/asm/irq.h: +1 -1
arch/x86/include/asm/irq_vectors.h: +0 -2
arch/x86/include/asm/kvm-x86-ops.h: +0 -1
arch/x86/include/asm/kvm-x86-pmu-ops.h: +1 -3
arch/x86/include/asm/kvm_host.h: +22 -6
arch/x86/include/asm/svm.h: +4 -4
arch/x86/include/asm/vmxfeatures.h: +1 -0
arch/x86/include/uapi/asm/kvm.h: +277 -8
arch/x86/include/uapi/asm/kvm_para.h: +1 -1
arch/x86/kernel/cpu/feat_ctl.c: +2 -0
arch/x86/kernel/idt.c: +1 -1
arch/x86/kernel/irq.c: +2 -2
arch/x86/kvm/Kconfig: +1 -3
arch/x86/kvm/debugfs.c: +1 -2
arch/x86/kvm/emulate.c: +20 -27
arch/x86/kvm/kvm_emulate.h: +2 -2
arch/x86/kvm/lapic.c: +30 -2
arch/x86/kvm/mmu/mmu.c: +24 -13
arch/x86/kvm/mmu/page_track.c: +66 -2
arch/x86/kvm/mmu/tdp_mmu.c: +87 -37
arch/x86/kvm/mmu/tdp_mmu.h: +1 -1
arch/x86/kvm/pmu.c: +103 -60
arch/x86/kvm/pmu.h: +51 -6
arch/x86/kvm/smm.c: +4 -11
arch/x86/kvm/svm/pmu.c: +8 -14
arch/x86/kvm/svm/svm.c: +12 -13
arch/x86/kvm/trace.h: +6 -3
arch/x86/kvm/vmx/nested.c: +2 -2
arch/x86/kvm/vmx/pmu_intel.c: +85 -135
arch/x86/kvm/vmx/vmx.c: +84 -73
arch/x86/kvm/vmx/vmx.h: +0 -2
arch/x86/kvm/x86.c: +114 -114
arch/x86/kvm/x86.h: +1 -6
arch/x86/kvm/xen.c: +219 -96
arch/x86/kvm/xen.h: +18 -0
drivers/vfio/pci/vfio_pci_core.c: +18 -1
drivers/vfio/vfio.h: +1 -1
drivers/vfio/vfio_main.c: +2 -2
include/kvm/arm_pmu.h: +0 -11
include/kvm/arm_vgic.h: +5 -4
include/linux/bits.h: +1 -7
include/linux/kvm_host.h: +46 -14
include/linux/kvm_types.h: +0 -8
include/linux/mm.h: +14 -0
include/uapi/asm-generic/bitsperlong.h: +4 -0
include/uapi/linux/bits.h: +15 -0
include/uapi/linux/kvm.h: +5 -684
scripts/gdb/linux/constants.py.in: +5 -1
scripts/gdb/linux/interrupts.py: +1 -1
tools/arch/riscv/include/asm/csr.h: +541 -0
tools/arch/riscv/include/asm/vdso/processor.h: +32 -0
tools/arch/x86/include/asm/irq_vectors.h: +1 -1
tools/testing/selftests/kvm/Makefile: +21 -10
tools/testing/selftests/kvm/aarch64/arch_timer.c: +22 -277
tools/testing/selftests/kvm/aarch64/debug-exceptions.c: +1 -1
tools/testing/selftests/kvm/aarch64/hypercalls.c: +2 -2
tools/testing/selftests/kvm/aarch64/page_fault_test.c: +1 -1
tools/testing/selftests/kvm/aarch64/set_id_regs.c: +11 -7
tools/testing/selftests/kvm/aarch64/vpmu_counter_access.c: +6 -22
tools/testing/selftests/kvm/arch_timer.c: +259 -0
tools/testing/selftests/kvm/guest_memfd_test.c: +3 -0
tools/testing/selftests/kvm/include/aarch64/kvm_util_arch.h: +7 -0
tools/testing/selftests/kvm/include/aarch64/processor.h: +0 -4
tools/testing/selftests/kvm/include/kvm_test_harness.h: +36 -0
tools/testing/selftests/kvm/include/kvm_util_base.h: +59 -8
tools/testing/selftests/kvm/include/riscv/arch_timer.h: +71 -0
tools/testing/selftests/kvm/include/riscv/kvm_util_arch.h: +7 -0
tools/testing/selftests/kvm/include/riscv/processor.h: +64 -8
tools/testing/selftests/kvm/include/s390x/kvm_util_arch.h: +7 -0
tools/testing/selftests/kvm/include/sparsebit.h: +38 -18
tools/testing/selftests/kvm/include/test_util.h: +2 -0
tools/testing/selftests/kvm/include/timer_test.h: +45 -0
tools/testing/selftests/kvm/include/x86_64/kvm_util_arch.h: +23 -0
tools/testing/selftests/kvm/include/x86_64/pmu.h: +97 -0
tools/testing/selftests/kvm/include/x86_64/processor.h: +124 -32
tools/testing/selftests/kvm/include/x86_64/sev.h: +107 -0
tools/testing/selftests/kvm/lib/aarch64/processor.c: +18 -6
tools/testing/selftests/kvm/lib/kvm_util.c: +114 -15
tools/testing/selftests/kvm/lib/riscv/handlers.S: +101 -0
tools/testing/selftests/kvm/lib/riscv/processor.c: +93 -3
tools/testing/selftests/kvm/lib/s390x/processor.c: +7 -6
tools/testing/selftests/kvm/lib/sparsebit.c: +24 -24
tools/testing/selftests/kvm/lib/ucall_common.c: +2 -1
tools/testing/selftests/kvm/lib/x86_64/pmu.c: +31 -0
tools/testing/selftests/kvm/lib/x86_64/processor.c: +53 -7
tools/testing/selftests/kvm/lib/x86_64/sev.c: +114 -0
tools/testing/selftests/kvm/riscv/arch_timer.c: +111 -0
tools/testing/selftests/kvm/riscv/get-reg-list.c: +9 -10
tools/testing/selftests/kvm/s390x/memop.c: +2 -0
tools/testing/selftests/kvm/x86_64/fix_hypercall_test.c: +18 -9
tools/testing/selftests/kvm/x86_64/pmu_counters_test.c: +620 -0
tools/testing/selftests/kvm/x86_64/pmu_event_filter_test.c: +45 -98
tools/testing/selftests/kvm/x86_64/private_mem_conversions_test.c: +2 -0
tools/testing/selftests/kvm/x86_64/sev_migrate_tests.c: +18 -42
tools/testing/selftests/kvm/x86_64/sev_smoke_test.c: +88 -0
tools/testing/selftests/kvm/x86_64/smaller_maxphyaddr_emulation_test.c: +1 -1
tools/testing/selftests/kvm/x86_64/sync_regs_test.c: +90 -31
tools/testing/selftests/kvm/x86_64/userspace_msr_exit_test.c: +21 -57
tools/testing/selftests/kvm/x86_64/vmx_pmu_caps_test.c: +13 -41
tools/testing/selftests/kvm/x86_64/xen_shinfo_test.c: +50 -9
virt/kvm/Kconfig: +4 -3
virt/kvm/async_pf.c: +49 -24
virt/kvm/kvm_main.c: +27 -10
virt/kvm/pfncache.c: +143 -108
