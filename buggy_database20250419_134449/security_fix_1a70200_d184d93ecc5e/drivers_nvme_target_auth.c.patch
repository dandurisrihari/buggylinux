commit 1a70200f404ae210b4f0334e3936e84f8edb6bc8
Author: Hannes Reinecke <hare@suse.de>
Date:   Mon Jun 27 11:52:07 2022 +0200

    nvmet-auth: expire authentication sessions
    
    Each authentication step is required to be completed within the
    KATO interval (or two minutes if not set). So add a workqueue function
    to reset the transaction ID and the expected next protocol step;
    this will automatically the next authentication command referring
    to the terminated authentication.
    
    Signed-off-by: Hannes Reinecke <hare@suse.de>
    Reviewed-by: Sagi Grimberg <sagi@grimberg.me>
    Signed-off-by: Christoph Hellwig <hch@lst.de>
    Signed-off-by: Jens Axboe <axboe@kernel.dk>

diff --git a/drivers/nvme/target/auth.c b/drivers/nvme/target/auth.c
index d5624bdf834b..bf92435c783c 100644
--- a/drivers/nvme/target/auth.c
+++ b/drivers/nvme/target/auth.c
@@ -218,6 +218,7 @@ int nvmet_setup_auth(struct nvmet_ctrl *ctrl)
 
 void nvmet_auth_sq_free(struct nvmet_sq *sq)
 {
+	cancel_delayed_work(&sq->auth_expired_work);
 	kfree(sq->dhchap_c1);
 	sq->dhchap_c1 = NULL;
 	kfree(sq->dhchap_c2);