{
  "hash": "b166a20b07382b8bc1dcee2a448715c9c2c81b5b",
  "hash_short": "b166a20b",
  "subject": "net/sctp: fix race condition in sctp_destroy_sock",
  "body": "If sctp_destroy_sock is called without sock_net(sk)->sctp.addr_wq_lock\nheld and sp->do_auto_asconf is true, then an element is removed\nfrom the auto_asconf_splist without any proper locking.\n\nThis can happen in the following functions:\n1. In sctp_accept, if sctp_sock_migrate fails.\n2. In inet_create or inet6_create, if there is a bpf program\n   attached to BPF_CGROUP_INET_SOCK_CREATE which denies\n   creation of the sctp socket.\n\nThe bug is fixed by acquiring addr_wq_lock in sctp_destroy_sock\ninstead of sctp_close.\n\nThis addresses CVE-2021-23133.\n\nReported-by: Or Cohen <orcohen@paloaltonetworks.com>\nReviewed-by: Xin Long <lucien.xin@gmail.com>\nFixes: 610236587600 (\"bpf: Add new cgroup attach type to enable sock modifications\")\nSigned-off-by: Or Cohen <orcohen@paloaltonetworks.com>\nAcked-by: Marcelo Ricardo Leitner <marcelo.leitner@gmail.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
  "full_message": "net/sctp: fix race condition in sctp_destroy_sock\n\nIf sctp_destroy_sock is called without sock_net(sk)->sctp.addr_wq_lock\nheld and sp->do_auto_asconf is true, then an element is removed\nfrom the auto_asconf_splist without any proper locking.\n\nThis can happen in the following functions:\n1. In sctp_accept, if sctp_sock_migrate fails.\n2. In inet_create or inet6_create, if there is a bpf program\n   attached to BPF_CGROUP_INET_SOCK_CREATE which denies\n   creation of the sctp socket.\n\nThe bug is fixed by acquiring addr_wq_lock in sctp_destroy_sock\ninstead of sctp_close.\n\nThis addresses CVE-2021-23133.\n\nReported-by: Or Cohen <orcohen@paloaltonetworks.com>\nReviewed-by: Xin Long <lucien.xin@gmail.com>\nFixes: 610236587600 (\"bpf: Add new cgroup attach type to enable sock modifications\")\nSigned-off-by: Or Cohen <orcohen@paloaltonetworks.com>\nAcked-by: Marcelo Ricardo Leitner <marcelo.leitner@gmail.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
  "author_name": "Or Cohen",
  "author_email": "orcohen@paloaltonetworks.com",
  "author_date": "Tue Apr 13 21:10:31 2021 +0300",
  "author_date_iso": "2021-04-13T21:10:31+03:00",
  "committer_name": "David S. Miller",
  "committer_email": "davem@davemloft.net",
  "committer_date": "Tue Apr 13 14:59:46 2021 -0700",
  "committer_date_iso": "2021-04-13T14:59:46-07:00",
  "files_changed": [
    "net/sctp/socket.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "net/sctp/socket.c",
      "insertions": 5,
      "deletions": 8
    }
  ],
  "total_insertions": 5,
  "total_deletions": 8,
  "total_changes": 13,
  "parents": [
    "ca09bf7bb109a37a7ff05f230bb3fa3627e6625f"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [
      "CVE-2021-23133"
    ],
    "security_keywords": []
  },
  "fix_type": "cve",
  "file_results": [
    {
      "file": "net/sctp/socket.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}