Commit Hash: 25888e30319f8896fc656fc68643e6a078263060
Subject: af_unix: limit recursion level


Security Keywords:
- exploit

Full commit message:
af_unix: limit recursion level

Its easy to eat all kernel memory and trigger NMI watchdog, using an
exploit program that queues unix sockets on top of others.

lkml ref : http://lkml.org/lkml/2010/11/25/8

This mechanism is used in applications, one choice we have is to have a
recursion limit.

Other limits might be needed as well (if we queue other types of files),
since the passfd mechanism is currently limited by socket receive queue
sizes only.

Add a recursion_level to unix socket, allowing up to 4 levels.

Each time we send an unix socket through sendfd mechanism, we copy its
recursion level (plus one) to receiver. This recursion level is cleared
when socket receive queue is emptied.

Reported-by: Марк Коренберг <socketpair@gmail.com>
Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com>
Signed-off-by: David S. Miller <davem@davemloft.net>

Metadata:
Author: Eric Dumazet <eric.dumazet@gmail.com>
Author Date: Thu Nov 25 04:11:39 2010 +0000
Committer: David S. Miller <davem@davemloft.net>
Commit Date: Mon Nov 29 09:45:15 2010 -0800

Files Changed: 3
Lines Added: 35
Lines Removed: 6
Total Changes: 41
