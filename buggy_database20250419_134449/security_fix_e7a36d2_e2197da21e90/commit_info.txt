Commit Hash: e7a36d27f6b9f389e41d8189a8a08919c6835732
Subject: s390/qeth: fix memory leak after failed TX Buffer allocation


Security Keywords:
- exploit

Full commit message:
s390/qeth: fix memory leak after failed TX Buffer allocation

When qeth_alloc_qdio_queues() fails to allocate one of the buffers that
back an Output Queue, the 'out_freeoutqbufs' path will free all
previously allocated buffers for this queue. But it misses to free the
half-finished queue struct itself.

Move the buffer allocation into qeth_alloc_output_queue(), and deal with
such errors internally.

Fixes: 0da9581ddb0f ("qeth: exploit asynchronous delivery of storage blocks")
Signed-off-by: Julian Wiedmann <jwi@linux.ibm.com>
Reviewed-by: Alexandra Winter <wintera@linux.ibm.com>
Signed-off-by: David S. Miller <davem@davemloft.net>

Metadata:
Author: Julian Wiedmann <jwi@linux.ibm.com>
Author Date: Tue Mar 9 17:52:18 2021 +0100
Committer: David S. Miller <davem@davemloft.net>
Commit Date: Tue Mar 9 16:14:53 2021 -0800

Files Changed: 1
Lines Added: 17
Lines Removed: 18
Total Changes: 35
