{
  "hash": "c9318a3e0218bc9dacc25be46b9eec363259536f",
  "hash_short": "c9318a3e",
  "subject": "scsi: 3w-9xxx: fix a missing-check bug",
  "body": "In twa_chrdev_ioctl(), the ioctl driver command is firstly copied from\nthe userspace pointer 'argp' and saved to the kernel object\n'driver_command'.  Then a security check is performed on the data buffer\nsize indicated by 'driver_command', which is\n'driver_command.buffer_length'. If the security check is passed, the\nentire ioctl command is copied again from the 'argp' pointer and saved\nto the kernel object 'tw_ioctl'. Then, various operations are performed\non 'tw_ioctl' according to the 'cmd'. Given that the 'argp' pointer\nresides in userspace, a malicious userspace process can race to change\nthe buffer size between the two copies. This way, the user can bypass\nthe security check and inject invalid data buffer size. This can cause\npotential security issues in the following execution.\n\nThis patch checks for capable(CAP_SYS_ADMIN) in twa_chrdev_open()t o\navoid the above issues.\n\nSigned-off-by: Wenwen Wang <wang6495@umn.edu>\nAcked-by: Adam Radford <aradford@gmail.com>\nSigned-off-by: Martin K. Petersen <martin.petersen@oracle.com>",
  "full_message": "scsi: 3w-9xxx: fix a missing-check bug\n\nIn twa_chrdev_ioctl(), the ioctl driver command is firstly copied from\nthe userspace pointer 'argp' and saved to the kernel object\n'driver_command'.  Then a security check is performed on the data buffer\nsize indicated by 'driver_command', which is\n'driver_command.buffer_length'. If the security check is passed, the\nentire ioctl command is copied again from the 'argp' pointer and saved\nto the kernel object 'tw_ioctl'. Then, various operations are performed\non 'tw_ioctl' according to the 'cmd'. Given that the 'argp' pointer\nresides in userspace, a malicious userspace process can race to change\nthe buffer size between the two copies. This way, the user can bypass\nthe security check and inject invalid data buffer size. This can cause\npotential security issues in the following execution.\n\nThis patch checks for capable(CAP_SYS_ADMIN) in twa_chrdev_open()t o\navoid the above issues.\n\nSigned-off-by: Wenwen Wang <wang6495@umn.edu>\nAcked-by: Adam Radford <aradford@gmail.com>\nSigned-off-by: Martin K. Petersen <martin.petersen@oracle.com>",
  "author_name": "Wenwen Wang",
  "author_email": "wang6495@umn.edu",
  "author_date": "Mon May 7 19:46:43 2018 -0500",
  "author_date_iso": "2018-05-07T19:46:43-05:00",
  "committer_name": "Martin K. Petersen",
  "committer_email": "martin.petersen@oracle.com",
  "committer_date": "Tue May 8 01:32:18 2018 -0400",
  "committer_date_iso": "2018-05-08T01:32:18-04:00",
  "files_changed": [
    "drivers/scsi/3w-9xxx.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/scsi/3w-9xxx.c",
      "insertions": 5,
      "deletions": 0
    }
  ],
  "total_insertions": 5,
  "total_deletions": 0,
  "total_changes": 5,
  "parents": [
    "a217b31165924af2989a0a454c4dff10b63ec6ea"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.18",
    "v4.18-rc1",
    "v4.18-rc2",
    "v4.18-rc3",
    "v4.18-rc4",
    "v4.18-rc5",
    "v4.18-rc6",
    "v4.18-rc7",
    "v4.18-rc8",
    "v4.19"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "inject",
      "bypass"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/scsi/3w-9xxx.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}