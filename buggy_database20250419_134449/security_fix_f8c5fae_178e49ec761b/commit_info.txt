Commit Hash: f8c5fae16649445e15656667f72bd51d777f7766
Subject: KVM: VMX: blocked-by-sti must not defer NMI injections


Security Keywords:
- injection

Full commit message:
KVM: VMX: blocked-by-sti must not defer NMI injections

As the processor may not consider GUEST_INTR_STATE_STI as a reason for
blocking NMI, it could return immediately with EXIT_REASON_NMI_WINDOW
when we asked for it. But as we consider this state as NMI-blocking, we
can run into an endless loop.

Resolve this by allowing NMI injection if just GUEST_INTR_STATE_STI is
active (originally suggested by Gleb). Intel confirmed that this is
safe, the processor will never complain about NMI injection in this
state.

Signed-off-by: Jan Kiszka <jan.kiszka@siemens.com>
KVM-Stable-Tag
Acked-by: Gleb Natapov <gleb@redhat.com>
Signed-off-by: Marcelo Tosatti <mtosatti@redhat.com>

Metadata:
Author: Jan Kiszka <jan.kiszka@siemens.com>
Author Date: Tue May 11 15:16:46 2010 +0200
Committer: Marcelo Tosatti <mtosatti@redhat.com>
Commit Date: Thu May 13 01:31:37 2010 -0300

Files Changed: 1
Lines Added: 1
Lines Removed: 2
Total Changes: 3
