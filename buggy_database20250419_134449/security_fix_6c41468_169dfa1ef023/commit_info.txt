Commit Hash: 6c41468c7c12d74843bb414fc00307ea8a6318c3
Subject: KVM: x86: Clear "has_error_code", not "error_code", for RM exception injection


Security Keywords:
- injection

Full commit message:
KVM: x86: Clear "has_error_code", not "error_code", for RM exception injection

When injecting an exception into a vCPU in Real Mode, suppress the error
code by clearing the flag that tracks whether the error code is valid, not
by clearing the error code itself.  The "typo" was introduced by recent
fix for SVM's funky Paged Real Mode.

Opportunistically hoist the logic above the tracepoint so that the trace
is coherent with respect to what is actually injected (this was also the
behavior prior to the buggy commit).

Fixes: b97f07458373 ("KVM: x86: determine if an exception has an error code only when injecting it.")
Cc: stable@vger.kernel.org
Cc: Maxim Levitsky <mlevitsk@redhat.com>
Signed-off-by: Sean Christopherson <seanjc@google.com>
Message-Id: <20230322143300.2209476-2-seanjc@google.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

Metadata:
Author: Sean Christopherson <seanjc@google.com>
Author Date: Wed Mar 22 07:32:59 2023 -0700
Committer: Paolo Bonzini <pbonzini@redhat.com>
Commit Date: Mon Mar 27 10:15:10 2023 -0400

Files Changed: 1
Lines Added: 9
Lines Removed: 2
Total Changes: 11
