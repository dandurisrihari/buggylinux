{
  "hash": "582c161cf38cf016cd573af6f087fa5fa786949b",
  "hash_short": "582c161c",
  "subject": "Merge tag 'hardening-v6.5-rc1' of git://git.kernel.org/pub/scm/linux/kernel/git/kees/linux",
  "body": "Pull hardening updates from Kees Cook:\n \"There are three areas of note:\n\n  A bunch of strlcpy()->strscpy() conversions ended up living in my tree\n  since they were either Acked by maintainers for me to carry, or got\n  ignored for multiple weeks (and were trivial changes).\n\n  The compiler option '-fstrict-flex-arrays=3' has been enabled\n  globally, and has been in -next for the entire devel cycle. This\n  changes compiler diagnostics (though mainly just -Warray-bounds which\n  is disabled) and potential UBSAN_BOUNDS and FORTIFY _warning_\n  coverage. In other words, there are no new restrictions, just\n  potentially new warnings. Any new FORTIFY warnings we've seen have\n  been fixed (usually in their respective subsystem trees). For more\n  details, see commit df8fc4e934c12b.\n\n  The under-development compiler attribute __counted_by has been added\n  so that we can start annotating flexible array members with their\n  associated structure member that tracks the count of flexible array\n  elements at run-time. It is possible (likely?) that the exact syntax\n  of the attribute will change before it is finalized, but GCC and Clang\n  are working together to sort it out. Any changes can be made to the\n  macro while we continue to add annotations.\n\n  As an example of that last case, I have a treewide commit waiting with\n  such annotations found via Coccinelle:\n\n    https://git.kernel.org/linus/adc5b3cb48a049563dc673f348eab7b6beba8a9b\n\n  Also see commit dd06e72e68bcb4 for more details.\n\n  Summary:\n\n   - Fix KMSAN vs FORTIFY in strlcpy/strlcat (Alexander Potapenko)\n\n   - Convert strreplace() to return string start (Andy Shevchenko)\n\n   - Flexible array conversions (Arnd Bergmann, Wyes Karny, Kees Cook)\n\n   - Add missing function prototypes seen with W=1 (Arnd Bergmann)\n\n   - Fix strscpy() kerndoc typo (Arne Welzel)\n\n   - Replace strlcpy() with strscpy() across many subsystems which were\n     either Acked by respective maintainers or were trivial changes that\n     went ignored for multiple weeks (Azeem Shaikh)\n\n   - Remove unneeded cc-option test for UBSAN_TRAP (Nick Desaulniers)\n\n   - Add KUnit tests for strcat()-family\n\n   - Enable KUnit tests of FORTIFY wrappers under UML\n\n   - Add more complete FORTIFY protections for strlcat()\n\n   - Add missed disabling of FORTIFY for all arch purgatories.\n\n   - Enable -fstrict-flex-arrays=3 globally\n\n   - Tightening UBSAN_BOUNDS when using GCC\n\n   - Improve checkpatch to check for strcpy, strncpy, and fake flex\n     arrays\n\n   - Improve use of const variables in FORTIFY\n\n   - Add requested struct_size_t() helper for types not pointers\n\n   - Add __counted_by macro for annotating flexible array size members\"\n\n* tag 'hardening-v6.5-rc1' of git://git.kernel.org/pub/scm/linux/kernel/git/kees/linux: (54 commits)\n  netfilter: ipset: Replace strlcpy with strscpy\n  uml: Replace strlcpy with strscpy\n  um: Use HOST_DIR for mrproper\n  kallsyms: Replace all non-returning strlcpy with strscpy\n  sh: Replace all non-returning strlcpy with strscpy\n  of/flattree: Replace all non-returning strlcpy with strscpy\n  sparc64: Replace all non-returning strlcpy with strscpy\n  Hexagon: Replace all non-returning strlcpy with strscpy\n  kobject: Use return value of strreplace()\n  lib/string_helpers: Change returned value of the strreplace()\n  jbd2: Avoid printing outside the boundary of the buffer\n  checkpatch: Check for 0-length and 1-element arrays\n  riscv/purgatory: Do not use fortified string functions\n  s390/purgatory: Do not use fortified string functions\n  x86/purgatory: Do not use fortified string functions\n  acpi: Replace struct acpi_table_slit 1-element array with flex-array\n  clocksource: Replace all non-returning strlcpy with strscpy\n  string: use __builtin_memcpy() in strlcpy/strlcat\n  staging: most: Replace all non-returning strlcpy with strscpy\n  drm/i2c: tda998x: Replace all non-returning strlcpy with strscpy\n  ...",
  "full_message": "Merge tag 'hardening-v6.5-rc1' of git://git.kernel.org/pub/scm/linux/kernel/git/kees/linux\n\nPull hardening updates from Kees Cook:\n \"There are three areas of note:\n\n  A bunch of strlcpy()->strscpy() conversions ended up living in my tree\n  since they were either Acked by maintainers for me to carry, or got\n  ignored for multiple weeks (and were trivial changes).\n\n  The compiler option '-fstrict-flex-arrays=3' has been enabled\n  globally, and has been in -next for the entire devel cycle. This\n  changes compiler diagnostics (though mainly just -Warray-bounds which\n  is disabled) and potential UBSAN_BOUNDS and FORTIFY _warning_\n  coverage. In other words, there are no new restrictions, just\n  potentially new warnings. Any new FORTIFY warnings we've seen have\n  been fixed (usually in their respective subsystem trees). For more\n  details, see commit df8fc4e934c12b.\n\n  The under-development compiler attribute __counted_by has been added\n  so that we can start annotating flexible array members with their\n  associated structure member that tracks the count of flexible array\n  elements at run-time. It is possible (likely?) that the exact syntax\n  of the attribute will change before it is finalized, but GCC and Clang\n  are working together to sort it out. Any changes can be made to the\n  macro while we continue to add annotations.\n\n  As an example of that last case, I have a treewide commit waiting with\n  such annotations found via Coccinelle:\n\n    https://git.kernel.org/linus/adc5b3cb48a049563dc673f348eab7b6beba8a9b\n\n  Also see commit dd06e72e68bcb4 for more details.\n\n  Summary:\n\n   - Fix KMSAN vs FORTIFY in strlcpy/strlcat (Alexander Potapenko)\n\n   - Convert strreplace() to return string start (Andy Shevchenko)\n\n   - Flexible array conversions (Arnd Bergmann, Wyes Karny, Kees Cook)\n\n   - Add missing function prototypes seen with W=1 (Arnd Bergmann)\n\n   - Fix strscpy() kerndoc typo (Arne Welzel)\n\n   - Replace strlcpy() with strscpy() across many subsystems which were\n     either Acked by respective maintainers or were trivial changes that\n     went ignored for multiple weeks (Azeem Shaikh)\n\n   - Remove unneeded cc-option test for UBSAN_TRAP (Nick Desaulniers)\n\n   - Add KUnit tests for strcat()-family\n\n   - Enable KUnit tests of FORTIFY wrappers under UML\n\n   - Add more complete FORTIFY protections for strlcat()\n\n   - Add missed disabling of FORTIFY for all arch purgatories.\n\n   - Enable -fstrict-flex-arrays=3 globally\n\n   - Tightening UBSAN_BOUNDS when using GCC\n\n   - Improve checkpatch to check for strcpy, strncpy, and fake flex\n     arrays\n\n   - Improve use of const variables in FORTIFY\n\n   - Add requested struct_size_t() helper for types not pointers\n\n   - Add __counted_by macro for annotating flexible array size members\"\n\n* tag 'hardening-v6.5-rc1' of git://git.kernel.org/pub/scm/linux/kernel/git/kees/linux: (54 commits)\n  netfilter: ipset: Replace strlcpy with strscpy\n  uml: Replace strlcpy with strscpy\n  um: Use HOST_DIR for mrproper\n  kallsyms: Replace all non-returning strlcpy with strscpy\n  sh: Replace all non-returning strlcpy with strscpy\n  of/flattree: Replace all non-returning strlcpy with strscpy\n  sparc64: Replace all non-returning strlcpy with strscpy\n  Hexagon: Replace all non-returning strlcpy with strscpy\n  kobject: Use return value of strreplace()\n  lib/string_helpers: Change returned value of the strreplace()\n  jbd2: Avoid printing outside the boundary of the buffer\n  checkpatch: Check for 0-length and 1-element arrays\n  riscv/purgatory: Do not use fortified string functions\n  s390/purgatory: Do not use fortified string functions\n  x86/purgatory: Do not use fortified string functions\n  acpi: Replace struct acpi_table_slit 1-element array with flex-array\n  clocksource: Replace all non-returning strlcpy with strscpy\n  string: use __builtin_memcpy() in strlcpy/strlcat\n  staging: most: Replace all non-returning strlcpy with strscpy\n  drm/i2c: tda998x: Replace all non-returning strlcpy with strscpy\n  ...",
  "author_name": "Linus Torvalds",
  "author_email": "torvalds@linux-foundation.org",
  "author_date": "Tue Jun 27 21:24:18 2023 -0700",
  "author_date_iso": "2023-06-27T21:24:18-07:00",
  "committer_name": "Linus Torvalds",
  "committer_email": "torvalds@linux-foundation.org",
  "committer_date": "Tue Jun 27 21:24:18 2023 -0700",
  "committer_date_iso": "2023-06-27T21:24:18-07:00",
  "files_changed": [
    "MAINTAINERS",
    "Makefile",
    "arch/riscv/purgatory/Makefile",
    "arch/s390/purgatory/Makefile",
    "arch/sh/kernel/setup.c",
    "arch/sparc/kernel/setup_32.c",
    "arch/x86/purgatory/Makefile",
    "drivers/gpu/drm/display/drm_dp_mst_topology.c",
    "drivers/md/raid5.c",
    "drivers/md/raid5.h",
    "drivers/misc/lkdtm/bugs.c",
    "include/linux/compiler_attributes.h",
    "kernel/trace/trace.c",
    "kernel/trace/trace_events.c",
    "lib/Kconfig.debug",
    "lib/Makefile"
  ],
  "files_changed_count": 16,
  "stats": [
    {
      "file": "Documentation/filesystems/autofs-mount-control.rst",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "Documentation/filesystems/autofs.rst",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "MAINTAINERS",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "Makefile",
      "insertions": 6,
      "deletions": 0
    },
    {
      "file": "arch/hexagon/kernel/setup.c",
      "insertions": 3,
      "deletions": 3
    },
    {
      "file": "arch/microblaze/kernel/prom.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/riscv/purgatory/Makefile",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/s390/purgatory/Makefile",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/sh/drivers/dma/dma-api.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/sh/kernel/setup.c",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "arch/sparc/kernel/ioport.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/sparc/kernel/setup_32.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/sparc/kernel/setup_64.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/sparc/prom/bootstr_32.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/um/Makefile",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/um/include/shared/user.h",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/um/os-Linux/drivers/tuntap_user.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/x86/purgatory/Makefile",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/gpu/drm/amd/amdgpu/atom.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/gpu/drm/amd/pm/legacy-dpm/legacy_dpm.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/gpu/drm/display/drm_dp_helper.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/gpu/drm/display/drm_dp_mst_topology.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/gpu/drm/drm_mipi_dsi.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/gpu/drm/i2c/tda998x_drv.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/gpu/drm/mediatek/mtk_hdmi_ddc.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/gpu/drm/radeon/radeon_atombios.c",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "drivers/gpu/drm/radeon/radeon_combios.c",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "drivers/gpu/drm/rockchip/inno_hdmi.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/gpu/drm/rockchip/rk3066_hdmi.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/gpu/drm/sun4i/sun4i_hdmi_i2c.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/md/raid5.c",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "drivers/md/raid5.h",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/misc/lkdtm/bugs.c",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "drivers/most/configfs.c",
      "insertions": 4,
      "deletions": 4
    },
    {
      "file": "drivers/net/ethernet/intel/ice/ice_ddp.h",
      "insertions": 4,
      "deletions": 5
    },
    {
      "file": "drivers/nvme/host/fc.c",
      "insertions": 4,
      "deletions": 4
    },
    {
      "file": "drivers/scsi/3w-9xxx.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/scsi/aacraid/aachba.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/scsi/bnx2i/bnx2i_init.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/scsi/hptiop.c",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "drivers/scsi/ibmvscsi/ibmvscsi.c",
      "insertions": 3,
      "deletions": 3
    },
    {
      "file": "drivers/scsi/megaraid/megaraid_sas_base.c",
      "insertions": 6,
      "deletions": 6
    },
    {
      "file": "drivers/scsi/megaraid/megaraid_sas_fp.c",
      "insertions": 3,
      "deletions": 3
    },
    {
      "file": "drivers/scsi/qedi/qedi_main.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/scsi/smartpqi/smartpqi_init.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "fs/befs/btree.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "fs/befs/linuxvfs.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "fs/dlm/config.c",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "fs/jbd2/journal.c",
      "insertions": 2,
      "deletions": 4
    },
    {
      "file": "fs/nfs/nfsroot.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "fs/vboxsf/super.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "fs/xfs/libxfs/xfs_btree.h",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "fs/xfs/scrub/btree.h",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "include/acpi/actbl3.h",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "include/linux/compiler_attributes.h",
      "insertions": 13,
      "deletions": 0
    },
    {
      "file": "include/linux/fortify-string.h",
      "insertions": 112,
      "deletions": 49
    },
    {
      "file": "include/linux/overflow.h",
      "insertions": 17,
      "deletions": 1
    },
    {
      "file": "include/linux/string.h",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "include/uapi/linux/auto_dev-ioctl.h",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "kernel/kallsyms.c",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "kernel/params.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "kernel/time/clocksource.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "kernel/trace/ftrace.c",
      "insertions": 9,
      "deletions": 9
    },
    {
      "file": "kernel/trace/trace.c",
      "insertions": 4,
      "deletions": 4
    },
    {
      "file": "kernel/trace/trace_events.c",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "kernel/trace/trace_events_inject.c",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "kernel/trace/trace_kprobe.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "kernel/trace/trace_probe.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "lib/Kconfig.debug",
      "insertions": 6,
      "deletions": 1
    },
    {
      "file": "lib/Kconfig.ubsan",
      "insertions": 31,
      "deletions": 26
    },
    {
      "file": "lib/Makefile",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "lib/fortify_kunit.c",
      "insertions": 14,
      "deletions": 0
    },
    {
      "file": "lib/kobject.c",
      "insertions": 1,
      "deletions": 2
    },
    {
      "file": "lib/overflow_kunit.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "lib/strcat_kunit.c",
      "insertions": 104,
      "deletions": 0
    },
    {
      "file": "lib/string.c",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "lib/string_helpers.c",
      "insertions": 8,
      "deletions": 4
    },
    {
      "file": "lib/ubsan.c",
      "insertions": 0,
      "deletions": 3
    },
    {
      "file": "lib/ubsan.h",
      "insertions": 11,
      "deletions": 0
    },
    {
      "file": "net/netfilter/ipset/ip_set_hash_netiface.c",
      "insertions": 5,
      "deletions": 5
    },
    {
      "file": "scripts/Makefile.ubsan",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "scripts/checkpatch.pl",
      "insertions": 23,
      "deletions": 1
    },
    {
      "file": "tools/testing/kunit/configs/all_tests.config",
      "insertions": 2,
      "deletions": 0
    },
    {
      "file": "tools/testing/kunit/configs/arch_uml.config",
      "insertions": 3,
      "deletions": 0
    }
  ],
  "total_insertions": 467,
  "total_deletions": 203,
  "total_changes": 670,
  "parents": [
    "8ad78685ffa6e3836b5b32197bffb03ee3389bec",
    "acf15e07eb06507c69f92394c36052677029b0a8"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": true,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "hardening"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "Makefile",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/riscv/purgatory/Makefile",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/sh/kernel/setup.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/s390/purgatory/Makefile",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/purgatory/Makefile",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "MAINTAINERS",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/sparc/kernel/setup_32.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/gpu/drm/display/drm_dp_mst_topology.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/md/raid5.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "kernel/trace/trace_events.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/linux/compiler_attributes.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/misc/lkdtm/bugs.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/md/raid5.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "lib/Kconfig.debug",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "lib/Makefile",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "kernel/trace/trace.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}