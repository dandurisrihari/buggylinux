commit 22e04f6b4b04a8afe9af9239224591d06ba3b24d
Merge: ec0ad7308021 4e5a494e4b4b
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Fri Sep 6 09:30:36 2013 -0700

    Merge branch 'for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/jikos/hid
    
    Pull HID updates from Jiri Kosina:
     "Highlights:
    
       - conversion of HID subsystem to use devm-based resource management,
         from Benjamin Tissoires
    
       - i2c-hid support for DT bindings, from Benjamin Tissoires
    
       - much improved support for Win8-multitouch devices, from Benjamin
         Tissoires
    
       - cleanup of core code using common hidinput_input_event(), from
         David Herrmann
    
       - fix for bug in implement() access to the bit stream (causing oops)
         that has been present in the code for ages, but devices that are
         able to trigger it have started to appear only now, from Jiri
         Kosina
    
       - fixes for CVE-2013-2899, CVE-2013-2898, CVE-2013-2896,
         CVE-2013-2892, CVE-2013-2888 (all triggerable only by specially
         crafted malicious HW devices plugged into the system), from Kees
         Cook
    
       - hidraw oops fix, from Manoj Chourasia
    
       - various smaller fixes here and there, support for a bunch of new
         devices by various contributors"
    
    * 'for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/jikos/hid: (53 commits)
      HID: MAINTAINERS: add roccat drivers
      HID: hid-sensor-hub: change kmalloc + memcpy by kmemdup
      HID: hid-sensor-hub: move to devm_kzalloc
      HID: hid-sensor-hub: fix indentation accross the code
      HID: move HID_REPORT_TYPES closer to the report-definitions
      HID: check for NULL field when setting values
      HID: picolcd_core: validate output report details
      HID: sensor-hub: validate feature report details
      HID: ntrig: validate feature report details
      HID: pantherlord: validate output report details
      HID: hid-wiimote: print small buffers via %*phC
      HID: uhid: improve uhid example client
      HID: Correct the USB IDs for the new Macbook Air 6
      HID: wiimote: add support for Guitar-Hero guitars
      HID: wiimote: add support for Guitar-Hero drums
      Input: introduce BTN/ABS bits for drums and guitars
      HID: battery: don't do DMA from stack
      HID: roccat: add support for KonePureOptical v2
      HID: picolcd: Prevent NULL pointer dereference on _remove()
      HID: usbhid: quirk for N-Trig DuoSense Touch Screen
      ...

diff --cc net/bluetooth/hidp/core.c
index 13863de433a4,d38ab1527006..bdc35a7a7fee
--- a/net/bluetooth/hidp/core.c
+++ b/net/bluetooth/hidp/core.c
@@@ -235,34 -236,13 +236,38 @@@ static int hidp_send_report(struct hidp
  	hid_output_report(report, buf);
  	hdr = HIDP_TRANS_DATA | HIDP_DATA_RTYPE_OUPUT;
  
- 	return hidp_send_intr_message(session, hdr, buf, rsize);
+ 	rsize = ((report->size - 1) >> 3) + 1 + (report->id > 0);
+ 	ret = hidp_send_intr_message(session, hdr, buf, rsize);
+ 
+ 	kfree(buf);
+ 	return ret;
  }
  
 +static int hidp_hidinput_event(struct input_dev *dev, unsigned int type,
 +			       unsigned int code, int value)
 +{
 +	struct hid_device *hid = input_get_drvdata(dev);
 +	struct hidp_session *session = hid->driver_data;
 +	struct hid_field *field;
 +	int offset;
 +
 +	BT_DBG("session %p type %d code %d value %d",
 +	       session, type, code, value);
 +
 +	if (type != EV_LED)
 +		return -1;
 +
 +	offset = hidinput_find_field(hid, type, code, &field);
 +	if (offset == -1) {
 +		hid_warn(dev, "event field not found\n");
 +		return -1;
 +	}
 +
 +	hid_set_field(field, offset, value);
 +
 +	return hidp_send_report(session, field->report);
 +}
 +
  static int hidp_get_raw_report(struct hid_device *hid,
  		unsigned char report_number,
  		unsigned char *data, size_t count,