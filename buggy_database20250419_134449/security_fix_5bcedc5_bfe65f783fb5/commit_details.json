{
  "hash": "5bcedc5931e7bd6928a2d8207078d4cb476b3b55",
  "hash_short": "5bcedc59",
  "subject": "powerpc/security: Fix Speculation_Store_Bypass reporting on Power10",
  "body": "Nageswara reported that /proc/self/status was showing \"vulnerable\" for\nthe Speculation_Store_Bypass feature on Power10, eg:\n\n  $ grep Speculation_Store_Bypass: /proc/self/status\n  Speculation_Store_Bypass:       vulnerable\n\nBut at the same time the sysfs files, and lscpu, were showing \"Not\naffected\".\n\nThis turns out to simply be a bug in the reporting of the\nSpeculation_Store_Bypass, aka. PR_SPEC_STORE_BYPASS, case.\n\nWhen SEC_FTR_STF_BARRIER was added, so that firmware could communicate\nthe vulnerability was not present, the code in ssb_prctl_get() was not\nupdated to check the new flag.\n\nSo add the check for SEC_FTR_STF_BARRIER being disabled. Rather than\nadding the new check to the existing if block and expanding the comment\nto cover both cases, rewrite the three cases to be separate so they can\nbe commented separately for clarity.\n\nFixes: 84ed26fd00c5 (\"powerpc/security: Add a security feature for STF barrier\")\nCc: stable@vger.kernel.org # v5.14+\nReported-by: Nageswara R Sastry <rnsastry@linux.ibm.com>\nTested-by: Nageswara R Sastry <rnsastry@linux.ibm.com>\nReviewed-by: Russell Currey <ruscur@russell.cc>\nSigned-off-by: Michael Ellerman <mpe@ellerman.id.au>\nLink: https://msgid.link/20230517074945.53188-1-mpe@ellerman.id.au",
  "full_message": "powerpc/security: Fix Speculation_Store_Bypass reporting on Power10\n\nNageswara reported that /proc/self/status was showing \"vulnerable\" for\nthe Speculation_Store_Bypass feature on Power10, eg:\n\n  $ grep Speculation_Store_Bypass: /proc/self/status\n  Speculation_Store_Bypass:       vulnerable\n\nBut at the same time the sysfs files, and lscpu, were showing \"Not\naffected\".\n\nThis turns out to simply be a bug in the reporting of the\nSpeculation_Store_Bypass, aka. PR_SPEC_STORE_BYPASS, case.\n\nWhen SEC_FTR_STF_BARRIER was added, so that firmware could communicate\nthe vulnerability was not present, the code in ssb_prctl_get() was not\nupdated to check the new flag.\n\nSo add the check for SEC_FTR_STF_BARRIER being disabled. Rather than\nadding the new check to the existing if block and expanding the comment\nto cover both cases, rewrite the three cases to be separate so they can\nbe commented separately for clarity.\n\nFixes: 84ed26fd00c5 (\"powerpc/security: Add a security feature for STF barrier\")\nCc: stable@vger.kernel.org # v5.14+\nReported-by: Nageswara R Sastry <rnsastry@linux.ibm.com>\nTested-by: Nageswara R Sastry <rnsastry@linux.ibm.com>\nReviewed-by: Russell Currey <ruscur@russell.cc>\nSigned-off-by: Michael Ellerman <mpe@ellerman.id.au>\nLink: https://msgid.link/20230517074945.53188-1-mpe@ellerman.id.au",
  "author_name": "Michael Ellerman",
  "author_email": "mpe@ellerman.id.au",
  "author_date": "Wed May 17 17:49:45 2023 +1000",
  "author_date_iso": "2023-05-17T17:49:45+10:00",
  "committer_name": "Michael Ellerman",
  "committer_email": "mpe@ellerman.id.au",
  "committer_date": "Mon Jul 10 09:47:47 2023 +1000",
  "committer_date_iso": "2023-07-10T09:47:47+10:00",
  "files_changed": [
    "arch/powerpc/kernel/security.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "arch/powerpc/kernel/security.c",
      "insertions": 19,
      "deletions": 18
    }
  ],
  "total_insertions": 19,
  "total_deletions": 18,
  "total_changes": 37,
  "parents": [
    "8bbe9fee5848371d4af101be445303cac8d880c5"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "vulnerability"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/powerpc/kernel/security.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}