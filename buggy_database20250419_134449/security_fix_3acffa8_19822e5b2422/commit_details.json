{
  "hash": "3acffa8cba757a60c0fe24874e0456df8e494778",
  "hash_short": "3acffa8c",
  "subject": "drm/i915/uc: Abort early on uc_init failure",
  "body": "Now that we can differentiate wants vs uses GuC/HuC, intel_uc_init is\nrestricted to running only if we have successfully fetched the required\nblob(s) and are committed to using the microcontroller(s).\nThe only remaining thing that can go wrong in uc_init is the allocation\nof GuC/HuC related objects; if we get such a failure better to bail out\nimmediately instead of wedging later, like we do for e.g.\nintel_engines_init, since without objects we can't use the HW, including\nnot being able to attempt the firmware load.\n\nWhile at it, remove the unneeded fw_cleanup call (this is handled\noutside of gt_init) and add a probe failure injection point for testing.\nAlso, update the logs for <g/h>uc_init failures to probe_failure() since\nthey will cause the driver load to fail.\n\nSigned-off-by: Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>\nCc: Michal Wajdeczko <michal.wajdeczko@intel.com>\nCc: John Harrison <John.C.Harrison@Intel.com>\nCc: Matthew Brost <matthew.brost@intel.com>\nReviewed-by: Fernando Pacheco <fernando.pacheco@intel.com>\nReviewed-by: Michal Wajdeczko <michal.wajdeczko@intel.com>\nReviewed-by: Andi Shyti <andi.shyti@intel.com>\nSigned-off-by: Chris Wilson <chris@chris-wilson.co.uk>\nLink: https://patchwork.freedesktop.org/patch/msgid/20200218223327.11058-8-daniele.ceraolospurio@intel.com",
  "full_message": "drm/i915/uc: Abort early on uc_init failure\n\nNow that we can differentiate wants vs uses GuC/HuC, intel_uc_init is\nrestricted to running only if we have successfully fetched the required\nblob(s) and are committed to using the microcontroller(s).\nThe only remaining thing that can go wrong in uc_init is the allocation\nof GuC/HuC related objects; if we get such a failure better to bail out\nimmediately instead of wedging later, like we do for e.g.\nintel_engines_init, since without objects we can't use the HW, including\nnot being able to attempt the firmware load.\n\nWhile at it, remove the unneeded fw_cleanup call (this is handled\noutside of gt_init) and add a probe failure injection point for testing.\nAlso, update the logs for <g/h>uc_init failures to probe_failure() since\nthey will cause the driver load to fail.\n\nSigned-off-by: Daniele Ceraolo Spurio <daniele.ceraolospurio@intel.com>\nCc: Michal Wajdeczko <michal.wajdeczko@intel.com>\nCc: John Harrison <John.C.Harrison@Intel.com>\nCc: Matthew Brost <matthew.brost@intel.com>\nReviewed-by: Fernando Pacheco <fernando.pacheco@intel.com>\nReviewed-by: Michal Wajdeczko <michal.wajdeczko@intel.com>\nReviewed-by: Andi Shyti <andi.shyti@intel.com>\nSigned-off-by: Chris Wilson <chris@chris-wilson.co.uk>\nLink: https://patchwork.freedesktop.org/patch/msgid/20200218223327.11058-8-daniele.ceraolospurio@intel.com",
  "author_name": "Daniele Ceraolo Spurio",
  "author_email": "daniele.ceraolospurio@intel.com",
  "author_date": "Tue Feb 18 14:33:25 2020 -0800",
  "author_date_iso": "2020-02-18T14:33:25-08:00",
  "committer_name": "Chris Wilson",
  "committer_email": "chris@chris-wilson.co.uk",
  "committer_date": "Thu Feb 20 17:48:07 2020 +0000",
  "committer_date_iso": "2020-02-20T17:48:07+00:00",
  "files_changed": [
    "drivers/gpu/drm/i915/gt/intel_gt.c",
    "drivers/gpu/drm/i915/gt/uc/intel_guc.c",
    "drivers/gpu/drm/i915/gt/uc/intel_huc.c",
    "drivers/gpu/drm/i915/gt/uc/intel_uc.c",
    "drivers/gpu/drm/i915/gt/uc/intel_uc.h"
  ],
  "files_changed_count": 5,
  "stats": [
    {
      "file": "drivers/gpu/drm/i915/gt/intel_gt.c",
      "insertions": 3,
      "deletions": 1
    },
    {
      "file": "drivers/gpu/drm/i915/gt/uc/intel_guc.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/gpu/drm/i915/gt/uc/intel_huc.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/gpu/drm/i915/gt/uc/intel_uc.c",
      "insertions": 17,
      "deletions": 7
    },
    {
      "file": "drivers/gpu/drm/i915/gt/uc/intel_uc.h",
      "insertions": 2,
      "deletions": 2
    }
  ],
  "total_insertions": 24,
  "total_deletions": 12,
  "total_changes": 36,
  "parents": [
    "202c98e7169248480d97a79416cbfb1154903d99"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v5.7-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/gpu/drm/i915/gt/intel_gt.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/gpu/drm/i915/gt/uc/intel_guc.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/gpu/drm/i915/gt/uc/intel_huc.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/gpu/drm/i915/gt/uc/intel_uc.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/gpu/drm/i915/gt/uc/intel_uc.h",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}