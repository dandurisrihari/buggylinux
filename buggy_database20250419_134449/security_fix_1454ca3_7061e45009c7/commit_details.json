{
  "hash": "1454ca3a97e147bb91e98b087446c39cf6692a48",
  "hash_short": "1454ca3a",
  "subject": "IB/rxe: Fix kernel panic in UDP tunnel with GRO and RX checksum",
  "body": "Missing initialization of udp_tunnel_sock_cfg causes to following\nkernel panic, while kernel tries to execute gro_receive().\n\nWhile being there, we converted udp_port_cfg to use the same\ninitialization scheme as udp_tunnel_sock_cfg.\n\n------------[ cut here ]------------\nkernel tried to execute NX-protected page - exploit attempt? (uid: 0)\nBUG: unable to handle kernel paging request at ffffffffa0588c50\nIP: [<ffffffffa0588c50>] __this_module+0x50/0xffffffffffff8400 [ib_rxe]\nPGD 1c09067 PUD 1c0a063 PMD bb394067 PTE 80000000ad5e8163\nOops: 0011 [#1] SMP\nModules linked in: ib_rxe ip6_udp_tunnel udp_tunnel\nCPU: 5 PID: 0 Comm: swapper/5 Not tainted 4.7.0-rc3+ #2\nHardware name: Red Hat KVM, BIOS Bochs 01/01/2011\ntask: ffff880235e4e680 ti: ffff880235e68000 task.ti: ffff880235e68000\nRIP: 0010:[<ffffffffa0588c50>]\n[<ffffffffa0588c50>] __this_module+0x50/0xffffffffffff8400 [ib_rxe]\nRSP: 0018:ffff880237343c80  EFLAGS: 00010282\nRAX: 00000000dffe482d RBX: ffff8800ae330900 RCX: 000000002001b712\nRDX: ffff8800ae330900 RSI: ffff8800ae102578 RDI: ffff880235589c00\nRBP: ffff880237343cb0 R08: 0000000000000000 R09: 0000000000000000\nR10: 0000000000000000 R11: 0000000000000000 R12: ffff8800ae33e262\nR13: ffff880235589c00 R14: 0000000000000014 R15: ffff8800ae102578\nFS:  0000000000000000(0000) GS:ffff880237340000(0000) knlGS:0000000000000000\nCS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\nCR2: ffffffffa0588c50 CR3: 0000000001c06000 CR4: 00000000000006e0\nStack:\nffffffff8160860e ffff8800ae330900 ffff8800ae102578 0000000000000014\n000000000000004e ffff8800ae102578 ffff880237343ce0 ffffffff816088fb\n0000000000000000 ffff8800ae330900 0000000000000000 00000000ffad0000\nCall Trace:\n<IRQ>\n[<ffffffff8160860e>] ? udp_gro_receive+0xde/0x130\n[<ffffffff816088fb>] udp4_gro_receive+0x10b/0x2d0\n[<ffffffff81611373>] inet_gro_receive+0x1d3/0x270\n[<ffffffff81594e29>] dev_gro_receive+0x269/0x3b0\n[<ffffffff81595188>] napi_gro_receive+0x38/0x120\n[<ffffffffa011caee>] mlx5e_handle_rx_cqe+0x27e/0x340 [mlx5_core]\n[<ffffffffa011d076>] mlx5e_poll_rx_cq+0x66/0x6d0 [mlx5_core]\n[<ffffffffa011d7ae>] mlx5e_napi_poll+0x8e/0x400 [mlx5_core]\n[<ffffffff815949a0>] net_rx_action+0x160/0x380\n[<ffffffff816a9197>] __do_softirq+0xd7/0x2c5\n[<ffffffff81085c35>] irq_exit+0xf5/0x100\n[<ffffffff816a8f16>] do_IRQ+0x56/0xd0\n[<ffffffff816a6dcc>] common_interrupt+0x8c/0x8c\n<EOI>\n[<ffffffff81061f96>] ? native_safe_halt+0x6/0x10\n[<ffffffff81037ade>] default_idle+0x1e/0xd0\n[<ffffffff8103828f>] arch_cpu_idle+0xf/0x20\n[<ffffffff810c37dc>] default_idle_call+0x3c/0x50\n[<ffffffff810c3b13>] cpu_startup_entry+0x323/0x3c0\n[<ffffffff81050d8c>] start_secondary+0x15c/0x1a0\nRIP  [<ffffffffa0588c50>] __this_module+0x50/0xffffffffffff8400 [ib_rxe]\nRSP <ffff880237343c80>\nCR2: ffffffffa0588c50\n---[ end trace 489ee31fa7614ac5 ]---\nKernel panic - not syncing: Fatal exception in interrupt\nKernel Offset: disabled\n---[ end Kernel panic - not syncing: Fatal exception in interrupt\n------------[ cut here ]------------\n\nFixes: 8700e3e7c485 (\"Soft RoCE driver\")\nSigned-off-by: Yonatan Cohen <yonatanc@mellanox.com>\nReviewed-by: Moni Shoua <monis@mellanox.com>\nSigned-off-by: Leon Romanovsky <leon@kernel.org>\nSigned-off-by: Doug Ledford <dledford@redhat.com>",
  "full_message": "IB/rxe: Fix kernel panic in UDP tunnel with GRO and RX checksum\n\nMissing initialization of udp_tunnel_sock_cfg causes to following\nkernel panic, while kernel tries to execute gro_receive().\n\nWhile being there, we converted udp_port_cfg to use the same\ninitialization scheme as udp_tunnel_sock_cfg.\n\n------------[ cut here ]------------\nkernel tried to execute NX-protected page - exploit attempt? (uid: 0)\nBUG: unable to handle kernel paging request at ffffffffa0588c50\nIP: [<ffffffffa0588c50>] __this_module+0x50/0xffffffffffff8400 [ib_rxe]\nPGD 1c09067 PUD 1c0a063 PMD bb394067 PTE 80000000ad5e8163\nOops: 0011 [#1] SMP\nModules linked in: ib_rxe ip6_udp_tunnel udp_tunnel\nCPU: 5 PID: 0 Comm: swapper/5 Not tainted 4.7.0-rc3+ #2\nHardware name: Red Hat KVM, BIOS Bochs 01/01/2011\ntask: ffff880235e4e680 ti: ffff880235e68000 task.ti: ffff880235e68000\nRIP: 0010:[<ffffffffa0588c50>]\n[<ffffffffa0588c50>] __this_module+0x50/0xffffffffffff8400 [ib_rxe]\nRSP: 0018:ffff880237343c80  EFLAGS: 00010282\nRAX: 00000000dffe482d RBX: ffff8800ae330900 RCX: 000000002001b712\nRDX: ffff8800ae330900 RSI: ffff8800ae102578 RDI: ffff880235589c00\nRBP: ffff880237343cb0 R08: 0000000000000000 R09: 0000000000000000\nR10: 0000000000000000 R11: 0000000000000000 R12: ffff8800ae33e262\nR13: ffff880235589c00 R14: 0000000000000014 R15: ffff8800ae102578\nFS:  0000000000000000(0000) GS:ffff880237340000(0000) knlGS:0000000000000000\nCS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\nCR2: ffffffffa0588c50 CR3: 0000000001c06000 CR4: 00000000000006e0\nStack:\nffffffff8160860e ffff8800ae330900 ffff8800ae102578 0000000000000014\n000000000000004e ffff8800ae102578 ffff880237343ce0 ffffffff816088fb\n0000000000000000 ffff8800ae330900 0000000000000000 00000000ffad0000\nCall Trace:\n<IRQ>\n[<ffffffff8160860e>] ? udp_gro_receive+0xde/0x130\n[<ffffffff816088fb>] udp4_gro_receive+0x10b/0x2d0\n[<ffffffff81611373>] inet_gro_receive+0x1d3/0x270\n[<ffffffff81594e29>] dev_gro_receive+0x269/0x3b0\n[<ffffffff81595188>] napi_gro_receive+0x38/0x120\n[<ffffffffa011caee>] mlx5e_handle_rx_cqe+0x27e/0x340 [mlx5_core]\n[<ffffffffa011d076>] mlx5e_poll_rx_cq+0x66/0x6d0 [mlx5_core]\n[<ffffffffa011d7ae>] mlx5e_napi_poll+0x8e/0x400 [mlx5_core]\n[<ffffffff815949a0>] net_rx_action+0x160/0x380\n[<ffffffff816a9197>] __do_softirq+0xd7/0x2c5\n[<ffffffff81085c35>] irq_exit+0xf5/0x100\n[<ffffffff816a8f16>] do_IRQ+0x56/0xd0\n[<ffffffff816a6dcc>] common_interrupt+0x8c/0x8c\n<EOI>\n[<ffffffff81061f96>] ? native_safe_halt+0x6/0x10\n[<ffffffff81037ade>] default_idle+0x1e/0xd0\n[<ffffffff8103828f>] arch_cpu_idle+0xf/0x20\n[<ffffffff810c37dc>] default_idle_call+0x3c/0x50\n[<ffffffff810c3b13>] cpu_startup_entry+0x323/0x3c0\n[<ffffffff81050d8c>] start_secondary+0x15c/0x1a0\nRIP  [<ffffffffa0588c50>] __this_module+0x50/0xffffffffffff8400 [ib_rxe]\nRSP <ffff880237343c80>\nCR2: ffffffffa0588c50\n---[ end trace 489ee31fa7614ac5 ]---\nKernel panic - not syncing: Fatal exception in interrupt\nKernel Offset: disabled\n---[ end Kernel panic - not syncing: Fatal exception in interrupt\n------------[ cut here ]------------\n\nFixes: 8700e3e7c485 (\"Soft RoCE driver\")\nSigned-off-by: Yonatan Cohen <yonatanc@mellanox.com>\nReviewed-by: Moni Shoua <monis@mellanox.com>\nSigned-off-by: Leon Romanovsky <leon@kernel.org>\nSigned-off-by: Doug Ledford <dledford@redhat.com>",
  "author_name": "Yonatan Cohen",
  "author_email": "yonatanc@mellanox.com",
  "author_date": "Wed Nov 16 10:39:14 2016 +0200",
  "author_date_iso": "2016-11-16T10:39:14+02:00",
  "committer_name": "Doug Ledford",
  "committer_email": "dledford@redhat.com",
  "committer_date": "Wed Nov 16 20:03:44 2016 -0500",
  "committer_date_iso": "2016-11-16T20:03:44-05:00",
  "files_changed": [
    "drivers/infiniband/sw/rxe/rxe_net.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/infiniband/sw/rxe/rxe_net.c",
      "insertions": 2,
      "deletions": 6
    }
  ],
  "total_insertions": 2,
  "total_deletions": 6,
  "total_changes": 8,
  "parents": [
    "593ff73bcfdc79f79a8a0df55504f75ad3e5d1a9"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.10",
    "v4.10-rc1",
    "v4.10-rc2",
    "v4.10-rc3",
    "v4.10-rc4",
    "v4.10-rc5",
    "v4.10-rc6",
    "v4.10-rc7",
    "v4.10-rc8",
    "v4.11"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "exploit"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/infiniband/sw/rxe/rxe_net.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}