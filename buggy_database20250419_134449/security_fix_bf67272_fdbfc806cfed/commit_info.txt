Commit Hash: bf672720e83cf04c007aa11c242229e70985135b
Subject: KVM: x86: check the kvm_cpu_get_interrupt result before using it


Security Keywords:
- injection

Full commit message:
KVM: x86: check the kvm_cpu_get_interrupt result before using it

The code was blindly assuming that kvm_cpu_get_interrupt never returns -1
when there is a pending interrupt.

While this should be true, a bug in KVM can still cause this.

If -1 is returned, the code before this patch was converting it to 0xFF,
and 0xFF interrupt was injected to the guest, which results in an issue
which was hard to debug.

Add WARN_ON_ONCE to catch this case and	skip the injection
if this happens again.

Signed-off-by: Maxim Levitsky <mlevitsk@redhat.com>
Message-Id: <20230726135945.260841-4-mlevitsk@redhat.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

Metadata:
Author: Maxim Levitsky <mlevitsk@redhat.com>
Author Date: Wed Jul 26 16:59:45 2023 +0300
Committer: Paolo Bonzini <pbonzini@redhat.com>
Commit Date: Sat Jul 29 11:05:25 2023 -0400

Files Changed: 1
Lines Added: 7
Lines Removed: 3
Total Changes: 10
