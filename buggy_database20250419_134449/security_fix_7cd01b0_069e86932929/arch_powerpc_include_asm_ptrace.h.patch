commit 7cd01b08d35f1b7d55686ed8cd57c94d3406ec8f
Author: Naveen N Rao <naveen@kernel.org>
Date:   Thu Jun 7 15:22:02 2018 +0530

    powerpc: Add support for function error injection
    
    We implement regs_set_return_value() and override_function_with_return()
    for this purpose.
    
    On powerpc, a return from a function (blr) just branches to the location
    contained in the link register. So, we can just update pt_regs rather
    than redirecting execution to a dummy function that returns.
    
    Signed-off-by: Naveen N. Rao <naveen.n.rao@linux.vnet.ibm.com>
    Reviewed-by: Samuel Mendoza-Jonas <sam@mendozajonas.com>
    Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>

diff --git a/arch/powerpc/include/asm/ptrace.h b/arch/powerpc/include/asm/ptrace.h
index 2ba2a1e52291..33196b311964 100644
--- a/arch/powerpc/include/asm/ptrace.h
+++ b/arch/powerpc/include/asm/ptrace.h
@@ -133,6 +133,11 @@ static inline long regs_return_value(struct pt_regs *regs)
 		return -regs->gpr[3];
 }
 
+static inline void regs_set_return_value(struct pt_regs *regs, unsigned long rc)
+{
+	regs->gpr[3] = rc;
+}
+
 #ifdef __powerpc64__
 #define user_mode(regs) ((((regs)->msr) >> MSR_PR_LG) & 0x1)
 #else