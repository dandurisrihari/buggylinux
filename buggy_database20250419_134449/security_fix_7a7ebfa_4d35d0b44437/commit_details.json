{
  "hash": "7a7ebfa85f4fac349f3ab219538c44efe18b0cf6",
  "hash_short": "7a7ebfa8",
  "subject": "thunderbolt: Power cycle the router if NVM authentication fails",
  "body": "On zang's Dell XPS 13 9370 after Thunderbolt NVM firmware upgrade the\nThunderbolt controller did not come back as expected. Only after the\nsystem was rebooted it became available again. It is not entirely clear\nwhat happened but I suspect the new NVM firmware image authentication\nfailed for some reason. Regardless of this the router needs to be power\ncycled if NVM authentication fails in order to get it fully functional\nagain.\n\nThis modifies the driver to issue a power cycle in case the NVM\nauthentication fails immediately when dma_port_flash_update_auth()\nreturns. We also need to call tb_switch_set_uuid() earlier to be able to\nfetch possible NVM authentication failure when DMA port is added.\n\nLink: https://bugzilla.kernel.org/show_bug.cgi?id=205457\nReported-by: zang <dump@tzib.net>\nCc: stable <stable@vger.kernel.org>\nSigned-off-by: Mika Westerberg <mika.westerberg@linux.intel.com>\nSigned-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>",
  "full_message": "thunderbolt: Power cycle the router if NVM authentication fails\n\nOn zang's Dell XPS 13 9370 after Thunderbolt NVM firmware upgrade the\nThunderbolt controller did not come back as expected. Only after the\nsystem was rebooted it became available again. It is not entirely clear\nwhat happened but I suspect the new NVM firmware image authentication\nfailed for some reason. Regardless of this the router needs to be power\ncycled if NVM authentication fails in order to get it fully functional\nagain.\n\nThis modifies the driver to issue a power cycle in case the NVM\nauthentication fails immediately when dma_port_flash_update_auth()\nreturns. We also need to call tb_switch_set_uuid() earlier to be able to\nfetch possible NVM authentication failure when DMA port is added.\n\nLink: https://bugzilla.kernel.org/show_bug.cgi?id=205457\nReported-by: zang <dump@tzib.net>\nCc: stable <stable@vger.kernel.org>\nSigned-off-by: Mika Westerberg <mika.westerberg@linux.intel.com>\nSigned-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>",
  "author_name": "Mika Westerberg",
  "author_email": "mika.westerberg@linux.intel.com",
  "author_date": "Mon Nov 11 13:25:44 2019 +0300",
  "author_date_iso": "2019-11-11T13:25:44+03:00",
  "committer_name": "Greg Kroah-Hartman",
  "committer_email": "gregkh@linuxfoundation.org",
  "committer_date": "Tue Nov 19 17:35:57 2019 +0100",
  "committer_date_iso": "2019-11-19T17:35:57+01:00",
  "files_changed": [
    "drivers/thunderbolt/switch.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/thunderbolt/switch.c",
      "insertions": 42,
      "deletions": 12
    }
  ],
  "total_insertions": 42,
  "total_deletions": 12,
  "total_changes": 54,
  "parents": [
    "64498695dd800bcb494d96b94f99356ece91ea90"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v5.5",
    "v5.5-rc1",
    "v5.5-rc2",
    "v5.5-rc3",
    "v5.5-rc4",
    "v5.5-rc5",
    "v5.5-rc6",
    "v5.5-rc7",
    "v5.6",
    "v5.6-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "authentication"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/thunderbolt/switch.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}