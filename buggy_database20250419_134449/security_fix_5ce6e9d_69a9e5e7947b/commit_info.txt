Commit Hash: 5ce6e9dbe6805ab8ee67e21936d17f431adc63c6
Subject: ceph: fix authentication races, auth_none oops


Security Keywords:
- authentication

Full commit message:
ceph: fix authentication races, auth_none oops

Call __validate_auth() under monc->mutex, and use helper for
initial hello so that the pending_auth flag is set.  This fixes
possible races in which we have an authentication request (hello
or otherwise) pending and send another one.  In particular, with
auth_none, we _never_ want to call ceph_build_auth() from
__validate_auth(), since the ->build_request() method is NULL.

Signed-off-by: Sage Weil <sage@newdream.net>

Metadata:
Author: Sage Weil <sage@newdream.net>
Author Date: Mon Feb 15 16:22:28 2010 -0800
Committer: Sage Weil <sage@newdream.net>
Commit Date: Tue Feb 16 22:01:11 2010 -0800

Files Changed: 1
Lines Added: 13
Lines Removed: 16
Total Changes: 29
