Commit Hash: 713bdfa10b5957053811470d298def9537d9ff13
Subject: media: cec-pin: fix interrupt en/disable handling


Security Keywords:
- injection

Full commit message:
media: cec-pin: fix interrupt en/disable handling

The en/disable_irq() functions keep track of the 'depth': i.e. if
interrupts are disabled twice, then it needs to enable_irq() calls to
enable them again. The cec-pin framework didn't take this into accound
and could disable irqs multiple times, and it expected that a single
enable_irq() would enable them again.

Move all calls to en/disable_irq() to the kthread where it is easy
to keep track of the current irq state and ensure that multiple
en/disable_irq calls never happen.

If interrupts where disabled twice, then they would never turn on
again, leaving the CEC adapter in a dead state.

Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Fixes: 865463fc03ed (media: cec-pin: add error injection support)
Cc: <stable@vger.kernel.org>
Signed-off-by: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>

Metadata:
Author: Hans Verkuil <hverkuil-cisco@xs4all.nl>
Author Date: Wed Dec 1 13:41:25 2021 +0100
Committer: Mauro Carvalho Chehab <mchehab+huawei@kernel.org>
Commit Date: Tue Dec 7 11:29:56 2021 +0100

Files Changed: 1
Lines Added: 18
Lines Removed: 13
Total Changes: 31
