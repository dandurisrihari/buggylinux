{
  "hash": "b3f2e67cc2dd59fffeffd35b1526a081bbec9490",
  "hash_short": "b3f2e67c",
  "subject": "scsi: lpfc: Fix NPIV discovery and Fabric Node detection",
  "body": "While testing NPIV and link bounces, the vport would not show a fabric node\nfor the F_Port, would not transition into NPR state during a link fault, or\nleave the FDMI node untouched during error injection. Cause for this was\ndetermined to be an inconsistent manner in which F_Port, Nameserver, and\nFDMI controller nodes were created and linked. In some cases, the nodes\nwould never be unregistered from the transport, leaving references\nactive. In other cases, the fabric nodes may register with the transport\nmultiple times while still registered.\n\nThe following changes were made:\n\n - Fix the FDISC issue routine, which starts vport (re)creation, to mark\n   the F_Port as a fabric node (NLP_FABRIC) and allow the F_Port node to\n   fully be created and show up in the node list.\n\n - When remote ports are cleaned up on vport termination, cleanup the\n   nameserver and FDMI controller nodes on the vport so they unregister\n   from the transport.\n\n - On link bounces, don't exclude the NPIV Fabric remote ports from\n   transitioning to the NPR state, allowing them to avoid re-registration\n   if already registered.\n\nLink: https://lore.kernel.org/r/20201115192646.12977-9-james.smart@broadcom.com\nCo-developed-by: Dick Kennedy <dick.kennedy@broadcom.com>\nSigned-off-by: Dick Kennedy <dick.kennedy@broadcom.com>\nSigned-off-by: James Smart <james.smart@broadcom.com>\nSigned-off-by: Martin K. Petersen <martin.petersen@oracle.com>",
  "full_message": "scsi: lpfc: Fix NPIV discovery and Fabric Node detection\n\nWhile testing NPIV and link bounces, the vport would not show a fabric node\nfor the F_Port, would not transition into NPR state during a link fault, or\nleave the FDMI node untouched during error injection. Cause for this was\ndetermined to be an inconsistent manner in which F_Port, Nameserver, and\nFDMI controller nodes were created and linked. In some cases, the nodes\nwould never be unregistered from the transport, leaving references\nactive. In other cases, the fabric nodes may register with the transport\nmultiple times while still registered.\n\nThe following changes were made:\n\n - Fix the FDISC issue routine, which starts vport (re)creation, to mark\n   the F_Port as a fabric node (NLP_FABRIC) and allow the F_Port node to\n   fully be created and show up in the node list.\n\n - When remote ports are cleaned up on vport termination, cleanup the\n   nameserver and FDMI controller nodes on the vport so they unregister\n   from the transport.\n\n - On link bounces, don't exclude the NPIV Fabric remote ports from\n   transitioning to the NPR state, allowing them to avoid re-registration\n   if already registered.\n\nLink: https://lore.kernel.org/r/20201115192646.12977-9-james.smart@broadcom.com\nCo-developed-by: Dick Kennedy <dick.kennedy@broadcom.com>\nSigned-off-by: Dick Kennedy <dick.kennedy@broadcom.com>\nSigned-off-by: James Smart <james.smart@broadcom.com>\nSigned-off-by: Martin K. Petersen <martin.petersen@oracle.com>",
  "author_name": "James Smart",
  "author_email": "james.smart@broadcom.com",
  "author_date": "Sun Nov 15 11:26:37 2020 -0800",
  "author_date_iso": "2020-11-15T11:26:37-08:00",
  "committer_name": "Martin K. Petersen",
  "committer_email": "martin.petersen@oracle.com",
  "committer_date": "Tue Nov 17 00:43:55 2020 -0500",
  "committer_date_iso": "2020-11-17T00:43:55-05:00",
  "files_changed": [
    "drivers/scsi/lpfc/lpfc_els.c",
    "drivers/scsi/lpfc/lpfc_hbadisc.c"
  ],
  "files_changed_count": 2,
  "stats": [
    {
      "file": "drivers/scsi/lpfc/lpfc_els.c",
      "insertions": 4,
      "deletions": 0
    },
    {
      "file": "drivers/scsi/lpfc/lpfc_hbadisc.c",
      "insertions": 5,
      "deletions": 6
    }
  ],
  "total_insertions": 9,
  "total_deletions": 6,
  "total_changes": 15,
  "parents": [
    "9d76d46751594264a91387583fef49af334ccea6"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/scsi/lpfc/lpfc_els.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/scsi/lpfc/lpfc_hbadisc.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}