{
  "hash": "fd7e9a88348472521d999434ee02f25735c7dadf",
  "hash_short": "fd7e9a88",
  "subject": "Merge tag 'for-linus' of git://git.kernel.org/pub/scm/virt/kvm/kvm",
  "body": "Pull KVM updates from Paolo Bonzini:\n \"4.11 is going to be a relatively large release for KVM, with a little\n  over 200 commits and noteworthy changes for most architectures.\n\n  ARM:\n   - GICv3 save/restore\n   - cache flushing fixes\n   - working MSI injection for GICv3 ITS\n   - physical timer emulation\n\n  MIPS:\n   - various improvements under the hood\n   - support for SMP guests\n   - a large rewrite of MMU emulation. KVM MIPS can now use MMU\n     notifiers to support copy-on-write, KSM, idle page tracking,\n     swapping, ballooning and everything else. KVM_CAP_READONLY_MEM is\n     also supported, so that writes to some memory regions can be\n     treated as MMIO. The new MMU also paves the way for hardware\n     virtualization support.\n\n  PPC:\n   - support for POWER9 using the radix-tree MMU for host and guest\n   - resizable hashed page table\n   - bugfixes.\n\n  s390:\n   - expose more features to the guest\n   - more SIMD extensions\n   - instruction execution protection\n   - ESOP2\n\n  x86:\n   - improved hashing in the MMU\n   - faster PageLRU tracking for Intel CPUs without EPT A/D bits\n   - some refactoring of nested VMX entry/exit code, preparing for live\n     migration support of nested hypervisors\n   - expose yet another AVX512 CPUID bit\n   - host-to-guest PTP support\n   - refactoring of interrupt injection, with some optimizations thrown\n     in and some duct tape removed.\n   - remove lazy FPU handling\n   - optimizations of user-mode exits\n   - optimizations of vcpu_is_preempted() for KVM guests\n\n  generic:\n   - alternative signaling mechanism that doesn't pound on\n     tsk->sighand->siglock\"\n\n* tag 'for-linus' of git://git.kernel.org/pub/scm/virt/kvm/kvm: (195 commits)\n  x86/kvm: Provide optimized version of vcpu_is_preempted() for x86-64\n  x86/paravirt: Change vcp_is_preempted() arg type to long\n  KVM: VMX: use correct vmcs_read/write for guest segment selector/base\n  x86/kvm/vmx: Defer TR reload after VM exit\n  x86/asm/64: Drop __cacheline_aligned from struct x86_hw_tss\n  x86/kvm/vmx: Simplify segment_base()\n  x86/kvm/vmx: Get rid of segment_base() on 64-bit kernels\n  x86/kvm/vmx: Don't fetch the TSS base from the GDT\n  x86/asm: Define the kernel TSS limit in a macro\n  kvm: fix page struct leak in handle_vmon\n  KVM: PPC: Book3S HV: Disable HPT resizing on POWER9 for now\n  KVM: Return an error code only as a constant in kvm_get_dirty_log()\n  KVM: Return an error code only as a constant in kvm_get_dirty_log_protect()\n  KVM: Return directly after a failed copy_from_user() in kvm_vm_compat_ioctl()\n  KVM: x86: remove code for lazy FPU handling\n  KVM: race-free exit from KVM_RUN without POSIX signals\n  KVM: PPC: Book3S HV: Turn \"KVM guest htab\" message into a debug message\n  KVM: PPC: Book3S PR: Ratelimit copy data failure error messages\n  KVM: Support vCPU-based gfn->hva cache\n  KVM: use separate generations for each address space\n  ...",
  "full_message": "Merge tag 'for-linus' of git://git.kernel.org/pub/scm/virt/kvm/kvm\n\nPull KVM updates from Paolo Bonzini:\n \"4.11 is going to be a relatively large release for KVM, with a little\n  over 200 commits and noteworthy changes for most architectures.\n\n  ARM:\n   - GICv3 save/restore\n   - cache flushing fixes\n   - working MSI injection for GICv3 ITS\n   - physical timer emulation\n\n  MIPS:\n   - various improvements under the hood\n   - support for SMP guests\n   - a large rewrite of MMU emulation. KVM MIPS can now use MMU\n     notifiers to support copy-on-write, KSM, idle page tracking,\n     swapping, ballooning and everything else. KVM_CAP_READONLY_MEM is\n     also supported, so that writes to some memory regions can be\n     treated as MMIO. The new MMU also paves the way for hardware\n     virtualization support.\n\n  PPC:\n   - support for POWER9 using the radix-tree MMU for host and guest\n   - resizable hashed page table\n   - bugfixes.\n\n  s390:\n   - expose more features to the guest\n   - more SIMD extensions\n   - instruction execution protection\n   - ESOP2\n\n  x86:\n   - improved hashing in the MMU\n   - faster PageLRU tracking for Intel CPUs without EPT A/D bits\n   - some refactoring of nested VMX entry/exit code, preparing for live\n     migration support of nested hypervisors\n   - expose yet another AVX512 CPUID bit\n   - host-to-guest PTP support\n   - refactoring of interrupt injection, with some optimizations thrown\n     in and some duct tape removed.\n   - remove lazy FPU handling\n   - optimizations of user-mode exits\n   - optimizations of vcpu_is_preempted() for KVM guests\n\n  generic:\n   - alternative signaling mechanism that doesn't pound on\n     tsk->sighand->siglock\"\n\n* tag 'for-linus' of git://git.kernel.org/pub/scm/virt/kvm/kvm: (195 commits)\n  x86/kvm: Provide optimized version of vcpu_is_preempted() for x86-64\n  x86/paravirt: Change vcp_is_preempted() arg type to long\n  KVM: VMX: use correct vmcs_read/write for guest segment selector/base\n  x86/kvm/vmx: Defer TR reload after VM exit\n  x86/asm/64: Drop __cacheline_aligned from struct x86_hw_tss\n  x86/kvm/vmx: Simplify segment_base()\n  x86/kvm/vmx: Get rid of segment_base() on 64-bit kernels\n  x86/kvm/vmx: Don't fetch the TSS base from the GDT\n  x86/asm: Define the kernel TSS limit in a macro\n  kvm: fix page struct leak in handle_vmon\n  KVM: PPC: Book3S HV: Disable HPT resizing on POWER9 for now\n  KVM: Return an error code only as a constant in kvm_get_dirty_log()\n  KVM: Return an error code only as a constant in kvm_get_dirty_log_protect()\n  KVM: Return directly after a failed copy_from_user() in kvm_vm_compat_ioctl()\n  KVM: x86: remove code for lazy FPU handling\n  KVM: race-free exit from KVM_RUN without POSIX signals\n  KVM: PPC: Book3S HV: Turn \"KVM guest htab\" message into a debug message\n  KVM: PPC: Book3S PR: Ratelimit copy data failure error messages\n  KVM: Support vCPU-based gfn->hva cache\n  KVM: use separate generations for each address space\n  ...",
  "author_name": "Linus Torvalds",
  "author_email": "torvalds@linux-foundation.org",
  "author_date": "Wed Feb 22 18:22:53 2017 -0800",
  "author_date_iso": "2017-02-22T18:22:53-08:00",
  "committer_name": "Linus Torvalds",
  "committer_email": "torvalds@linux-foundation.org",
  "committer_date": "Wed Feb 22 18:22:53 2017 -0800",
  "committer_date_iso": "2017-02-22T18:22:53-08:00",
  "files_changed": [
    "arch/arm64/include/asm/kvm_host.h",
    "arch/arm64/include/asm/kvm_mmu.h",
    "arch/s390/kvm/kvm-s390.c",
    "arch/s390/kvm/priv.c",
    "arch/s390/kvm/vsie.c",
    "arch/s390/mm/pgtable.c",
    "arch/x86/include/asm/processor.h",
    "arch/x86/kernel/kvm.c",
    "arch/x86/kernel/kvmclock.c",
    "arch/x86/kernel/paravirt-spinlocks.c",
    "arch/x86/kvm/hyperv.c",
    "arch/x86/kvm/x86.c",
    "include/linux/irqchip/arm-gic-v3.h"
  ],
  "files_changed_count": 13,
  "stats": [
    {
      "file": "Documentation/virtual/kvm/api.txt",
      "insertions": 128,
      "deletions": 10
    },
    {
      "file": "Documentation/virtual/kvm/devices/arm-vgic-v3.txt",
      "insertions": 8,
      "deletions": 3
    },
    {
      "file": "Documentation/virtual/kvm/hypercalls.txt",
      "insertions": 35,
      "deletions": 0
    },
    {
      "file": "Documentation/virtual/kvm/locking.txt",
      "insertions": 27,
      "deletions": 4
    },
    {
      "file": "arch/arm/include/asm/kvm_host.h",
      "insertions": 0,
      "deletions": 3
    },
    {
      "file": "arch/arm/include/asm/kvm_mmu.h",
      "insertions": 2,
      "deletions": 10
    },
    {
      "file": "arch/arm/include/uapi/asm/kvm.h",
      "insertions": 13,
      "deletions": 0
    },
    {
      "file": "arch/arm/kvm/Makefile",
      "insertions": 3,
      "deletions": 2
    },
    {
      "file": "arch/arm/kvm/arm.c",
      "insertions": 6,
      "deletions": 2
    },
    {
      "file": "arch/arm/kvm/mmu.c",
      "insertions": 4,
      "deletions": 16
    },
    {
      "file": "arch/arm/kvm/reset.c",
      "insertions": 8,
      "deletions": 1
    },
    {
      "file": "arch/arm/kvm/vgic-v3-coproc.c",
      "insertions": 35,
      "deletions": 0
    },
    {
      "file": "arch/arm64/include/asm/kvm_host.h",
      "insertions": 0,
      "deletions": 3
    },
    {
      "file": "arch/arm64/include/asm/kvm_mmu.h",
      "insertions": 2,
      "deletions": 4
    },
    {
      "file": "arch/arm64/include/uapi/asm/kvm.h",
      "insertions": 13,
      "deletions": 0
    },
    {
      "file": "arch/arm64/kvm/Makefile",
      "insertions": 3,
      "deletions": 1
    },
    {
      "file": "arch/arm64/kvm/reset.c",
      "insertions": 8,
      "deletions": 1
    },
    {
      "file": "arch/arm64/kvm/sys_regs.c",
      "insertions": 81,
      "deletions": 11
    },
    {
      "file": "arch/arm64/kvm/sys_regs.h",
      "insertions": 4,
      "deletions": 0
    },
    {
      "file": "arch/arm64/kvm/vgic-sys-reg-v3.c",
      "insertions": 346,
      "deletions": 0
    },
    {
      "file": "arch/mips/include/asm/kvm_host.h",
      "insertions": 135,
      "deletions": 48
    },
    {
      "file": "arch/mips/include/asm/mmu_context.h",
      "insertions": 3,
      "deletions": 6
    },
    {
      "file": "arch/mips/include/uapi/asm/kvm.h",
      "insertions": 2,
      "deletions": 0
    },
    {
      "file": "arch/mips/kvm/Kconfig",
      "insertions": 2,
      "deletions": 0
    },
    {
      "file": "arch/mips/kvm/dyntrans.c",
      "insertions": 31,
      "deletions": 21
    },
    {
      "file": "arch/mips/kvm/emulate.c",
      "insertions": 224,
      "deletions": 208
    },
    {
      "file": "arch/mips/kvm/entry.c",
      "insertions": 140,
      "deletions": 15
    },
    {
      "file": "arch/mips/kvm/interrupt.c",
      "insertions": 3,
      "deletions": 2
    },
    {
      "file": "arch/mips/kvm/mips.c",
      "insertions": 139,
      "deletions": 364
    },
    {
      "file": "arch/mips/kvm/mmu.c",
      "insertions": 1088,
      "deletions": 241
    },
    {
      "file": "arch/mips/kvm/tlb.c",
      "insertions": 61,
      "deletions": 230
    },
    {
      "file": "arch/mips/kvm/trap_emul.c",
      "insertions": 654,
      "deletions": 80
    },
    {
      "file": "arch/powerpc/include/asm/kvm_book3s_64.h",
      "insertions": 16,
      "deletions": 0
    },
    {
      "file": "arch/powerpc/include/asm/kvm_host.h",
      "insertions": 15,
      "deletions": 6
    },
    {
      "file": "arch/powerpc/include/asm/kvm_ppc.h",
      "insertions": 10,
      "deletions": 5
    },
    {
      "file": "arch/powerpc/include/uapi/asm/kvm.h",
      "insertions": 2,
      "deletions": 0
    },
    {
      "file": "arch/powerpc/kvm/book3s_32_mmu.c",
      "insertions": 2,
      "deletions": 1
    },
    {
      "file": "arch/powerpc/kvm/book3s_64_mmu.c",
      "insertions": 2,
      "deletions": 1
    },
    {
      "file": "arch/powerpc/kvm/book3s_64_mmu_hv.c",
      "insertions": 515,
      "deletions": 120
    },
    {
      "file": "arch/powerpc/kvm/book3s_64_vio.c",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/powerpc/kvm/book3s_hv.c",
      "insertions": 48,
      "deletions": 17
    },
    {
      "file": "arch/powerpc/kvm/book3s_hv_builtin.c",
      "insertions": 4,
      "deletions": 4
    },
    {
      "file": "arch/powerpc/kvm/book3s_hv_rm_mmu.c",
      "insertions": 31,
      "deletions": 31
    },
    {
      "file": "arch/powerpc/kvm/book3s_hv_rm_xics.c",
      "insertions": 91,
      "deletions": 47
    },
    {
      "file": "arch/powerpc/kvm/book3s_pr.c",
      "insertions": 65,
      "deletions": 65
    },
    {
      "file": "arch/powerpc/kvm/book3s_xics.c",
      "insertions": 115,
      "deletions": 77
    },
    {
      "file": "arch/powerpc/kvm/book3s_xics.h",
      "insertions": 4,
      "deletions": 3
    },
    {
      "file": "arch/powerpc/kvm/powerpc.c",
      "insertions": 9,
      "deletions": 1
    },
    {
      "file": "arch/s390/kvm/gaccess.c",
      "insertions": 16,
      "deletions": 10
    },
    {
      "file": "arch/s390/kvm/gaccess.h",
      "insertions": 10,
      "deletions": 9
    },
    {
      "file": "arch/s390/kvm/guestdbg.c",
      "insertions": 107,
      "deletions": 13
    },
    {
      "file": "arch/s390/kvm/intercept.c",
      "insertions": 24,
      "deletions": 1
    },
    {
      "file": "arch/s390/kvm/kvm-s390.c",
      "insertions": 44,
      "deletions": 2
    },
    {
      "file": "arch/s390/kvm/kvm-s390.h",
      "insertions": 5,
      "deletions": 7
    },
    {
      "file": "arch/s390/kvm/priv.c",
      "insertions": 15,
      "deletions": 15
    },
    {
      "file": "arch/s390/kvm/vsie.c",
      "insertions": 3,
      "deletions": 0
    },
    {
      "file": "arch/s390/mm/pgtable.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/s390/tools/gen_facilities.c",
      "insertions": 2,
      "deletions": 0
    },
    {
      "file": "arch/x86/include/asm/desc.h",
      "insertions": 49,
      "deletions": 9
    },
    {
      "file": "arch/x86/include/asm/kvm_emulate.h",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/x86/include/asm/kvm_host.h",
      "insertions": 23,
      "deletions": 7
    },
    {
      "file": "arch/x86/include/asm/kvmclock.h",
      "insertions": 6,
      "deletions": 0
    },
    {
      "file": "arch/x86/include/asm/paravirt.h",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/x86/include/asm/processor.h",
      "insertions": 11,
      "deletions": 1
    },
    {
      "file": "arch/x86/include/asm/qspinlock.h",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/x86/include/asm/vmx.h",
      "insertions": 26,
      "deletions": 2
    },
    {
      "file": "arch/x86/include/uapi/asm/kvm_para.h",
      "insertions": 9,
      "deletions": 0
    },
    {
      "file": "arch/x86/kernel/asm-offsets_64.c",
      "insertions": 9,
      "deletions": 0
    },
    {
      "file": "arch/x86/kernel/ioport.c",
      "insertions": 5,
      "deletions": 0
    },
    {
      "file": "arch/x86/kernel/kvm.c",
      "insertions": 25,
      "deletions": 1
    },
    {
      "file": "arch/x86/kernel/kvmclock.c",
      "insertions": 4,
      "deletions": 1
    },
    {
      "file": "arch/x86/kernel/paravirt-spinlocks.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/x86/kernel/process.c",
      "insertions": 10,
      "deletions": 0
    },
    {
      "file": "arch/x86/kvm/cpuid.c",
      "insertions": 1,
      "deletions": 9
    },
    {
      "file": "arch/x86/kvm/emulate.c",
      "insertions": 16,
      "deletions": 4
    },
    {
      "file": "arch/x86/kvm/hyperv.c",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "arch/x86/kvm/i8259.c",
      "insertions": 11,
      "deletions": 5
    },
    {
      "file": "arch/x86/kvm/irq.h",
      "insertions": 10,
      "deletions": 9
    },
    {
      "file": "arch/x86/kvm/irq_comm.c",
      "insertions": 10,
      "deletions": 19
    },
    {
      "file": "arch/x86/kvm/lapic.c",
      "insertions": 131,
      "deletions": 66
    },
    {
      "file": "arch/x86/kvm/lapic.h",
      "insertions": 3,
      "deletions": 13
    },
    {
      "file": "arch/x86/kvm/mmu.c",
      "insertions": 356,
      "deletions": 153
    },
    {
      "file": "arch/x86/kvm/svm.c",
      "insertions": 7,
      "deletions": 50
    },
    {
      "file": "arch/x86/kvm/vmx.c",
      "insertions": 444,
      "deletions": 465
    },
    {
      "file": "arch/x86/kvm/x86.c",
      "insertions": 187,
      "deletions": 87
    },
    {
      "file": "drivers/ptp/Kconfig",
      "insertions": 12,
      "deletions": 0
    },
    {
      "file": "drivers/ptp/Makefile",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "drivers/ptp/ptp_kvm.c",
      "insertions": 207,
      "deletions": 0
    },
    {
      "file": "include/kvm/arm_arch_timer.h",
      "insertions": 21,
      "deletions": 18
    },
    {
      "file": "include/kvm/arm_vgic.h",
      "insertions": 16,
      "deletions": 2
    },
    {
      "file": "include/linux/irqchip/arm-gic-v3.h",
      "insertions": 41,
      "deletions": 4
    },
    {
      "file": "include/linux/kvm_host.h",
      "insertions": 8,
      "deletions": 10
    },
    {
      "file": "include/uapi/linux/kvm.h",
      "insertions": 14,
      "deletions": 1
    },
    {
      "file": "include/uapi/linux/kvm_para.h",
      "insertions": 2,
      "deletions": 0
    },
    {
      "file": "virt/kvm/arm/arch_timer.c",
      "insertions": 139,
      "deletions": 62
    },
    {
      "file": "virt/kvm/arm/hyp/timer-sr.c",
      "insertions": 7,
      "deletions": 6
    },
    {
      "file": "virt/kvm/arm/vgic/vgic-debug.c",
      "insertions": 283,
      "deletions": 0
    },
    {
      "file": "virt/kvm/arm/vgic/vgic-init.c",
      "insertions": 4,
      "deletions": 0
    },
    {
      "file": "virt/kvm/arm/vgic/vgic-irqfd.c",
      "insertions": 3,
      "deletions": 0
    },
    {
      "file": "virt/kvm/arm/vgic/vgic-its.c",
      "insertions": 3,
      "deletions": 3
    },
    {
      "file": "virt/kvm/arm/vgic/vgic-kvm-device.c",
      "insertions": 216,
      "deletions": 15
    },
    {
      "file": "virt/kvm/arm/vgic/vgic-mmio-v2.c",
      "insertions": 24,
      "deletions": 63
    },
    {
      "file": "virt/kvm/arm/vgic/vgic-mmio-v3.c",
      "insertions": 184,
      "deletions": 19
    },
    {
      "file": "virt/kvm/arm/vgic/vgic-mmio.c",
      "insertions": 147,
      "deletions": 20
    },
    {
      "file": "virt/kvm/arm/vgic/vgic-mmio.h",
      "insertions": 24,
      "deletions": 0
    },
    {
      "file": "virt/kvm/arm/vgic/vgic-v2.c",
      "insertions": 5,
      "deletions": 7
    },
    {
      "file": "virt/kvm/arm/vgic/vgic-v3.c",
      "insertions": 31,
      "deletions": 9
    },
    {
      "file": "virt/kvm/arm/vgic/vgic.c",
      "insertions": 23,
      "deletions": 43
    },
    {
      "file": "virt/kvm/arm/vgic/vgic.h",
      "insertions": 82,
      "deletions": 1
    },
    {
      "file": "virt/kvm/kvm_main.c",
      "insertions": 56,
      "deletions": 57
    }
  ],
  "total_insertions": 7277,
  "total_deletions": 2968,
  "total_changes": 10245,
  "parents": [
    "5066e4a34081dd82fb625f2f382bfa29ca421a3f",
    "dd0fd8bca1850ddadf5d33a9ed28f3707cd98ac7"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.11",
    "v4.11-rc1",
    "v4.11-rc2",
    "v4.11-rc3",
    "v4.11-rc4",
    "v4.11-rc5",
    "v4.11-rc6",
    "v4.11-rc7",
    "v4.11-rc8",
    "v4.12"
  ],
  "is_merge": true,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/arm64/include/asm/kvm_host.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/s390/mm/pgtable.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/arm64/include/asm/kvm_mmu.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/s390/kvm/kvm-s390.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/s390/kvm/vsie.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/s390/kvm/priv.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kernel/paravirt-spinlocks.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kernel/kvmclock.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/include/asm/processor.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kernel/kvm.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kvm/hyperv.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/linux/irqchip/arm-gic-v3.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kvm/x86.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}