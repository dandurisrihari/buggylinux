Commit Hash: a51abbbf25317c07cb00b40ae7d04a209d2a3d54
Subject: KVM: selftests: Add tests in xen_shinfo_test to detect lock races


Security Keywords:
- injection

Full commit message:
KVM: selftests: Add tests in xen_shinfo_test to detect lock races

Tests for races between shinfo_cache (de)activation and hypercall+ioctl()
processing.  KVM has had bugs where activating the shared info cache
multiple times and/or with concurrent users results in lock corruption,
NULL pointer dereferences, and other fun.

For the timer injection testcase (#22), re-arm the timer until the IRQ
is successfully injected.  If the timer expires while the shared info
is deactivated (invalid), KVM will drop the event.

Signed-off-by: Michal Luczaj <mhal@rbox.co>
Co-developed-by: Sean Christopherson <seanjc@google.com>
Signed-off-by: Sean Christopherson <seanjc@google.com>
Message-Id: <20221013211234.1318131-16-seanjc@google.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

Metadata:
Author: Michal Luczaj <mhal@rbox.co>
Author Date: Thu Oct 13 21:12:33 2022 +0000
Committer: Paolo Bonzini <pbonzini@redhat.com>
Commit Date: Fri Oct 28 06:10:27 2022 -0400

Files Changed: 1
Lines Added: 140
Lines Removed: 0
Total Changes: 140
