{
  "hash": "9520628e8ceb69fa9a4aee6b57f22675d9e1b709",
  "hash_short": "9520628e",
  "subject": "fs: make dumpable=2 require fully qualified path",
  "body": "When the suid_dumpable sysctl is set to \"2\", and there is no core dump\npipe defined in the core_pattern sysctl, a local user can cause core files\nto be written to root-writable directories, potentially with\nuser-controlled content.\n\nThis means an admin can unknowningly reintroduce a variation of\nCVE-2006-2451, allowing local users to gain root privileges.\n\n  $ cat /proc/sys/fs/suid_dumpable\n  2\n  $ cat /proc/sys/kernel/core_pattern\n  core\n  $ ulimit -c unlimited\n  $ cd /\n  $ ls -l core\n  ls: cannot access core: No such file or directory\n  $ touch core\n  touch: cannot touch `core': Permission denied\n  $ OHAI=\"evil-string-here\" ping localhost >/dev/null 2>&1 &\n  $ pid=$!\n  $ sleep 1\n  $ kill -SEGV $pid\n  $ ls -l core\n  -rw------- 1 root kees 458752 Jun 21 11:35 core\n  $ sudo strings core | grep evil\n  OHAI=evil-string-here\n\nWhile cron has been fixed to abort reading a file when there is any\nparse error, there are still other sensitive directories that will read\nany file present and skip unparsable lines.\n\nInstead of introducing a suid_dumpable=3 mode and breaking all users of\nmode 2, this only disables the unsafe portion of mode 2 (writing to disk\nvia relative path).  Most users of mode 2 (e.g.  Chrome OS) already use\na core dump pipe handler, so this change will not break them.  For the\nsituations where a pipe handler is not defined but mode 2 is still\nactive, crash dumps will only be written to fully qualified paths.  If a\nrelative path is defined (e.g.  the default \"core\" pattern), dump\nattempts will trigger a printk yelling about the lack of a fully\nqualified path.\n\nSigned-off-by: Kees Cook <keescook@chromium.org>\nCc: Alexander Viro <viro@zeniv.linux.org.uk>\nCc: Alan Cox <alan@linux.intel.com>\nCc: \"Eric W. Biederman\" <ebiederm@xmission.com>\nCc: Doug Ledford <dledford@redhat.com>\nCc: Serge Hallyn <serge.hallyn@canonical.com>\nCc: James Morris <james.l.morris@oracle.com>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
  "full_message": "fs: make dumpable=2 require fully qualified path\n\nWhen the suid_dumpable sysctl is set to \"2\", and there is no core dump\npipe defined in the core_pattern sysctl, a local user can cause core files\nto be written to root-writable directories, potentially with\nuser-controlled content.\n\nThis means an admin can unknowningly reintroduce a variation of\nCVE-2006-2451, allowing local users to gain root privileges.\n\n  $ cat /proc/sys/fs/suid_dumpable\n  2\n  $ cat /proc/sys/kernel/core_pattern\n  core\n  $ ulimit -c unlimited\n  $ cd /\n  $ ls -l core\n  ls: cannot access core: No such file or directory\n  $ touch core\n  touch: cannot touch `core': Permission denied\n  $ OHAI=\"evil-string-here\" ping localhost >/dev/null 2>&1 &\n  $ pid=$!\n  $ sleep 1\n  $ kill -SEGV $pid\n  $ ls -l core\n  -rw------- 1 root kees 458752 Jun 21 11:35 core\n  $ sudo strings core | grep evil\n  OHAI=evil-string-here\n\nWhile cron has been fixed to abort reading a file when there is any\nparse error, there are still other sensitive directories that will read\nany file present and skip unparsable lines.\n\nInstead of introducing a suid_dumpable=3 mode and breaking all users of\nmode 2, this only disables the unsafe portion of mode 2 (writing to disk\nvia relative path).  Most users of mode 2 (e.g.  Chrome OS) already use\na core dump pipe handler, so this change will not break them.  For the\nsituations where a pipe handler is not defined but mode 2 is still\nactive, crash dumps will only be written to fully qualified paths.  If a\nrelative path is defined (e.g.  the default \"core\" pattern), dump\nattempts will trigger a printk yelling about the lack of a fully\nqualified path.\n\nSigned-off-by: Kees Cook <keescook@chromium.org>\nCc: Alexander Viro <viro@zeniv.linux.org.uk>\nCc: Alan Cox <alan@linux.intel.com>\nCc: \"Eric W. Biederman\" <ebiederm@xmission.com>\nCc: Doug Ledford <dledford@redhat.com>\nCc: Serge Hallyn <serge.hallyn@canonical.com>\nCc: James Morris <james.l.morris@oracle.com>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
  "author_name": "Kees Cook",
  "author_email": "keescook@chromium.org",
  "author_date": "Mon Jul 30 14:39:15 2012 -0700",
  "author_date_iso": "2012-07-30T14:39:15-07:00",
  "committer_name": "Linus Torvalds",
  "committer_email": "torvalds@linux-foundation.org",
  "committer_date": "Mon Jul 30 17:25:11 2012 -0700",
  "committer_date_iso": "2012-07-30T17:25:11-07:00",
  "files_changed": [
    "Documentation/sysctl/fs.txt",
    "fs/exec.c"
  ],
  "files_changed_count": 2,
  "stats": [
    {
      "file": "Documentation/sysctl/fs.txt",
      "insertions": 12,
      "deletions": 6
    },
    {
      "file": "fs/exec.c",
      "insertions": 14,
      "deletions": 3
    }
  ],
  "total_insertions": 26,
  "total_deletions": 9,
  "total_changes": 35,
  "parents": [
    "779302e67835fe9a6b74327e54969ba59cb3478a"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v3.10",
    "v3.10-rc1",
    "v3.10-rc2",
    "v3.10-rc3",
    "v3.10-rc4",
    "v3.10-rc5",
    "v3.10-rc6",
    "v3.10-rc7",
    "v3.11",
    "v3.11-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [
      "CVE-2006-2451"
    ],
    "security_keywords": []
  },
  "fix_type": "cve",
  "file_results": [
    {
      "file": "Documentation/sysctl/fs.txt",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "fs/exec.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}