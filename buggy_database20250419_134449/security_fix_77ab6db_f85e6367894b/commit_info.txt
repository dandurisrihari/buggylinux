Commit Hash: 77ab6db0a1c403387b403e9351ab3f5ae1df83e6
Subject: KVM: VMX: Reinject real mode exception


Security Keywords:
- injection

Full commit message:
KVM: VMX: Reinject real mode exception

As we execute real mode guests in VM86 mode, exception have to be
reinjected appropriately when the guest triggered them. For this purpose
the patch adopts the real-mode injection pattern used in vmx_inject_irq
to vmx_queue_exception, additionally taking care that the IP is set
correctly for #BP exceptions. Furthermore it extends
handle_rmode_exception to reinject all those exceptions that can be
raised in real mode.

This fixes the execution of himem.exe from FreeDOS and also makes its
debug.com work properly.

Note that guest debugging in real mode is broken now. This has to be
fixed by the scheduled debugging infrastructure rework (will be done
once base patches for QEMU have been accepted).

Signed-off-by: Jan Kiszka <jan.kiszka@web.de>
Signed-off-by: Avi Kivity <avi@qumranet.com>

Metadata:
Author: Jan Kiszka <jan.kiszka@web.de>
Author Date: Mon Jul 14 12:28:51 2008 +0200
Committer: Avi Kivity <avi@qumranet.com>
Commit Date: Wed Oct 15 10:15:14 2008 +0200

Files Changed: 2
Lines Added: 43
Lines Removed: 2
Total Changes: 45
