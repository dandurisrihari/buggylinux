{
  "hash": "19597cad64d608aa8ac2f8aef50a50187a565223",
  "hash_short": "19597cad",
  "subject": "scsi: qla2xxx: Fix system crash due to bad pointer access",
  "body": "User experiences system crash when running AER error injection.  The\nperturbation causes the abort-all-I/O path to trigger. The driver assumes\nall I/O on this path is FCP only. If there is both NVMe & FCP traffic, a\nsystem crash happens. Add additional check to see if I/O is FCP or not\nbefore access.\n\nPID: 999019  TASK: ff35d769f24722c0  CPU: 53  COMMAND: \"kworker/53:1\"\n 0 [ff3f78b964847b58] machine_kexec at ffffffffae86973d\n 1 [ff3f78b964847ba8] __crash_kexec at ffffffffae9be29d\n 2 [ff3f78b964847c70] crash_kexec at ffffffffae9bf528\n 3 [ff3f78b964847c78] oops_end at ffffffffae8282ab\n 4 [ff3f78b964847c98] exc_page_fault at ffffffffaf2da502\n 5 [ff3f78b964847cc0] asm_exc_page_fault at ffffffffaf400b62\n   [exception RIP: qla2x00_abort_srb+444]\n   RIP: ffffffffc07b5f8c  RSP: ff3f78b964847d78  RFLAGS: 00010046\n   RAX: 0000000000000282  RBX: ff35d74a0195a200  RCX: ff35d76886fd03a0\n   RDX: 0000000000000001  RSI: ffffffffc07c5ec8  RDI: ff35d74a0195a200\n   RBP: ff35d76913d22080   R8: ff35d7694d103200   R9: ff35d7694d103200\n   R10: 0000000100000000  R11: ffffffffb05d6630  R12: 0000000000010000\n   R13: ff3f78b964847df8  R14: ff35d768d8754000  R15: ff35d768877248e0\n   ORIG_RAX: ffffffffffffffff  CS: 0010  SS: 0018\n 6 [ff3f78b964847d70] qla2x00_abort_srb at ffffffffc07b5f84 [qla2xxx]\n 7 [ff3f78b964847de0] __qla2x00_abort_all_cmds at ffffffffc07b6238 [qla2xxx]\n 8 [ff3f78b964847e38] qla2x00_abort_all_cmds at ffffffffc07ba635 [qla2xxx]\n 9 [ff3f78b964847e58] qla2x00_terminate_rport_io at ffffffffc08145eb [qla2xxx]\n10 [ff3f78b964847e70] fc_terminate_rport_io at ffffffffc045987e [scsi_transport_fc]\n11 [ff3f78b964847e88] process_one_work at ffffffffae914f15\n12 [ff3f78b964847ed0] worker_thread at ffffffffae9154c0\n13 [ff3f78b964847f10] kthread at ffffffffae91c456\n14 [ff3f78b964847f50] ret_from_fork at ffffffffae8036ef\n\nCc: stable@vger.kernel.org\nFixes: f45bca8c5052 (\"scsi: qla2xxx: Fix double scsi_done for abort path\")\nSigned-off-by: Quinn Tran <qutran@marvell.com>\nSigned-off-by: Nilesh Javali <njavali@marvell.com>\nLink: https://lore.kernel.org/r/20231030064912.37912-1-njavali@marvell.com\nSigned-off-by: Martin K. Petersen <martin.petersen@oracle.com>",
  "full_message": "scsi: qla2xxx: Fix system crash due to bad pointer access\n\nUser experiences system crash when running AER error injection.  The\nperturbation causes the abort-all-I/O path to trigger. The driver assumes\nall I/O on this path is FCP only. If there is both NVMe & FCP traffic, a\nsystem crash happens. Add additional check to see if I/O is FCP or not\nbefore access.\n\nPID: 999019  TASK: ff35d769f24722c0  CPU: 53  COMMAND: \"kworker/53:1\"\n 0 [ff3f78b964847b58] machine_kexec at ffffffffae86973d\n 1 [ff3f78b964847ba8] __crash_kexec at ffffffffae9be29d\n 2 [ff3f78b964847c70] crash_kexec at ffffffffae9bf528\n 3 [ff3f78b964847c78] oops_end at ffffffffae8282ab\n 4 [ff3f78b964847c98] exc_page_fault at ffffffffaf2da502\n 5 [ff3f78b964847cc0] asm_exc_page_fault at ffffffffaf400b62\n   [exception RIP: qla2x00_abort_srb+444]\n   RIP: ffffffffc07b5f8c  RSP: ff3f78b964847d78  RFLAGS: 00010046\n   RAX: 0000000000000282  RBX: ff35d74a0195a200  RCX: ff35d76886fd03a0\n   RDX: 0000000000000001  RSI: ffffffffc07c5ec8  RDI: ff35d74a0195a200\n   RBP: ff35d76913d22080   R8: ff35d7694d103200   R9: ff35d7694d103200\n   R10: 0000000100000000  R11: ffffffffb05d6630  R12: 0000000000010000\n   R13: ff3f78b964847df8  R14: ff35d768d8754000  R15: ff35d768877248e0\n   ORIG_RAX: ffffffffffffffff  CS: 0010  SS: 0018\n 6 [ff3f78b964847d70] qla2x00_abort_srb at ffffffffc07b5f84 [qla2xxx]\n 7 [ff3f78b964847de0] __qla2x00_abort_all_cmds at ffffffffc07b6238 [qla2xxx]\n 8 [ff3f78b964847e38] qla2x00_abort_all_cmds at ffffffffc07ba635 [qla2xxx]\n 9 [ff3f78b964847e58] qla2x00_terminate_rport_io at ffffffffc08145eb [qla2xxx]\n10 [ff3f78b964847e70] fc_terminate_rport_io at ffffffffc045987e [scsi_transport_fc]\n11 [ff3f78b964847e88] process_one_work at ffffffffae914f15\n12 [ff3f78b964847ed0] worker_thread at ffffffffae9154c0\n13 [ff3f78b964847f10] kthread at ffffffffae91c456\n14 [ff3f78b964847f50] ret_from_fork at ffffffffae8036ef\n\nCc: stable@vger.kernel.org\nFixes: f45bca8c5052 (\"scsi: qla2xxx: Fix double scsi_done for abort path\")\nSigned-off-by: Quinn Tran <qutran@marvell.com>\nSigned-off-by: Nilesh Javali <njavali@marvell.com>\nLink: https://lore.kernel.org/r/20231030064912.37912-1-njavali@marvell.com\nSigned-off-by: Martin K. Petersen <martin.petersen@oracle.com>",
  "author_name": "Quinn Tran",
  "author_email": "qutran@marvell.com",
  "author_date": "Mon Oct 30 12:19:12 2023 +0530",
  "author_date_iso": "2023-10-30T12:19:12+05:30",
  "committer_name": "Martin K. Petersen",
  "committer_email": "martin.petersen@oracle.com",
  "committer_date": "Wed Nov 8 21:32:41 2023 -0500",
  "committer_date_iso": "2023-11-08T21:32:41-05:00",
  "files_changed": [
    "drivers/scsi/qla2xxx/qla_os.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/scsi/qla2xxx/qla_os.c",
      "insertions": 10,
      "deletions": 2
    }
  ],
  "total_insertions": 10,
  "total_deletions": 2,
  "total_changes": 12,
  "parents": [
    "a75a16c62a2540f11eeae4f2b50e95deefb652ea"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/scsi/qla2xxx/qla_os.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}