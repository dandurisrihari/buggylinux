Commit Hash: c20383ad1656b0f6354dd50e4acd894f9d94090d
Subject: s390/qeth: improve completion of pending TX buffers


Security Keywords:
- exploit

Full commit message:
s390/qeth: improve completion of pending TX buffers

The current design attaches a pending TX buffer to a custom
single-linked list, which is anchored at the buffer's slot on the
TX ring. The buffer is then checked for final completion whenever
this slot is processed during a subsequent TX NAPI poll cycle.

But if there's insufficient traffic on the ring, we might never make
enough progress to get back to this ring slot and discover the pending
buffer's final TX completion. In particular if this missing TX
completion blocks the application from sending further traffic.

So convert the custom single-linked list code to a per-queue list_head,
and scan this list on every TX NAPI cycle.

Fixes: 0da9581ddb0f ("qeth: exploit asynchronous delivery of storage blocks")
Signed-off-by: Julian Wiedmann <jwi@linux.ibm.com>
Signed-off-by: David S. Miller <davem@davemloft.net>

Metadata:
Author: Julian Wiedmann <jwi@linux.ibm.com>
Author Date: Tue Mar 9 17:52:19 2021 +0100
Committer: David S. Miller <davem@davemloft.net>
Commit Date: Tue Mar 9 16:14:54 2021 -0800

Files Changed: 2
Lines Added: 30
Lines Removed: 42
Total Changes: 72
