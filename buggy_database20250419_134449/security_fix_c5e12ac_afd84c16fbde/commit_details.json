{
  "hash": "c5e12ac3beb0dd3a718296b2d8af5528e9ab728e",
  "hash_short": "c5e12ac3",
  "subject": "net: mscc: ocelot: serialize access to the injection/extraction groups",
  "body": "As explained by Horatiu Vultur in commit 603ead96582d (\"net: sparx5: Add\nspinlock for frame transmission from CPU\") which is for a similar\nhardware design, multiple CPUs can simultaneously perform injection\nor extraction. There are only 2 register groups for injection and 2\nfor extraction, and the driver only uses one of each. So we'd better\nserialize access using spin locks, otherwise frame corruption is\npossible.\n\nNote that unlike in sparx5, FDMA in ocelot does not have this issue\nbecause struct ocelot_fdma_tx_ring already contains an xmit_lock.\n\nI guess this is mostly a problem for NXP LS1028A, as that is dual core.\nI don't think VSC7514 is. So I'm blaming the commit where LS1028A (aka\nthe felix DSA driver) started using register-based packet injection and\nextraction.\n\nFixes: 0a6f17c6ae21 (\"net: dsa: tag_ocelot_8021q: add support for PTP timestamping\")\nSigned-off-by: Vladimir Oltean <vladimir.oltean@nxp.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
  "full_message": "net: mscc: ocelot: serialize access to the injection/extraction groups\n\nAs explained by Horatiu Vultur in commit 603ead96582d (\"net: sparx5: Add\nspinlock for frame transmission from CPU\") which is for a similar\nhardware design, multiple CPUs can simultaneously perform injection\nor extraction. There are only 2 register groups for injection and 2\nfor extraction, and the driver only uses one of each. So we'd better\nserialize access using spin locks, otherwise frame corruption is\npossible.\n\nNote that unlike in sparx5, FDMA in ocelot does not have this issue\nbecause struct ocelot_fdma_tx_ring already contains an xmit_lock.\n\nI guess this is mostly a problem for NXP LS1028A, as that is dual core.\nI don't think VSC7514 is. So I'm blaming the commit where LS1028A (aka\nthe felix DSA driver) started using register-based packet injection and\nextraction.\n\nFixes: 0a6f17c6ae21 (\"net: dsa: tag_ocelot_8021q: add support for PTP timestamping\")\nSigned-off-by: Vladimir Oltean <vladimir.oltean@nxp.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>",
  "author_name": "Vladimir Oltean",
  "author_email": "vladimir.oltean@nxp.com",
  "author_date": "Thu Aug 15 03:07:04 2024 +0300",
  "author_date_iso": "2024-08-15T03:07:04+03:00",
  "committer_name": "David S. Miller",
  "committer_email": "davem@davemloft.net",
  "committer_date": "Fri Aug 16 09:59:32 2024 +0100",
  "committer_date_iso": "2024-08-16T09:59:32+01:00",
  "files_changed": [
    "drivers/net/dsa/ocelot/felix.c",
    "drivers/net/ethernet/mscc/ocelot.c",
    "drivers/net/ethernet/mscc/ocelot_vsc7514.c",
    "include/soc/mscc/ocelot.h"
  ],
  "files_changed_count": 4,
  "stats": [
    {
      "file": "drivers/net/dsa/ocelot/felix.c",
      "insertions": 11,
      "deletions": 0
    },
    {
      "file": "drivers/net/ethernet/mscc/ocelot.c",
      "insertions": 52,
      "deletions": 0
    },
    {
      "file": "drivers/net/ethernet/mscc/ocelot_vsc7514.c",
      "insertions": 4,
      "deletions": 0
    },
    {
      "file": "include/soc/mscc/ocelot.h",
      "insertions": 9,
      "deletions": 0
    }
  ],
  "total_insertions": 76,
  "total_deletions": 0,
  "total_changes": 76,
  "parents": [
    "e1b9e80236c540fa85d76e2d510d1b38e1968c5d"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/net/dsa/ocelot/felix.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/ethernet/mscc/ocelot.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/net/ethernet/mscc/ocelot_vsc7514.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/soc/mscc/ocelot.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}