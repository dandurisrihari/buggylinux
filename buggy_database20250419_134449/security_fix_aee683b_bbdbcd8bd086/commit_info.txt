Commit Hash: aee683b9e77e17237b0e146025c3d363c9203634
Subject: ecryptfs: release keys loaded in ecryptfs_keyring_auth_tok_for_sig()


Security Keywords:
- authentication

Full commit message:
ecryptfs: release keys loaded in ecryptfs_keyring_auth_tok_for_sig()

This patch allows keys requested in the function
ecryptfs_keyring_auth_tok_for_sig()to be released when they are no
longer required. In particular keys are directly released in the same
function if the obtained authentication token is not valid.

Further, a new function parameter 'auth_tok_key' has been added to
ecryptfs_find_auth_tok_for_sig() in order to provide callers the key
pointer to be passed to key_put().

Signed-off-by: Roberto Sassu <roberto.sassu@polito.it>
Cc: Dustin Kirkland <kirkland@canonical.com>
Cc: James Morris <jmorris@namei.org>
[Tyler: Initialize auth_tok_key to NULL in ecryptfs_parse_packet_set]
Signed-off-by: Tyler Hicks <tyhicks@linux.vnet.ibm.com>

Metadata:
Author: Roberto Sassu <roberto.sassu@polito.it>
Author Date: Wed Oct 6 18:31:06 2010 +0200
Committer: Tyler Hicks <tyhicks@linux.vnet.ibm.com>
Commit Date: Fri Oct 29 10:31:35 2010 -0500

Files Changed: 1
Lines Added: 28
Lines Removed: 6
Total Changes: 34
