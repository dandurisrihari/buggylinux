commit f2ab95814103314af3239d322e382c61c69a788d
Author: David S. Miller <davem@davemloft.net>
Date:   Sun Dec 23 16:01:35 2018 -0800

    net: Revert recent Spectre-v1 patches.
    
    This reverts:
    
    50d5258634ae ("net: core: Fix Spectre v1 vulnerability")
    d686026b1e6e ("phonet: af_phonet: Fix Spectre v1 vulnerability")
    a95386f0390a ("nfc: af_nfc: Fix Spectre v1 vulnerability")
    a3ac5817ffe8 ("can: af_can: Fix Spectre v1 vulnerability")
    
    After some discussion with Alexei Starovoitov these all seem to
    be completely unnecessary.
    
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/net/can/af_can.c b/net/can/af_can.c
index cade7250c6d4..1684ba5b51eb 100644
--- a/net/can/af_can.c
+++ b/net/can/af_can.c
@@ -59,7 +59,6 @@
 #include <linux/can/core.h>
 #include <linux/can/skb.h>
 #include <linux/ratelimit.h>
-#include <linux/nospec.h>
 #include <net/net_namespace.h>
 #include <net/sock.h>
 
@@ -137,7 +136,6 @@ static int can_create(struct net *net, struct socket *sock, int protocol,
 
 	if (protocol < 0 || protocol >= CAN_NPROTO)
 		return -EINVAL;
-	protocol = array_index_nospec(protocol, CAN_NPROTO);
 
 	cp = can_get_proto(protocol);