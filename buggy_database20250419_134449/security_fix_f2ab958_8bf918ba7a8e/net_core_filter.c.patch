commit f2ab95814103314af3239d322e382c61c69a788d
Author: David S. Miller <davem@davemloft.net>
Date:   Sun Dec 23 16:01:35 2018 -0800

    net: Revert recent Spectre-v1 patches.
    
    This reverts:
    
    50d5258634ae ("net: core: Fix Spectre v1 vulnerability")
    d686026b1e6e ("phonet: af_phonet: Fix Spectre v1 vulnerability")
    a95386f0390a ("nfc: af_nfc: Fix Spectre v1 vulnerability")
    a3ac5817ffe8 ("can: af_can: Fix Spectre v1 vulnerability")
    
    After some discussion with Alexei Starovoitov these all seem to
    be completely unnecessary.
    
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/net/core/filter.c b/net/core/filter.c
index 0c74c2f9776a..8d2c629501e2 100644
--- a/net/core/filter.c
+++ b/net/core/filter.c
@@ -73,7 +73,6 @@
 #include <linux/seg6_local.h>
 #include <net/seg6.h>
 #include <net/seg6_local.h>
-#include <linux/nospec.h>
 
 /**
  *	sk_filter_trim_cap - run a packet through a socket filter
@@ -1039,7 +1038,6 @@ static int bpf_check_classic(const struct sock_filter *filter,
 	bool anc_found;
 	int pc;
 
-	flen = array_index_nospec(flen, BPF_MAXINSNS + 1);
 	/* Check the filter code now */
 	for (pc = 0; pc < flen; pc++) {
 		const struct sock_filter *ftest = &filter[pc];