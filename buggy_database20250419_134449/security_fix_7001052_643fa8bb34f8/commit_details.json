{
  "hash": "7001052160d172f6de06adeffde24dde9935ece8",
  "hash_short": "70010521",
  "subject": "Merge tag 'x86_core_for_5.18_rc1' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip",
  "body": "Pull x86 CET-IBT (Control-Flow-Integrity) support from Peter Zijlstra:\n \"Add support for Intel CET-IBT, available since Tigerlake (11th gen),\n  which is a coarse grained, hardware based, forward edge\n  Control-Flow-Integrity mechanism where any indirect CALL/JMP must\n  target an ENDBR instruction or suffer #CP.\n\n  Additionally, since Alderlake (12th gen)/Sapphire-Rapids, speculation\n  is limited to 2 instructions (and typically fewer) on branch targets\n  not starting with ENDBR. CET-IBT also limits speculation of the next\n  sequential instruction after the indirect CALL/JMP [1].\n\n  CET-IBT is fundamentally incompatible with retpolines, but provides,\n  as described above, speculation limits itself\"\n\n[1] https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/technical-documentation/branch-history-injection.html\n\n* tag 'x86_core_for_5.18_rc1' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip: (53 commits)\n  kvm/emulate: Fix SETcc emulation for ENDBR\n  x86/Kconfig: Only allow CONFIG_X86_KERNEL_IBT with ld.lld >= 14.0.0\n  x86/Kconfig: Only enable CONFIG_CC_HAS_IBT for clang >= 14.0.0\n  kbuild: Fixup the IBT kbuild changes\n  x86/Kconfig: Do not allow CONFIG_X86_X32_ABI=y with llvm-objcopy\n  x86: Remove toolchain check for X32 ABI capability\n  x86/alternative: Use .ibt_endbr_seal to seal indirect calls\n  objtool: Find unused ENDBR instructions\n  objtool: Validate IBT assumptions\n  objtool: Add IBT/ENDBR decoding\n  objtool: Read the NOENDBR annotation\n  x86: Annotate idtentry_df()\n  x86,objtool: Move the ASM_REACHABLE annotation to objtool.h\n  x86: Annotate call_on_stack()\n  objtool: Rework ASM_REACHABLE\n  x86: Mark __invalid_creds() __noreturn\n  exit: Mark do_group_exit() __noreturn\n  x86: Mark stop_this_cpu() __noreturn\n  objtool: Ignore extra-symbol code\n  objtool: Rename --duplicate to --lto\n  ...",
  "full_message": "Merge tag 'x86_core_for_5.18_rc1' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip\n\nPull x86 CET-IBT (Control-Flow-Integrity) support from Peter Zijlstra:\n \"Add support for Intel CET-IBT, available since Tigerlake (11th gen),\n  which is a coarse grained, hardware based, forward edge\n  Control-Flow-Integrity mechanism where any indirect CALL/JMP must\n  target an ENDBR instruction or suffer #CP.\n\n  Additionally, since Alderlake (12th gen)/Sapphire-Rapids, speculation\n  is limited to 2 instructions (and typically fewer) on branch targets\n  not starting with ENDBR. CET-IBT also limits speculation of the next\n  sequential instruction after the indirect CALL/JMP [1].\n\n  CET-IBT is fundamentally incompatible with retpolines, but provides,\n  as described above, speculation limits itself\"\n\n[1] https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/technical-documentation/branch-history-injection.html\n\n* tag 'x86_core_for_5.18_rc1' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip: (53 commits)\n  kvm/emulate: Fix SETcc emulation for ENDBR\n  x86/Kconfig: Only allow CONFIG_X86_KERNEL_IBT with ld.lld >= 14.0.0\n  x86/Kconfig: Only enable CONFIG_CC_HAS_IBT for clang >= 14.0.0\n  kbuild: Fixup the IBT kbuild changes\n  x86/Kconfig: Do not allow CONFIG_X86_X32_ABI=y with llvm-objcopy\n  x86: Remove toolchain check for X32 ABI capability\n  x86/alternative: Use .ibt_endbr_seal to seal indirect calls\n  objtool: Find unused ENDBR instructions\n  objtool: Validate IBT assumptions\n  objtool: Add IBT/ENDBR decoding\n  objtool: Read the NOENDBR annotation\n  x86: Annotate idtentry_df()\n  x86,objtool: Move the ASM_REACHABLE annotation to objtool.h\n  x86: Annotate call_on_stack()\n  objtool: Rework ASM_REACHABLE\n  x86: Mark __invalid_creds() __noreturn\n  exit: Mark do_group_exit() __noreturn\n  x86: Mark stop_this_cpu() __noreturn\n  objtool: Ignore extra-symbol code\n  objtool: Rename --duplicate to --lto\n  ...",
  "author_name": "Linus Torvalds",
  "author_email": "torvalds@linux-foundation.org",
  "author_date": "Sun Mar 27 10:17:23 2022 -0700",
  "author_date_iso": "2022-03-27T10:17:23-07:00",
  "committer_name": "Linus Torvalds",
  "committer_email": "torvalds@linux-foundation.org",
  "committer_date": "Sun Mar 27 10:17:23 2022 -0700",
  "committer_date_iso": "2022-03-27T10:17:23-07:00",
  "files_changed": [
    "arch/powerpc/include/asm/livepatch.h",
    "arch/x86/Kconfig",
    "arch/x86/include/asm/cpufeatures.h",
    "arch/x86/include/asm/msr-index.h",
    "arch/x86/include/asm/paravirt_types.h",
    "arch/x86/include/asm/text-patching.h",
    "arch/x86/kernel/alternative.c",
    "arch/x86/kernel/module.c",
    "arch/x86/kvm/emulate.c",
    "arch/x86/net/bpf_jit_comp.c",
    "include/asm-generic/vmlinux.lds.h",
    "include/linux/kprobes.h",
    "kernel/bpf/trampoline.c",
    "kernel/exit.c",
    "kernel/trace/ftrace.c",
    "scripts/Makefile.lib",
    "scripts/mod/modpost.c"
  ],
  "files_changed_count": 17,
  "stats": [
    {
      "file": "arch/powerpc/include/asm/livepatch.h",
      "insertions": 0,
      "deletions": 11
    },
    {
      "file": "arch/powerpc/kernel/kprobes.c",
      "insertions": 21,
      "deletions": 13
    },
    {
      "file": "arch/um/kernel/um_arch.c",
      "insertions": 4,
      "deletions": 0
    },
    {
      "file": "arch/x86/Kconfig",
      "insertions": 37,
      "deletions": 6
    },
    {
      "file": "arch/x86/Makefile",
      "insertions": 14,
      "deletions": 18
    },
    {
      "file": "arch/x86/crypto/crc32c-pcl-intel-asm_64.S",
      "insertions": 3,
      "deletions": 0
    },
    {
      "file": "arch/x86/entry/entry_64.S",
      "insertions": 27,
      "deletions": 4
    },
    {
      "file": "arch/x86/entry/entry_64_compat.S",
      "insertions": 5,
      "deletions": 0
    },
    {
      "file": "arch/x86/entry/syscalls/Makefile",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/x86/include/asm/alternative.h",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/x86/include/asm/bug.h",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/x86/include/asm/cpu.h",
      "insertions": 4,
      "deletions": 0
    },
    {
      "file": "arch/x86/include/asm/cpufeatures.h",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/x86/include/asm/efi.h",
      "insertions": 7,
      "deletions": 2
    },
    {
      "file": "arch/x86/include/asm/ibt.h",
      "insertions": 105,
      "deletions": 0
    },
    {
      "file": "arch/x86/include/asm/idtentry.h",
      "insertions": 16,
      "deletions": 9
    },
    {
      "file": "arch/x86/include/asm/irq_stack.h",
      "insertions": 3,
      "deletions": 1
    },
    {
      "file": "arch/x86/include/asm/irqflags.h",
      "insertions": 0,
      "deletions": 5
    },
    {
      "file": "arch/x86/include/asm/linkage.h",
      "insertions": 31,
      "deletions": 0
    },
    {
      "file": "arch/x86/include/asm/msr-index.h",
      "insertions": 19,
      "deletions": 1
    },
    {
      "file": "arch/x86/include/asm/paravirt.h",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/x86/include/asm/paravirt_types.h",
      "insertions": 0,
      "deletions": 1
    },
    {
      "file": "arch/x86/include/asm/processor.h",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/x86/include/asm/qspinlock_paravirt.h",
      "insertions": 3,
      "deletions": 0
    },
    {
      "file": "arch/x86/include/asm/segment.h",
      "insertions": 3,
      "deletions": 2
    },
    {
      "file": "arch/x86/include/asm/setup.h",
      "insertions": 2,
      "deletions": 1
    },
    {
      "file": "arch/x86/include/asm/syscall_wrapper.h",
      "insertions": 3,
      "deletions": 3
    },
    {
      "file": "arch/x86/include/asm/text-patching.h",
      "insertions": 23,
      "deletions": 7
    },
    {
      "file": "arch/x86/include/asm/traps.h",
      "insertions": 2,
      "deletions": 0
    },
    {
      "file": "arch/x86/include/asm/vdso.h",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/x86/include/uapi/asm/processor-flags.h",
      "insertions": 2,
      "deletions": 0
    },
    {
      "file": "arch/x86/kernel/alternative.c",
      "insertions": 52,
      "deletions": 14
    },
    {
      "file": "arch/x86/kernel/apm_32.c",
      "insertions": 7,
      "deletions": 0
    },
    {
      "file": "arch/x86/kernel/cpu/common.c",
      "insertions": 58,
      "deletions": 1
    },
    {
      "file": "arch/x86/kernel/ftrace.c",
      "insertions": 2,
      "deletions": 7
    },
    {
      "file": "arch/x86/kernel/ftrace_64.S",
      "insertions": 24,
      "deletions": 4
    },
    {
      "file": "arch/x86/kernel/head_64.S",
      "insertions": 12,
      "deletions": 2
    },
    {
      "file": "arch/x86/kernel/idt.c",
      "insertions": 7,
      "deletions": 2
    },
    {
      "file": "arch/x86/kernel/kprobes/core.c",
      "insertions": 20,
      "deletions": 9
    },
    {
      "file": "arch/x86/kernel/kvm.c",
      "insertions": 2,
      "deletions": 1
    },
    {
      "file": "arch/x86/kernel/machine_kexec_64.c",
      "insertions": 3,
      "deletions": 1
    },
    {
      "file": "arch/x86/kernel/module.c",
      "insertions": 7,
      "deletions": 1
    },
    {
      "file": "arch/x86/kernel/paravirt.c",
      "insertions": 5,
      "deletions": 24
    },
    {
      "file": "arch/x86/kernel/process.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/x86/kernel/process_64.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/x86/kernel/relocate_kernel_64.S",
      "insertions": 10,
      "deletions": 0
    },
    {
      "file": "arch/x86/kernel/traps.c",
      "insertions": 75,
      "deletions": 0
    },
    {
      "file": "arch/x86/kernel/vmlinux.lds.S",
      "insertions": 9,
      "deletions": 0
    },
    {
      "file": "arch/x86/kvm/emulate.c",
      "insertions": 10,
      "deletions": 6
    },
    {
      "file": "arch/x86/lib/error-inject.c",
      "insertions": 2,
      "deletions": 0
    },
    {
      "file": "arch/x86/lib/retpoline.S",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/x86/net/bpf_jit_comp.c",
      "insertions": 24,
      "deletions": 2
    },
    {
      "file": "arch/x86/platform/efi/Makefile",
      "insertions": 0,
      "deletions": 1
    },
    {
      "file": "arch/x86/platform/efi/efi_thunk_64.S",
      "insertions": 4,
      "deletions": 2
    },
    {
      "file": "arch/x86/xen/enlighten_pv.c",
      "insertions": 9,
      "deletions": 1
    },
    {
      "file": "arch/x86/xen/xen-asm.S",
      "insertions": 10,
      "deletions": 0
    },
    {
      "file": "arch/x86/xen/xen-head.S",
      "insertions": 7,
      "deletions": 2
    },
    {
      "file": "fs/fuse/ioctl.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "fs/xfs/xfs_ioctl32.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "include/asm-generic/vmlinux.lds.h",
      "insertions": 4,
      "deletions": 0
    },
    {
      "file": "include/linux/cfi.h",
      "insertions": 10,
      "deletions": 1
    },
    {
      "file": "include/linux/compiler.h",
      "insertions": 0,
      "deletions": 7
    },
    {
      "file": "include/linux/cred.h",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "include/linux/kprobes.h",
      "insertions": 2,
      "deletions": 1
    },
    {
      "file": "include/linux/objtool.h",
      "insertions": 32,
      "deletions": 0
    },
    {
      "file": "include/linux/sched/task.h",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "kernel/bpf/trampoline.c",
      "insertions": 4,
      "deletions": 16
    },
    {
      "file": "kernel/cred.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "kernel/exit.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "kernel/kprobes.c",
      "insertions": 54,
      "deletions": 20
    },
    {
      "file": "kernel/livepatch/patch.c",
      "insertions": 2,
      "deletions": 17
    },
    {
      "file": "kernel/trace/ftrace.c",
      "insertions": 40,
      "deletions": 8
    },
    {
      "file": "samples/ftrace/ftrace-direct-modify.c",
      "insertions": 5,
      "deletions": 0
    },
    {
      "file": "samples/ftrace/ftrace-direct-multi-modify.c",
      "insertions": 7,
      "deletions": 3
    },
    {
      "file": "samples/ftrace/ftrace-direct-multi.c",
      "insertions": 4,
      "deletions": 1
    },
    {
      "file": "samples/ftrace/ftrace-direct-too.c",
      "insertions": 3,
      "deletions": 0
    },
    {
      "file": "samples/ftrace/ftrace-direct.c",
      "insertions": 3,
      "deletions": 0
    },
    {
      "file": "scripts/Makefile.build",
      "insertions": 14,
      "deletions": 13
    },
    {
      "file": "scripts/Makefile.lib",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "scripts/link-vmlinux.sh",
      "insertions": 9,
      "deletions": 3
    },
    {
      "file": "scripts/mod/modpost.c",
      "insertions": 6,
      "deletions": 6
    },
    {
      "file": "sound/core/control_compat.c",
      "insertions": 8,
      "deletions": 8
    },
    {
      "file": "sound/core/pcm_compat.c",
      "insertions": 10,
      "deletions": 10
    },
    {
      "file": "tools/include/linux/objtool.h",
      "insertions": 32,
      "deletions": 0
    },
    {
      "file": "tools/objtool/arch/x86/decode.c",
      "insertions": 29,
      "deletions": 5
    },
    {
      "file": "tools/objtool/builtin-check.c",
      "insertions": 5,
      "deletions": 2
    },
    {
      "file": "tools/objtool/check.c",
      "insertions": 376,
      "deletions": 24
    },
    {
      "file": "tools/objtool/elf.c",
      "insertions": 63,
      "deletions": 0
    },
    {
      "file": "tools/objtool/include/objtool/arch.h",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "tools/objtool/include/objtool/builtin.h",
      "insertions": 2,
      "deletions": 1
    },
    {
      "file": "tools/objtool/include/objtool/check.h",
      "insertions": 10,
      "deletions": 3
    },
    {
      "file": "tools/objtool/include/objtool/elf.h",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "tools/objtool/include/objtool/objtool.h",
      "insertions": 4,
      "deletions": 0
    },
    {
      "file": "tools/objtool/include/objtool/warn.h",
      "insertions": 2,
      "deletions": 0
    },
    {
      "file": "tools/objtool/objtool.c",
      "insertions": 1,
      "deletions": 0
    }
  ],
  "total_insertions": 1454,
  "total_deletions": 326,
  "total_changes": 1780,
  "parents": [
    "f022814633e1c600507b3a99691b4d624c2813f0",
    "3986f65d4f408ce9d0a361e3226a3246a5fb701c"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": true,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/powerpc/include/asm/livepatch.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kernel/alternative.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/include/asm/paravirt_types.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/include/asm/cpufeatures.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kernel/module.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/Kconfig",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/include/asm/msr-index.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kvm/emulate.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/include/asm/text-patching.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/net/bpf_jit_comp.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/linux/kprobes.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "kernel/bpf/trampoline.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "scripts/mod/modpost.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "kernel/exit.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "scripts/Makefile.lib",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/asm-generic/vmlinux.lds.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "kernel/trace/ftrace.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}