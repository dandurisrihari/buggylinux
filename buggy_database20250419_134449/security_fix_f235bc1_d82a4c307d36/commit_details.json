{
  "hash": "f235bc11cc95fcd5847e8249d4c1c9ae5979701c",
  "hash_short": "f235bc11",
  "subject": "crypto: arm/aes-neonbs - go back to using aes-arm directly",
  "body": "In aes-neonbs, instead of going through the crypto API for the parts\nthat the bit-sliced AES code doesn't handle, namely AES-CBC encryption\nand single-block AES, just call the ARM scalar AES cipher directly.\n\nThis basically goes back to the original approach that was used before\ncommit b56f5cbc7e08 (\"crypto: arm/aes-neonbs - resolve fallback cipher\nat runtime\").  Calling the ARM scalar AES cipher directly is faster,\nsimpler, and avoids any chance of bugs specific to the use of fallback\nciphers such as module loading deadlocks which have happened twice.  The\ndeadlocks turned out to be fixable in other ways, but there's no need to\nrely on anything so fragile in the first place.\n\nThe rationale for the above-mentioned commit was to allow people to\nchoose to use a time-invariant AES implementation for the fallback\ncipher.  There are a couple problems with that rationale, though:\n\n- In practice the ARM scalar AES cipher (aes-arm) was used anyway, since\n  it has a higher priority than aes-fixed-time.  Users *could* go out of\n  their way to disable or blacklist aes-arm, or to lower its priority\n  using NETLINK_CRYPTO, but very few users customize the crypto API to\n  this extent.  Systems with the ARMv8 Crypto Extensions used aes-ce,\n  but the bit-sliced algorithms are irrelevant on such systems anyway.\n\n- Since commit 913a3aa07d16 (\"crypto: arm/aes - add some hardening\n  against cache-timing attacks\"), the ARM scalar AES cipher is partially\n  hardened against cache-timing attacks.  It actually works like\n  aes-fixed-time, in that it disables interrupts and prefetches its\n  lookup table.  It does use a larger table than aes-fixed-time, but\n  even so, it is not clear that aes-fixed-time is meaningfully more\n  time-invariant than aes-arm.  And of course, the real solution for\n  time-invariant AES is to use a CPU that supports AES instructions.\n\nSigned-off-by: Eric Biggers <ebiggers@google.com>\nSigned-off-by: Herbert Xu <herbert@gondor.apana.org.au>",
  "full_message": "crypto: arm/aes-neonbs - go back to using aes-arm directly\n\nIn aes-neonbs, instead of going through the crypto API for the parts\nthat the bit-sliced AES code doesn't handle, namely AES-CBC encryption\nand single-block AES, just call the ARM scalar AES cipher directly.\n\nThis basically goes back to the original approach that was used before\ncommit b56f5cbc7e08 (\"crypto: arm/aes-neonbs - resolve fallback cipher\nat runtime\").  Calling the ARM scalar AES cipher directly is faster,\nsimpler, and avoids any chance of bugs specific to the use of fallback\nciphers such as module loading deadlocks which have happened twice.  The\ndeadlocks turned out to be fixable in other ways, but there's no need to\nrely on anything so fragile in the first place.\n\nThe rationale for the above-mentioned commit was to allow people to\nchoose to use a time-invariant AES implementation for the fallback\ncipher.  There are a couple problems with that rationale, though:\n\n- In practice the ARM scalar AES cipher (aes-arm) was used anyway, since\n  it has a higher priority than aes-fixed-time.  Users *could* go out of\n  their way to disable or blacklist aes-arm, or to lower its priority\n  using NETLINK_CRYPTO, but very few users customize the crypto API to\n  this extent.  Systems with the ARMv8 Crypto Extensions used aes-ce,\n  but the bit-sliced algorithms are irrelevant on such systems anyway.\n\n- Since commit 913a3aa07d16 (\"crypto: arm/aes - add some hardening\n  against cache-timing attacks\"), the ARM scalar AES cipher is partially\n  hardened against cache-timing attacks.  It actually works like\n  aes-fixed-time, in that it disables interrupts and prefetches its\n  lookup table.  It does use a larger table than aes-fixed-time, but\n  even so, it is not clear that aes-fixed-time is meaningfully more\n  time-invariant than aes-arm.  And of course, the real solution for\n  time-invariant AES is to use a CPU that supports AES instructions.\n\nSigned-off-by: Eric Biggers <ebiggers@google.com>\nSigned-off-by: Herbert Xu <herbert@gondor.apana.org.au>",
  "author_name": "Eric Biggers",
  "author_email": "ebiggers@google.com",
  "author_date": "Fri Aug 9 16:11:49 2024 -0700",
  "author_date_iso": "2024-08-09T16:11:49-07:00",
  "committer_name": "Herbert Xu",
  "committer_email": "herbert@gondor.apana.org.au",
  "committer_date": "Sat Aug 17 13:55:50 2024 +0800",
  "committer_date_iso": "2024-08-17T13:55:50+08:00",
  "files_changed": [
    "arch/arm/crypto/Kconfig",
    "arch/arm/crypto/aes-cipher-glue.c",
    "arch/arm/crypto/aes-cipher.h",
    "arch/arm/crypto/aes-neonbs-glue.c"
  ],
  "files_changed_count": 4,
  "stats": [
    {
      "file": "arch/arm/crypto/Kconfig",
      "insertions": 10,
      "deletions": 4
    },
    {
      "file": "arch/arm/crypto/aes-cipher-glue.c",
      "insertions": 3,
      "deletions": 2
    },
    {
      "file": "arch/arm/crypto/aes-cipher.h",
      "insertions": 13,
      "deletions": 0
    },
    {
      "file": "arch/arm/crypto/aes-neonbs-glue.c",
      "insertions": 41,
      "deletions": 90
    }
  ],
  "total_insertions": 67,
  "total_deletions": 96,
  "total_changes": 163,
  "parents": [
    "9a22b2812393d93d84358a760c347c21939029a6"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "hardening"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/arm/crypto/Kconfig",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/arm/crypto/aes-cipher-glue.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/arm/crypto/aes-cipher.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/arm/crypto/aes-neonbs-glue.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}