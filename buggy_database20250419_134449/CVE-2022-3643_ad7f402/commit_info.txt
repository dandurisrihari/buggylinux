Commit Hash: ad7f402ae4f466647c3a669b8a6f3e5d4271c84a
Subject: xen/netback: Ensure protocol headers don't fall in the non-linear area

CVE Identifiers:
- CVE-2022-3643

Full commit message:
xen/netback: Ensure protocol headers don't fall in the non-linear area

In some cases, the frontend may send a packet where the protocol headers
are spread across multiple slots. This would result in netback creating
an skb where the protocol headers spill over into the non-linear area.
Some drivers and NICs don't handle this properly resulting in an
interface reset or worse.

This issue was introduced by the removal of an unconditional skb pull in
the tx path to improve performance.  Fix this without reintroducing the
pull by setting up grant copy ops for as many slots as needed to reach
the XEN_NETBACK_TX_COPY_LEN size. Adjust the rest of the code to handle
multiple copy operations per skb.

This is XSA-423 / CVE-2022-3643.

Fixes: 7e5d7753956b ("xen-netback: remove unconditional __pskb_pull_tail() in guest Tx path")
Signed-off-by: Ross Lagerwall <ross.lagerwall@citrix.com>
Reviewed-by: Paul Durrant <paul@xen.org>
Signed-off-by: Juergen Gross <jgross@suse.com>

Metadata:
Author: Ross Lagerwall <ross.lagerwall@citrix.com>
Author Date: Tue Nov 22 09:16:59 2022 +0000
Committer: Juergen Gross <jgross@suse.com>
Commit Date: Tue Dec 6 16:00:30 2022 +0100

Files Changed: 1
Lines Added: 123
Lines Removed: 100
Total Changes: 223
