{
  "hash": "56b88b50565cd8b946a2d00b0c83927b7ebb055e",
  "hash_short": "56b88b50",
  "subject": "ALSA: pcm: Move rwsem lock inside snd_ctl_elem_read to prevent UAF",
  "body": "Takes rwsem lock inside snd_ctl_elem_read instead of snd_ctl_elem_read_user\nlike it was done for write in commit 1fa4445f9adf1 (\"ALSA: control - introduce\nsnd_ctl_notify_one() helper\"). Doing this way we are also fixing the following\nlocking issue happening in the compat path which can be easily triggered and\nturned into an use-after-free.\n\n64-bits:\nsnd_ctl_ioctl\n  snd_ctl_elem_read_user\n    [takes controls_rwsem]\n    snd_ctl_elem_read [lock properly held, all good]\n    [drops controls_rwsem]\n\n32-bits:\nsnd_ctl_ioctl_compat\n  snd_ctl_elem_write_read_compat\n    ctl_elem_write_read\n      snd_ctl_elem_read [missing lock, not good]\n\nCVE-2023-0266 was assigned for this issue.\n\nCc: stable@kernel.org # 5.13+\nSigned-off-by: Clement Lecigne <clecigne@google.com>\nReviewed-by: Jaroslav Kysela <perex@perex.cz>\nLink: https://lore.kernel.org/r/20230113120745.25464-1-tiwai@suse.de\nSigned-off-by: Takashi Iwai <tiwai@suse.de>",
  "full_message": "ALSA: pcm: Move rwsem lock inside snd_ctl_elem_read to prevent UAF\n\nTakes rwsem lock inside snd_ctl_elem_read instead of snd_ctl_elem_read_user\nlike it was done for write in commit 1fa4445f9adf1 (\"ALSA: control - introduce\nsnd_ctl_notify_one() helper\"). Doing this way we are also fixing the following\nlocking issue happening in the compat path which can be easily triggered and\nturned into an use-after-free.\n\n64-bits:\nsnd_ctl_ioctl\n  snd_ctl_elem_read_user\n    [takes controls_rwsem]\n    snd_ctl_elem_read [lock properly held, all good]\n    [drops controls_rwsem]\n\n32-bits:\nsnd_ctl_ioctl_compat\n  snd_ctl_elem_write_read_compat\n    ctl_elem_write_read\n      snd_ctl_elem_read [missing lock, not good]\n\nCVE-2023-0266 was assigned for this issue.\n\nCc: stable@kernel.org # 5.13+\nSigned-off-by: Clement Lecigne <clecigne@google.com>\nReviewed-by: Jaroslav Kysela <perex@perex.cz>\nLink: https://lore.kernel.org/r/20230113120745.25464-1-tiwai@suse.de\nSigned-off-by: Takashi Iwai <tiwai@suse.de>",
  "author_name": "Clement Lecigne",
  "author_email": "clecigne@google.com",
  "author_date": "Fri Jan 13 13:07:45 2023 +0100",
  "author_date_iso": "2023-01-13T13:07:45+01:00",
  "committer_name": "Takashi Iwai",
  "committer_email": "tiwai@suse.de",
  "committer_date": "Fri Jan 13 14:15:26 2023 +0100",
  "committer_date_iso": "2023-01-13T14:15:26+01:00",
  "files_changed": [
    "sound/core/control.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "sound/core/control.c",
      "insertions": 15,
      "deletions": 9
    }
  ],
  "total_insertions": 15,
  "total_deletions": 9,
  "total_changes": 24,
  "parents": [
    "92a9c0ad86d47ff4cce899012e355c400f02cfb8"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [
      "CVE-2023-0266"
    ],
    "security_keywords": []
  },
  "fix_type": "cve",
  "file_results": [
    {
      "file": "sound/core/control.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}