{
  "hash": "ee8f844e3c5a73b999edf733df1c529d6503ec2f",
  "hash_short": "ee8f844e",
  "subject": "KEYS: Disallow keyrings beginning with '.' to be joined as session keyrings",
  "body": "This fixes CVE-2016-9604.\n\nKeyrings whose name begin with a '.' are special internal keyrings and so\nuserspace isn't allowed to create keyrings by this name to prevent\nshadowing.  However, the patch that added the guard didn't fix\nKEYCTL_JOIN_SESSION_KEYRING.  Not only can that create dot-named keyrings,\nit can also subscribe to them as a session keyring if they grant SEARCH\npermission to the user.\n\nThis, for example, allows a root process to set .builtin_trusted_keys as\nits session keyring, at which point it has full access because now the\npossessor permissions are added.  This permits root to add extra public\nkeys, thereby bypassing module verification.\n\nThis also affects kexec and IMA.\n\nThis can be tested by (as root):\n\n\tkeyctl session .builtin_trusted_keys\n\tkeyctl add user a a @s\n\tkeyctl list @s\n\nwhich on my test box gives me:\n\n\t2 keys in keyring:\n\t180010936: ---lswrv     0     0 asymmetric: Build time autogenerated kernel key: ae3d4a31b82daa8e1a75b49dc2bba949fd992a05\n\t801382539: --alswrv     0     0 user: a\n\n\nFix this by rejecting names beginning with a '.' in the keyctl.\n\nSigned-off-by: David Howells <dhowells@redhat.com>\nAcked-by: Mimi Zohar <zohar@linux.vnet.ibm.com>\ncc: linux-ima-devel@lists.sourceforge.net\ncc: stable@vger.kernel.org",
  "full_message": "KEYS: Disallow keyrings beginning with '.' to be joined as session keyrings\n\nThis fixes CVE-2016-9604.\n\nKeyrings whose name begin with a '.' are special internal keyrings and so\nuserspace isn't allowed to create keyrings by this name to prevent\nshadowing.  However, the patch that added the guard didn't fix\nKEYCTL_JOIN_SESSION_KEYRING.  Not only can that create dot-named keyrings,\nit can also subscribe to them as a session keyring if they grant SEARCH\npermission to the user.\n\nThis, for example, allows a root process to set .builtin_trusted_keys as\nits session keyring, at which point it has full access because now the\npossessor permissions are added.  This permits root to add extra public\nkeys, thereby bypassing module verification.\n\nThis also affects kexec and IMA.\n\nThis can be tested by (as root):\n\n\tkeyctl session .builtin_trusted_keys\n\tkeyctl add user a a @s\n\tkeyctl list @s\n\nwhich on my test box gives me:\n\n\t2 keys in keyring:\n\t180010936: ---lswrv     0     0 asymmetric: Build time autogenerated kernel key: ae3d4a31b82daa8e1a75b49dc2bba949fd992a05\n\t801382539: --alswrv     0     0 user: a\n\n\nFix this by rejecting names beginning with a '.' in the keyctl.\n\nSigned-off-by: David Howells <dhowells@redhat.com>\nAcked-by: Mimi Zohar <zohar@linux.vnet.ibm.com>\ncc: linux-ima-devel@lists.sourceforge.net\ncc: stable@vger.kernel.org",
  "author_name": "David Howells",
  "author_email": "dhowells@redhat.com",
  "author_date": "Tue Apr 18 15:31:07 2017 +0100",
  "author_date_iso": "2017-04-18T15:31:07+01:00",
  "committer_name": "David Howells",
  "committer_email": "dhowells@redhat.com",
  "committer_date": "Tue Apr 18 15:31:35 2017 +0100",
  "committer_date_iso": "2017-04-18T15:31:35+01:00",
  "files_changed": [
    "security/keys/keyctl.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "security/keys/keyctl.c",
      "insertions": 7,
      "deletions": 2
    }
  ],
  "total_insertions": 7,
  "total_deletions": 2,
  "total_changes": 9,
  "parents": [
    "4f7d029b9bf009fbee76bb10c0c4351a1870d2f3"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.11",
    "v4.11-rc8",
    "v4.12",
    "v4.12-rc1",
    "v4.12-rc2",
    "v4.12-rc3",
    "v4.12-rc4",
    "v4.12-rc5",
    "v4.12-rc6",
    "v4.12-rc7"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [
      "CVE-2016-9604"
    ],
    "security_keywords": []
  },
  "fix_type": "cve",
  "file_results": [
    {
      "file": "security/keys/keyctl.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}