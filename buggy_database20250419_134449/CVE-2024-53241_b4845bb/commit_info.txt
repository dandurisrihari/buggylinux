Commit Hash: b4845bb6383821a9516ce30af3a27dc873e37fd4
Subject: x86/xen: add central hypercall functions

CVE Identifiers:
- CVE-2024-53241

Full commit message:
x86/xen: add central hypercall functions

Add generic hypercall functions usable for all normal (i.e. not iret)
hypercalls. Depending on the guest type and the processor vendor
different functions need to be used due to the to be used instruction
for entering the hypervisor:

- PV guests need to use syscall
- HVM/PVH guests on Intel need to use vmcall
- HVM/PVH guests on AMD and Hygon need to use vmmcall

As PVH guests need to issue hypercalls very early during boot, there
is a 4th hypercall function needed for HVM/PVH which can be used on
Intel and AMD processors. It will check the vendor type and then set
the Intel or AMD specific function to use via static_call().

This is part of XSA-466 / CVE-2024-53241.

Reported-by: Andrew Cooper <andrew.cooper3@citrix.com>
Signed-off-by: Juergen Gross <jgross@suse.com>
Co-developed-by: Peter Zijlstra <peterz@infradead.org>

Metadata:
Author: Juergen Gross <jgross@suse.com>
Author Date: Thu Oct 17 11:00:52 2024 +0200
Committer: Juergen Gross <jgross@suse.com>
Commit Date: Tue Dec 17 08:23:29 2024 +0100

Files Changed: 7
Lines Added: 190
Lines Removed: 1
Total Changes: 191
