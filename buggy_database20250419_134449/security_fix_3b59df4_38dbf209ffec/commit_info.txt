Commit Hash: 3b59df46a449ec9975146d71318c4777ad086744
Subject: xfrm: Workaround incompatibility of ESN and async crypto


Security Keywords:
- authentication

Full commit message:
xfrm: Workaround incompatibility of ESN and async crypto

ESN for esp is defined in RFC 4303. This RFC assumes that the
sequence number counters are always up to date. However,
this is not true if an async crypto algorithm is employed.

If the sequence number counters are not up to date on sequence
number check, we may incorrectly update the upper 32 bit of
the sequence number. This leads to a DOS.

We workaround this by comparing the upper sequence number,
(used for authentication) with the upper sequence number
computed after the async processing. We drop the packet
if these numbers are different.

To do this, we introduce a recheck function that does this
check in the ESN case.

Signed-off-by: Steffen Klassert <steffen.klassert@secunet.com>
Acked-by: Herbert Xu <herbert@gondor.apana.org.au>
Signed-off-by: David S. Miller <davem@davemloft.net>

Metadata:
Author: Steffen Klassert <steffen.klassert@secunet.com>
Author Date: Tue Sep 4 00:03:29 2012 +0000
Committer: David S. Miller <davem@davemloft.net>
Commit Date: Tue Sep 4 14:09:45 2012 -0400

Files Changed: 3
Lines Added: 19
Lines Removed: 1
Total Changes: 20
