{
  "hash": "de734831224e74fcaf8917386e33644c4243db95",
  "hash_short": "de734831",
  "subject": "NFS: Treat NFS4ERR_CLID_INUSE as a fatal error",
  "body": "For NFSv4 minor version 0, currently the cl_id_uniquifier allows the\nLinux client to generate a unique nfs_client_id4 string whenever a\nserver replies with NFS4ERR_CLID_INUSE.\n\nThis implementation seems to be based on a flawed reading of RFC\n3530.  NFS4ERR_CLID_INUSE actually means that the client has presented\nthis nfs_client_id4 string with a different principal at some time in\nthe past, and that lease is still in use on the server.\n\nFor a Linux client this might be rather difficult to achieve: the\nauthentication flavor is named right in the nfs_client_id4.id\nstring.  If we change flavors, we change strings automatically.\n\nSo, practically speaking, NFS4ERR_CLID_INUSE means there is some other\nclient using our string.  There is not much that can be done to\nrecover automatically.  Let's make it a permanent error.\n\nRemove the recovery logic in nfs4_proc_setclientid(), and remove the\ncl_id_uniquifier field from the nfs_client data structure.  And,\nremove the authentication flavor from the nfs_client_id4 string.\n\nKeeping the authentication flavor in the nfs_client_id4.id string\nmeans that we could have a separate lease for each authentication\nflavor used by mounts on the client.  But we want just one lease for\nall the mounts on this client.\n\nSigned-off-by: Chuck Lever <chuck.lever@oracle.com>\nSigned-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>",
  "full_message": "NFS: Treat NFS4ERR_CLID_INUSE as a fatal error\n\nFor NFSv4 minor version 0, currently the cl_id_uniquifier allows the\nLinux client to generate a unique nfs_client_id4 string whenever a\nserver replies with NFS4ERR_CLID_INUSE.\n\nThis implementation seems to be based on a flawed reading of RFC\n3530.  NFS4ERR_CLID_INUSE actually means that the client has presented\nthis nfs_client_id4 string with a different principal at some time in\nthe past, and that lease is still in use on the server.\n\nFor a Linux client this might be rather difficult to achieve: the\nauthentication flavor is named right in the nfs_client_id4.id\nstring.  If we change flavors, we change strings automatically.\n\nSo, practically speaking, NFS4ERR_CLID_INUSE means there is some other\nclient using our string.  There is not much that can be done to\nrecover automatically.  Let's make it a permanent error.\n\nRemove the recovery logic in nfs4_proc_setclientid(), and remove the\ncl_id_uniquifier field from the nfs_client data structure.  And,\nremove the authentication flavor from the nfs_client_id4 string.\n\nKeeping the authentication flavor in the nfs_client_id4.id string\nmeans that we could have a separate lease for each authentication\nflavor used by mounts on the client.  But we want just one lease for\nall the mounts on this client.\n\nSigned-off-by: Chuck Lever <chuck.lever@oracle.com>\nSigned-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>",
  "author_name": "Chuck Lever",
  "author_email": "chuck.lever@oracle.com",
  "author_date": "Wed Jul 11 16:30:50 2012 -0400",
  "author_date_iso": "2012-07-11T16:30:50-04:00",
  "committer_name": "Trond Myklebust",
  "committer_email": "Trond.Myklebust@netapp.com",
  "committer_date": "Mon Jul 16 15:12:16 2012 -0400",
  "committer_date_iso": "2012-07-16T15:12:16-04:00",
  "files_changed": [
    "fs/nfs/nfs4proc.c",
    "fs/nfs/nfs4state.c",
    "include/linux/nfs_fs_sb.h"
  ],
  "files_changed_count": 3,
  "stats": [
    {
      "file": "fs/nfs/nfs4proc.c",
      "insertions": 16,
      "deletions": 31
    },
    {
      "file": "fs/nfs/nfs4state.c",
      "insertions": 6,
      "deletions": 1
    },
    {
      "file": "include/linux/nfs_fs_sb.h",
      "insertions": 1,
      "deletions": 2
    }
  ],
  "total_insertions": 23,
  "total_deletions": 34,
  "total_changes": 57,
  "parents": [
    "46a87b8a7b939900d779042da7097bf330ab787f"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v3.10",
    "v3.10-rc1",
    "v3.10-rc2",
    "v3.10-rc3",
    "v3.10-rc4",
    "v3.10-rc5",
    "v3.10-rc6",
    "v3.10-rc7",
    "v3.11",
    "v3.11-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "authentication"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "fs/nfs/nfs4proc.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "fs/nfs/nfs4state.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/linux/nfs_fs_sb.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}