{
  "hash": "553a5c03e90a6087e88f8ff878335ef0621536fb",
  "hash_short": "553a5c03",
  "subject": "x86/speculation: Add force option to GDS mitigation",
  "body": "The Gather Data Sampling (GDS) vulnerability allows malicious software\nto infer stale data previously stored in vector registers. This may\ninclude sensitive data such as cryptographic keys. GDS is mitigated in\nmicrocode, and systems with up-to-date microcode are protected by\ndefault. However, any affected system that is running with older\nmicrocode will still be vulnerable to GDS attacks.\n\nSince the gather instructions used by the attacker are part of the\nAVX2 and AVX512 extensions, disabling these extensions prevents gather\ninstructions from being executed, thereby mitigating the system from\nGDS. Disabling AVX2 is sufficient, but we don't have the granularity\nto do this. The XCR0[2] disables AVX, with no option to just disable\nAVX2.\n\nAdd a kernel parameter gather_data_sampling=force that will enable the\nmicrocode mitigation if available, otherwise it will disable AVX on\naffected systems.\n\nThis option will be ignored if cmdline mitigations=off.\n\nThis is a *big* hammer.  It is known to break buggy userspace that\nuses incomplete, buggy AVX enumeration.  Unfortunately, such userspace\ndoes exist in the wild:\n\n\thttps://www.mail-archive.com/bug-coreutils@gnu.org/msg33046.html\n\n[ dhansen: add some more ominous warnings about disabling AVX ]\n\nSigned-off-by: Daniel Sneddon <daniel.sneddon@linux.intel.com>\nSigned-off-by: Dave Hansen <dave.hansen@linux.intel.com>\nAcked-by: Josh Poimboeuf <jpoimboe@kernel.org>",
  "full_message": "x86/speculation: Add force option to GDS mitigation\n\nThe Gather Data Sampling (GDS) vulnerability allows malicious software\nto infer stale data previously stored in vector registers. This may\ninclude sensitive data such as cryptographic keys. GDS is mitigated in\nmicrocode, and systems with up-to-date microcode are protected by\ndefault. However, any affected system that is running with older\nmicrocode will still be vulnerable to GDS attacks.\n\nSince the gather instructions used by the attacker are part of the\nAVX2 and AVX512 extensions, disabling these extensions prevents gather\ninstructions from being executed, thereby mitigating the system from\nGDS. Disabling AVX2 is sufficient, but we don't have the granularity\nto do this. The XCR0[2] disables AVX, with no option to just disable\nAVX2.\n\nAdd a kernel parameter gather_data_sampling=force that will enable the\nmicrocode mitigation if available, otherwise it will disable AVX on\naffected systems.\n\nThis option will be ignored if cmdline mitigations=off.\n\nThis is a *big* hammer.  It is known to break buggy userspace that\nuses incomplete, buggy AVX enumeration.  Unfortunately, such userspace\ndoes exist in the wild:\n\n\thttps://www.mail-archive.com/bug-coreutils@gnu.org/msg33046.html\n\n[ dhansen: add some more ominous warnings about disabling AVX ]\n\nSigned-off-by: Daniel Sneddon <daniel.sneddon@linux.intel.com>\nSigned-off-by: Dave Hansen <dave.hansen@linux.intel.com>\nAcked-by: Josh Poimboeuf <jpoimboe@kernel.org>",
  "author_name": "Daniel Sneddon",
  "author_email": "daniel.sneddon@linux.intel.com",
  "author_date": "Wed Jul 12 19:43:12 2023 -0700",
  "author_date_iso": "2023-07-12T19:43:12-07:00",
  "committer_name": "Dave Hansen",
  "committer_email": "dave.hansen@linux.intel.com",
  "committer_date": "Fri Jul 21 12:59:49 2023 -0700",
  "committer_date_iso": "2023-07-21T12:59:49-07:00",
  "files_changed": [
    "Documentation/admin-guide/hw-vuln/gather_data_sampling.rst",
    "Documentation/admin-guide/kernel-parameters.txt",
    "arch/x86/kernel/cpu/bugs.c"
  ],
  "files_changed_count": 3,
  "stats": [
    {
      "file": "Documentation/admin-guide/hw-vuln/gather_data_sampling.rst",
      "insertions": 14,
      "deletions": 4
    },
    {
      "file": "Documentation/admin-guide/kernel-parameters.txt",
      "insertions": 7,
      "deletions": 1
    },
    {
      "file": "arch/x86/kernel/cpu/bugs.c",
      "insertions": 19,
      "deletions": 1
    }
  ],
  "total_insertions": 40,
  "total_deletions": 6,
  "total_changes": 46,
  "parents": [
    "8974eb588283b7d44a7c91fa09fcbaf380339f3a"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "vulnerability"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "Documentation/admin-guide/hw-vuln/gather_data_sampling.rst",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "Documentation/admin-guide/kernel-parameters.txt",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kernel/cpu/bugs.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}