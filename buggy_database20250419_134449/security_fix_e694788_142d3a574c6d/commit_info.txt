Commit Hash: e694788d73efe139b24f78b036deb97fe57fa8cb
Subject: Bluetooth: Fix check for connection encryption


Security Keywords:
- authentication

Full commit message:
Bluetooth: Fix check for connection encryption

The conn->link_key variable tracks the type of link key in use. It is
set whenever we respond to a link key request as well as when we get a
link key notification event.

These two events do not however always guarantee that encryption is
enabled: getting a link key request and responding to it may only mean
that the remote side has requested authentication but not encryption. On
the other hand, the encrypt change event is a certain guarantee that
encryption is enabled. The real encryption state is already tracked in
the conn->link_mode variable through the HCI_LM_ENCRYPT bit.

This patch fixes a check for encryption in the hci_conn_auth function to
use the proper conn->link_mode value and thereby eliminates the chance
of a false positive result.

Signed-off-by: Johan Hedberg <johan.hedberg@intel.com>
Signed-off-by: Marcel Holtmann <marcel@holtmann.org>
Cc: stable@vger.kernel.org

Metadata:
Author: Johan Hedberg <johan.hedberg@intel.com>
Author Date: Tue Jun 10 09:54:24 2014 +0300
Committer: Marcel Holtmann <marcel@holtmann.org>
Commit Date: Fri Jun 13 13:30:39 2014 +0200

Files Changed: 1
Lines Added: 1
Lines Removed: 1
Total Changes: 2
