commit 45c3094a6424614e6fea135e4e1afd8e0a65f468
Author: Radim Krčmář <rkrcmar@redhat.com>
Date:   Thu Nov 27 20:03:13 2014 +0100

    KVM: x86: allow 256 logical x2APICs again
    
    While fixing an x2apic bug,
     17d68b7 KVM: x86: fix guest-initiated crash with x2apic (CVE-2013-6376)
    we've made only one cluster available.  This means that the amount of
    logically addressible x2APICs was reduced to 16 and VCPUs kept
    overwriting themselves in that region, so even the first cluster wasn't
    set up correctly.
    
    This patch extends x2APIC support back to the logical_map's limit, and
    keeps the CVE fixed as messages for non-present APICs are dropped.
    
    Signed-off-by: Radim Krčmář <rkrcmar@redhat.com>
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

diff --git a/arch/x86/kvm/lapic.h b/arch/x86/kvm/lapic.h
index d4365f21ea2e..c674fce53cf9 100644
--- a/arch/x86/kvm/lapic.h
+++ b/arch/x86/kvm/lapic.h
@@ -154,8 +154,6 @@ static inline u16 apic_cluster_id(struct kvm_apic_map *map, u32 ldr)
 	ldr >>= 32 - map->ldr_bits;
 	cid = (ldr >> map->cid_shift) & map->cid_mask;
 
-	BUG_ON(cid >= ARRAY_SIZE(map->logical_map));
-
 	return cid;
 }