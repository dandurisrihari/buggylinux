Commit Hash: 63733a0fc55cca74b1911769633dc5dfd1a45907
Subject: ceph: fix authenticator timeout


Security Keywords:
- authentication

Full commit message:
ceph: fix authenticator timeout

We were failing to reconnect to services due to an old authenticator, even
though we had the new ticket, because we weren't properly retrying the
connect handshake, because we were calling an old/incorrect helper that
left in_base_pos incorrect.  The result was a failure to reconnect to the
OSD or MDS (with an authentication error) if the MDS restarted after the
service had been up a few hours (long enough for the original authenticator
to be invalid).  This was only a problem if the AUTH_X authentication was
enabled.

Now that the 'negotiate' and 'connect' stages are fully separated, we
should use the prepare_read_connect() helper instead, and remove the
obsolete one.

Signed-off-by: Sage Weil <sage@newdream.net>

Metadata:
Author: Sage Weil <sage@newdream.net>
Author Date: Mon Mar 15 15:47:22 2010 -0700
Committer: Sage Weil <sage@newdream.net>
Commit Date: Sat Mar 20 21:33:09 2010 -0700

Files Changed: 1
Lines Added: 1
Lines Removed: 8
Total Changes: 9
