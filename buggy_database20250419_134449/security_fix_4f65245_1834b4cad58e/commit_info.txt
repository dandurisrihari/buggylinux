Commit Hash: 4f65245f2d178b9cba48350620d76faa4a098841
Subject: HID: hiddev: fix potential Spectre v1


Security Keywords:
- vulnerability
- sanitizing

Full commit message:
HID: hiddev: fix potential Spectre v1

uref->field_index, uref->usage_index, finfo.field_index and cinfo.index can be
indirectly controlled by user-space, hence leading to a potential exploitation
of the Spectre variant 1 vulnerability.

This issue was detected with the help of Smatch:

drivers/hid/usbhid/hiddev.c:473 hiddev_ioctl_usage() warn: potential spectre issue 'report->field' (local cap)
drivers/hid/usbhid/hiddev.c:477 hiddev_ioctl_usage() warn: potential spectre issue 'field->usage' (local cap)
drivers/hid/usbhid/hiddev.c:757 hiddev_ioctl() warn: potential spectre issue 'report->field' (local cap)
drivers/hid/usbhid/hiddev.c:801 hiddev_ioctl() warn: potential spectre issue 'hid->collection' (local cap)

Fix this by sanitizing such structure fields before using them to index
report->field, field->usage and hid->collection

Notice that given that speculation windows are large, the policy is
to kill the speculation on the first load and not worry if it can be
completed with a dependent load/store [1].

[1] https://marc.info/?l=linux-kernel&m=152449131114778&w=2

Cc: stable@vger.kernel.org
Signed-off-by: Gustavo A. R. Silva <gustavo@embeddedor.com>
Signed-off-by: Jiri Kosina <jkosina@suse.cz>

Metadata:
Author: Gustavo A. R. Silva <gustavo@embeddedor.com>
Author Date: Fri Jun 29 17:08:44 2018 -0500
Committer: Jiri Kosina <jkosina@suse.cz>
Commit Date: Mon Jul 9 14:31:14 2018 +0200

Files Changed: 1
Lines Added: 11
Lines Removed: 0
Total Changes: 11
