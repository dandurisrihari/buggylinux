Commit Hash: d9cee9f85b22fab88d2b76d2e92b18e3d0e6aa8c
Subject: libnvdimm/region: Fix label activation vs errors


Security Keywords:
- injection

Full commit message:
libnvdimm/region: Fix label activation vs errors

There are a few scenarios where init_active_labels() can return without
registering deactivate_labels() to run when the region is disabled. In
particular label error injection creates scenarios where a DIMM is
disabled, but labels on other DIMMs in the region become activated.

Arrange for init_active_labels() to always register deactivate_labels().

Reported-by: Krzysztof Kensicki <krzysztof.kensicki@intel.com>
Cc: <stable@vger.kernel.org>
Fixes: bf9bccc14c05 ("libnvdimm: pmem label sets and namespace instantiation.")
Reviewed-by: Jeff Moyer <jmoyer@redhat.com>
Link: https://lore.kernel.org/r/162766356450.3223041.1183118139023841447.stgit@dwillia2-desk3.amr.corp.intel.com
Signed-off-by: Dan Williams <dan.j.williams@intel.com>

Metadata:
Author: Dan Williams <dan.j.williams@intel.com>
Author Date: Fri Jul 30 09:46:04 2021 -0700
Committer: Dan Williams <dan.j.williams@intel.com>
Commit Date: Wed Aug 11 11:54:43 2021 -0700

Files Changed: 1
Lines Added: 11
Lines Removed: 6
Total Changes: 17
