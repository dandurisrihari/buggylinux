{
  "hash": "4d02e2de0e80a786452e70d7f3a20a50641e6620",
  "hash_short": "4d02e2de",
  "subject": "drm: Per-plane locking",
  "body": "Turned out to be much simpler on top of my latest atomic stuff than\nwhat I've feared. Some details:\n\n- Drop the modeset_lock_all snakeoil in drm_plane_init. Same\n  justification as for the equivalent change in drm_crtc_init done in\n\n\tcommit d0fa1af40e784aaf7ebb7ba8a17b229bb3fa4c21\n\tAuthor: Daniel Vetter <daniel.vetter@ffwll.ch>\n\tDate:   Mon Sep 8 09:02:49 2014 +0200\n\n\t    drm: Drop modeset locking from crtc init function\n\n  Without these the drm_modeset_lock_init would fall over the exact\n  same way.\n\n- Since the atomic core code wraps the locking switching it to\n  per-plane locks was a one-line change.\n\n- For the legacy ioctls add a plane argument to the locking helper so\n  that we can grab the right plane lock (cursor or primary). Since the\n  universal cursor plane might not be there, or someone really crazy\n  might forgoe the primary plane even accept NULL.\n\n- Add some locking WARN_ON to the atomic helpers for good paranoid\n  measure and to check that it all works out.\n\nTested on my exynos atomic hackfest with full lockdep checks and ww\nbackoff injection.\n\nv2: I've forgotten about the load-detect code in i915.\n\nv3: Thierry reported that in latest 3.18-rc vmwgfx doesn't compile any\nmore due to\n\ncommit 21e88620aa21b48d4f62d29275e3e2944a5ea2b5\nAuthor: Rob Clark <robdclark@gmail.com>\nDate:   Thu Oct 30 13:39:04 2014 -0400\n\n    drm/vmwgfx: fix lock breakage\n\nRebased and fix this up.\n\nCc: Thierry Reding <thierry.reding@gmail.com>\nSigned-off-by: Daniel Vetter <daniel.vetter@intel.com>\nReviewed-by: Sean Paul <seanpaul@chromium.org>\nSigned-off-by: Dave Airlie <airlied@redhat.com>",
  "full_message": "drm: Per-plane locking\n\nTurned out to be much simpler on top of my latest atomic stuff than\nwhat I've feared. Some details:\n\n- Drop the modeset_lock_all snakeoil in drm_plane_init. Same\n  justification as for the equivalent change in drm_crtc_init done in\n\n\tcommit d0fa1af40e784aaf7ebb7ba8a17b229bb3fa4c21\n\tAuthor: Daniel Vetter <daniel.vetter@ffwll.ch>\n\tDate:   Mon Sep 8 09:02:49 2014 +0200\n\n\t    drm: Drop modeset locking from crtc init function\n\n  Without these the drm_modeset_lock_init would fall over the exact\n  same way.\n\n- Since the atomic core code wraps the locking switching it to\n  per-plane locks was a one-line change.\n\n- For the legacy ioctls add a plane argument to the locking helper so\n  that we can grab the right plane lock (cursor or primary). Since the\n  universal cursor plane might not be there, or someone really crazy\n  might forgoe the primary plane even accept NULL.\n\n- Add some locking WARN_ON to the atomic helpers for good paranoid\n  measure and to check that it all works out.\n\nTested on my exynos atomic hackfest with full lockdep checks and ww\nbackoff injection.\n\nv2: I've forgotten about the load-detect code in i915.\n\nv3: Thierry reported that in latest 3.18-rc vmwgfx doesn't compile any\nmore due to\n\ncommit 21e88620aa21b48d4f62d29275e3e2944a5ea2b5\nAuthor: Rob Clark <robdclark@gmail.com>\nDate:   Thu Oct 30 13:39:04 2014 -0400\n\n    drm/vmwgfx: fix lock breakage\n\nRebased and fix this up.\n\nCc: Thierry Reding <thierry.reding@gmail.com>\nSigned-off-by: Daniel Vetter <daniel.vetter@intel.com>\nReviewed-by: Sean Paul <seanpaul@chromium.org>\nSigned-off-by: Dave Airlie <airlied@redhat.com>",
  "author_name": "Daniel Vetter",
  "author_email": "daniel.vetter@ffwll.ch",
  "author_date": "Tue Nov 11 10:12:00 2014 +0100",
  "author_date_iso": "2014-11-11T10:12:00+01:00",
  "committer_name": "Dave Airlie",
  "committer_email": "airlied@redhat.com",
  "committer_date": "Wed Nov 12 17:56:12 2014 +1000",
  "committer_date_iso": "2014-11-12T17:56:12+10:00",
  "files_changed": [
    "drivers/gpu/drm/drm_atomic.c",
    "drivers/gpu/drm/drm_atomic_helper.c",
    "drivers/gpu/drm/drm_crtc.c",
    "drivers/gpu/drm/drm_modeset_lock.c",
    "drivers/gpu/drm/i915/intel_display.c",
    "drivers/gpu/drm/vmwgfx/vmwgfx_kms.c",
    "include/drm/drm_crtc.h",
    "include/drm/drm_modeset_lock.h"
  ],
  "files_changed_count": 8,
  "stats": [
    {
      "file": "drivers/gpu/drm/drm_atomic.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/gpu/drm/drm_atomic_helper.c",
      "insertions": 4,
      "deletions": 0
    },
    {
      "file": "drivers/gpu/drm/drm_crtc.c",
      "insertions": 4,
      "deletions": 5
    },
    {
      "file": "drivers/gpu/drm/drm_modeset_lock.c",
      "insertions": 33,
      "deletions": 10
    },
    {
      "file": "drivers/gpu/drm/i915/intel_display.c",
      "insertions": 6,
      "deletions": 0
    },
    {
      "file": "drivers/gpu/drm/vmwgfx/vmwgfx_kms.c",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "include/drm/drm_crtc.h",
      "insertions": 2,
      "deletions": 0
    },
    {
      "file": "include/drm/drm_modeset_lock.h",
      "insertions": 3,
      "deletions": 1
    }
  ],
  "total_insertions": 55,
  "total_deletions": 19,
  "total_changes": 74,
  "parents": [
    "5ee3229c87d396cab3c2dfc335b90320cc4a2f42"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v3.19",
    "v3.19-rc1",
    "v3.19-rc2",
    "v3.19-rc3",
    "v3.19-rc4",
    "v3.19-rc5",
    "v3.19-rc6",
    "v3.19-rc7",
    "v4.0",
    "v4.0-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/gpu/drm/drm_atomic.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/gpu/drm/drm_atomic_helper.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/gpu/drm/drm_modeset_lock.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/gpu/drm/drm_crtc.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/gpu/drm/i915/intel_display.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/gpu/drm/vmwgfx/vmwgfx_kms.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/drm/drm_crtc.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/drm/drm_modeset_lock.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}