commit 607e57c6c62c00965ae276902c166834ce73014a
Author: Kees Cook <kees@kernel.org>
Date:   Thu Sep 29 22:57:43 2022 -0700

    hardening: Remove Clang's enable flag for -ftrivial-auto-var-init=zero
    
    Now that Clang's -enable-trivial-auto-var-init-zero-knowing-it-will-be-removed-from-clang
    option is no longer required, remove it from the command line. Clang 16
    and later will warn when it is used, which will cause Kconfig to think
    it can't use -ftrivial-auto-var-init=zero at all. Check for whether it
    is required and only use it when so.
    
    Cc: Nathan Chancellor <nathan@kernel.org>
    Cc: Masahiro Yamada <masahiroy@kernel.org>
    Cc: Nick Desaulniers <ndesaulniers@google.com>
    Cc: linux-kbuild@vger.kernel.org
    Cc: llvm@lists.linux.dev
    Cc: stable@vger.kernel.org
    Fixes: f02003c860d9 ("hardening: Avoid harmless Clang option under CONFIG_INIT_STACK_ALL_ZERO")
    Signed-off-by: Kees Cook <keescook@chromium.org>

diff --git a/Makefile b/Makefile
index c7705f749601..02c857e2243c 100644
--- a/Makefile
+++ b/Makefile
@@ -831,8 +831,8 @@ endif
 # Initialize all stack variables with a zero value.
 ifdef CONFIG_INIT_STACK_ALL_ZERO
 KBUILD_CFLAGS	+= -ftrivial-auto-var-init=zero
-ifdef CONFIG_CC_IS_CLANG
-# https://bugs.llvm.org/show_bug.cgi?id=45497
+ifdef CONFIG_CC_HAS_AUTO_VAR_INIT_ZERO_ENABLER
+# https://github.com/llvm/llvm-project/issues/44842
 KBUILD_CFLAGS	+= -enable-trivial-auto-var-init-zero-knowing-it-will-be-removed-from-clang
 endif
 endif