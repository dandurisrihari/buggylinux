{
  "hash": "7d41e8543d809c3c900d1212d6ea887eb284b69a",
  "hash_short": "7d41e854",
  "subject": "io_uring: remove indirect ctx into sqo injection",
  "body": "We use ->ctx_new_list to notify sqo about new ctx pending, then sqo\nshould stop and splice it to its sqd->ctx_list, paired with\n->sq_thread_comp.\n\nThe last one is broken because nobody reinitialises it, and trying to\nfix it would only add more complexity and bugs. And the first isn't\nreally needed as is done under park(), that protects from races well.\nAdd ctx into sqd->ctx_list directly (under park()), it's much simpler\nand allows to kill both, ctx_new_list and sq_thread_comp.\n\nnote: apparently there is no real problem at the moment, because\nsq_thread_comp is used only by io_sq_thread_finish() followed by\nparking, where list_del(&ctx->sqd_list) removes it well regardless\nwhether it's in the new or the active list.\n\nSigned-off-by: Pavel Begunkov <asml.silence@gmail.com>\nSigned-off-by: Jens Axboe <axboe@kernel.dk>",
  "full_message": "io_uring: remove indirect ctx into sqo injection\n\nWe use ->ctx_new_list to notify sqo about new ctx pending, then sqo\nshould stop and splice it to its sqd->ctx_list, paired with\n->sq_thread_comp.\n\nThe last one is broken because nobody reinitialises it, and trying to\nfix it would only add more complexity and bugs. And the first isn't\nreally needed as is done under park(), that protects from races well.\nAdd ctx into sqd->ctx_list directly (under park()), it's much simpler\nand allows to kill both, ctx_new_list and sq_thread_comp.\n\nnote: apparently there is no real problem at the moment, because\nsq_thread_comp is used only by io_sq_thread_finish() followed by\nparking, where list_del(&ctx->sqd_list) removes it well regardless\nwhether it's in the new or the active list.\n\nSigned-off-by: Pavel Begunkov <asml.silence@gmail.com>\nSigned-off-by: Jens Axboe <axboe@kernel.dk>",
  "author_name": "Pavel Begunkov",
  "author_email": "asml.silence@gmail.com",
  "author_date": "Wed Mar 10 13:13:54 2021 +0000",
  "author_date_iso": "2021-03-10T13:13:54+00:00",
  "committer_name": "Jens Axboe",
  "committer_email": "axboe@kernel.dk",
  "committer_date": "Wed Mar 10 07:30:32 2021 -0700",
  "committer_date_iso": "2021-03-10T07:30:32-07:00",
  "files_changed": [
    "fs/io_uring.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "fs/io_uring.c",
      "insertions": 3,
      "deletions": 25
    }
  ],
  "total_insertions": 3,
  "total_deletions": 25,
  "total_changes": 28,
  "parents": [
    "78d7f6ba82edb7f8763390982be29051c4216772"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "fs/io_uring.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}