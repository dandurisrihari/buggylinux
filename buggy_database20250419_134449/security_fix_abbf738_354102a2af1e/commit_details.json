{
  "hash": "abbf73816b6f5f4268fbfb3b3505003c2356d4a9",
  "hash_short": "abbf7381",
  "subject": "kunit: fix possible memory leak in kunit_filter_suites()",
  "body": "Inject fault while probing drm_kunit_helpers.ko, if one of\nkunit_next_attr_filter(), kunit_filter_glob_tests() and\nkunit_filter_attr_tests() fails, parsed_filters,\nparsed_glob.suite_glob/test_glob alloced in\nkunit_parse_glob_filter() is leaked.\nAnd the filtered_suite->test_cases alloced in kunit_filter_glob_tests()\nor kunit_filter_attr_tests() may also be leaked.\n\nunreferenced object 0xff110001067e4800 (size 1024):\n  comm \"kunit_try_catch\", pid 96, jiffies 4294671796 (age 763.547s)\n  hex dump (first 32 bytes):\n    73 75 69 74 65 32 00 00 00 00 00 00 00 00 00 00  suite2..........\n    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................\n  backtrace:\n    [<00000000116e8eba>] __kmalloc_node_track_caller+0x4e/0x140\n    [<00000000e2f9cce9>] kmemdup+0x2c/0x60\n    [<000000002a36710b>] kunit_filter_suites+0x3e4/0xa50\n    [<0000000045779fb9>] filter_suites_test+0x1b7/0x440\n    [<00000000cd1104a7>] kunit_try_run_case+0x119/0x270\n    [<00000000c654c917>] kunit_generic_run_threadfn_adapter+0x4e/0xa0\n    [<00000000d195ac13>] kthread+0x2c7/0x3c0\n    [<00000000b79c1ee9>] ret_from_fork+0x2c/0x70\n    [<000000001167f7e6>] ret_from_fork_asm+0x1b/0x30\nunreferenced object 0xff11000105d79b00 (size 192):\n  comm \"kunit_try_catch\", pid 96, jiffies 4294671796 (age 763.547s)\n  hex dump (first 32 bytes):\n    f0 e1 5a 88 ff ff ff ff 60 59 bb 8a ff ff ff ff  ..Z.....`Y......\n    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................\n  backtrace:\n    [<000000000d6e4891>] __kmalloc+0x4d/0x140\n    [<000000006afe50bd>] kunit_filter_suites+0x424/0xa50\n    [<0000000045779fb9>] filter_suites_test+0x1b7/0x440\n    [<00000000cd1104a7>] kunit_try_run_case+0x119/0x270\n    [<00000000c654c917>] kunit_generic_run_threadfn_adapter+0x4e/0xa0\n    [<00000000d195ac13>] kthread+0x2c7/0x3c0\n    [<00000000b79c1ee9>] ret_from_fork+0x2c/0x70\n    [<000000001167f7e6>] ret_from_fork_asm+0x1b/0x30\nunreferenced object 0xff110001067e6000 (size 1024):\n  comm \"kunit_try_catch\", pid 98, jiffies 4294671798 (age 763.545s)\n  hex dump (first 32 bytes):\n    73 75 69 74 65 32 00 00 00 00 00 00 00 00 00 00  suite2..........\n    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................\n  backtrace:\n    [<00000000116e8eba>] __kmalloc_node_track_caller+0x4e/0x140\n    [<00000000e2f9cce9>] kmemdup+0x2c/0x60\n    [<000000002a36710b>] kunit_filter_suites+0x3e4/0xa50\n    [<00000000f452f130>] filter_suites_test_glob_test+0x1b7/0x660\n    [<00000000cd1104a7>] kunit_try_run_case+0x119/0x270\n    [<00000000c654c917>] kunit_generic_run_threadfn_adapter+0x4e/0xa0\n    [<00000000d195ac13>] kthread+0x2c7/0x3c0\n    [<00000000b79c1ee9>] ret_from_fork+0x2c/0x70\n    [<000000001167f7e6>] ret_from_fork_asm+0x1b/0x30\nunreferenced object 0xff11000103f3a800 (size 96):\n  comm \"kunit_try_catch\", pid 98, jiffies 4294671798 (age 763.545s)\n  hex dump (first 32 bytes):\n    f0 e1 5a 88 ff ff ff ff 40 39 bb 8a ff ff ff ff  ..Z.....@9......\n    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................\n  backtrace:\n    [<000000000d6e4891>] __kmalloc+0x4d/0x140\n    [<000000006afe50bd>] kunit_filter_suites+0x424/0xa50\n    [<00000000f452f130>] filter_suites_test_glob_test+0x1b7/0x660\n    [<00000000cd1104a7>] kunit_try_run_case+0x119/0x270\n    [<00000000c654c917>] kunit_generic_run_threadfn_adapter+0x4e/0xa0\n    [<00000000d195ac13>] kthread+0x2c7/0x3c0\n    [<00000000b79c1ee9>] ret_from_fork+0x2c/0x70\n    [<000000001167f7e6>] ret_from_fork_asm+0x1b/0x30\nunreferenced object 0xff11000101a72ac0 (size 16):\n  comm \"kunit_try_catch\", pid 104, jiffies 4294671814 (age 763.529s)\n  hex dump (first 16 bytes):\n    00 00 00 00 00 00 00 00 e0 2a a7 01 01 00 11 ff  .........*......\n  backtrace:\n    [<000000000d6e4891>] __kmalloc+0x4d/0x140\n    [<00000000c7b724e7>] kunit_filter_suites+0x108/0xa50\n    [<00000000bad5427d>] filter_attr_test+0x1e9/0x6a0\n    [<00000000cd1104a7>] kunit_try_run_case+0x119/0x270\n    [<00000000c654c917>] kunit_generic_run_threadfn_adapter+0x4e/0xa0\n    [<00000000d195ac13>] kthread+0x2c7/0x3c0\n    [<00000000b79c1ee9>] ret_from_fork+0x2c/0x70\n    [<000000001167f7e6>] ret_from_fork_asm+0x1b/0x30\nunreferenced object 0xff11000103caf880 (size 32):\n  comm \"kunit_try_catch\", pid 104, jiffies 4294671814 (age 763.547s)\n  hex dump (first 32 bytes):\n    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................\n    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................\n  backtrace:\n    [<000000000d6e4891>] __kmalloc+0x4d/0x140\n    [<00000000c47b0f75>] kunit_filter_suites+0x189/0xa50\n    [<00000000bad5427d>] filter_attr_test+0x1e9/0x6a0\n    [<00000000cd1104a7>] kunit_try_run_case+0x119/0x270\n    [<00000000c654c917>] kunit_generic_run_threadfn_adapter+0x4e/0xa0\n    [<00000000d195ac13>] kthread+0x2c7/0x3c0\n    [<00000000b79c1ee9>] ret_from_fork+0x2c/0x70\n    [<000000001167f7e6>] ret_from_fork_asm+0x1b/0x30\nunreferenced object 0xff11000101a72ae0 (size 16):\n  comm \"kunit_try_catch\", pid 106, jiffies 4294671823 (age 763.538s)\n  hex dump (first 16 bytes):\n    00 00 00 00 00 00 00 00 00 2b a7 01 01 00 11 ff  .........+......\n  backtrace:\n    [<000000000d6e4891>] __kmalloc+0x4d/0x140\n    [<00000000c7b724e7>] kunit_filter_suites+0x108/0xa50\n    [<0000000096255c51>] filter_attr_empty_test+0x1b0/0x310\n    [<00000000cd1104a7>] kunit_try_run_case+0x119/0x270\n    [<00000000c654c917>] kunit_generic_run_threadfn_adapter+0x4e/0xa0\n    [<00000000d195ac13>] kthread+0x2c7/0x3c0\n    [<00000000b79c1ee9>] ret_from_fork+0x2c/0x70\n    [<000000001167f7e6>] ret_from_fork_asm+0x1b/0x30\nunreferenced object 0xff11000103caf9c0 (size 32):\n  comm \"kunit_try_catch\", pid 106, jiffies 4294671823 (age 763.538s)\n  hex dump (first 32 bytes):\n    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................\n    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................\n  backtrace:\n    [<000000000d6e4891>] __kmalloc+0x4d/0x140\n    [<00000000c47b0f75>] kunit_filter_suites+0x189/0xa50\n    [<0000000096255c51>] filter_attr_empty_test+0x1b0/0x310\n    [<00000000cd1104a7>] kunit_try_run_case+0x119/0x270\n    [<00000000c654c917>] kunit_generic_run_threadfn_adapter+0x4e/0xa0\n    [<00000000d195ac13>] kthread+0x2c7/0x3c0\n    [<00000000b79c1ee9>] ret_from_fork+0x2c/0x70\n    [<000000001167f7e6>] ret_from_fork_asm+0x1b/0x30\nunreferenced object 0xff11000101a72b00 (size 16):\n  comm \"kunit_try_catch\", pid 108, jiffies 4294671832 (age 763.529s)\n  hex dump (first 16 bytes):\n    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................\n  backtrace:\n    [<000000000d6e4891>] __kmalloc+0x4d/0x140\n    [<00000000c47b0f75>] kunit_filter_suites+0x189/0xa50\n    [<00000000881258cc>] filter_attr_skip_test+0x148/0x770\n    [<00000000cd1104a7>] kunit_try_run_case+0x119/0x270\n    [<00000000c654c917>] kunit_generic_run_threadfn_adapter+0x4e/0xa0\n    [<00000000d195ac13>] kthread+0x2c7/0x3c0\n    [<00000000b79c1ee9>] ret_from_fork+0x2c/0x70\n    [<000000001167f7e6>] ret_from_fork_asm+0x1b/0x30\n\nFixes: 5d31f71efcb6 (\"kunit: add kunit.filter_glob cmdline option to filter suites\")\nFixes: 529534e8cba3 (\"kunit: Add ability to filter attributes\")\nSigned-off-by: Ruan Jinjie <ruanjinjie@huawei.com>\nReviewed-by: Rae Moar <rmoar@google.com>\nReviewed-by: David Gow <davidgow@google.com>\nSigned-off-by: Shuah Khan <skhan@linuxfoundation.org>",
  "full_message": "kunit: fix possible memory leak in kunit_filter_suites()\n\nInject fault while probing drm_kunit_helpers.ko, if one of\nkunit_next_attr_filter(), kunit_filter_glob_tests() and\nkunit_filter_attr_tests() fails, parsed_filters,\nparsed_glob.suite_glob/test_glob alloced in\nkunit_parse_glob_filter() is leaked.\nAnd the filtered_suite->test_cases alloced in kunit_filter_glob_tests()\nor kunit_filter_attr_tests() may also be leaked.\n\nunreferenced object 0xff110001067e4800 (size 1024):\n  comm \"kunit_try_catch\", pid 96, jiffies 4294671796 (age 763.547s)\n  hex dump (first 32 bytes):\n    73 75 69 74 65 32 00 00 00 00 00 00 00 00 00 00  suite2..........\n    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................\n  backtrace:\n    [<00000000116e8eba>] __kmalloc_node_track_caller+0x4e/0x140\n    [<00000000e2f9cce9>] kmemdup+0x2c/0x60\n    [<000000002a36710b>] kunit_filter_suites+0x3e4/0xa50\n    [<0000000045779fb9>] filter_suites_test+0x1b7/0x440\n    [<00000000cd1104a7>] kunit_try_run_case+0x119/0x270\n    [<00000000c654c917>] kunit_generic_run_threadfn_adapter+0x4e/0xa0\n    [<00000000d195ac13>] kthread+0x2c7/0x3c0\n    [<00000000b79c1ee9>] ret_from_fork+0x2c/0x70\n    [<000000001167f7e6>] ret_from_fork_asm+0x1b/0x30\nunreferenced object 0xff11000105d79b00 (size 192):\n  comm \"kunit_try_catch\", pid 96, jiffies 4294671796 (age 763.547s)\n  hex dump (first 32 bytes):\n    f0 e1 5a 88 ff ff ff ff 60 59 bb 8a ff ff ff ff  ..Z.....`Y......\n    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................\n  backtrace:\n    [<000000000d6e4891>] __kmalloc+0x4d/0x140\n    [<000000006afe50bd>] kunit_filter_suites+0x424/0xa50\n    [<0000000045779fb9>] filter_suites_test+0x1b7/0x440\n    [<00000000cd1104a7>] kunit_try_run_case+0x119/0x270\n    [<00000000c654c917>] kunit_generic_run_threadfn_adapter+0x4e/0xa0\n    [<00000000d195ac13>] kthread+0x2c7/0x3c0\n    [<00000000b79c1ee9>] ret_from_fork+0x2c/0x70\n    [<000000001167f7e6>] ret_from_fork_asm+0x1b/0x30\nunreferenced object 0xff110001067e6000 (size 1024):\n  comm \"kunit_try_catch\", pid 98, jiffies 4294671798 (age 763.545s)\n  hex dump (first 32 bytes):\n    73 75 69 74 65 32 00 00 00 00 00 00 00 00 00 00  suite2..........\n    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................\n  backtrace:\n    [<00000000116e8eba>] __kmalloc_node_track_caller+0x4e/0x140\n    [<00000000e2f9cce9>] kmemdup+0x2c/0x60\n    [<000000002a36710b>] kunit_filter_suites+0x3e4/0xa50\n    [<00000000f452f130>] filter_suites_test_glob_test+0x1b7/0x660\n    [<00000000cd1104a7>] kunit_try_run_case+0x119/0x270\n    [<00000000c654c917>] kunit_generic_run_threadfn_adapter+0x4e/0xa0\n    [<00000000d195ac13>] kthread+0x2c7/0x3c0\n    [<00000000b79c1ee9>] ret_from_fork+0x2c/0x70\n    [<000000001167f7e6>] ret_from_fork_asm+0x1b/0x30\nunreferenced object 0xff11000103f3a800 (size 96):\n  comm \"kunit_try_catch\", pid 98, jiffies 4294671798 (age 763.545s)\n  hex dump (first 32 bytes):\n    f0 e1 5a 88 ff ff ff ff 40 39 bb 8a ff ff ff ff  ..Z.....@9......\n    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................\n  backtrace:\n    [<000000000d6e4891>] __kmalloc+0x4d/0x140\n    [<000000006afe50bd>] kunit_filter_suites+0x424/0xa50\n    [<00000000f452f130>] filter_suites_test_glob_test+0x1b7/0x660\n    [<00000000cd1104a7>] kunit_try_run_case+0x119/0x270\n    [<00000000c654c917>] kunit_generic_run_threadfn_adapter+0x4e/0xa0\n    [<00000000d195ac13>] kthread+0x2c7/0x3c0\n    [<00000000b79c1ee9>] ret_from_fork+0x2c/0x70\n    [<000000001167f7e6>] ret_from_fork_asm+0x1b/0x30\nunreferenced object 0xff11000101a72ac0 (size 16):\n  comm \"kunit_try_catch\", pid 104, jiffies 4294671814 (age 763.529s)\n  hex dump (first 16 bytes):\n    00 00 00 00 00 00 00 00 e0 2a a7 01 01 00 11 ff  .........*......\n  backtrace:\n    [<000000000d6e4891>] __kmalloc+0x4d/0x140\n    [<00000000c7b724e7>] kunit_filter_suites+0x108/0xa50\n    [<00000000bad5427d>] filter_attr_test+0x1e9/0x6a0\n    [<00000000cd1104a7>] kunit_try_run_case+0x119/0x270\n    [<00000000c654c917>] kunit_generic_run_threadfn_adapter+0x4e/0xa0\n    [<00000000d195ac13>] kthread+0x2c7/0x3c0\n    [<00000000b79c1ee9>] ret_from_fork+0x2c/0x70\n    [<000000001167f7e6>] ret_from_fork_asm+0x1b/0x30\nunreferenced object 0xff11000103caf880 (size 32):\n  comm \"kunit_try_catch\", pid 104, jiffies 4294671814 (age 763.547s)\n  hex dump (first 32 bytes):\n    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................\n    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................\n  backtrace:\n    [<000000000d6e4891>] __kmalloc+0x4d/0x140\n    [<00000000c47b0f75>] kunit_filter_suites+0x189/0xa50\n    [<00000000bad5427d>] filter_attr_test+0x1e9/0x6a0\n    [<00000000cd1104a7>] kunit_try_run_case+0x119/0x270\n    [<00000000c654c917>] kunit_generic_run_threadfn_adapter+0x4e/0xa0\n    [<00000000d195ac13>] kthread+0x2c7/0x3c0\n    [<00000000b79c1ee9>] ret_from_fork+0x2c/0x70\n    [<000000001167f7e6>] ret_from_fork_asm+0x1b/0x30\nunreferenced object 0xff11000101a72ae0 (size 16):\n  comm \"kunit_try_catch\", pid 106, jiffies 4294671823 (age 763.538s)\n  hex dump (first 16 bytes):\n    00 00 00 00 00 00 00 00 00 2b a7 01 01 00 11 ff  .........+......\n  backtrace:\n    [<000000000d6e4891>] __kmalloc+0x4d/0x140\n    [<00000000c7b724e7>] kunit_filter_suites+0x108/0xa50\n    [<0000000096255c51>] filter_attr_empty_test+0x1b0/0x310\n    [<00000000cd1104a7>] kunit_try_run_case+0x119/0x270\n    [<00000000c654c917>] kunit_generic_run_threadfn_adapter+0x4e/0xa0\n    [<00000000d195ac13>] kthread+0x2c7/0x3c0\n    [<00000000b79c1ee9>] ret_from_fork+0x2c/0x70\n    [<000000001167f7e6>] ret_from_fork_asm+0x1b/0x30\nunreferenced object 0xff11000103caf9c0 (size 32):\n  comm \"kunit_try_catch\", pid 106, jiffies 4294671823 (age 763.538s)\n  hex dump (first 32 bytes):\n    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................\n    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................\n  backtrace:\n    [<000000000d6e4891>] __kmalloc+0x4d/0x140\n    [<00000000c47b0f75>] kunit_filter_suites+0x189/0xa50\n    [<0000000096255c51>] filter_attr_empty_test+0x1b0/0x310\n    [<00000000cd1104a7>] kunit_try_run_case+0x119/0x270\n    [<00000000c654c917>] kunit_generic_run_threadfn_adapter+0x4e/0xa0\n    [<00000000d195ac13>] kthread+0x2c7/0x3c0\n    [<00000000b79c1ee9>] ret_from_fork+0x2c/0x70\n    [<000000001167f7e6>] ret_from_fork_asm+0x1b/0x30\nunreferenced object 0xff11000101a72b00 (size 16):\n  comm \"kunit_try_catch\", pid 108, jiffies 4294671832 (age 763.529s)\n  hex dump (first 16 bytes):\n    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................\n  backtrace:\n    [<000000000d6e4891>] __kmalloc+0x4d/0x140\n    [<00000000c47b0f75>] kunit_filter_suites+0x189/0xa50\n    [<00000000881258cc>] filter_attr_skip_test+0x148/0x770\n    [<00000000cd1104a7>] kunit_try_run_case+0x119/0x270\n    [<00000000c654c917>] kunit_generic_run_threadfn_adapter+0x4e/0xa0\n    [<00000000d195ac13>] kthread+0x2c7/0x3c0\n    [<00000000b79c1ee9>] ret_from_fork+0x2c/0x70\n    [<000000001167f7e6>] ret_from_fork_asm+0x1b/0x30\n\nFixes: 5d31f71efcb6 (\"kunit: add kunit.filter_glob cmdline option to filter suites\")\nFixes: 529534e8cba3 (\"kunit: Add ability to filter attributes\")\nSigned-off-by: Ruan Jinjie <ruanjinjie@huawei.com>\nReviewed-by: Rae Moar <rmoar@google.com>\nReviewed-by: David Gow <davidgow@google.com>\nSigned-off-by: Shuah Khan <skhan@linuxfoundation.org>",
  "author_name": "Ruan Jinjie",
  "author_email": "ruanjinjie@huawei.com",
  "author_date": "Tue Aug 1 15:37:00 2023 +0800",
  "author_date_iso": "2023-08-01T15:37:00+08:00",
  "committer_name": "Shuah Khan",
  "committer_email": "skhan@linuxfoundation.org",
  "committer_date": "Fri Aug 4 13:41:47 2023 -0600",
  "committer_date_iso": "2023-08-04T13:41:47-06:00",
  "files_changed": [
    "lib/kunit/executor.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "lib/kunit/executor.c",
      "insertions": 12,
      "deletions": 5
    }
  ],
  "total_insertions": 12,
  "total_deletions": 5,
  "total_changes": 17,
  "parents": [
    "5a175d369c702ce08c9feb630125c9fc7a9e1370"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "Inject"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "lib/kunit/executor.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}