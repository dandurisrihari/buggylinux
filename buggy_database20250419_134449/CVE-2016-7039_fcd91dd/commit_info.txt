Commit Hash: fcd91dd449867c6bfe56a81cabba76b829fd05cd
Subject: net: add recursion limit to GRO

CVE Identifiers:
- CVE-2016-7039

Full commit message:
net: add recursion limit to GRO

Currently, GRO can do unlimited recursion through the gro_receive
handlers.  This was fixed for tunneling protocols by limiting tunnel GRO
to one level with encap_mark, but both VLAN and TEB still have this
problem.  Thus, the kernel is vulnerable to a stack overflow, if we
receive a packet composed entirely of VLAN headers.

This patch adds a recursion counter to the GRO layer to prevent stack
overflow.  When a gro_receive function hits the recursion limit, GRO is
aborted for this skb and it is processed normally.  This recursion
counter is put in the GRO CB, but could be turned into a percpu counter
if we run out of space in the CB.

Thanks to Vladimír Beneš <vbenes@redhat.com> for the initial bug report.

Fixes: CVE-2016-7039
Fixes: 9b174d88c257 ("net: Add Transparent Ethernet Bridging GRO support.")
Fixes: 66e5133f19e9 ("vlan: Add GRO support for non hardware accelerated vlan")
Signed-off-by: Sabrina Dubroca <sd@queasysnail.net>
Reviewed-by: Jiri Benc <jbenc@redhat.com>
Acked-by: Hannes Frederic Sowa <hannes@stressinduktion.org>
Acked-by: Tom Herbert <tom@herbertland.com>
Signed-off-by: David S. Miller <davem@davemloft.net>

Metadata:
Author: Sabrina Dubroca <sd@queasysnail.net>
Author Date: Thu Oct 20 15:58:02 2016 +0200
Committer: David S. Miller <davem@davemloft.net>
Commit Date: Thu Oct 20 14:32:22 2016 -0400

Files Changed: 11
Lines Added: 49
Lines Removed: 11
Total Changes: 60
