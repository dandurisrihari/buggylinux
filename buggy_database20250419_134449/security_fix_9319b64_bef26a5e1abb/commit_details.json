{
  "hash": "9319b647902cbd5cc884ac08a8a6d54ce111fc78",
  "hash_short": "9319b647",
  "subject": "mm/writeback: fix possible divide-by-zero in wb_dirty_limits(), again",
  "body": "(struct dirty_throttle_control *)->thresh is an unsigned long, but is\npassed as the u32 divisor argument to div_u64().  On architectures where\nunsigned long is 64 bytes, the argument will be implicitly truncated.\n\nUse div64_u64() instead of div_u64() so that the value used in the \"is\nthis a safe division\" check is the same as the divisor.\n\nAlso, remove redundant cast of the numerator to u64, as that should happen\nimplicitly.\n\nThis would be difficult to exploit in memcg domain, given the ratio-based\narithmetic domain_drity_limits() uses, but is much easier in global\nwriteback domain with a BDI_CAP_STRICTLIMIT-backing device, using e.g. \nvm.dirty_bytes=(1<<32)*PAGE_SIZE so that dtc->thresh == (1<<32)\n\nLink: https://lkml.kernel.org/r/20240118181954.1415197-1-zokeefe@google.com\nFixes: f6789593d5ce (\"mm/page-writeback.c: fix divide by zero in bdi_dirty_limits()\")\nSigned-off-by: Zach O'Keefe <zokeefe@google.com>\nCc: Maxim Patlasov <MPatlasov@parallels.com>\nCc: <stable@vger.kernel.org>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>",
  "full_message": "mm/writeback: fix possible divide-by-zero in wb_dirty_limits(), again\n\n(struct dirty_throttle_control *)->thresh is an unsigned long, but is\npassed as the u32 divisor argument to div_u64().  On architectures where\nunsigned long is 64 bytes, the argument will be implicitly truncated.\n\nUse div64_u64() instead of div_u64() so that the value used in the \"is\nthis a safe division\" check is the same as the divisor.\n\nAlso, remove redundant cast of the numerator to u64, as that should happen\nimplicitly.\n\nThis would be difficult to exploit in memcg domain, given the ratio-based\narithmetic domain_drity_limits() uses, but is much easier in global\nwriteback domain with a BDI_CAP_STRICTLIMIT-backing device, using e.g. \nvm.dirty_bytes=(1<<32)*PAGE_SIZE so that dtc->thresh == (1<<32)\n\nLink: https://lkml.kernel.org/r/20240118181954.1415197-1-zokeefe@google.com\nFixes: f6789593d5ce (\"mm/page-writeback.c: fix divide by zero in bdi_dirty_limits()\")\nSigned-off-by: Zach O'Keefe <zokeefe@google.com>\nCc: Maxim Patlasov <MPatlasov@parallels.com>\nCc: <stable@vger.kernel.org>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>",
  "author_name": "Zach O'Keefe",
  "author_email": "zokeefe@google.com",
  "author_date": "Thu Jan 18 10:19:53 2024 -0800",
  "author_date_iso": "2024-01-18T10:19:53-08:00",
  "committer_name": "Andrew Morton",
  "committer_email": "akpm@linux-foundation.org",
  "committer_date": "Thu Jan 25 23:52:20 2024 -0800",
  "committer_date_iso": "2024-01-25T23:52:20-08:00",
  "files_changed": [
    "mm/page-writeback.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "mm/page-writeback.c",
      "insertions": 1,
      "deletions": 1
    }
  ],
  "total_insertions": 1,
  "total_deletions": 1,
  "total_changes": 2,
  "parents": [
    "bc29036e1da1cf66e5f8312649aeec2d51ea3d86"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "exploit"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "mm/page-writeback.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}