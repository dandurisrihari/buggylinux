{
  "hash": "e51aded92d42784313ba16c12f4f88cc4f973bbb",
  "hash_short": "e51aded9",
  "subject": "ntb: ntb_hw_switchtec: Fix use after free vulnerability in switchtec_ntb_remove due to race condition",
  "body": "In the switchtec_ntb_add function, it can call switchtec_ntb_init_sndev\nfunction, then &sndev->check_link_status_work is bound with\ncheck_link_status_work. switchtec_ntb_link_notification may be called\nto start the work.\n\nIf we remove the module which will call switchtec_ntb_remove to make\ncleanup, it will free sndev through kfree(sndev), while the work\nmentioned above will be used. The sequence of operations that may lead\nto a UAF bug is as follows:\n\nCPU0                                 CPU1\n\n                        | check_link_status_work\nswitchtec_ntb_remove    |\nkfree(sndev);           |\n                        | if (sndev->link_force_down)\n                        | // use sndev\n\nFix it by ensuring that the work is canceled before proceeding with\nthe cleanup in switchtec_ntb_remove.\n\nSigned-off-by: Kaixin Wang <kxwang23@m.fudan.edu.cn>\nReviewed-by: Logan Gunthorpe <logang@deltatee.com>\nSigned-off-by: Jon Mason <jdmason@kudzu.us>",
  "full_message": "ntb: ntb_hw_switchtec: Fix use after free vulnerability in switchtec_ntb_remove due to race condition\n\nIn the switchtec_ntb_add function, it can call switchtec_ntb_init_sndev\nfunction, then &sndev->check_link_status_work is bound with\ncheck_link_status_work. switchtec_ntb_link_notification may be called\nto start the work.\n\nIf we remove the module which will call switchtec_ntb_remove to make\ncleanup, it will free sndev through kfree(sndev), while the work\nmentioned above will be used. The sequence of operations that may lead\nto a UAF bug is as follows:\n\nCPU0                                 CPU1\n\n                        | check_link_status_work\nswitchtec_ntb_remove    |\nkfree(sndev);           |\n                        | if (sndev->link_force_down)\n                        | // use sndev\n\nFix it by ensuring that the work is canceled before proceeding with\nthe cleanup in switchtec_ntb_remove.\n\nSigned-off-by: Kaixin Wang <kxwang23@m.fudan.edu.cn>\nReviewed-by: Logan Gunthorpe <logang@deltatee.com>\nSigned-off-by: Jon Mason <jdmason@kudzu.us>",
  "author_name": "Kaixin Wang",
  "author_email": "kxwang23@m.fudan.edu.cn",
  "author_date": "Tue Sep 10 01:20:07 2024 +0800",
  "author_date_iso": "2024-09-10T01:20:07+08:00",
  "committer_name": "Jon Mason",
  "committer_email": "jdmason@kudzu.us",
  "committer_date": "Fri Sep 20 10:50:38 2024 -0400",
  "committer_date_iso": "2024-09-20T10:50:38-04:00",
  "files_changed": [
    "drivers/ntb/hw/mscc/ntb_hw_switchtec.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/ntb/hw/mscc/ntb_hw_switchtec.c",
      "insertions": 1,
      "deletions": 0
    }
  ],
  "total_insertions": 1,
  "total_deletions": 0,
  "total_changes": 1,
  "parents": [
    "87a7d7150589f68cd7938b208310c93d1e4c3773"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "vulnerability"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/ntb/hw/mscc/ntb_hw_switchtec.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}