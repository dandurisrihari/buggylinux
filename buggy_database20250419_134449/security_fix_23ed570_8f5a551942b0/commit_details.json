{
  "hash": "23ed570accc94cf9de9036b71102aa7c0e0e8dc6",
  "hash_short": "23ed570a",
  "subject": "block, bfq: update inject limit only after injection occurred",
  "body": "BFQ updates the injection limit of each bfq_queue as a function of how\nmuch the limit inflates the service times experienced by the I/O\nrequests of the queue. So only service times affected by injection\nmust be taken into account. Unfortunately, in the current\nimplementation of this update scheme, the service time of an I/O\nrequest rq not affected by injection may happen to be considered in\nthe following case: there is no I/O request in service when rq\narrives.\n\nThis commit fixes this issue by making sure that only service times\naffected by injection are considered for updating the injection\nlimit. In particular, the service time of an I/O request rq is now\nconsidered only if at least one of the following two conditions holds:\n- the destination bfq_queue for rq underwent injection before rq\narrival, and there is still I/O in service in the drive on rq arrival\n(the service of such unfinished I/O may delay the service of rq);\n- injection occurs between the arrival and the completion time of rq.\n\nTested-by: Oleksandr Natalenko <oleksandr@natalenko.name>\nSigned-off-by: Paolo Valente <paolo.valente@linaro.org>\nSigned-off-by: Jens Axboe <axboe@kernel.dk>",
  "full_message": "block, bfq: update inject limit only after injection occurred\n\nBFQ updates the injection limit of each bfq_queue as a function of how\nmuch the limit inflates the service times experienced by the I/O\nrequests of the queue. So only service times affected by injection\nmust be taken into account. Unfortunately, in the current\nimplementation of this update scheme, the service time of an I/O\nrequest rq not affected by injection may happen to be considered in\nthe following case: there is no I/O request in service when rq\narrives.\n\nThis commit fixes this issue by making sure that only service times\naffected by injection are considered for updating the injection\nlimit. In particular, the service time of an I/O request rq is now\nconsidered only if at least one of the following two conditions holds:\n- the destination bfq_queue for rq underwent injection before rq\narrival, and there is still I/O in service in the drive on rq arrival\n(the service of such unfinished I/O may delay the service of rq);\n- injection occurs between the arrival and the completion time of rq.\n\nTested-by: Oleksandr Natalenko <oleksandr@natalenko.name>\nSigned-off-by: Paolo Valente <paolo.valente@linaro.org>\nSigned-off-by: Jens Axboe <axboe@kernel.dk>",
  "author_name": "Paolo Valente",
  "author_email": "paolo.valente@linaro.org",
  "author_date": "Thu Aug 22 17:20:34 2019 +0200",
  "author_date_iso": "2019-08-22T17:20:34+02:00",
  "committer_name": "Jens Axboe",
  "committer_email": "axboe@kernel.dk",
  "committer_date": "Tue Sep 17 20:03:49 2019 -0600",
  "committer_date_iso": "2019-09-17T20:03:49-06:00",
  "files_changed": [
    "block/bfq-iosched.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "block/bfq-iosched.c",
      "insertions": 17,
      "deletions": 2
    }
  ],
  "total_insertions": 17,
  "total_deletions": 2,
  "total_changes": 19,
  "parents": [
    "54d4e6ab91eb24b47a58403d8561206e916f0242"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v5.4",
    "v5.4-rc1",
    "v5.4-rc2",
    "v5.4-rc3",
    "v5.4-rc4",
    "v5.4-rc5",
    "v5.4-rc6",
    "v5.4-rc7",
    "v5.4-rc8",
    "v5.5"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "inject"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "block/bfq-iosched.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}