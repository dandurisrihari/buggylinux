Commit Hash: 14c0abf14a5e67e793131116bd97f57da37ccce3
Subject: x86: mce, inject: Use real inject-msg in raise_local


Security Keywords:
- inject

Full commit message:
x86: mce, inject: Use real inject-msg in raise_local

Current raise_local() uses a struct mce that comes from mce_write()
as a parameter instead of the real inject-msg, so when we set
mce.finished = 0 to clear injected MCE, the real inject stays
valid.

This will cause the remaining inject-msg affect the next injection,
which is not desired.

To fix this, real inject-msg is used in raise_local instead of the
one on the stack.

This patch is based on the diagnosis and the fixes by Dean Nelson.

Reported-by: Dean Nelson <dnelson@redhat.com>
Signed-off-by: Huang Ying <ying.huang@intel.com>
Cc: Hidetoshi Seto <seto.hidetoshi@jp.fujitsu.com>
Cc: Andi Kleen <ak@linux.intel.com>
LKML-Reference: <1253601357.15717.757.camel@yhuang-dev.sh.intel.com>
Signed-off-by: Ingo Molnar <mingo@elte.hu>

Metadata:
Author: Huang Ying <ying.huang@intel.com>
Author Date: Tue Sep 22 14:35:57 2009 +0800
Committer: Ingo Molnar <mingo@elte.hu>
Commit Date: Tue Sep 22 21:06:37 2009 +0200

Files Changed: 1
Lines Added: 4
Lines Removed: 3
Total Changes: 7
