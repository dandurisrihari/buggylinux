{
  "hash": "dccf78d39f1069a5ddf4328bf0c97aa5f2f4296e",
  "hash_short": "dccf78d3",
  "subject": "kernel/Kconfig.kexec: drop select of KEXEC for CRASH_DUMP",
  "body": "Ignat Korchagin complained that a potential config regression was\nintroduced by commit 89cde455915f (\"kexec: consolidate kexec and crash\noptions into kernel/Kconfig.kexec\").  Before the commit, CONFIG_CRASH_DUMP\nhas no dependency on CONFIG_KEXEC.  After the commit, CRASH_DUMP selects\nKEXEC.  That enforces system to have CONFIG_KEXEC=y as long as\nCONFIG_CRASH_DUMP=Y which people may not want.\n\nIn Ignat's case, he sets CONFIG_CRASH_DUMP=y, CONFIG_KEXEC_FILE=y and\nCONFIG_KEXEC=n because kexec_load interface could have security issue if\nkernel/initrd has no chance to be signed and verified.\n\nCRASH_DUMP has select of KEXEC because Eric, author of above commit, met a\nLKP report of build failure when posting patch of earlier version.  Please\nsee below link to get detail of the LKP report:\n\n    https://lore.kernel.org/all/3e8eecd1-a277-2cfb-690e-5de2eb7b988e@oracle.com/T/#u\n\nIn fact, that LKP report is triggered because arm's <asm/kexec.h> is\nwrapped in CONFIG_KEXEC ifdeffery scope.  That is wrong.  CONFIG_KEXEC\ncontrols the enabling/disabling of kexec_load interface, but not kexec\nfeature.  Removing the wrongly added CONFIG_KEXEC ifdeffery scope in\n<asm/kexec.h> of arm allows us to drop the select KEXEC for CRASH_DUMP. \nMeanwhile, change arch/arm/kernel/Makefile to let machine_kexec.o\nrelocate_kernel.o depend on KEXEC_CORE.\n\nLink: https://lkml.kernel.org/r/20231128054457.659452-1-bhe@redhat.com\nFixes: 89cde455915f (\"kexec: consolidate kexec and crash options into kernel/Kconfig.kexec\")\nSigned-off-by: Baoquan He <bhe@redhat.com>\nReported-by: Ignat Korchagin <ignat@cloudflare.com>\nTested-by: Ignat Korchagin <ignat@cloudflare.com>\t[compile-time only]\nTested-by: Alexander Gordeev <agordeev@linux.ibm.com>\nReviewed-by: Eric DeVolder <eric_devolder@yahoo.com>\nTested-by: Eric DeVolder <eric_devolder@yahoo.com>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>",
  "full_message": "kernel/Kconfig.kexec: drop select of KEXEC for CRASH_DUMP\n\nIgnat Korchagin complained that a potential config regression was\nintroduced by commit 89cde455915f (\"kexec: consolidate kexec and crash\noptions into kernel/Kconfig.kexec\").  Before the commit, CONFIG_CRASH_DUMP\nhas no dependency on CONFIG_KEXEC.  After the commit, CRASH_DUMP selects\nKEXEC.  That enforces system to have CONFIG_KEXEC=y as long as\nCONFIG_CRASH_DUMP=Y which people may not want.\n\nIn Ignat's case, he sets CONFIG_CRASH_DUMP=y, CONFIG_KEXEC_FILE=y and\nCONFIG_KEXEC=n because kexec_load interface could have security issue if\nkernel/initrd has no chance to be signed and verified.\n\nCRASH_DUMP has select of KEXEC because Eric, author of above commit, met a\nLKP report of build failure when posting patch of earlier version.  Please\nsee below link to get detail of the LKP report:\n\n    https://lore.kernel.org/all/3e8eecd1-a277-2cfb-690e-5de2eb7b988e@oracle.com/T/#u\n\nIn fact, that LKP report is triggered because arm's <asm/kexec.h> is\nwrapped in CONFIG_KEXEC ifdeffery scope.  That is wrong.  CONFIG_KEXEC\ncontrols the enabling/disabling of kexec_load interface, but not kexec\nfeature.  Removing the wrongly added CONFIG_KEXEC ifdeffery scope in\n<asm/kexec.h> of arm allows us to drop the select KEXEC for CRASH_DUMP. \nMeanwhile, change arch/arm/kernel/Makefile to let machine_kexec.o\nrelocate_kernel.o depend on KEXEC_CORE.\n\nLink: https://lkml.kernel.org/r/20231128054457.659452-1-bhe@redhat.com\nFixes: 89cde455915f (\"kexec: consolidate kexec and crash options into kernel/Kconfig.kexec\")\nSigned-off-by: Baoquan He <bhe@redhat.com>\nReported-by: Ignat Korchagin <ignat@cloudflare.com>\nTested-by: Ignat Korchagin <ignat@cloudflare.com>\t[compile-time only]\nTested-by: Alexander Gordeev <agordeev@linux.ibm.com>\nReviewed-by: Eric DeVolder <eric_devolder@yahoo.com>\nTested-by: Eric DeVolder <eric_devolder@yahoo.com>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>",
  "author_name": "Baoquan He",
  "author_email": "bhe@redhat.com",
  "author_date": "Tue Nov 28 13:44:57 2023 +0800",
  "author_date_iso": "2023-11-28T13:44:57+08:00",
  "committer_name": "Andrew Morton",
  "committer_email": "akpm@linux-foundation.org",
  "committer_date": "Wed Dec 6 16:12:48 2023 -0800",
  "committer_date_iso": "2023-12-06T16:12:48-08:00",
  "files_changed": [
    "arch/arm/include/asm/kexec.h",
    "arch/arm/kernel/Makefile",
    "kernel/Kconfig.kexec"
  ],
  "files_changed_count": 3,
  "stats": [
    {
      "file": "arch/arm/include/asm/kexec.h",
      "insertions": 0,
      "deletions": 4
    },
    {
      "file": "arch/arm/kernel/Makefile",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "kernel/Kconfig.kexec",
      "insertions": 0,
      "deletions": 1
    }
  ],
  "total_insertions": 1,
  "total_deletions": 6,
  "total_changes": 7,
  "parents": [
    "8e92157d7f6190c86bfd6144a409001469827100"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "security issue"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/arm/include/asm/kexec.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/arm/kernel/Makefile",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "kernel/Kconfig.kexec",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}