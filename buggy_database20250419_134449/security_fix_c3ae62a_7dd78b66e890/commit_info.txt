Commit Hash: c3ae62af8e755ea68380fb5ce682e60079a4c388
Subject: tcp: should drop incoming frames without ACK flag set


Security Keywords:
- Injection

Full commit message:
tcp: should drop incoming frames without ACK flag set

In commit 96e0bf4b5193d (tcp: Discard segments that ack data not yet
sent) John Dykstra enforced a check against ack sequences.

In commit 354e4aa391ed5 (tcp: RFC 5961 5.2 Blind Data Injection Attack
Mitigation) I added more safety tests.

But we missed fact that these tests are not performed if ACK bit is
not set.

RFC 793 3.9 mandates TCP should drop a frame without ACK flag set.

" fifth check the ACK field,
      if the ACK bit is off drop the segment and return"

Not doing so permits an attacker to only guess an acceptable sequence
number, evading stronger checks.

Many thanks to Zhiyun Qian for bringing this issue to our attention.

See :
http://web.eecs.umich.edu/~zhiyunq/pub/ccs12_TCP_sequence_number_inference.pdf

Reported-by: Zhiyun Qian <zhiyunq@umich.edu>
Signed-off-by: Eric Dumazet <edumazet@google.com>
Cc: Nandita Dukkipati <nanditad@google.com>
Cc: Neal Cardwell <ncardwell@google.com>
Cc: John Dykstra <john.dykstra1@gmail.com>
Signed-off-by: David S. Miller <davem@davemloft.net>

Metadata:
Author: Eric Dumazet <edumazet@google.com>
Author Date: Wed Dec 26 12:44:34 2012 +0000
Committer: David S. Miller <davem@davemloft.net>
Commit Date: Wed Dec 26 15:08:55 2012 -0800

Files Changed: 1
Lines Added: 10
Lines Removed: 4
Total Changes: 14
