{
  "hash": "1e0ad70cc1957b9050368e433b1061a2cd1ce543",
  "hash_short": "1e0ad70c",
  "subject": "KVM: x86: fix deadline tsc interrupt injection",
  "body": "The check in kvm_set_lapic_tscdeadline_msr() was trying to prevent a\nsituation where we lose a pending deadline timer in a MSR write.\nLosing it is fine, because it effectively occurs before the timer fired,\nso we should be able to cancel or postpone it.\n\nAnother problem comes from interaction with QEMU, or other userspace\nthat can set deadline MSR without a good reason, when timer is already\npending:  one guest's deadline request results in more than one\ninterrupt because one is injected immediately on MSR write from\nuserspace and one through hrtimer later.\n\nThe solution is to remove the injection when replacing a pending timer\nand to improve the usual QEMU path, we inject without a hrtimer when the\ndeadline has already passed.\n\nSigned-off-by: Radim Kr\u010dm\u00e1\u0159 <rkrcmar@redhat.com>\nReported-by: Nadav Amit <namit@cs.technion.ac.il>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "full_message": "KVM: x86: fix deadline tsc interrupt injection\n\nThe check in kvm_set_lapic_tscdeadline_msr() was trying to prevent a\nsituation where we lose a pending deadline timer in a MSR write.\nLosing it is fine, because it effectively occurs before the timer fired,\nso we should be able to cancel or postpone it.\n\nAnother problem comes from interaction with QEMU, or other userspace\nthat can set deadline MSR without a good reason, when timer is already\npending:  one guest's deadline request results in more than one\ninterrupt because one is injected immediately on MSR write from\nuserspace and one through hrtimer later.\n\nThe solution is to remove the injection when replacing a pending timer\nand to improve the usual QEMU path, we inject without a hrtimer when the\ndeadline has already passed.\n\nSigned-off-by: Radim Kr\u010dm\u00e1\u0159 <rkrcmar@redhat.com>\nReported-by: Nadav Amit <namit@cs.technion.ac.il>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "author_name": "Radim Kr\u010dm\u00e1\u0159",
  "author_email": "rkrcmar@redhat.com",
  "author_date": "Fri Oct 10 19:15:09 2014 +0200",
  "author_date_iso": "2014-10-10T19:15:09+02:00",
  "committer_name": "Paolo Bonzini",
  "committer_email": "pbonzini@redhat.com",
  "committer_date": "Mon Nov 3 12:07:28 2014 +0100",
  "committer_date_iso": "2014-11-03T12:07:28+01:00",
  "files_changed": [
    "arch/x86/kvm/lapic.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "arch/x86/kvm/lapic.c",
      "insertions": 4,
      "deletions": 6
    }
  ],
  "total_insertions": 4,
  "total_deletions": 6,
  "total_changes": 10,
  "parents": [
    "5d87db711937019cb8eba1137c37573d7a604be8"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v3.19",
    "v3.19-rc1",
    "v3.19-rc2",
    "v3.19-rc3",
    "v3.19-rc4",
    "v3.19-rc5",
    "v3.19-rc6",
    "v3.19-rc7",
    "v4.0",
    "v4.0-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/x86/kvm/lapic.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}