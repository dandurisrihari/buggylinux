{
  "hash": "52a9dab6d892763b2a8334a568bd4e2c1a6fde66",
  "hash_short": "52a9dab6",
  "subject": "libsubcmd: Fix use-after-free for realloc(..., 0)",
  "body": "GCC 12 correctly reports a potential use-after-free condition in the\nxrealloc helper. Fix the warning by avoiding an implicit \"free(ptr)\"\nwhen size == 0:\n\nIn file included from help.c:12:\nIn function 'xrealloc',\n    inlined from 'add_cmdname' at help.c:24:2: subcmd-util.h:56:23: error: pointer may be used after 'realloc' [-Werror=use-after-free]\n   56 |                 ret = realloc(ptr, size);\n      |                       ^~~~~~~~~~~~~~~~~~\nsubcmd-util.h:52:21: note: call to 'realloc' here\n   52 |         void *ret = realloc(ptr, size);\n      |                     ^~~~~~~~~~~~~~~~~~\nsubcmd-util.h:58:31: error: pointer may be used after 'realloc' [-Werror=use-after-free]\n   58 |                         ret = realloc(ptr, 1);\n      |                               ^~~~~~~~~~~~~~~\nsubcmd-util.h:52:21: note: call to 'realloc' here\n   52 |         void *ret = realloc(ptr, size);\n      |                     ^~~~~~~~~~~~~~~~~~\n\nFixes: 2f4ce5ec1d447beb (\"perf tools: Finalize subcmd independence\")\nReported-by: Valdis Kl\u0113tnieks <valdis.kletnieks@vt.edu>\nSigned-off-by: Kees Kook <keescook@chromium.org>\nTested-by: Valdis Kl\u0113tnieks <valdis.kletnieks@vt.edu>\nTested-by: Justin M. Forbes <jforbes@fedoraproject.org>\nAcked-by: Josh Poimboeuf <jpoimboe@redhat.com>\nCc: linux-hardening@vger.kernel.org\nCc: Valdis Kl\u0113tnieks <valdis.kletnieks@vt.edu>\nLink: http://lore.kernel.org/lkml/20220213182443.4037039-1-keescook@chromium.org\nSigned-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>",
  "full_message": "libsubcmd: Fix use-after-free for realloc(..., 0)\n\nGCC 12 correctly reports a potential use-after-free condition in the\nxrealloc helper. Fix the warning by avoiding an implicit \"free(ptr)\"\nwhen size == 0:\n\nIn file included from help.c:12:\nIn function 'xrealloc',\n    inlined from 'add_cmdname' at help.c:24:2: subcmd-util.h:56:23: error: pointer may be used after 'realloc' [-Werror=use-after-free]\n   56 |                 ret = realloc(ptr, size);\n      |                       ^~~~~~~~~~~~~~~~~~\nsubcmd-util.h:52:21: note: call to 'realloc' here\n   52 |         void *ret = realloc(ptr, size);\n      |                     ^~~~~~~~~~~~~~~~~~\nsubcmd-util.h:58:31: error: pointer may be used after 'realloc' [-Werror=use-after-free]\n   58 |                         ret = realloc(ptr, 1);\n      |                               ^~~~~~~~~~~~~~~\nsubcmd-util.h:52:21: note: call to 'realloc' here\n   52 |         void *ret = realloc(ptr, size);\n      |                     ^~~~~~~~~~~~~~~~~~\n\nFixes: 2f4ce5ec1d447beb (\"perf tools: Finalize subcmd independence\")\nReported-by: Valdis Kl\u0113tnieks <valdis.kletnieks@vt.edu>\nSigned-off-by: Kees Kook <keescook@chromium.org>\nTested-by: Valdis Kl\u0113tnieks <valdis.kletnieks@vt.edu>\nTested-by: Justin M. Forbes <jforbes@fedoraproject.org>\nAcked-by: Josh Poimboeuf <jpoimboe@redhat.com>\nCc: linux-hardening@vger.kernel.org\nCc: Valdis Kl\u0113tnieks <valdis.kletnieks@vt.edu>\nLink: http://lore.kernel.org/lkml/20220213182443.4037039-1-keescook@chromium.org\nSigned-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>",
  "author_name": "Kees Cook",
  "author_email": "keescook@chromium.org",
  "author_date": "Sun Feb 13 10:24:43 2022 -0800",
  "author_date_iso": "2022-02-13T10:24:43-08:00",
  "committer_name": "Arnaldo Carvalho de Melo",
  "committer_email": "acme@redhat.com",
  "committer_date": "Wed Feb 16 13:49:25 2022 -0300",
  "committer_date_iso": "2022-02-16T13:49:25-03:00",
  "files_changed": [
    "tools/lib/subcmd/subcmd-util.h"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "tools/lib/subcmd/subcmd-util.h",
      "insertions": 2,
      "deletions": 9
    }
  ],
  "total_insertions": 2,
  "total_deletions": 9,
  "total_changes": 11,
  "parents": [
    "30d1c4d947983f3cfbff9cbb7a4d69b05b699678"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "hardening"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "tools/lib/subcmd/subcmd-util.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}