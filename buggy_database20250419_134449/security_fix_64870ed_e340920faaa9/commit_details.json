{
  "hash": "64870ed1b12e235cfca3f6c6da75b542c973ff78",
  "hash_short": "64870ed1",
  "subject": "x86/speculation: Fix incorrect MDS/TAA mitigation status",
  "body": "For MDS vulnerable processors with TSX support, enabling either MDS or\nTAA mitigations will enable the use of VERW to flush internal processor\nbuffers at the right code path. IOW, they are either both mitigated\nor both not. However, if the command line options are inconsistent,\nthe vulnerabilites sysfs files may not report the mitigation status\ncorrectly.\n\nFor example, with only the \"mds=off\" option:\n\n  vulnerabilities/mds:Vulnerable; SMT vulnerable\n  vulnerabilities/tsx_async_abort:Mitigation: Clear CPU buffers; SMT vulnerable\n\nThe mds vulnerabilities file has wrong status in this case. Similarly,\nthe taa vulnerability file will be wrong with mds mitigation on, but\ntaa off.\n\nChange taa_select_mitigation() to sync up the two mitigation status\nand have them turned off if both \"mds=off\" and \"tsx_async_abort=off\"\nare present.\n\nUpdate documentation to emphasize the fact that both \"mds=off\" and\n\"tsx_async_abort=off\" have to be specified together for processors that\nare affected by both TAA and MDS to be effective.\n\n [ bp: Massage and add kernel-parameters.txt change too. ]\n\nFixes: 1b42f017415b (\"x86/speculation/taa: Add mitigation for TSX Async Abort\")\nSigned-off-by: Waiman Long <longman@redhat.com>\nSigned-off-by: Borislav Petkov <bp@suse.de>\nCc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>\nCc: \"H. Peter Anvin\" <hpa@zytor.com>\nCc: Ingo Molnar <mingo@redhat.com>\nCc: Jiri Kosina <jkosina@suse.cz>\nCc: Jonathan Corbet <corbet@lwn.net>\nCc: Josh Poimboeuf <jpoimboe@redhat.com>\nCc: linux-doc@vger.kernel.org\nCc: Mark Gross <mgross@linux.intel.com>\nCc: <stable@vger.kernel.org>\nCc: Pawan Gupta <pawan.kumar.gupta@linux.intel.com>\nCc: Peter Zijlstra <peterz@infradead.org>\nCc: Thomas Gleixner <tglx@linutronix.de>\nCc: Tim Chen <tim.c.chen@linux.intel.com>\nCc: Tony Luck <tony.luck@intel.com>\nCc: Tyler Hicks <tyhicks@canonical.com>\nCc: x86-ml <x86@kernel.org>\nLink: https://lkml.kernel.org/r/20191115161445.30809-2-longman@redhat.com",
  "full_message": "x86/speculation: Fix incorrect MDS/TAA mitigation status\n\nFor MDS vulnerable processors with TSX support, enabling either MDS or\nTAA mitigations will enable the use of VERW to flush internal processor\nbuffers at the right code path. IOW, they are either both mitigated\nor both not. However, if the command line options are inconsistent,\nthe vulnerabilites sysfs files may not report the mitigation status\ncorrectly.\n\nFor example, with only the \"mds=off\" option:\n\n  vulnerabilities/mds:Vulnerable; SMT vulnerable\n  vulnerabilities/tsx_async_abort:Mitigation: Clear CPU buffers; SMT vulnerable\n\nThe mds vulnerabilities file has wrong status in this case. Similarly,\nthe taa vulnerability file will be wrong with mds mitigation on, but\ntaa off.\n\nChange taa_select_mitigation() to sync up the two mitigation status\nand have them turned off if both \"mds=off\" and \"tsx_async_abort=off\"\nare present.\n\nUpdate documentation to emphasize the fact that both \"mds=off\" and\n\"tsx_async_abort=off\" have to be specified together for processors that\nare affected by both TAA and MDS to be effective.\n\n [ bp: Massage and add kernel-parameters.txt change too. ]\n\nFixes: 1b42f017415b (\"x86/speculation/taa: Add mitigation for TSX Async Abort\")\nSigned-off-by: Waiman Long <longman@redhat.com>\nSigned-off-by: Borislav Petkov <bp@suse.de>\nCc: Greg Kroah-Hartman <gregkh@linuxfoundation.org>\nCc: \"H. Peter Anvin\" <hpa@zytor.com>\nCc: Ingo Molnar <mingo@redhat.com>\nCc: Jiri Kosina <jkosina@suse.cz>\nCc: Jonathan Corbet <corbet@lwn.net>\nCc: Josh Poimboeuf <jpoimboe@redhat.com>\nCc: linux-doc@vger.kernel.org\nCc: Mark Gross <mgross@linux.intel.com>\nCc: <stable@vger.kernel.org>\nCc: Pawan Gupta <pawan.kumar.gupta@linux.intel.com>\nCc: Peter Zijlstra <peterz@infradead.org>\nCc: Thomas Gleixner <tglx@linutronix.de>\nCc: Tim Chen <tim.c.chen@linux.intel.com>\nCc: Tony Luck <tony.luck@intel.com>\nCc: Tyler Hicks <tyhicks@canonical.com>\nCc: x86-ml <x86@kernel.org>\nLink: https://lkml.kernel.org/r/20191115161445.30809-2-longman@redhat.com",
  "author_name": "Waiman Long",
  "author_email": "longman@redhat.com",
  "author_date": "Fri Nov 15 11:14:44 2019 -0500",
  "author_date_iso": "2019-11-15T11:14:44-05:00",
  "committer_name": "Borislav Petkov",
  "committer_email": "bp@suse.de",
  "committer_date": "Sat Nov 16 13:17:49 2019 +0100",
  "committer_date_iso": "2019-11-16T13:17:49+01:00",
  "files_changed": [
    "Documentation/admin-guide/hw-vuln/mds.rst",
    "Documentation/admin-guide/hw-vuln/tsx_async_abort.rst",
    "Documentation/admin-guide/kernel-parameters.txt",
    "arch/x86/kernel/cpu/bugs.c"
  ],
  "files_changed_count": 4,
  "stats": [
    {
      "file": "Documentation/admin-guide/hw-vuln/mds.rst",
      "insertions": 5,
      "deletions": 2
    },
    {
      "file": "Documentation/admin-guide/hw-vuln/tsx_async_abort.rst",
      "insertions": 4,
      "deletions": 1
    },
    {
      "file": "Documentation/admin-guide/kernel-parameters.txt",
      "insertions": 11,
      "deletions": 0
    },
    {
      "file": "arch/x86/kernel/cpu/bugs.c",
      "insertions": 15,
      "deletions": 2
    }
  ],
  "total_insertions": 35,
  "total_deletions": 5,
  "total_changes": 40,
  "parents": [
    "eb094f06963bb0fd8134c6a9b805d4ad0002a7d4"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v5.5",
    "v5.5-rc1",
    "v5.5-rc2",
    "v5.5-rc3",
    "v5.5-rc4",
    "v5.5-rc5",
    "v5.5-rc6",
    "v5.5-rc7",
    "v5.6",
    "v5.6-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "vulnerability"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "Documentation/admin-guide/hw-vuln/mds.rst",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "Documentation/admin-guide/hw-vuln/tsx_async_abort.rst",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "Documentation/admin-guide/kernel-parameters.txt",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kernel/cpu/bugs.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}