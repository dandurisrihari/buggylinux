{
  "hash": "bbb0eada826636f658ce49290d2896aead5515f7",
  "hash_short": "bbb0eada",
  "subject": "Bluetooth: Fix incorrect SSP mode bit for non SSP devices",
  "body": "Some faulty non SSP devices send extended inquiry response\nduring device discovery which is a violation of 2.1 specification.\nSo for these devices we set SSP bit during acl connection\ninitiation thinking that it is an SSP device. But for these\ndevices, in remote host features event SSP supported bit\nwill be off. But we are not clearing the SSP bit in that case\nand eventually SSP bit in conn flag will be incorrectly set for\nthese devices.\n\nThe software which has caused this issue is MecApp\nhttp://www.mecel.se/products/bluetooth/downloads/MecApp_download\n\nThis patch does a workaround by clearing the SSP bit if it is\nnot supported in remote host features event\n\nhcidump log\n----------\n\n< HCI Command: Inquiry (0x01|0x0001) plen 5\n    lap 0x9e8b33 len 4 num 0\n> HCI Event: Command Status (0x0f) plen 4\n    Inquiry (0x01|0x0001) status 0x00 ncmd 1\n> HCI Event: Extended Inquiry Result (0x2f) plen 255\n    bdaddr 00:1B:DC:05:B5:25 mode 1 clkoffset 0x3263 class 0x3c0000 rssi -77\n    Unknown type 0x42 with 8 bytes data\n    Unknown type 0x1e with 2 bytes data\n> HCI Event: Inquiry Complete (0x01) plen 1\n    status 0x00\n\n< HCI Command: Create Connection (0x01|0x0005) plen 13\n    bdaddr 00:1B:DC:05:B5:25 ptype 0xcc18 rswitch 0x01 clkoffset 0x0000\n    Packet type: DM1 DM3 DM5 DH1 DH3 DH5\n> HCI Event: Command Status (0x0f) plen 4\n    Create Connection (0x01|0x0005) status 0x00 ncmd 1\n> HCI Event: Connect Complete (0x03) plen 11\n    status 0x00 handle 12 bdaddr 00:1B:DC:05:B5:25 type ACL encrypt 0x00\n< HCI Command: Read Remote Supported Features (0x01|0x001b) plen 2\n    handle 12\n> HCI Event: Command Status (0x0f) plen 4\n    Read Remote Supported Features (0x01|0x001b) status 0x00 ncmd 1\n> HCI Event: Read Remote Supported Features (0x0b) plen 11\n    status 0x00 handle 12\n    Features: 0xff 0xff 0x8f 0x7e 0xd8 0x1f 0x5b 0x87\n< HCI Command: Read Remote Extended Features (0x01|0x001c) plen 3\n    handle 12 page 1\n> HCI Event: Command Status (0x0f) plen 4\n    Read Remote Extended Features (0x01|0x001c) status 0x00 ncmd 1\n> HCI Event: Page Scan Repetition Mode Change (0x20) plen 7\n    bdaddr 00:1B:DC:05:B5:25 mode 1\n> HCI Event: Max Slots Change (0x1b) plen 3\n    handle 12 slots 5\n> HCI Event: Read Remote Extended Features (0x23) plen 13\n    status 0x00 handle 12 page 1 max 0\n    Features: 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n< HCI Command: Remote Name Request (0x01|0x0019) plen 10\n    bdaddr 00:1B:DC:05:B5:25 mode 2 clkoffset 0x0000\n> HCI Event: Command Status (0x0f) plen 4\n    Remote Name Request (0x01|0x0019) status 0x00 ncmd 1\n> HCI Event: Remote Name Req Complete (0x07) plen 255\n    status 0x00 bdaddr 00:1B:DC:05:B5:25 name 'Bluetooth PTS Radio v4'\n< HCI Command: Authentication Requested (0x01|0x0011) plen 2\n    handle 12\n> HCI Event: Command Status (0x0f) plen 4\n    Authentication Requested (0x01|0x0011) status 0x00 ncmd 1\n> HCI Event: Link Key Request (0x17) plen 6\n    bdaddr 00:1B:DC:05:B5:25\n< HCI Command: Link Key Request Negative Reply (0x01|0x000c) plen 6\n    bdaddr 00:1B:DC:05:B5:25\n> HCI Event: Command Complete (0x0e) plen 10\n    Link Key Request Negative Reply (0x01|0x000c) ncmd 1\n    status 0x00 bdaddr 00:1B:DC:05:B5:25\n> HCI Event: PIN Code Request (0x16) plen 6\n    bdaddr 00:1B:DC:05:B5:25\n\nSigned-off-by: Jaganath Kanakkassery <jaganath.k@samsung.com>\nSigned-off-by: Gustavo Padovan <gustavo.padovan@collabora.co.uk>",
  "full_message": "Bluetooth: Fix incorrect SSP mode bit for non SSP devices\n\nSome faulty non SSP devices send extended inquiry response\nduring device discovery which is a violation of 2.1 specification.\nSo for these devices we set SSP bit during acl connection\ninitiation thinking that it is an SSP device. But for these\ndevices, in remote host features event SSP supported bit\nwill be off. But we are not clearing the SSP bit in that case\nand eventually SSP bit in conn flag will be incorrectly set for\nthese devices.\n\nThe software which has caused this issue is MecApp\nhttp://www.mecel.se/products/bluetooth/downloads/MecApp_download\n\nThis patch does a workaround by clearing the SSP bit if it is\nnot supported in remote host features event\n\nhcidump log\n----------\n\n< HCI Command: Inquiry (0x01|0x0001) plen 5\n    lap 0x9e8b33 len 4 num 0\n> HCI Event: Command Status (0x0f) plen 4\n    Inquiry (0x01|0x0001) status 0x00 ncmd 1\n> HCI Event: Extended Inquiry Result (0x2f) plen 255\n    bdaddr 00:1B:DC:05:B5:25 mode 1 clkoffset 0x3263 class 0x3c0000 rssi -77\n    Unknown type 0x42 with 8 bytes data\n    Unknown type 0x1e with 2 bytes data\n> HCI Event: Inquiry Complete (0x01) plen 1\n    status 0x00\n\n< HCI Command: Create Connection (0x01|0x0005) plen 13\n    bdaddr 00:1B:DC:05:B5:25 ptype 0xcc18 rswitch 0x01 clkoffset 0x0000\n    Packet type: DM1 DM3 DM5 DH1 DH3 DH5\n> HCI Event: Command Status (0x0f) plen 4\n    Create Connection (0x01|0x0005) status 0x00 ncmd 1\n> HCI Event: Connect Complete (0x03) plen 11\n    status 0x00 handle 12 bdaddr 00:1B:DC:05:B5:25 type ACL encrypt 0x00\n< HCI Command: Read Remote Supported Features (0x01|0x001b) plen 2\n    handle 12\n> HCI Event: Command Status (0x0f) plen 4\n    Read Remote Supported Features (0x01|0x001b) status 0x00 ncmd 1\n> HCI Event: Read Remote Supported Features (0x0b) plen 11\n    status 0x00 handle 12\n    Features: 0xff 0xff 0x8f 0x7e 0xd8 0x1f 0x5b 0x87\n< HCI Command: Read Remote Extended Features (0x01|0x001c) plen 3\n    handle 12 page 1\n> HCI Event: Command Status (0x0f) plen 4\n    Read Remote Extended Features (0x01|0x001c) status 0x00 ncmd 1\n> HCI Event: Page Scan Repetition Mode Change (0x20) plen 7\n    bdaddr 00:1B:DC:05:B5:25 mode 1\n> HCI Event: Max Slots Change (0x1b) plen 3\n    handle 12 slots 5\n> HCI Event: Read Remote Extended Features (0x23) plen 13\n    status 0x00 handle 12 page 1 max 0\n    Features: 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n< HCI Command: Remote Name Request (0x01|0x0019) plen 10\n    bdaddr 00:1B:DC:05:B5:25 mode 2 clkoffset 0x0000\n> HCI Event: Command Status (0x0f) plen 4\n    Remote Name Request (0x01|0x0019) status 0x00 ncmd 1\n> HCI Event: Remote Name Req Complete (0x07) plen 255\n    status 0x00 bdaddr 00:1B:DC:05:B5:25 name 'Bluetooth PTS Radio v4'\n< HCI Command: Authentication Requested (0x01|0x0011) plen 2\n    handle 12\n> HCI Event: Command Status (0x0f) plen 4\n    Authentication Requested (0x01|0x0011) status 0x00 ncmd 1\n> HCI Event: Link Key Request (0x17) plen 6\n    bdaddr 00:1B:DC:05:B5:25\n< HCI Command: Link Key Request Negative Reply (0x01|0x000c) plen 6\n    bdaddr 00:1B:DC:05:B5:25\n> HCI Event: Command Complete (0x0e) plen 10\n    Link Key Request Negative Reply (0x01|0x000c) ncmd 1\n    status 0x00 bdaddr 00:1B:DC:05:B5:25\n> HCI Event: PIN Code Request (0x16) plen 6\n    bdaddr 00:1B:DC:05:B5:25\n\nSigned-off-by: Jaganath Kanakkassery <jaganath.k@samsung.com>\nSigned-off-by: Gustavo Padovan <gustavo.padovan@collabora.co.uk>",
  "author_name": "Jaganath Kanakkassery",
  "author_email": "jaganath.k@samsung.com",
  "author_date": "Tue Apr 16 20:16:30 2013 +0530",
  "author_date_iso": "2013-04-16T20:16:30+05:30",
  "committer_name": "Gustavo Padovan",
  "committer_email": "gustavo.padovan@collabora.co.uk",
  "committer_date": "Thu Apr 18 00:08:55 2013 -0300",
  "committer_date_iso": "2013-04-18T00:08:55-03:00",
  "files_changed": [
    "net/bluetooth/hci_event.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "net/bluetooth/hci_event.c",
      "insertions": 12,
      "deletions": 1
    }
  ],
  "total_insertions": 12,
  "total_deletions": 1,
  "total_changes": 13,
  "parents": [
    "e73dcfbf061b524fe9aaef56cf3c2e234a45ec19"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v3.10",
    "v3.10-rc1",
    "v3.10-rc2",
    "v3.10-rc3",
    "v3.10-rc4",
    "v3.10-rc5",
    "v3.10-rc6",
    "v3.10-rc7",
    "v3.11",
    "v3.11-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "Authentication"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "net/bluetooth/hci_event.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}