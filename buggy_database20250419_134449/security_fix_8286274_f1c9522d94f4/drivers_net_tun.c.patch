commit 8286274284e15b11b0f531b6ceeef21fbe00a8dd
Author: Herbert Xu <herbert@gondor.apana.org.au>
Date:   Mon May 24 00:14:10 2010 -0700

    tun: Update classid on packet injection
    
    This patch makes tun update its socket classid every time we
    inject a packet into the network stack.  This is so that any
    updates made by the admin to the process writing packets to
    tun is effected.
    
    Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
    Signed-off-by: David S. Miller <davem@davemloft.net>

diff --git a/drivers/net/tun.c b/drivers/net/tun.c
index 97b25533e5fb..8793c2bf7f15 100644
--- a/drivers/net/tun.c
+++ b/drivers/net/tun.c
@@ -526,6 +526,8 @@ static inline struct sk_buff *tun_alloc_skb(struct tun_struct *tun,
 	struct sk_buff *skb;
 	int err;
 
+	sock_update_classid(sk);
+
 	/* Under a page?  Don't bother with paged skb. */
 	if (prepad + len < PAGE_SIZE || !linear)
 		linear = len;