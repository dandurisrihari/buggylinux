{
  "hash": "9899e4d3523faaef17c67141aa80ff2088f17871",
  "hash_short": "9899e4d3",
  "subject": "scsi: 3w-xxxx: fix a missing-check bug",
  "body": "In tw_chrdev_ioctl(), the length of the data buffer is firstly copied\nfrom the userspace pointer 'argp' and saved to the kernel object\n'data_buffer_length'. Then a security check is performed on it to make\nsure that the length is not more than 'TW_MAX_IOCTL_SECTORS *\n512'. Otherwise, an error code -EINVAL is returned. If the security\ncheck is passed, the entire ioctl command is copied again from the\n'argp' pointer and saved to the kernel object 'tw_ioctl'. Then, various\noperations are performed on 'tw_ioctl' according to the 'cmd'. Given\nthat the 'argp' pointer resides in userspace, a malicious userspace\nprocess can race to change the buffer length between the two\ncopies. This way, the user can bypass the security check and inject\ninvalid data buffer length. This can cause potential security issues in\nthe following execution.\n\nThis patch checks for capable(CAP_SYS_ADMIN) in tw_chrdev_open() to\navoid the above issues.\n\nSigned-off-by: Wenwen Wang <wang6495@umn.edu>\nAcked-by: Adam Radford <aradford@gmail.com>\nSigned-off-by: Martin K. Petersen <martin.petersen@oracle.com>",
  "full_message": "scsi: 3w-xxxx: fix a missing-check bug\n\nIn tw_chrdev_ioctl(), the length of the data buffer is firstly copied\nfrom the userspace pointer 'argp' and saved to the kernel object\n'data_buffer_length'. Then a security check is performed on it to make\nsure that the length is not more than 'TW_MAX_IOCTL_SECTORS *\n512'. Otherwise, an error code -EINVAL is returned. If the security\ncheck is passed, the entire ioctl command is copied again from the\n'argp' pointer and saved to the kernel object 'tw_ioctl'. Then, various\noperations are performed on 'tw_ioctl' according to the 'cmd'. Given\nthat the 'argp' pointer resides in userspace, a malicious userspace\nprocess can race to change the buffer length between the two\ncopies. This way, the user can bypass the security check and inject\ninvalid data buffer length. This can cause potential security issues in\nthe following execution.\n\nThis patch checks for capable(CAP_SYS_ADMIN) in tw_chrdev_open() to\navoid the above issues.\n\nSigned-off-by: Wenwen Wang <wang6495@umn.edu>\nAcked-by: Adam Radford <aradford@gmail.com>\nSigned-off-by: Martin K. Petersen <martin.petersen@oracle.com>",
  "author_name": "Wenwen Wang",
  "author_email": "wang6495@umn.edu",
  "author_date": "Mon May 7 19:54:01 2018 -0500",
  "author_date_iso": "2018-05-07T19:54:01-05:00",
  "committer_name": "Martin K. Petersen",
  "committer_email": "martin.petersen@oracle.com",
  "committer_date": "Tue May 8 01:32:43 2018 -0400",
  "committer_date_iso": "2018-05-08T01:32:43-04:00",
  "files_changed": [
    "drivers/scsi/3w-xxxx.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/scsi/3w-xxxx.c",
      "insertions": 3,
      "deletions": 0
    }
  ],
  "total_insertions": 3,
  "total_deletions": 0,
  "total_changes": 3,
  "parents": [
    "c9318a3e0218bc9dacc25be46b9eec363259536f"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.18",
    "v4.18-rc1",
    "v4.18-rc2",
    "v4.18-rc3",
    "v4.18-rc4",
    "v4.18-rc5",
    "v4.18-rc6",
    "v4.18-rc7",
    "v4.18-rc8",
    "v4.19"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "inject",
      "bypass"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/scsi/3w-xxxx.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}