Commit Hash: 74e7e1efdad45580cc3839f2a155174cf158f9b5
Subject: xen/netback: don't call kfree_skb() with interrupts disabled

CVE Identifiers:
- CVE-2022-42328
- CVE-2022-42329

Full commit message:
xen/netback: don't call kfree_skb() with interrupts disabled

It is not allowed to call kfree_skb() from hardware interrupt
context or with interrupts being disabled. So remove kfree_skb()
from the spin_lock_irqsave() section and use the already existing
"drop" label in xenvif_start_xmit() for dropping the SKB. At the
same time replace the dev_kfree_skb() call there with a call of
dev_kfree_skb_any(), as xenvif_start_xmit() can be called with
disabled interrupts.

This is XSA-424 / CVE-2022-42328 / CVE-2022-42329.

Fixes: be81992f9086 ("xen/netback: don't queue unlimited number of packages")
Reported-by: Yang Yingliang <yangyingliang@huawei.com>
Signed-off-by: Juergen Gross <jgross@suse.com>
Reviewed-by: Jan Beulich <jbeulich@suse.com>
Signed-off-by: Juergen Gross <jgross@suse.com>

Metadata:
Author: Juergen Gross <jgross@suse.com>
Author Date: Tue Dec 6 08:54:24 2022 +0100
Committer: Juergen Gross <jgross@suse.com>
Commit Date: Tue Dec 6 16:00:33 2022 +0100

Files Changed: 3
Lines Added: 10
Lines Removed: 6
Total Changes: 16
