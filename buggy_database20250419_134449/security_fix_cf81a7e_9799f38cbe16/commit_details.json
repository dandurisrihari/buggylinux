{
  "hash": "cf81a7e580ac0d598d3e7e9c06864168b2b4073d",
  "hash_short": "cf81a7e5",
  "subject": "KVM: vmx: remove save/restore of host BNDCGFS MSR",
  "body": "Linux does not support Memory Protection Extensions (MPX) in the\nkernel itself, thus the BNDCFGS (Bound Config Supervisor) MSR will\nalways be zero in the KVM host, i.e. RDMSR in vmx_save_host_state()\nis superfluous.  KVM unconditionally sets VM_EXIT_CLEAR_BNDCFGS,\ni.e. BNDCFGS will always be zero after VMEXIT, thus manually loading\nBNDCFGS is also superfluous.\n\nAnd in the event the MPX kernel support is added (unlikely given\nthat MPX for userspace is in its death throes[1]), BNDCFGS will\nlikely be common across all CPUs[2], and at the least shouldn't\nchange on a regular basis, i.e. saving the MSR on every VMENTRY is\ncompletely unnecessary.\n\nWARN_ONCE in hardware_setup() if the host's BNDCFGS is non-zero to\ndocument that KVM does not preserve BNDCFGS and to serve as a hint\nas to how BNDCFGS likely should be handled if MPX is used in the\nkernel, e.g. BNDCFGS should be saved once during KVM setup.\n\n[1] https://lkml.org/lkml/2018/4/27/1046\n[2] http://www.openwall.com/lists/kernel-hardening/2017/07/24/28\n\nSigned-off-by: Sean Christopherson <sean.j.christopherson@intel.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "full_message": "KVM: vmx: remove save/restore of host BNDCGFS MSR\n\nLinux does not support Memory Protection Extensions (MPX) in the\nkernel itself, thus the BNDCFGS (Bound Config Supervisor) MSR will\nalways be zero in the KVM host, i.e. RDMSR in vmx_save_host_state()\nis superfluous.  KVM unconditionally sets VM_EXIT_CLEAR_BNDCFGS,\ni.e. BNDCFGS will always be zero after VMEXIT, thus manually loading\nBNDCFGS is also superfluous.\n\nAnd in the event the MPX kernel support is added (unlikely given\nthat MPX for userspace is in its death throes[1]), BNDCFGS will\nlikely be common across all CPUs[2], and at the least shouldn't\nchange on a regular basis, i.e. saving the MSR on every VMENTRY is\ncompletely unnecessary.\n\nWARN_ONCE in hardware_setup() if the host's BNDCFGS is non-zero to\ndocument that KVM does not preserve BNDCFGS and to serve as a hint\nas to how BNDCFGS likely should be handled if MPX is used in the\nkernel, e.g. BNDCFGS should be saved once during KVM setup.\n\n[1] https://lkml.org/lkml/2018/4/27/1046\n[2] http://www.openwall.com/lists/kernel-hardening/2017/07/24/28\n\nSigned-off-by: Sean Christopherson <sean.j.christopherson@intel.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "author_name": "Sean Christopherson",
  "author_email": "sean.j.christopherson@intel.com",
  "author_date": "Wed Jul 11 09:54:30 2018 -0700",
  "author_date_iso": "2018-07-11T09:54:30-07:00",
  "committer_name": "Paolo Bonzini",
  "committer_email": "pbonzini@redhat.com",
  "committer_date": "Mon Aug 6 17:32:00 2018 +0200",
  "committer_date_iso": "2018-08-06T17:32:00+02:00",
  "files_changed": [
    "arch/x86/kvm/vmx.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "arch/x86/kvm/vmx.c",
      "insertions": 6,
      "deletions": 5
    }
  ],
  "total_insertions": 6,
  "total_deletions": 5,
  "total_changes": 11,
  "parents": [
    "86dafed50e2b9b18198cc663775ece819ff113ba"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.19",
    "v4.19-rc1",
    "v4.19-rc2",
    "v4.19-rc3",
    "v4.19-rc4",
    "v4.19-rc5",
    "v4.19-rc6",
    "v4.19-rc7",
    "v4.19-rc8",
    "v4.20"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "hardening"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/x86/kvm/vmx.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}