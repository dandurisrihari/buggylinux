Commit Hash: d9f89b4e9290e46cd9b273e9ad0bff0f93e86fae
Subject: KVM: arm/arm64: PMU: Fix overflow interrupt injection


Security Keywords:
- injection

Full commit message:
KVM: arm/arm64: PMU: Fix overflow interrupt injection

kvm_pmu_overflow_set() is called from perf's interrupt handler,
making the call of kvm_vgic_inject_irq() from it introduced with
"KVM: arm/arm64: PMU: remove request-less vcpu kick" a really bad
idea, as it's quite easy to try and retake a lock that the
interrupted context is already holding. The fix is to use a vcpu
kick, leaving the interrupt injection to kvm_pmu_sync_hwstate(),
like it was doing before the refactoring. We don't just revert,
though, because before the kick was request-less, leaving the vcpu
exposed to the request-less vcpu kick race, and also because the
kick was used unnecessarily from register access handlers.

Reviewed-by: Christoffer Dall <cdall@linaro.org>
Signed-off-by: Andrew Jones <drjones@redhat.com>
Signed-off-by: Marc Zyngier <marc.zyngier@arm.com>

Metadata:
Author: Andrew Jones <drjones@redhat.com>
Author Date: Sat Jul 1 18:26:54 2017 +0200
Committer: Marc Zyngier <marc.zyngier@arm.com>
Commit Date: Tue Jul 25 14:18:01 2017 +0100

Files Changed: 3
Lines Added: 16
Lines Removed: 31
Total Changes: 47
