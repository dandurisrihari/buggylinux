Commit Hash: db599f9ed9bd31b018b6c48ad7c6b21d5b790ecf
Subject: block, bfq: fix rq_in_driver check in bfq_update_inject_limit


Security Keywords:
- injection

Full commit message:
block, bfq: fix rq_in_driver check in bfq_update_inject_limit

One of the cases where the parameters for injection may be updated is
when there are no more in-flight I/O requests. The number of in-flight
requests is stored in the field bfqd->rq_in_driver of the descriptor
bfqd of the device. So, the controlled condition is
bfqd->rq_in_driver == 0.

Unfortunately, this is wrong because, the instruction that checks this
condition is in the code path that handles the completion of a
request, and, in particular, the instruction is executed before
bfqd->rq_in_driver is decremented in such a code path.

This commit fixes this issue by just replacing 0 with 1 in the
comparison.

Reported-by: Srivatsa S. Bhat (VMware) <srivatsa@csail.mit.edu>
Tested-by: Srivatsa S. Bhat (VMware) <srivatsa@csail.mit.edu>
Signed-off-by: Paolo Valente <paolo.valente@linaro.org>
Signed-off-by: Jens Axboe <axboe@kernel.dk>

Metadata:
Author: Paolo Valente <paolo.valente@linaro.org>
Author Date: Tue Jun 25 07:12:44 2019 +0200
Committer: Jens Axboe <axboe@kernel.dk>
Commit Date: Tue Jun 25 09:07:34 2019 -0600

Files Changed: 1
Lines Added: 7
Lines Removed: 1
Total Changes: 8
