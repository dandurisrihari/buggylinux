Commit Hash: 31e83e21cf00fe5b669eb352ff3ed70e74b40fad
Subject: KVM: x86: compile out vendor-specific code if SMM is disabled


Security Keywords:
- injection

Full commit message:
KVM: x86: compile out vendor-specific code if SMM is disabled

Vendor-specific code that deals with SMI injection and saving/restoring
SMM state is not needed if CONFIG_KVM_SMM is disabled, so remove the
four callbacks smi_allowed, enter_smm, leave_smm and enable_smi_window.
The users in svm/nested.c and x86.c also have to be compiled out; the
amount of #ifdef'ed code is small and it's not worth moving it to
smm.c.

enter_smm is now used only within #ifdef CONFIG_KVM_SMM, and the stub
can therefore be removed.

Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
Reviewed-by: Maxim Levitsky <mlevitsk@redhat.com>
Message-Id: <20220929172016.319443-7-pbonzini@redhat.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

Metadata:
Author: Paolo Bonzini <pbonzini@redhat.com>
Author Date: Thu Sep 29 13:20:14 2022 -0400
Committer: Paolo Bonzini <pbonzini@redhat.com>
Commit Date: Wed Nov 9 12:31:19 2022 -0500

Files Changed: 7
Lines Added: 18
Lines Removed: 1
Total Changes: 19
