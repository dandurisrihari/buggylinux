commit 7a09e8d92c6d56121910ccb2e8bc0d1affff66ee
Author: Quinn Tran <qutran@marvell.com>
Date:   Wed Jun 23 22:26:03 2021 -0700

    scsi: qla2xxx: edif: Add doorbell notification for app
    
    Some FC adapters from Marvell offer the ability to encrypt data in flight
    (EDIF). This feature requires an application to act as an authenticator.
    
    During runtime, driver and authentication application need to stay in sync
    in terms of: Session being down|up, arrival of new authentication
    message (AUTH ELS) and SADB update completion.
    
    These events are queued up as doorbell to the authentication
    application. Application would read this doorbell on regular basis to stay
    up to date. Each SCSI host would have a separate doorbell queue.
    
    The doorbell interface can daisy chain a list of events for each read. Each
    event contains an event code + hint to help application steer the next
    course of action.
    
    Link: https://lore.kernel.org/r/20210624052606.21613-9-njavali@marvell.com
    Reviewed-by: Hannes Reinecke <hare@suse.de>
    Reviewed-by: Himanshu Madhani <himanshu.madhani@oracle.com>
    Co-developed-by: Larry Wisneski <Larry.Wisneski@marvell.com>
    Signed-off-by: Larry Wisneski <Larry.Wisneski@marvell.com>
    Co-developed-by: Duane Grigsby <duane.grigsby@marvell.com>
    Signed-off-by: Duane Grigsby <duane.grigsby@marvell.com>
    Co-developed-by: Rick Hicksted Jr <rhicksted@marvell.com>
    Signed-off-by: Rick Hicksted Jr <rhicksted@marvell.com>
    Signed-off-by: Quinn Tran <qutran@marvell.com>
    Signed-off-by: Nilesh Javali <njavali@marvell.com>
    Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>

diff --git a/drivers/scsi/qla2xxx/qla_target.c b/drivers/scsi/qla2xxx/qla_target.c
index c7e12715186e..77b54e9ac0a1 100644
--- a/drivers/scsi/qla2xxx/qla_target.c
+++ b/drivers/scsi/qla2xxx/qla_target.c
@@ -585,6 +585,8 @@ static void qla2x00_async_nack_sp_done(srb_t *sp, int res)
 			    DSC_LOGIN_AUTH_PEND);
 			qla2x00_post_aen_work(vha, FCH_EVT_PORT_ONLINE,
 			    sp->fcport->d_id.b24);
+			qla_edb_eventcreate(vha, VND_CMD_AUTH_STATE_NEEDED, sp->fcport->d_id.b24,
+			    0, sp->fcport);
 		}
 		break;