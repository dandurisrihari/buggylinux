{
  "hash": "cd5297b0855f17c8b4e3ef1d20c6a3656209c7b3",
  "hash_short": "cd5297b0",
  "subject": "drm/etnaviv: Use FOLL_FORCE for userptr",
  "body": "Nothing checks userptr.ro except this call to pup_fast, which means\nthere's nothing actually preventing userspace from writing to this.\nWhich means you can just read-only mmap any file you want, userptr it\nand then write to it with the gpu. Not good.\n\nThe right way to handle this is FOLL_WRITE | FOLL_FORCE, which will\nbreak any COW mappings and update tracking for MAY_WRITE mappings so\nthere's no exploit and the vm isn't confused about what's going on.\nFor any legit use case there's no difference from what userspace can\nobserve and do.\n\nReviewed-by: Lucas Stach <l.stach@pengutronix.de>\nCc: stable@vger.kernel.org\nCc: John Hubbard <jhubbard@nvidia.com>\nSigned-off-by: Daniel Vetter <daniel.vetter@intel.com>\nCc: Lucas Stach <l.stach@pengutronix.de>\nCc: Russell King <linux+etnaviv@armlinux.org.uk>\nCc: Christian Gmeiner <christian.gmeiner@gmail.com>\nCc: etnaviv@lists.freedesktop.org\nLink: https://patchwork.freedesktop.org/patch/msgid/20210301095254.1946084-1-daniel.vetter@ffwll.ch",
  "full_message": "drm/etnaviv: Use FOLL_FORCE for userptr\n\nNothing checks userptr.ro except this call to pup_fast, which means\nthere's nothing actually preventing userspace from writing to this.\nWhich means you can just read-only mmap any file you want, userptr it\nand then write to it with the gpu. Not good.\n\nThe right way to handle this is FOLL_WRITE | FOLL_FORCE, which will\nbreak any COW mappings and update tracking for MAY_WRITE mappings so\nthere's no exploit and the vm isn't confused about what's going on.\nFor any legit use case there's no difference from what userspace can\nobserve and do.\n\nReviewed-by: Lucas Stach <l.stach@pengutronix.de>\nCc: stable@vger.kernel.org\nCc: John Hubbard <jhubbard@nvidia.com>\nSigned-off-by: Daniel Vetter <daniel.vetter@intel.com>\nCc: Lucas Stach <l.stach@pengutronix.de>\nCc: Russell King <linux+etnaviv@armlinux.org.uk>\nCc: Christian Gmeiner <christian.gmeiner@gmail.com>\nCc: etnaviv@lists.freedesktop.org\nLink: https://patchwork.freedesktop.org/patch/msgid/20210301095254.1946084-1-daniel.vetter@ffwll.ch",
  "author_name": "Daniel Vetter",
  "author_email": "daniel.vetter@ffwll.ch",
  "author_date": "Mon Mar 1 10:52:53 2021 +0100",
  "author_date_iso": "2021-03-01T10:52:53+01:00",
  "committer_name": "Daniel Vetter",
  "committer_email": "daniel.vetter@ffwll.ch",
  "committer_date": "Fri Mar 19 20:15:27 2021 +0100",
  "committer_date_iso": "2021-03-19T20:15:27+01:00",
  "files_changed": [
    "drivers/gpu/drm/etnaviv/etnaviv_gem.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/gpu/drm/etnaviv/etnaviv_gem.c",
      "insertions": 1,
      "deletions": 1
    }
  ],
  "total_insertions": 1,
  "total_deletions": 1,
  "total_changes": 2,
  "parents": [
    "6909115442759efef3d4bc5d9c54d7943f1afc14"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "exploit"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/gpu/drm/etnaviv/etnaviv_gem.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}