Commit Hash: cc3d967f7e32ceeb9b78dc962126ebcf1a2b24b2
Subject: KVM: SVM: detect opening of SMI window using STGI intercept


Security Keywords:
- injection

Full commit message:
KVM: SVM: detect opening of SMI window using STGI intercept

Commit 05cade71cf3b ("KVM: nSVM: fix SMI injection in guest mode") made
KVM mask SMI if GIF=0 but it didn't do anything to unmask it when GIF is
enabled.

The issue manifests for me as a significantly longer boot time of Windows
guests when running with SMM-enabled OVMF.

This commit fixes it by intercepting STGI instead of requesting immediate
exit if the reason why SMM was masked is GIF.

Fixes: 05cade71cf3b ("KVM: nSVM: fix SMI injection in guest mode")
Signed-off-by: Ladi Prosek <lprosek@redhat.com>
Signed-off-by: Radim Krčmář <rkrcmar@redhat.com>

Metadata:
Author: Ladi Prosek <lprosek@redhat.com>
Author Date: Tue Oct 17 16:02:39 2017 +0200
Committer: Radim Krčmář <rkrcmar@redhat.com>
Commit Date: Wed Oct 18 21:21:22 2017 +0200

Files Changed: 4
Lines Added: 36
Lines Removed: 9
Total Changes: 45
