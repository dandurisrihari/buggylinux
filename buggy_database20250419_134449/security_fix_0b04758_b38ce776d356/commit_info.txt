Commit Hash: 0b04758b002bde9434053be2fff8064ac3d9d8bb
Subject: irqchip/gic-v3: Use SGIs without active state if offered


Security Keywords:
- injection

Full commit message:
irqchip/gic-v3: Use SGIs without active state if offered

To allow the direct injection of SGIs into a guest, the GICv4.1
architecture has to sacrifice the Active state so that SGIs look
a lot like LPIs (they are injected by the same mechanism).

In order not to break existing software, the architecture gives
offers guests OSs the choice: SGIs with or without an active
state. It is the hypervisors duty to honor the guest's choice.

For this, the architecture offers a discovery bit indicating whether
the GIC supports GICv4.1 SGIs (GICD_TYPER2.nASSGIcap), and another
bit indicating whether the guest wants Active-less SGIs or not
(controlled by GICD_CTLR.nASSGIreq).

A hypervisor not supporting GICv4.1 SGIs would leave nASSGIcap
clear, and a guest not knowing about GICv4.1 SGIs (or definitely
wanting an Active state) would leave nASSGIreq clear (both being
thankfully backward compatible with older revisions of the GIC).

Since Linux is perfectly happy without an active state on SGIs,
inform the hypervisor that we'll use that if offered.

Signed-off-by: Marc Zyngier <maz@kernel.org>
Reviewed-by: Zenghui Yu <yuzenghui@huawei.com>
Link: https://lore.kernel.org/r/20200304203330.4967-2-maz@kernel.org

Metadata:
Author: Marc Zyngier <maz@kernel.org>
Author Date: Wed Mar 4 20:33:08 2020 +0000
Committer: Marc Zyngier <maz@kernel.org>
Commit Date: Thu Mar 19 11:11:21 2020 +0000

Files Changed: 2
Lines Added: 10
Lines Removed: 2
Total Changes: 12
