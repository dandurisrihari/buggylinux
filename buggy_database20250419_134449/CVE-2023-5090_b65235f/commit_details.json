{
  "hash": "b65235f6e102354ccafda601eaa1c5bef5284d21",
  "hash_short": "b65235f6",
  "subject": "x86: KVM: SVM: always update the x2avic msr interception",
  "body": "The following problem exists since x2avic was enabled in the KVM:\n\nsvm_set_x2apic_msr_interception is called to enable the interception of\nthe x2apic msrs.\n\nIn particular it is called at the moment the guest resets its apic.\n\nAssuming that the guest's apic was in x2apic mode, the reset will bring\nit back to the xapic mode.\n\nThe svm_set_x2apic_msr_interception however has an erroneous check for\n'!apic_x2apic_mode()' which prevents it from doing anything in this case.\n\nAs a result of this, all x2apic msrs are left unintercepted, and that\nexposes the bare metal x2apic (if enabled) to the guest.\nOops.\n\nRemove the erroneous '!apic_x2apic_mode()' check to fix that.\n\nThis fixes CVE-2023-5090\n\nFixes: 4d1d7942e36a (\"KVM: SVM: Introduce logic to (de)activate x2AVIC mode\")\nCc: stable@vger.kernel.org\nSigned-off-by: Maxim Levitsky <mlevitsk@redhat.com>\nReviewed-by: Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>\nTested-by: Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>\nReviewed-by: Sean Christopherson <seanjc@google.com>\nMessage-Id: <20230928173354.217464-2-mlevitsk@redhat.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "full_message": "x86: KVM: SVM: always update the x2avic msr interception\n\nThe following problem exists since x2avic was enabled in the KVM:\n\nsvm_set_x2apic_msr_interception is called to enable the interception of\nthe x2apic msrs.\n\nIn particular it is called at the moment the guest resets its apic.\n\nAssuming that the guest's apic was in x2apic mode, the reset will bring\nit back to the xapic mode.\n\nThe svm_set_x2apic_msr_interception however has an erroneous check for\n'!apic_x2apic_mode()' which prevents it from doing anything in this case.\n\nAs a result of this, all x2apic msrs are left unintercepted, and that\nexposes the bare metal x2apic (if enabled) to the guest.\nOops.\n\nRemove the erroneous '!apic_x2apic_mode()' check to fix that.\n\nThis fixes CVE-2023-5090\n\nFixes: 4d1d7942e36a (\"KVM: SVM: Introduce logic to (de)activate x2AVIC mode\")\nCc: stable@vger.kernel.org\nSigned-off-by: Maxim Levitsky <mlevitsk@redhat.com>\nReviewed-by: Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>\nTested-by: Suravee Suthikulpanit <suravee.suthikulpanit@amd.com>\nReviewed-by: Sean Christopherson <seanjc@google.com>\nMessage-Id: <20230928173354.217464-2-mlevitsk@redhat.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "author_name": "Maxim Levitsky",
  "author_email": "mlevitsk@redhat.com",
  "author_date": "Thu Sep 28 20:33:51 2023 +0300",
  "author_date_iso": "2023-09-28T20:33:51+03:00",
  "committer_name": "Paolo Bonzini",
  "committer_email": "pbonzini@redhat.com",
  "committer_date": "Thu Oct 12 11:08:59 2023 -0400",
  "committer_date_iso": "2023-10-12T11:08:59-04:00",
  "files_changed": [
    "arch/x86/kvm/svm/svm.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "arch/x86/kvm/svm/svm.c",
      "insertions": 1,
      "deletions": 2
    }
  ],
  "total_insertions": 1,
  "total_deletions": 2,
  "total_changes": 3,
  "parents": [
    "87e3ca055cdc6c63fb82b9bec7c370405d03f6ef"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [
      "CVE-2023-5090"
    ],
    "security_keywords": []
  },
  "fix_type": "cve",
  "file_results": [
    {
      "file": "arch/x86/kvm/svm/svm.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}