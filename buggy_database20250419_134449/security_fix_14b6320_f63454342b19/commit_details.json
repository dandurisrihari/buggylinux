{
  "hash": "14b6320953a3f856a3f93bf9a0e423395baa593d",
  "hash_short": "14b63209",
  "subject": "Merge tag 'for-linus' of git://git.kernel.org/pub/scm/virt/kvm/kvm",
  "body": "Pull kvm fixes from Paolo Bonzini:\n \"x86 and selftests fixes.\n\n  x86:\n\n   - When emulating a guest TLB flush for a nested guest, flush vpid01,\n     not vpid02, if L2 is active but VPID is disabled in vmcs12, i.e. if\n     L2 and L1 are sharing VPID '0' (from L1's perspective).\n\n   - Fix a bug in the SNP initialization flow where KVM would return '0'\n     to userspace instead of -errno on failure.\n\n   - Move the Intel PT virtualization (i.e. outputting host trace to\n     host buffer and guest trace to guest buffer) behind CONFIG_BROKEN.\n\n   - Fix memory leak on failure of KVM_SEV_SNP_LAUNCH_START\n\n   - Fix a bug where KVM fails to inject an interrupt from the IRR after\n     KVM_SET_LAPIC.\n\n  Selftests:\n\n   - Increase the timeout for the memslot performance selftest to avoid\n     false failures on arm64 and nested x86 platforms.\n\n   - Fix a goof in the guest_memfd selftest where a for-loop initialized\n     a bit mask to zero instead of BIT(0).\n\n   - Disable strict aliasing when building KVM selftests to prevent the\n     compiler from treating things like \"u64 *\" to \"uint64_t *\" cases as\n     undefined behavior, which can lead to nasty, hard to debug\n     failures.\n\n   - Force -march=x86-64-v2 for KVM x86 selftests if and only if the\n     uarch is supported by the compiler.\n\n   - Fix broken compilation of kvm selftests after a header sync in\n     tools/\"\n\n* tag 'for-linus' of git://git.kernel.org/pub/scm/virt/kvm/kvm:\n  KVM: VMX: Bury Intel PT virtualization (guest/host mode) behind CONFIG_BROKEN\n  KVM: x86: Unconditionally set irr_pending when updating APICv state\n  kvm: svm: Fix gctx page leak on invalid inputs\n  KVM: selftests: use X86_MEMTYPE_WB instead of VMX_BASIC_MEM_TYPE_WB\n  KVM: SVM: Propagate error from snp_guest_req_init() to userspace\n  KVM: nVMX: Treat vpid01 as current if L2 is active, but with VPID disabled\n  KVM: selftests: Don't force -march=x86-64-v2 if it's unsupported\n  KVM: selftests: Disable strict aliasing\n  KVM: selftests: fix unintentional noop test in guest_memfd_test.c\n  KVM: selftests: memslot_perf_test: increase guest sync timeout",
  "full_message": "Merge tag 'for-linus' of git://git.kernel.org/pub/scm/virt/kvm/kvm\n\nPull kvm fixes from Paolo Bonzini:\n \"x86 and selftests fixes.\n\n  x86:\n\n   - When emulating a guest TLB flush for a nested guest, flush vpid01,\n     not vpid02, if L2 is active but VPID is disabled in vmcs12, i.e. if\n     L2 and L1 are sharing VPID '0' (from L1's perspective).\n\n   - Fix a bug in the SNP initialization flow where KVM would return '0'\n     to userspace instead of -errno on failure.\n\n   - Move the Intel PT virtualization (i.e. outputting host trace to\n     host buffer and guest trace to guest buffer) behind CONFIG_BROKEN.\n\n   - Fix memory leak on failure of KVM_SEV_SNP_LAUNCH_START\n\n   - Fix a bug where KVM fails to inject an interrupt from the IRR after\n     KVM_SET_LAPIC.\n\n  Selftests:\n\n   - Increase the timeout for the memslot performance selftest to avoid\n     false failures on arm64 and nested x86 platforms.\n\n   - Fix a goof in the guest_memfd selftest where a for-loop initialized\n     a bit mask to zero instead of BIT(0).\n\n   - Disable strict aliasing when building KVM selftests to prevent the\n     compiler from treating things like \"u64 *\" to \"uint64_t *\" cases as\n     undefined behavior, which can lead to nasty, hard to debug\n     failures.\n\n   - Force -march=x86-64-v2 for KVM x86 selftests if and only if the\n     uarch is supported by the compiler.\n\n   - Fix broken compilation of kvm selftests after a header sync in\n     tools/\"\n\n* tag 'for-linus' of git://git.kernel.org/pub/scm/virt/kvm/kvm:\n  KVM: VMX: Bury Intel PT virtualization (guest/host mode) behind CONFIG_BROKEN\n  KVM: x86: Unconditionally set irr_pending when updating APICv state\n  kvm: svm: Fix gctx page leak on invalid inputs\n  KVM: selftests: use X86_MEMTYPE_WB instead of VMX_BASIC_MEM_TYPE_WB\n  KVM: SVM: Propagate error from snp_guest_req_init() to userspace\n  KVM: nVMX: Treat vpid01 as current if L2 is active, but with VPID disabled\n  KVM: selftests: Don't force -march=x86-64-v2 if it's unsupported\n  KVM: selftests: Disable strict aliasing\n  KVM: selftests: fix unintentional noop test in guest_memfd_test.c\n  KVM: selftests: memslot_perf_test: increase guest sync timeout",
  "author_name": "Linus Torvalds",
  "author_email": "torvalds@linux-foundation.org",
  "author_date": "Tue Nov 12 13:35:13 2024 -0800",
  "author_date_iso": "2024-11-12T13:35:13-08:00",
  "committer_name": "Linus Torvalds",
  "committer_email": "torvalds@linux-foundation.org",
  "committer_date": "Tue Nov 12 13:35:13 2024 -0800",
  "committer_date_iso": "2024-11-12T13:35:13-08:00",
  "files_changed": [],
  "files_changed_count": 0,
  "stats": [
    {
      "file": "arch/x86/kvm/lapic.c",
      "insertions": 18,
      "deletions": 11
    },
    {
      "file": "arch/x86/kvm/svm/sev.c",
      "insertions": 9,
      "deletions": 6
    },
    {
      "file": "arch/x86/kvm/vmx/nested.c",
      "insertions": 25,
      "deletions": 5
    },
    {
      "file": "arch/x86/kvm/vmx/vmx.c",
      "insertions": 4,
      "deletions": 2
    },
    {
      "file": "tools/testing/selftests/kvm/Makefile",
      "insertions": 6,
      "deletions": 4
    },
    {
      "file": "tools/testing/selftests/kvm/guest_memfd_test.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "tools/testing/selftests/kvm/lib/x86_64/vmx.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "tools/testing/selftests/kvm/memslot_perf_test.c",
      "insertions": 1,
      "deletions": 1
    }
  ],
  "total_insertions": 65,
  "total_deletions": 31,
  "total_changes": 96,
  "parents": [
    "5456ec9dab3a918ccfc0dc82677d38a74fab4212",
    "aa0d42cacf093a6fcca872edc954f6f812926a17"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": true,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "inject"
    ]
  },
  "fix_type": "security",
  "file_results": []
}