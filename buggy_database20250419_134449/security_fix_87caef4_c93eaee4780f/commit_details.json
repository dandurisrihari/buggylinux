{
  "hash": "87caef42200cd44f8b808ec2f8ac2257f3e0a8c1",
  "hash_short": "87caef42",
  "subject": "Merge tag 'hardening-6.10-rc1' of git://git.kernel.org/pub/scm/linux/kernel/git/kees/linux",
  "body": "Pull hardening updates from Kees Cook:\n \"The bulk of the changes here are related to refactoring and expanding\n  the KUnit tests for string helper and fortify behavior.\n\n  Some trivial strncpy replacements in fs/ were carried in my tree. Also\n  some fixes to SCSI string handling were carried in my tree since the\n  helper for those was introduce here. Beyond that, just little fixes\n  all around: objtool getting confused about LKDTM+KCFI, preparing for\n  future refactors (constification of sysctl tables, additional\n  __counted_by annotations), a Clang UBSAN+i386 crash fix, and adding\n  more options in the hardening.config Kconfig fragment.\n\n  Summary:\n\n   - selftests: Add str*cmp tests (Ivan Orlov)\n\n   - __counted_by: provide UAPI for _le/_be variants (Erick Archer)\n\n   - Various strncpy deprecation refactors (Justin Stitt)\n\n   - stackleak: Use a copy of soon-to-be-const sysctl table (Thomas\n     Wei\u00dfschuh)\n\n   - UBSAN: Work around i386 -regparm=3 bug with Clang prior to\n     version 19\n\n   - Provide helper to deal with non-NUL-terminated string copying\n\n   - SCSI: Fix older string copying bugs (with new helper)\n\n   - selftests: Consolidate string helper behavioral tests\n\n   - selftests: add memcpy() fortify tests\n\n   - string: Add additional __realloc_size() annotations for \"dup\"\n     helpers\n\n   - LKDTM: Fix KCFI+rodata+objtool confusion\n\n   - hardening.config: Enable KCFI\"\n\n* tag 'hardening-6.10-rc1' of git://git.kernel.org/pub/scm/linux/kernel/git/kees/linux: (29 commits)\n  uapi: stddef.h: Provide UAPI macros for __counted_by_{le, be}\n  stackleak: Use a copy of the ctl_table argument\n  string: Add additional __realloc_size() annotations for \"dup\" helpers\n  kunit/fortify: Fix replaced failure path to unbreak __alloc_size\n  hardening: Enable KCFI and some other options\n  lkdtm: Disable CFI checking for perms functions\n  kunit/fortify: Add memcpy() tests\n  kunit/fortify: Do not spam logs with fortify WARNs\n  kunit/fortify: Rename tests to use recommended conventions\n  init: replace deprecated strncpy with strscpy_pad\n  kunit/fortify: Fix mismatched kvalloc()/vfree() usage\n  scsi: qla2xxx: Avoid possible run-time warning with long model_num\n  scsi: mpi3mr: Avoid possible run-time warning with long manufacturer strings\n  scsi: mptfusion: Avoid possible run-time warning with long manufacturer strings\n  fs: ecryptfs: replace deprecated strncpy with strscpy\n  hfsplus: refactor copy_name to not use strncpy\n  reiserfs: replace deprecated strncpy with scnprintf\n  virt: acrn: replace deprecated strncpy with strscpy\n  ubsan: Avoid i386 UBSAN handler crashes with Clang\n  ubsan: Remove 1-element array usage in debug reporting\n  ...",
  "full_message": "Merge tag 'hardening-6.10-rc1' of git://git.kernel.org/pub/scm/linux/kernel/git/kees/linux\n\nPull hardening updates from Kees Cook:\n \"The bulk of the changes here are related to refactoring and expanding\n  the KUnit tests for string helper and fortify behavior.\n\n  Some trivial strncpy replacements in fs/ were carried in my tree. Also\n  some fixes to SCSI string handling were carried in my tree since the\n  helper for those was introduce here. Beyond that, just little fixes\n  all around: objtool getting confused about LKDTM+KCFI, preparing for\n  future refactors (constification of sysctl tables, additional\n  __counted_by annotations), a Clang UBSAN+i386 crash fix, and adding\n  more options in the hardening.config Kconfig fragment.\n\n  Summary:\n\n   - selftests: Add str*cmp tests (Ivan Orlov)\n\n   - __counted_by: provide UAPI for _le/_be variants (Erick Archer)\n\n   - Various strncpy deprecation refactors (Justin Stitt)\n\n   - stackleak: Use a copy of soon-to-be-const sysctl table (Thomas\n     Wei\u00dfschuh)\n\n   - UBSAN: Work around i386 -regparm=3 bug with Clang prior to\n     version 19\n\n   - Provide helper to deal with non-NUL-terminated string copying\n\n   - SCSI: Fix older string copying bugs (with new helper)\n\n   - selftests: Consolidate string helper behavioral tests\n\n   - selftests: add memcpy() fortify tests\n\n   - string: Add additional __realloc_size() annotations for \"dup\"\n     helpers\n\n   - LKDTM: Fix KCFI+rodata+objtool confusion\n\n   - hardening.config: Enable KCFI\"\n\n* tag 'hardening-6.10-rc1' of git://git.kernel.org/pub/scm/linux/kernel/git/kees/linux: (29 commits)\n  uapi: stddef.h: Provide UAPI macros for __counted_by_{le, be}\n  stackleak: Use a copy of the ctl_table argument\n  string: Add additional __realloc_size() annotations for \"dup\" helpers\n  kunit/fortify: Fix replaced failure path to unbreak __alloc_size\n  hardening: Enable KCFI and some other options\n  lkdtm: Disable CFI checking for perms functions\n  kunit/fortify: Add memcpy() tests\n  kunit/fortify: Do not spam logs with fortify WARNs\n  kunit/fortify: Rename tests to use recommended conventions\n  init: replace deprecated strncpy with strscpy_pad\n  kunit/fortify: Fix mismatched kvalloc()/vfree() usage\n  scsi: qla2xxx: Avoid possible run-time warning with long model_num\n  scsi: mpi3mr: Avoid possible run-time warning with long manufacturer strings\n  scsi: mptfusion: Avoid possible run-time warning with long manufacturer strings\n  fs: ecryptfs: replace deprecated strncpy with strscpy\n  hfsplus: refactor copy_name to not use strncpy\n  reiserfs: replace deprecated strncpy with scnprintf\n  virt: acrn: replace deprecated strncpy with strscpy\n  ubsan: Avoid i386 UBSAN handler crashes with Clang\n  ubsan: Remove 1-element array usage in debug reporting\n  ...",
  "author_name": "Linus Torvalds",
  "author_email": "torvalds@linux-foundation.org",
  "author_date": "Mon May 13 14:14:05 2024 -0700",
  "author_date_iso": "2024-05-13T14:14:05-07:00",
  "committer_name": "Linus Torvalds",
  "committer_email": "torvalds@linux-foundation.org",
  "committer_date": "Mon May 13 14:14:05 2024 -0700",
  "committer_date_iso": "2024-05-13T14:14:05-07:00",
  "files_changed": [
    "MAINTAINERS",
    "kernel/configs/hardening.config",
    "lib/Kconfig.debug",
    "lib/Makefile"
  ],
  "files_changed_count": 4,
  "stats": [
    {
      "file": "MAINTAINERS",
      "insertions": 1,
      "deletions": 2
    },
    {
      "file": "arch/arm64/configs/hardening.config",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/x86/configs/hardening.config",
      "insertions": 3,
      "deletions": 0
    },
    {
      "file": "drivers/message/fusion/mptsas.c",
      "insertions": 5,
      "deletions": 9
    },
    {
      "file": "drivers/misc/lkdtm/Makefile",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/misc/lkdtm/perms.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "drivers/scsi/mpi3mr/mpi3mr_transport.c",
      "insertions": 5,
      "deletions": 9
    },
    {
      "file": "drivers/scsi/qla2xxx/qla_mr.c",
      "insertions": 2,
      "deletions": 4
    },
    {
      "file": "drivers/virt/acrn/ioreq.c",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "fs/ecryptfs/crypto.c",
      "insertions": 1,
      "deletions": 3
    },
    {
      "file": "fs/ecryptfs/main.c",
      "insertions": 6,
      "deletions": 20
    },
    {
      "file": "fs/hfsplus/xattr.c",
      "insertions": 10,
      "deletions": 12
    },
    {
      "file": "fs/reiserfs/item_ops.c",
      "insertions": 3,
      "deletions": 10
    },
    {
      "file": "include/linux/fortify-string.h",
      "insertions": 7,
      "deletions": 2
    },
    {
      "file": "include/linux/string.h",
      "insertions": 57,
      "deletions": 5
    },
    {
      "file": "include/uapi/linux/stddef.h",
      "insertions": 8,
      "deletions": 0
    },
    {
      "file": "init/do_mounts.c",
      "insertions": 1,
      "deletions": 2
    },
    {
      "file": "kernel/configs/hardening.config",
      "insertions": 8,
      "deletions": 0
    },
    {
      "file": "kernel/stackleak.c",
      "insertions": 3,
      "deletions": 3
    },
    {
      "file": "lib/Kconfig.debug",
      "insertions": 0,
      "deletions": 10
    },
    {
      "file": "lib/Makefile",
      "insertions": 0,
      "deletions": 2
    },
    {
      "file": "lib/fortify_kunit.c",
      "insertions": 167,
      "deletions": 55
    },
    {
      "file": "lib/memcpy_kunit.c",
      "insertions": 0,
      "deletions": 53
    },
    {
      "file": "lib/strcat_kunit.c",
      "insertions": 0,
      "deletions": 104
    },
    {
      "file": "lib/string_kunit.c",
      "insertions": 449,
      "deletions": 12
    },
    {
      "file": "lib/strscpy_kunit.c",
      "insertions": 0,
      "deletions": 142
    },
    {
      "file": "lib/ubsan.h",
      "insertions": 28,
      "deletions": 15
    }
  ],
  "total_insertions": 768,
  "total_deletions": 477,
  "total_changes": 1245,
  "parents": [
    "92f74f7f4083cb7b1fdab807cbbe4f5ece534fbc",
    "6d305cbef1aa01b9714e01e35f3d5c28544cf04d"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": true,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "hardening"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "MAINTAINERS",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "kernel/configs/hardening.config",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "lib/Kconfig.debug",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "lib/Makefile",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}