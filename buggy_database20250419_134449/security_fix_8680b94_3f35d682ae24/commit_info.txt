Commit Hash: 8680b94b0e6046af2644c17313287ec0cb5843dc
Subject: KVM: optimize ISR lookups


Security Keywords:
- injection

Full commit message:
KVM: optimize ISR lookups

We perform ISR lookups twice: during interrupt
injection and on EOI. Typical workloads only have
a single bit set there. So we can avoid ISR scans by
1. counting bits as we set/clear them in ISR
2. on set, caching the injected vector number
3. on clear, invalidating the cache

The real purpose of this is enabling PV EOI
which needs to quickly validate the vector.
But non PV guests also benefit: with this patch,
and without interrupt nesting, apic_find_highest_isr
will always return immediately without scanning ISR.

Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
Signed-off-by: Avi Kivity <avi@redhat.com>

Metadata:
Author: Michael S. Tsirkin <mst@redhat.com>
Author Date: Sun Jun 24 19:24:26 2012 +0300
Committer: Avi Kivity <avi@redhat.com>
Commit Date: Mon Jun 25 12:37:21 2012 +0300

Files Changed: 2
Lines Added: 55
Lines Removed: 2
Total Changes: 57
