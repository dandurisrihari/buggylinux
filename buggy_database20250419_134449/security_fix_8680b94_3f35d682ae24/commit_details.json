{
  "hash": "8680b94b0e6046af2644c17313287ec0cb5843dc",
  "hash_short": "8680b94b",
  "subject": "KVM: optimize ISR lookups",
  "body": "We perform ISR lookups twice: during interrupt\ninjection and on EOI. Typical workloads only have\na single bit set there. So we can avoid ISR scans by\n1. counting bits as we set/clear them in ISR\n2. on set, caching the injected vector number\n3. on clear, invalidating the cache\n\nThe real purpose of this is enabling PV EOI\nwhich needs to quickly validate the vector.\nBut non PV guests also benefit: with this patch,\nand without interrupt nesting, apic_find_highest_isr\nwill always return immediately without scanning ISR.\n\nSigned-off-by: Michael S. Tsirkin <mst@redhat.com>\nSigned-off-by: Avi Kivity <avi@redhat.com>",
  "full_message": "KVM: optimize ISR lookups\n\nWe perform ISR lookups twice: during interrupt\ninjection and on EOI. Typical workloads only have\na single bit set there. So we can avoid ISR scans by\n1. counting bits as we set/clear them in ISR\n2. on set, caching the injected vector number\n3. on clear, invalidating the cache\n\nThe real purpose of this is enabling PV EOI\nwhich needs to quickly validate the vector.\nBut non PV guests also benefit: with this patch,\nand without interrupt nesting, apic_find_highest_isr\nwill always return immediately without scanning ISR.\n\nSigned-off-by: Michael S. Tsirkin <mst@redhat.com>\nSigned-off-by: Avi Kivity <avi@redhat.com>",
  "author_name": "Michael S. Tsirkin",
  "author_email": "mst@redhat.com",
  "author_date": "Sun Jun 24 19:24:26 2012 +0300",
  "author_date_iso": "2012-06-24T19:24:26+03:00",
  "committer_name": "Avi Kivity",
  "committer_email": "avi@redhat.com",
  "committer_date": "Mon Jun 25 12:37:21 2012 +0300",
  "committer_date_iso": "2012-06-25T12:37:21+03:00",
  "files_changed": [
    "arch/x86/kvm/lapic.c",
    "arch/x86/kvm/lapic.h"
  ],
  "files_changed_count": 2,
  "stats": [
    {
      "file": "arch/x86/kvm/lapic.c",
      "insertions": 51,
      "deletions": 2
    },
    {
      "file": "arch/x86/kvm/lapic.h",
      "insertions": 4,
      "deletions": 0
    }
  ],
  "total_insertions": 55,
  "total_deletions": 2,
  "total_changes": 57,
  "parents": [
    "5eadf916dfa04c3c51397dbcb803ce8735bf191a"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v3.10",
    "v3.10-rc1",
    "v3.10-rc2",
    "v3.10-rc3",
    "v3.10-rc4",
    "v3.10-rc5",
    "v3.10-rc6",
    "v3.10-rc7",
    "v3.11",
    "v3.11-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/x86/kvm/lapic.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kvm/lapic.h",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}