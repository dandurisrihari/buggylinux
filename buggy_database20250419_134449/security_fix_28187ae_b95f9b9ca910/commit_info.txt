Commit Hash: 28187ae569e8a6c34eb7ac8871f479d94be31e16
Subject: btrfs: Simplify page unlocking in alloc_extent_buffer


Security Keywords:
- exploit

Full commit message:
btrfs: Simplify page unlocking in alloc_extent_buffer

Current version of the page unlocking code was added in
727011e07cbd ("Btrfs: allow metadata blocks larger than the page size")
but even in this commit that particular flag was never used per-se. In
fact, btrfs only uses PageChecked for data pages to identify pages
which have been dirtied but don't have ORDERED bit set. For more
information see 247e743cbe6e ("Btrfs: Use async helpers to deal with
pages that have been improperly dirtied").

However, this doesn't apply to extent buffer pages. The important bit
here is that the pages are unlocked AFTER the extent buffer has been
properly recorded in the radix tree to avoid races with
btree_releasepage. Let's exploit this fact and simplify the page
unlocking sequence by unlocking the pages in-order and removing the
redundant PageChecked flag setting/clearing.

Signed-off-by: Nikolay Borisov <nborisov@suse.com>
Reviewed-by: David Sterba <dsterba@suse.com>
Signed-off-by: David Sterba <dsterba@suse.com>

Metadata:
Author: Nikolay Borisov <nborisov@suse.com>
Author Date: Wed Jul 4 10:24:51 2018 +0300
Committer: David Sterba <dsterba@suse.com>
Commit Date: Mon Aug 6 13:12:54 2018 +0200

Files Changed: 1
Lines Added: 2
Lines Removed: 7
Total Changes: 9
