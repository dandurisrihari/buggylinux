{
  "hash": "c779a9cdf7c65291b94ad174e003348bc2ab7cdf",
  "hash_short": "c779a9cd",
  "subject": "[media] mceusb: TX -EPIPE (urb status = -32) lockup fix",
  "body": "Once IR blasting or mceusb device commands fail with mce_async_callback()\nTX -EPIPE error, all subsequent TX to device then fail with the same error.\n...\n[  249.986174] mceusb 1-1.2:1.0: requesting 38000 HZ carrier\n[  249.986210] mceusb 1-1.2:1.0: send request called (size=0x4)\n[  249.986256] mceusb 1-1.2:1.0: send request complete (res=0)\n[  249.986403] mceusb 1-1.2:1.0: Error: request urb status = -32 (TX HALT)\n[  249.999885] mceusb 1-1.2:1.0: send request called (size=0x3)\n[  249.999929] mceusb 1-1.2:1.0: send request complete (res=0)\n[  250.000013] mceusb 1-1.2:1.0: Error: request urb status = -32 (TX HALT)\n[  250.019830] mceusb 1-1.2:1.0: send request called (size=0x21)\n[  250.019868] mceusb 1-1.2:1.0: send request complete (res=0)\n[  250.020007] mceusb 1-1.2:1.0: Error: request urb status = -32 (TX HALT)\n...\n\nFault simulation/injection is by executing the following USB operation\nin a mceusb instrumented driver, prior to TX I/O.\n    retval = usb_control_msg(ir->usbdev, usb_sndctrlpipe(ir->usbdev, 0),\n\tUSB_REQ_SET_FEATURE, USB_RECIP_ENDPOINT,\n\tUSB_ENDPOINT_HALT, usb_pipeendpoint(ir->pipe_out),\n\tNULL, 0, USB_CTRL_SET_TIMEOUT);\n    dev_dbg(ir->dev, \"set halt retval, %d\", retval);\n\nAfter setting halt state for the TX endpoint, perform an lirc \"irsend\"\nto generate TX traffic to device. After the TX HALT, the patch restores\nsubsequent TX to working state.\n...\n[  508.009638] mceusb 1-1.2:1.0: send request called (size=0x3)\n[  508.009697] mceusb 1-1.2:1.0: send request complete (res=0)\n[  508.009847] mce_async_callback()\n[  508.009864] mceusb 1-1.2:1.0: Error: request urb status = -32 (TX HALT)\n[  508.009890] mceusb 1-1.2:1.0: kevent 0 scheduled\n[  508.021552] mceusb 1-1.2:1.0: send request called (size=0x21)\n[  508.021598] mceusb 1-1.2:1.0: send request complete (res=0)\n[  508.021963] mce_async_callback()\n[  508.021981] mceusb 1-1.2:1.0: tx data: 84 b0 0c 8c 0c 84 8c 0c 8c 0c 84 8c 0c 8c 0c 84 98 0c 98 0c 84 98 0c 8c 0c 84 8c 0c 8c 0c 81 8c 80 (length=33)\n[  508.021997] mceusb 1-1.2:1.0: Raw IR data, 0 pulse/space samples\n[  508.066627] mceusb 1-1.2:1.0: send request called (size=0x3)\n[  508.066669] mceusb 1-1.2:1.0: send request complete (res=0)\n[  508.066841] mce_async_callback()\n[  508.066858] mceusb 1-1.2:1.0: tx data: 9f 08 03 (length=3)\n...\n\nSigned-off-by: A Sun <as1033x@comcast.net>\nSigned-off-by: Sean Young <sean@mess.org>\nSigned-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>",
  "full_message": "[media] mceusb: TX -EPIPE (urb status = -32) lockup fix\n\nOnce IR blasting or mceusb device commands fail with mce_async_callback()\nTX -EPIPE error, all subsequent TX to device then fail with the same error.\n...\n[  249.986174] mceusb 1-1.2:1.0: requesting 38000 HZ carrier\n[  249.986210] mceusb 1-1.2:1.0: send request called (size=0x4)\n[  249.986256] mceusb 1-1.2:1.0: send request complete (res=0)\n[  249.986403] mceusb 1-1.2:1.0: Error: request urb status = -32 (TX HALT)\n[  249.999885] mceusb 1-1.2:1.0: send request called (size=0x3)\n[  249.999929] mceusb 1-1.2:1.0: send request complete (res=0)\n[  250.000013] mceusb 1-1.2:1.0: Error: request urb status = -32 (TX HALT)\n[  250.019830] mceusb 1-1.2:1.0: send request called (size=0x21)\n[  250.019868] mceusb 1-1.2:1.0: send request complete (res=0)\n[  250.020007] mceusb 1-1.2:1.0: Error: request urb status = -32 (TX HALT)\n...\n\nFault simulation/injection is by executing the following USB operation\nin a mceusb instrumented driver, prior to TX I/O.\n    retval = usb_control_msg(ir->usbdev, usb_sndctrlpipe(ir->usbdev, 0),\n\tUSB_REQ_SET_FEATURE, USB_RECIP_ENDPOINT,\n\tUSB_ENDPOINT_HALT, usb_pipeendpoint(ir->pipe_out),\n\tNULL, 0, USB_CTRL_SET_TIMEOUT);\n    dev_dbg(ir->dev, \"set halt retval, %d\", retval);\n\nAfter setting halt state for the TX endpoint, perform an lirc \"irsend\"\nto generate TX traffic to device. After the TX HALT, the patch restores\nsubsequent TX to working state.\n...\n[  508.009638] mceusb 1-1.2:1.0: send request called (size=0x3)\n[  508.009697] mceusb 1-1.2:1.0: send request complete (res=0)\n[  508.009847] mce_async_callback()\n[  508.009864] mceusb 1-1.2:1.0: Error: request urb status = -32 (TX HALT)\n[  508.009890] mceusb 1-1.2:1.0: kevent 0 scheduled\n[  508.021552] mceusb 1-1.2:1.0: send request called (size=0x21)\n[  508.021598] mceusb 1-1.2:1.0: send request complete (res=0)\n[  508.021963] mce_async_callback()\n[  508.021981] mceusb 1-1.2:1.0: tx data: 84 b0 0c 8c 0c 84 8c 0c 8c 0c 84 8c 0c 8c 0c 84 98 0c 98 0c 84 98 0c 8c 0c 84 8c 0c 8c 0c 81 8c 80 (length=33)\n[  508.021997] mceusb 1-1.2:1.0: Raw IR data, 0 pulse/space samples\n[  508.066627] mceusb 1-1.2:1.0: send request called (size=0x3)\n[  508.066669] mceusb 1-1.2:1.0: send request complete (res=0)\n[  508.066841] mce_async_callback()\n[  508.066858] mceusb 1-1.2:1.0: tx data: 9f 08 03 (length=3)\n...\n\nSigned-off-by: A Sun <as1033x@comcast.net>\nSigned-off-by: Sean Young <sean@mess.org>\nSigned-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>",
  "author_name": "A Sun",
  "author_email": "as1033x@comcast.net",
  "author_date": "Thu Apr 13 05:06:47 2017 -0300",
  "author_date_iso": "2017-04-13T05:06:47-03:00",
  "committer_name": "Mauro Carvalho Chehab",
  "committer_email": "mchehab@s-opensource.com",
  "committer_date": "Tue Jun 6 08:58:48 2017 -0300",
  "committer_date_iso": "2017-06-06T08:58:48-03:00",
  "files_changed": [
    "drivers/media/rc/mceusb.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/media/rc/mceusb.c",
      "insertions": 34,
      "deletions": 19
    }
  ],
  "total_insertions": 34,
  "total_deletions": 19,
  "total_changes": 53,
  "parents": [
    "a06854a600f6ccb72f097d86a44688949b867906"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.13",
    "v4.13-rc1",
    "v4.13-rc2",
    "v4.13-rc3",
    "v4.13-rc4",
    "v4.13-rc5",
    "v4.13-rc6",
    "v4.13-rc7",
    "v4.14",
    "v4.14-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/media/rc/mceusb.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}