{
  "hash": "c9f838d104fed6f2f61d68164712e3204bf5271b",
  "hash_short": "c9f838d1",
  "subject": "KEYS: fix keyctl_set_reqkey_keyring() to not leak thread keyrings",
  "body": "This fixes CVE-2017-7472.\n\nRunning the following program as an unprivileged user exhausts kernel\nmemory by leaking thread keyrings:\n\n\t#include <keyutils.h>\n\n\tint main()\n\t{\n\t\tfor (;;)\n\t\t\tkeyctl_set_reqkey_keyring(KEY_REQKEY_DEFL_THREAD_KEYRING);\n\t}\n\nFix it by only creating a new thread keyring if there wasn't one before.\nTo make things more consistent, make install_thread_keyring_to_cred()\nand install_process_keyring_to_cred() both return 0 if the corresponding\nkeyring is already present.\n\nFixes: d84f4f992cbd (\"CRED: Inaugurate COW credentials\")\nCc: stable@vger.kernel.org # 2.6.29+\nSigned-off-by: Eric Biggers <ebiggers@google.com>\nSigned-off-by: David Howells <dhowells@redhat.com>",
  "full_message": "KEYS: fix keyctl_set_reqkey_keyring() to not leak thread keyrings\n\nThis fixes CVE-2017-7472.\n\nRunning the following program as an unprivileged user exhausts kernel\nmemory by leaking thread keyrings:\n\n\t#include <keyutils.h>\n\n\tint main()\n\t{\n\t\tfor (;;)\n\t\t\tkeyctl_set_reqkey_keyring(KEY_REQKEY_DEFL_THREAD_KEYRING);\n\t}\n\nFix it by only creating a new thread keyring if there wasn't one before.\nTo make things more consistent, make install_thread_keyring_to_cred()\nand install_process_keyring_to_cred() both return 0 if the corresponding\nkeyring is already present.\n\nFixes: d84f4f992cbd (\"CRED: Inaugurate COW credentials\")\nCc: stable@vger.kernel.org # 2.6.29+\nSigned-off-by: Eric Biggers <ebiggers@google.com>\nSigned-off-by: David Howells <dhowells@redhat.com>",
  "author_name": "Eric Biggers",
  "author_email": "ebiggers@google.com",
  "author_date": "Tue Apr 18 15:31:09 2017 +0100",
  "author_date_iso": "2017-04-18T15:31:09+01:00",
  "committer_name": "David Howells",
  "committer_email": "dhowells@redhat.com",
  "committer_date": "Tue Apr 18 15:31:49 2017 +0100",
  "committer_date_iso": "2017-04-18T15:31:49+01:00",
  "files_changed": [
    "security/keys/keyctl.c",
    "security/keys/process_keys.c"
  ],
  "files_changed_count": 2,
  "stats": [
    {
      "file": "security/keys/keyctl.c",
      "insertions": 4,
      "deletions": 7
    },
    {
      "file": "security/keys/process_keys.c",
      "insertions": 27,
      "deletions": 17
    }
  ],
  "total_insertions": 31,
  "total_deletions": 24,
  "total_changes": 55,
  "parents": [
    "c1644fe041ebaf6519f6809146a77c3ead9193af"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.11",
    "v4.11-rc8",
    "v4.12",
    "v4.12-rc1",
    "v4.12-rc2",
    "v4.12-rc3",
    "v4.12-rc4",
    "v4.12-rc5",
    "v4.12-rc6",
    "v4.12-rc7"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [
      "CVE-2017-7472"
    ],
    "security_keywords": []
  },
  "fix_type": "cve",
  "file_results": [
    {
      "file": "security/keys/keyctl.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "security/keys/process_keys.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}