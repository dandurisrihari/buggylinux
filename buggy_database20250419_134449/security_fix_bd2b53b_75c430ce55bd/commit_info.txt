Commit Hash: bd2b53b20fcd0d6c4c815b54e6d464e34429d3a4
Subject: KVM: fast-path msi injection with irqfd


Security Keywords:
- injection

Full commit message:
KVM: fast-path msi injection with irqfd

Store irq routing table pointer in the irqfd object,
and use that to inject MSI directly without bouncing out to
a kernel thread.

While we touch this structure, rearrange irqfd fields to make fastpath
better packed for better cache utilization.

This also adds some comments about locking rules and rcu usage in code.

Some notes on the design:
- Use pointer into the rt instead of copying an entry,
  to make it possible to use rcu, thus side-stepping
  locking complexities.  We also save some memory this way.
- Old workqueue code is still used for level irqs.
  I don't think we DTRT with level anyway, however,
  it seems easier to keep the code around as
  it has been thought through and debugged, and fix level later than
  rip out and re-instate it later.

Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
Acked-by: Marcelo Tosatti <mtosatti@redhat.com>
Acked-by: Gregory Haskins <ghaskins@novell.com>
Signed-off-by: Avi Kivity <avi@redhat.com>

Metadata:
Author: Michael S. Tsirkin <mst@redhat.com>
Author Date: Thu Nov 18 19:09:08 2010 +0200
Committer: Avi Kivity <avi@redhat.com>
Commit Date: Wed Jan 12 11:29:38 2011 +0200

Files Changed: 3
Lines Added: 99
Lines Removed: 15
Total Changes: 114
