{
  "hash": "3d96208c30f84d6edf9ab4fac813306ac0d20c10",
  "hash_short": "3d96208c",
  "subject": "sunrpc: expiry_time should be seconds not timeval",
  "body": "When upcalling gssproxy, cache_head.expiry_time is set as a\ntimeval, not seconds since boot. As such, RPC cache expiry\nlogic will not clean expired objects created under\nauth.rpcsec.context cache.\n\nThis has proven to cause kernel memory leaks on field. Using\n64 bit variants of getboottime/timespec\n\nExpiration times have worked this way since 2010's c5b29f885afe \"sunrpc:\nuse seconds since boot in expiry cache\".  The gssproxy code introduced\nin 2012 added gss_proxy_save_rsc and introduced the bug.  That's a while\nfor this to lurk, but it required a bit of an extreme case to make it\nobvious.\n\nSigned-off-by: Roberto Bergantinos Corpas <rbergant@redhat.com>\nCc: stable@vger.kernel.org\nFixes: 030d794bf498 \"SUNRPC: Use gssproxy upcall for server...\"\nTested-By: Frank Sorenson <sorenson@redhat.com>\nSigned-off-by: J. Bruce Fields <bfields@redhat.com>",
  "full_message": "sunrpc: expiry_time should be seconds not timeval\n\nWhen upcalling gssproxy, cache_head.expiry_time is set as a\ntimeval, not seconds since boot. As such, RPC cache expiry\nlogic will not clean expired objects created under\nauth.rpcsec.context cache.\n\nThis has proven to cause kernel memory leaks on field. Using\n64 bit variants of getboottime/timespec\n\nExpiration times have worked this way since 2010's c5b29f885afe \"sunrpc:\nuse seconds since boot in expiry cache\".  The gssproxy code introduced\nin 2012 added gss_proxy_save_rsc and introduced the bug.  That's a while\nfor this to lurk, but it required a bit of an extreme case to make it\nobvious.\n\nSigned-off-by: Roberto Bergantinos Corpas <rbergant@redhat.com>\nCc: stable@vger.kernel.org\nFixes: 030d794bf498 \"SUNRPC: Use gssproxy upcall for server...\"\nTested-By: Frank Sorenson <sorenson@redhat.com>\nSigned-off-by: J. Bruce Fields <bfields@redhat.com>",
  "author_name": "Roberto Bergantinos Corpas",
  "author_email": "rbergant@redhat.com",
  "author_date": "Tue Feb 4 11:32:56 2020 +0100",
  "author_date_iso": "2020-02-04T11:32:56+01:00",
  "committer_name": "J. Bruce Fields",
  "committer_email": "bfields@redhat.com",
  "committer_date": "Fri Feb 7 13:30:41 2020 -0500",
  "committer_date_iso": "2020-02-07T13:30:41-05:00",
  "files_changed": [
    "net/sunrpc/auth_gss/svcauth_gss.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "net/sunrpc/auth_gss/svcauth_gss.c",
      "insertions": 4,
      "deletions": 0
    }
  ],
  "total_insertions": 4,
  "total_deletions": 0,
  "total_changes": 4,
  "parents": [
    "50d0def966a5f1237ba647e827a945e8ece4c10b"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v5.6",
    "v5.6-rc1",
    "v5.6-rc2",
    "v5.6-rc3",
    "v5.6-rc4",
    "v5.6-rc5",
    "v5.6-rc6",
    "v5.6-rc7",
    "v5.7-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "auth"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "net/sunrpc/auth_gss/svcauth_gss.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}