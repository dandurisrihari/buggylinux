Commit Hash: 89aa3619d141d6cfb6040a561aebb6d99d3e2285
Subject: cipso: make cipso_v4_skbuff_delattr() fully remove the CIPSO options


Security Keywords:
- hardening

Full commit message:
cipso: make cipso_v4_skbuff_delattr() fully remove the CIPSO options

As the comment in this function says, the code currently just clears the
CIPSO part with IPOPT_NOP, rather than removing it completely and
trimming the packet. The other cipso_v4_*_delattr() functions, however,
do the proper removal and also calipso_skbuff_delattr() makes an effort
to remove the CALIPSO options instead of replacing them with padding.

Some routers treat IPv4 packets with anything (even NOPs) in the option
header as a special case and take them through a slower processing path.
Consequently, hardening guides such as STIG recommend to configure such
routers to drop packets with non-empty IP option headers [1][2]. Thus,
users might expect NetLabel to produce packets with minimal padding (or
at least with no padding when no actual options are present).

Implement the proper option removal to address this and to be closer to
what the peer functions do.

[1] https://www.stigviewer.com/stig/juniper_router_rtr/2019-09-27/finding/V-90937
[2] https://www.stigviewer.com/stig/cisco_ios_xe_router_rtr/2021-03-26/finding/V-217001

Signed-off-by: Ondrej Mosnacek <omosnace@redhat.com>
Signed-off-by: David S. Miller <davem@davemloft.net>

Metadata:
Author: Ondrej Mosnacek <omosnace@redhat.com>
Author Date: Fri Jun 7 18:07:53 2024 +0200
Committer: David S. Miller <davem@davemloft.net>
Commit Date: Fri Jun 14 08:19:54 2024 +0100

Files Changed: 1
Lines Added: 54
Lines Removed: 25
Total Changes: 79
