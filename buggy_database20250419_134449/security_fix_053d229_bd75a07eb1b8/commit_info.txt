Commit Hash: 053d2290c0307e3642e75e0185ddadf084dc36c1
Subject: KVM: VMX: Exit to userspace if vCPU has injected exception and invalid state


Security Keywords:
- inject

Full commit message:
KVM: VMX: Exit to userspace if vCPU has injected exception and invalid state

Exit to userspace with an emulation error if KVM encounters an injected
exception with invalid guest state, in addition to the existing check of
bailing if there's a pending exception (KVM doesn't support emulating
exceptions except when emulating real mode via vm86).

In theory, KVM should never get to such a situation as KVM is supposed to
exit to userspace before injecting an exception with invalid guest state.
But in practice, userspace can intervene and manually inject an exception
and/or stuff registers to force invalid guest state while a previously
injected exception is awaiting reinjection.

Fixes: fc4fad79fc3d ("KVM: VMX: Reject KVM_RUN if emulation is required with pending exception")
Reported-by: syzbot+cfafed3bb76d3e37581b@syzkaller.appspotmail.com
Signed-off-by: Sean Christopherson <seanjc@google.com>
Message-Id: <20220502221850.131873-1-seanjc@google.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

Metadata:
Author: Sean Christopherson <seanjc@google.com>
Author Date: Mon May 2 22:18:50 2022 +0000
Committer: Paolo Bonzini <pbonzini@redhat.com>
Commit Date: Fri May 6 13:08:06 2022 -0400

Files Changed: 1
Lines Added: 1
Lines Removed: 1
Total Changes: 2
