{
  "hash": "f9fabcb58a6d26d6efde842d1703ac7cfa9427b6",
  "hash_short": "f9fabcb5",
  "subject": "personality: fix PER_CLEAR_ON_SETID",
  "body": "We have found that the current PER_CLEAR_ON_SETID mask on Linux doesn't\ninclude neither ADDR_COMPAT_LAYOUT, nor MMAP_PAGE_ZERO.\n\nThe current mask is READ_IMPLIES_EXEC|ADDR_NO_RANDOMIZE.\n\nWe believe it is important to add MMAP_PAGE_ZERO, because by using this\npersonality it is possible to have the first page mapped inside a\nprocess running as setuid root.  This could be used in those scenarios:\n\n - Exploiting a NULL pointer dereference issue in a setuid root binary\n - Bypassing the mmap_min_addr restrictions of the Linux kernel: by\n   running a setuid binary that would drop privileges before giving us\n   control back (for instance by loading a user-supplied library), we\n   could get the first page mapped in a process we control.  By further\n   using mremap and mprotect on this mapping, we can then completely\n   bypass the mmap_min_addr restrictions.\n\nLess importantly, we believe ADDR_COMPAT_LAYOUT should also be added\nsince on x86 32bits it will in practice disable most of the address\nspace layout randomization (only the stack will remain randomized).\n\nSigned-off-by: Julien Tinnes <jt@cr0.org>\nSigned-off-by: Tavis Ormandy <taviso@sdf.lonestar.org>\nCc: stable@kernel.org\nAcked-by: Christoph Hellwig <hch@infradead.org>\nAcked-by: Kees Cook <kees@ubuntu.com>\nAcked-by: Eugene Teo <eugene@redhat.com>\n[ Shortened lines and fixed whitespace as per Christophs' suggestion ]\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
  "full_message": "personality: fix PER_CLEAR_ON_SETID\n\nWe have found that the current PER_CLEAR_ON_SETID mask on Linux doesn't\ninclude neither ADDR_COMPAT_LAYOUT, nor MMAP_PAGE_ZERO.\n\nThe current mask is READ_IMPLIES_EXEC|ADDR_NO_RANDOMIZE.\n\nWe believe it is important to add MMAP_PAGE_ZERO, because by using this\npersonality it is possible to have the first page mapped inside a\nprocess running as setuid root.  This could be used in those scenarios:\n\n - Exploiting a NULL pointer dereference issue in a setuid root binary\n - Bypassing the mmap_min_addr restrictions of the Linux kernel: by\n   running a setuid binary that would drop privileges before giving us\n   control back (for instance by loading a user-supplied library), we\n   could get the first page mapped in a process we control.  By further\n   using mremap and mprotect on this mapping, we can then completely\n   bypass the mmap_min_addr restrictions.\n\nLess importantly, we believe ADDR_COMPAT_LAYOUT should also be added\nsince on x86 32bits it will in practice disable most of the address\nspace layout randomization (only the stack will remain randomized).\n\nSigned-off-by: Julien Tinnes <jt@cr0.org>\nSigned-off-by: Tavis Ormandy <taviso@sdf.lonestar.org>\nCc: stable@kernel.org\nAcked-by: Christoph Hellwig <hch@infradead.org>\nAcked-by: Kees Cook <kees@ubuntu.com>\nAcked-by: Eugene Teo <eugene@redhat.com>\n[ Shortened lines and fixed whitespace as per Christophs' suggestion ]\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
  "author_name": "Julien Tinnes",
  "author_email": "jt@cr0.org",
  "author_date": "Fri Jun 26 20:27:40 2009 +0200",
  "author_date_iso": "2009-06-26T20:27:40+02:00",
  "committer_name": "Linus Torvalds",
  "committer_email": "torvalds@linux-foundation.org",
  "committer_date": "Sun Jul 12 12:21:33 2009 -0700",
  "committer_date_iso": "2009-07-12T12:21:33-07:00",
  "files_changed": [
    "include/linux/personality.h"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "include/linux/personality.h",
      "insertions": 4,
      "deletions": 1
    }
  ],
  "total_insertions": 4,
  "total_deletions": 1,
  "total_changes": 5,
  "parents": [
    "a137802ee839ace40079bebde24cfb416f73208a"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v2.6.31",
    "v2.6.31-rc3",
    "v2.6.31-rc4",
    "v2.6.31-rc5",
    "v2.6.31-rc6",
    "v2.6.31-rc7",
    "v2.6.31-rc8",
    "v2.6.31-rc9",
    "v2.6.32",
    "v2.6.32-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "bypass"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "include/linux/personality.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}