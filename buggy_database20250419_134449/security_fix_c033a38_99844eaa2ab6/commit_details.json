{
  "hash": "c033a38a81bc539d6c0db8c5387e0b14d819a0cf",
  "hash_short": "c033a38a",
  "subject": "mac80211: fix radiotap header generation",
  "body": "In commit 8c89f7b3d3f2 (\"mac80211: Use flex-array for radiotap header\nbitmap\") we accidentally pointed the position to the wrong place, so\nwe overwrite a present bitmap, and thus cause all kinds of trouble.\n\nTo see the issue, note that the previous code read:\n\n  pos = (void *)(it_present + 1);\n\nThe requirement now is that we need to calculate pos via it_optional,\nto not trigger the compiler hardening checks, as:\n\n  pos = (void *)&rthdr->it_optional[...];\n\nRewriting the original expression, we get (obviously, since that just\nadds \"+ x - x\" terms):\n\n  pos = (void *)(it_present + 1 + rthdr->it_optional - rthdr->it_optional)\n\nand moving the \"+ rthdr->it_optional\" outside to be used as an array:\n\n  pos = (void *)&rthdr->it_optional[it_present + 1 - rthdr->it_optional];\n\nThe original is off by one, fix it.\n\nCc: stable@vger.kernel.org\nFixes: 8c89f7b3d3f2 (\"mac80211: Use flex-array for radiotap header bitmap\")\nReported-by: Sid Hayn <sidhayn@gmail.com>\nSigned-off-by: Johannes Berg <johannes.berg@intel.com>\nTested-by: Sid Hayn <sidhayn@gmail.com>\nReviewed-by: Kees Cook <keescook@chromium.org>\nLink: https://lore.kernel.org/r/20211109100203.c61007433ed6.I1dade57aba7de9c4f48d68249adbae62636fd98c@changeid\nSigned-off-by: Johannes Berg <johannes.berg@intel.com>",
  "full_message": "mac80211: fix radiotap header generation\n\nIn commit 8c89f7b3d3f2 (\"mac80211: Use flex-array for radiotap header\nbitmap\") we accidentally pointed the position to the wrong place, so\nwe overwrite a present bitmap, and thus cause all kinds of trouble.\n\nTo see the issue, note that the previous code read:\n\n  pos = (void *)(it_present + 1);\n\nThe requirement now is that we need to calculate pos via it_optional,\nto not trigger the compiler hardening checks, as:\n\n  pos = (void *)&rthdr->it_optional[...];\n\nRewriting the original expression, we get (obviously, since that just\nadds \"+ x - x\" terms):\n\n  pos = (void *)(it_present + 1 + rthdr->it_optional - rthdr->it_optional)\n\nand moving the \"+ rthdr->it_optional\" outside to be used as an array:\n\n  pos = (void *)&rthdr->it_optional[it_present + 1 - rthdr->it_optional];\n\nThe original is off by one, fix it.\n\nCc: stable@vger.kernel.org\nFixes: 8c89f7b3d3f2 (\"mac80211: Use flex-array for radiotap header bitmap\")\nReported-by: Sid Hayn <sidhayn@gmail.com>\nSigned-off-by: Johannes Berg <johannes.berg@intel.com>\nTested-by: Sid Hayn <sidhayn@gmail.com>\nReviewed-by: Kees Cook <keescook@chromium.org>\nLink: https://lore.kernel.org/r/20211109100203.c61007433ed6.I1dade57aba7de9c4f48d68249adbae62636fd98c@changeid\nSigned-off-by: Johannes Berg <johannes.berg@intel.com>",
  "author_name": "Johannes Berg",
  "author_email": "johannes.berg@intel.com",
  "author_date": "Tue Nov 9 10:02:04 2021 +0100",
  "author_date_iso": "2021-11-09T10:02:04+01:00",
  "committer_name": "Johannes Berg",
  "committer_email": "johannes.berg@intel.com",
  "committer_date": "Mon Nov 15 10:55:20 2021 +0100",
  "committer_date_iso": "2021-11-15T10:55:20+01:00",
  "files_changed": [
    "net/mac80211/rx.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "net/mac80211/rx.c",
      "insertions": 1,
      "deletions": 1
    }
  ],
  "total_insertions": 1,
  "total_deletions": 1,
  "total_changes": 2,
  "parents": [
    "77dfc2bc0bb4b8376ecd7a430f27a4a8fff6a5a0"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "hardening"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "net/mac80211/rx.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}