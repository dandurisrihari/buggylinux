{
  "hash": "7dd0fdff145c5be7146d0ac06732ae3613412ac1",
  "hash_short": "7dd0fdff",
  "subject": "KVM: i8254: change PIT discard tick policy",
  "body": "Discard policy uses ack_notifiers to prevent injection of PIT interrupts\nbefore EOI from the last one.\n\nThis patch changes the policy to always try to deliver the interrupt,\nwhich makes a difference when its vector is in ISR.\nOld implementation would drop the interrupt, but proposed one injects to\nIRR, like real hardware would.\n\nThe old policy breaks legacy NMI watchdogs, where PIT is used through\nvirtual wire (LVT0): PIT never sends an interrupt before receiving EOI,\nthus a guest deadlock with disabled interrupts will stop NMIs.\n\nNote that NMI doesn't do EOI, so PIT also had to send a normal interrupt\nthrough IOAPIC.  (KVM's PIT is deeply rotten and luckily not used much\nin modern systems.)\n\nEven though there is a chance of regressions, I think we can fix the\nLVT0 NMI bug without introducing a new tick policy.\n\nCc: <stable@vger.kernel.org>\nReported-by: Yuki Shibuya <shibuya.yk@ncos.nec.co.jp>\nReviewed-by: Paolo Bonzini <pbonzini@redhat.com>\nSigned-off-by: Radim Kr\u010dm\u00e1\u0159 <rkrcmar@redhat.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "full_message": "KVM: i8254: change PIT discard tick policy\n\nDiscard policy uses ack_notifiers to prevent injection of PIT interrupts\nbefore EOI from the last one.\n\nThis patch changes the policy to always try to deliver the interrupt,\nwhich makes a difference when its vector is in ISR.\nOld implementation would drop the interrupt, but proposed one injects to\nIRR, like real hardware would.\n\nThe old policy breaks legacy NMI watchdogs, where PIT is used through\nvirtual wire (LVT0): PIT never sends an interrupt before receiving EOI,\nthus a guest deadlock with disabled interrupts will stop NMIs.\n\nNote that NMI doesn't do EOI, so PIT also had to send a normal interrupt\nthrough IOAPIC.  (KVM's PIT is deeply rotten and luckily not used much\nin modern systems.)\n\nEven though there is a chance of regressions, I think we can fix the\nLVT0 NMI bug without introducing a new tick policy.\n\nCc: <stable@vger.kernel.org>\nReported-by: Yuki Shibuya <shibuya.yk@ncos.nec.co.jp>\nReviewed-by: Paolo Bonzini <pbonzini@redhat.com>\nSigned-off-by: Radim Kr\u010dm\u00e1\u0159 <rkrcmar@redhat.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>",
  "author_name": "Radim Kr\u010dm\u00e1\u0159",
  "author_email": "rkrcmar@redhat.com",
  "author_date": "Wed Mar 2 22:56:38 2016 +0100",
  "author_date_iso": "2016-03-02T22:56:38+01:00",
  "committer_name": "Paolo Bonzini",
  "committer_email": "pbonzini@redhat.com",
  "committer_date": "Fri Mar 4 09:29:31 2016 +0100",
  "committer_date_iso": "2016-03-04T09:29:31+01:00",
  "files_changed": [
    "arch/x86/kvm/i8254.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "arch/x86/kvm/i8254.c",
      "insertions": 7,
      "deletions": 5
    }
  ],
  "total_insertions": 7,
  "total_deletions": 5,
  "total_changes": 12,
  "parents": [
    "13d268ca2c4c29d6da2ba79419f9a655e602afed"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.10",
    "v4.10-rc1",
    "v4.10-rc2",
    "v4.10-rc3",
    "v4.10-rc4",
    "v4.10-rc5",
    "v4.10-rc6",
    "v4.10-rc7",
    "v4.10-rc8",
    "v4.11"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/x86/kvm/i8254.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}