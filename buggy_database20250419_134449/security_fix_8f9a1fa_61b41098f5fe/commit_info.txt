Commit Hash: 8f9a1fa4308363944ba94a961f69646c4b0ff26b
Subject: net: xfrmi: implement header_ops->parse_protocol for AF_PACKET


Security Keywords:
- injection

Full commit message:
net: xfrmi: implement header_ops->parse_protocol for AF_PACKET

The xfrm interface uses skb->protocol to determine packet type, and
bails out if it's not set. For AF_PACKET injection, we need to support
its call chain of:

    packet_sendmsg -> packet_snd -> packet_parse_headers ->
      dev_parse_header_protocol -> parse_protocol

Without a valid parse_protocol, this returns zero, and xfrmi rejects the
skb. So, this wires up the ip_tunnel handler for layer 3 packets for
that case.

Reported-by: Willem de Bruijn <willemdebruijn.kernel@gmail.com>
Signed-off-by: Jason A. Donenfeld <Jason@zx2c4.com>
Signed-off-by: David S. Miller <davem@davemloft.net>

Metadata:
Author: Jason A. Donenfeld <Jason@zx2c4.com>
Author Date: Mon Jun 29 19:06:25 2020 -0600
Committer: David S. Miller <davem@davemloft.net>
Commit Date: Tue Jun 30 12:29:39 2020 -0700

Files Changed: 1
Lines Added: 2
Lines Removed: 0
Total Changes: 2
