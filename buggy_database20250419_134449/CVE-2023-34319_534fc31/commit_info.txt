Commit Hash: 534fc31d09b706a16d83533e16b5dc855caf7576
Subject: xen/netback: Fix buffer overrun triggered by unusual packet

CVE Identifiers:
- CVE-2023-34319

Full commit message:
xen/netback: Fix buffer overrun triggered by unusual packet

It is possible that a guest can send a packet that contains a head + 18
slots and yet has a len <= XEN_NETBACK_TX_COPY_LEN. This causes nr_slots
to underflow in xenvif_get_requests() which then causes the subsequent
loop's termination condition to be wrong, causing a buffer overrun of
queue->tx_map_ops.

Rework the code to account for the extra frag_overflow slots.

This is CVE-2023-34319 / XSA-432.

Fixes: ad7f402ae4f4 ("xen/netback: Ensure protocol headers don't fall in the non-linear area")
Signed-off-by: Ross Lagerwall <ross.lagerwall@citrix.com>
Reviewed-by: Paul Durrant <paul@xen.org>
Reviewed-by: Wei Liu <wei.liu@kernel.org>
Signed-off-by: Juergen Gross <jgross@suse.com>

Metadata:
Author: Ross Lagerwall <ross.lagerwall@citrix.com>
Author Date: Thu Aug 3 08:41:22 2023 +0200
Committer: Juergen Gross <jgross@suse.com>
Commit Date: Thu Aug 3 09:04:08 2023 +0200

Files Changed: 1
Lines Added: 10
Lines Removed: 5
Total Changes: 15
