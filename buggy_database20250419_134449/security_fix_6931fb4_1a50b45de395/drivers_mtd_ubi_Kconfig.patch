commit 6931fb44858c3b9da9f35fdc8d9cbeef0b4b50a3
Author: ZhaoLong Wang <wangzhaolong1@huawei.com>
Date:   Tue Dec 26 09:01:09 2023 +0800

    ubi: Use the fault injection framework to enhance the fault injection capability
    
    To make debug parameters configurable at run time, use the
    fault injection framework to reconstruct the debugfs interface,
    and retain the legacy fault injection interface.
    
    Now, the file emulate_failures and fault_attr files control whether
    to enable fault emmulation.
    
    The file emulate_failures receives a mask that controls type and
    process of fault injection. Generally, for ease of use, you can
    directly enter a mask with all 1s.
    
    echo 0xffff > /sys/kernel/debug/ubi/ubi0/emulate_failures
    
    And you need to configure other fault-injection capabilities for
    testing purpose:
    
    echo 100 > /sys/kernel/debug/ubi/fault_inject/emulate_power_cut/probability
    echo 15 > /sys/kernel/debug/ubi/fault_inject/emulate_power_cut/space
    echo 2 > /sys/kernel/debug/ubi/fault_inject/emulate_power_cut/verbose
    echo -1 > /sys/kernel/debug/ubi/fault_inject/emulate_power_cut/times
    
    The CONFIG_MTD_UBI_FAULT_INJECTION to enable the Fault Injection is
    added to kconfig.
    
    Signed-off-by: ZhaoLong Wang <wangzhaolong1@huawei.com>
    Reviewed-by: Zhihao Cheng <chengzhihao1@huawei.com>
    Signed-off-by: Richard Weinberger <richard@nod.at>

diff --git a/drivers/mtd/ubi/Kconfig b/drivers/mtd/ubi/Kconfig
index 2ed77b7b3fcb..7499a540121e 100644
--- a/drivers/mtd/ubi/Kconfig
+++ b/drivers/mtd/ubi/Kconfig
@@ -104,4 +104,13 @@ config MTD_UBI_BLOCK
 
 	   If in doubt, say "N".
 
+config MTD_UBI_FAULT_INJECTION
+	bool "Fault injection capability of UBI device"
+	default n
+	depends on FAULT_INJECTION_DEBUG_FS
+	help
+	   This option enables fault-injection support for UBI devices for
+	   testing purposes.
+
+	   If in doubt, say "N".
 endif # MTD_UBI