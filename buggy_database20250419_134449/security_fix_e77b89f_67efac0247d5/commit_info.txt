Commit Hash: e77b89f13a0d48aea70b69976e854f2a2444a519
Subject: [CPUFREQ] Fix use after free on governor restore


Security Keywords:
- exploit

Full commit message:
[CPUFREQ] Fix use after free on governor restore

Currently on governer backup/restore path we storing governor's pointer.
This is wrong because one may unload governor's module after cpu goes
offline. As result use-after-free will take place on restored cpu.
It is not easy to exploit this bug, but still we have to close this
issue ASAP. Issue was introduced by following commit
084f34939424161669467c19280dbcf637730314

##TESTCASE##
#!/bin/sh -x
modprobe acpi_cpufreq
# Any non default governor, in may case it is "ondemand"
modprobe cpufreq_ondemand
echo ondemand > /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
rmmod acpi_cpufreq
rmmod cpufreq_ondemand
modprobe acpi_cpufreq  # << use-after-free here.

Signed-off-by: Dmitry Monakhov <dmonakhov@openvz.org>
Signed-off-by: Dave Jones <davej@redhat.com>

Metadata:
Author: Dmitry Monakhov <dmonakhov@openvz.org>
Author Date: Mon Oct 5 00:38:55 2009 +0400
Committer: Dave Jones <davej@redhat.com>
Commit Date: Tue Nov 17 23:15:04 2009 -0500

Files Changed: 1
Lines Added: 10
Lines Removed: 6
Total Changes: 16
