{
  "hash": "56c5812623f95313f6a46fbf0beee7fa17c68bbf",
  "hash_short": "56c58126",
  "subject": "certs: Add EFI_CERT_X509_GUID support for dbx entries",
  "body": "This fixes CVE-2020-26541.\n\nThe Secure Boot Forbidden Signature Database, dbx, contains a list of now\nrevoked signatures and keys previously approved to boot with UEFI Secure\nBoot enabled.  The dbx is capable of containing any number of\nEFI_CERT_X509_SHA256_GUID, EFI_CERT_SHA256_GUID, and EFI_CERT_X509_GUID\nentries.\n\nCurrently when EFI_CERT_X509_GUID are contained in the dbx, the entries are\nskipped.\n\nAdd support for EFI_CERT_X509_GUID dbx entries. When a EFI_CERT_X509_GUID\nis found, it is added as an asymmetrical key to the .blacklist keyring.\nAnytime the .platform keyring is used, the keys in the .blacklist keyring\nare referenced, if a matching key is found, the key will be rejected.\n\n[DH: Made the following changes:\n - Added to have a config option to enable the facility.  This allows a\n   Kconfig solution to make sure that pkcs7_validate_trust() is\n   enabled.[1][2]\n - Moved the functions out from the middle of the blacklist functions.\n - Added kerneldoc comments.]\n\nSigned-off-by: Eric Snowberg <eric.snowberg@oracle.com>\nSigned-off-by: David Howells <dhowells@redhat.com>\nReviewed-by: Jarkko Sakkinen <jarkko@kernel.org>\ncc: Randy Dunlap <rdunlap@infradead.org>\ncc: Micka\u00ebl Sala\u00fcn <mic@digikod.net>\ncc: Arnd Bergmann <arnd@kernel.org>\ncc: keyrings@vger.kernel.org\nLink: https://lore.kernel.org/r/20200901165143.10295-1-eric.snowberg@oracle.com/ # rfc\nLink: https://lore.kernel.org/r/20200909172736.73003-1-eric.snowberg@oracle.com/ # v2\nLink: https://lore.kernel.org/r/20200911182230.62266-1-eric.snowberg@oracle.com/ # v3\nLink: https://lore.kernel.org/r/20200916004927.64276-1-eric.snowberg@oracle.com/ # v4\nLink: https://lore.kernel.org/r/20210122181054.32635-2-eric.snowberg@oracle.com/ # v5\nLink: https://lore.kernel.org/r/161428672051.677100.11064981943343605138.stgit@warthog.procyon.org.uk/\nLink: https://lore.kernel.org/r/161433310942.902181.4901864302675874242.stgit@warthog.procyon.org.uk/ # v2\nLink: https://lore.kernel.org/r/161529605075.163428.14625520893961300757.stgit@warthog.procyon.org.uk/ # v3\nLink: https://lore.kernel.org/r/bc2c24e3-ed68-2521-0bf4-a1f6be4a895d@infradead.org/ [1]\nLink: https://lore.kernel.org/r/20210225125638.1841436-1-arnd@kernel.org/ [2]",
  "full_message": "certs: Add EFI_CERT_X509_GUID support for dbx entries\n\nThis fixes CVE-2020-26541.\n\nThe Secure Boot Forbidden Signature Database, dbx, contains a list of now\nrevoked signatures and keys previously approved to boot with UEFI Secure\nBoot enabled.  The dbx is capable of containing any number of\nEFI_CERT_X509_SHA256_GUID, EFI_CERT_SHA256_GUID, and EFI_CERT_X509_GUID\nentries.\n\nCurrently when EFI_CERT_X509_GUID are contained in the dbx, the entries are\nskipped.\n\nAdd support for EFI_CERT_X509_GUID dbx entries. When a EFI_CERT_X509_GUID\nis found, it is added as an asymmetrical key to the .blacklist keyring.\nAnytime the .platform keyring is used, the keys in the .blacklist keyring\nare referenced, if a matching key is found, the key will be rejected.\n\n[DH: Made the following changes:\n - Added to have a config option to enable the facility.  This allows a\n   Kconfig solution to make sure that pkcs7_validate_trust() is\n   enabled.[1][2]\n - Moved the functions out from the middle of the blacklist functions.\n - Added kerneldoc comments.]\n\nSigned-off-by: Eric Snowberg <eric.snowberg@oracle.com>\nSigned-off-by: David Howells <dhowells@redhat.com>\nReviewed-by: Jarkko Sakkinen <jarkko@kernel.org>\ncc: Randy Dunlap <rdunlap@infradead.org>\ncc: Micka\u00ebl Sala\u00fcn <mic@digikod.net>\ncc: Arnd Bergmann <arnd@kernel.org>\ncc: keyrings@vger.kernel.org\nLink: https://lore.kernel.org/r/20200901165143.10295-1-eric.snowberg@oracle.com/ # rfc\nLink: https://lore.kernel.org/r/20200909172736.73003-1-eric.snowberg@oracle.com/ # v2\nLink: https://lore.kernel.org/r/20200911182230.62266-1-eric.snowberg@oracle.com/ # v3\nLink: https://lore.kernel.org/r/20200916004927.64276-1-eric.snowberg@oracle.com/ # v4\nLink: https://lore.kernel.org/r/20210122181054.32635-2-eric.snowberg@oracle.com/ # v5\nLink: https://lore.kernel.org/r/161428672051.677100.11064981943343605138.stgit@warthog.procyon.org.uk/\nLink: https://lore.kernel.org/r/161433310942.902181.4901864302675874242.stgit@warthog.procyon.org.uk/ # v2\nLink: https://lore.kernel.org/r/161529605075.163428.14625520893961300757.stgit@warthog.procyon.org.uk/ # v3\nLink: https://lore.kernel.org/r/bc2c24e3-ed68-2521-0bf4-a1f6be4a895d@infradead.org/ [1]\nLink: https://lore.kernel.org/r/20210225125638.1841436-1-arnd@kernel.org/ [2]",
  "author_name": "Eric Snowberg",
  "author_email": "eric.snowberg@oracle.com",
  "author_date": "Fri Jan 22 13:10:51 2021 -0500",
  "author_date_iso": "2021-01-22T13:10:51-05:00",
  "committer_name": "David Howells",
  "committer_email": "dhowells@redhat.com",
  "committer_date": "Thu Mar 11 16:31:28 2021 +0000",
  "committer_date_iso": "2021-03-11T16:31:28+00:00",
  "files_changed": [
    "certs/Kconfig",
    "certs/blacklist.c",
    "certs/blacklist.h",
    "certs/system_keyring.c",
    "include/keys/system_keyring.h",
    "security/integrity/platform_certs/keyring_handler.c"
  ],
  "files_changed_count": 6,
  "stats": [
    {
      "file": "certs/Kconfig",
      "insertions": 9,
      "deletions": 0
    },
    {
      "file": "certs/blacklist.c",
      "insertions": 43,
      "deletions": 0
    },
    {
      "file": "certs/blacklist.h",
      "insertions": 2,
      "deletions": 0
    },
    {
      "file": "certs/system_keyring.c",
      "insertions": 6,
      "deletions": 0
    },
    {
      "file": "include/keys/system_keyring.h",
      "insertions": 15,
      "deletions": 0
    },
    {
      "file": "security/integrity/platform_certs/keyring_handler.c",
      "insertions": 11,
      "deletions": 0
    }
  ],
  "total_insertions": 86,
  "total_deletions": 0,
  "total_changes": 86,
  "parents": [
    "8f0bfc25c907f38e7f9dc498e8f43000d77327ef"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [
      "CVE-2020-26541"
    ],
    "security_keywords": []
  },
  "fix_type": "cve",
  "file_results": [
    {
      "file": "certs/Kconfig",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "certs/blacklist.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "certs/system_keyring.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "certs/blacklist.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "security/integrity/platform_certs/keyring_handler.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/keys/system_keyring.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}