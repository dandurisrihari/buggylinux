Commit Hash: 45b3fae4675dc1d4ee2d7aefa19d85ee4f891377
Subject: neighbour: Fix __randomize_layout crash in struct neighbour


Security Keywords:
- hardening

Full commit message:
neighbour: Fix __randomize_layout crash in struct neighbour

Previously, one-element and zero-length arrays were treated as true
flexible arrays, even though they are actually "fake" flex arrays.
The __randomize_layout would leave them untouched at the end of the
struct, similarly to proper C99 flex-array members.

However, this approach changed with commit 1ee60356c2dc ("gcc-plugins:
randstruct: Only warn about true flexible arrays"). Now, only C99
flexible-array members will remain untouched at the end of the struct,
while one-element and zero-length arrays will be subject to randomization.

Fix a `__randomize_layout` crash in `struct neighbour` by transforming
zero-length array `primary_key` into a proper C99 flexible-array member.

Fixes: 1ee60356c2dc ("gcc-plugins: randstruct: Only warn about true flexible arrays")
Closes: https://lore.kernel.org/linux-hardening/20231124102458.GB1503258@e124191.cambridge.arm.com/
Signed-off-by: Gustavo A. R. Silva <gustavoars@kernel.org>
Reviewed-by: Kees Cook <keescook@chromium.org>
Tested-by: Joey Gouly <joey.gouly@arm.com>
Link: https://lore.kernel.org/r/ZWJoRsJGnCPdJ3+2@work
Signed-off-by: Paolo Abeni <pabeni@redhat.com>

Metadata:
Author: Gustavo A. R. Silva <gustavoars@kernel.org>
Author Date: Sat Nov 25 15:33:58 2023 -0600
Committer: Paolo Abeni <pabeni@redhat.com>
Commit Date: Tue Nov 28 12:18:29 2023 +0100

Files Changed: 1
Lines Added: 1
Lines Removed: 1
Total Changes: 2
