commit dbf568755e7781a4ce8bd3c587c2c388600ae661
Author: Giovanni Cabiddu <giovanni.cabiddu@intel.com>
Date:   Mon Oct 12 21:38:33 2020 +0100

    crypto: qat - register crypto instances based on capability
    
    Introduce the function adf_hw_dev_has_crypto() that returns true if a
    device supports symmetric crypto, asymmetric crypto and authentication
    services.
    If a device has crypto capabilities, add crypto instances to the
    configuration.
    This is done since the function that allows to retrieve crypto
    instances, qat_crypto_get_instance_node(), return instances that support
    all crypto services.
    
    Signed-off-by: Giovanni Cabiddu <giovanni.cabiddu@intel.com>
    Reviewed-by: Wojciech Ziemba <wojciech.ziemba@intel.com>
    Reviewed-by: Fiona Trahe <fiona.trahe@intel.com>
    Reviewed-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
    Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>

diff --git a/drivers/crypto/qat/qat_common/qat_crypto.h b/drivers/crypto/qat/qat_common/qat_crypto.h
index 8d11e94cbf08..b6a4c95ae003 100644
--- a/drivers/crypto/qat/qat_common/qat_crypto.h
+++ b/drivers/crypto/qat/qat_common/qat_crypto.h
@@ -55,4 +55,19 @@ struct qat_crypto_request {
 	bool encryption;
 };
 
+static inline bool adf_hw_dev_has_crypto(struct adf_accel_dev *accel_dev)
+{
+	struct adf_hw_device_data *hw_device = accel_dev->hw_device;
+	u32 mask = ~hw_device->accel_capabilities_mask;
+
+	if (mask & ADF_ACCEL_CAPABILITIES_CRYPTO_SYMMETRIC)
+		return false;
+	if (mask & ADF_ACCEL_CAPABILITIES_CRYPTO_ASYMMETRIC)
+		return false;
+	if (mask & ADF_ACCEL_CAPABILITIES_AUTHENTICATION)
+		return false;
+
+	return true;
+}
+
 #endif