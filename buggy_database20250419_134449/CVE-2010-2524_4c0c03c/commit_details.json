{
  "hash": "4c0c03ca54f72fdd5912516ad0a23ec5cf01bda7",
  "hash_short": "4c0c03ca",
  "subject": "CIFS: Fix a malicious redirect problem in the DNS lookup code",
  "body": "Fix the security problem in the CIFS filesystem DNS lookup code in which a\nmalicious redirect could be installed by a random user by simply adding a\nresult record into one of their keyrings with add_key() and then invoking a\nCIFS CFS lookup [CVE-2010-2524].\n\nThis is done by creating an internal keyring specifically for the caching of\nDNS lookups.  To enforce the use of this keyring, the module init routine\ncreates a set of override credentials with the keyring installed as the thread\nkeyring and instructs request_key() to only install lookup result keys in that\nkeyring.\n\nThe override is then applied around the call to request_key().\n\nThis has some additional benefits when a kernel service uses this module to\nrequest a key:\n\n (1) The result keys are owned by root, not the user that caused the lookup.\n\n (2) The result keys don't pop up in the user's keyrings.\n\n (3) The result keys don't come out of the quota of the user that caused the\n     lookup.\n\nThe keyring can be viewed as root by doing cat /proc/keys:\n\n2a0ca6c3 I-----     1 perm 1f030000     0     0 keyring   .dns_resolver: 1/4\n\nIt can then be listed with 'keyctl list' by root.\n\n\t# keyctl list 0x2a0ca6c3\n\t1 key in keyring:\n\t726766307: --alswrv     0     0 dns_resolver: foo.bar.com\n\nSigned-off-by: David Howells <dhowells@redhat.com>\nReviewed-and-Tested-by: Jeff Layton <jlayton@redhat.com>\nAcked-by: Steve French <smfrench@gmail.com>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
  "full_message": "CIFS: Fix a malicious redirect problem in the DNS lookup code\n\nFix the security problem in the CIFS filesystem DNS lookup code in which a\nmalicious redirect could be installed by a random user by simply adding a\nresult record into one of their keyrings with add_key() and then invoking a\nCIFS CFS lookup [CVE-2010-2524].\n\nThis is done by creating an internal keyring specifically for the caching of\nDNS lookups.  To enforce the use of this keyring, the module init routine\ncreates a set of override credentials with the keyring installed as the thread\nkeyring and instructs request_key() to only install lookup result keys in that\nkeyring.\n\nThe override is then applied around the call to request_key().\n\nThis has some additional benefits when a kernel service uses this module to\nrequest a key:\n\n (1) The result keys are owned by root, not the user that caused the lookup.\n\n (2) The result keys don't pop up in the user's keyrings.\n\n (3) The result keys don't come out of the quota of the user that caused the\n     lookup.\n\nThe keyring can be viewed as root by doing cat /proc/keys:\n\n2a0ca6c3 I-----     1 perm 1f030000     0     0 keyring   .dns_resolver: 1/4\n\nIt can then be listed with 'keyctl list' by root.\n\n\t# keyctl list 0x2a0ca6c3\n\t1 key in keyring:\n\t726766307: --alswrv     0     0 dns_resolver: foo.bar.com\n\nSigned-off-by: David Howells <dhowells@redhat.com>\nReviewed-and-Tested-by: Jeff Layton <jlayton@redhat.com>\nAcked-by: Steve French <smfrench@gmail.com>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
  "author_name": "David Howells",
  "author_email": "dhowells@redhat.com",
  "author_date": "Thu Jul 22 12:53:18 2010 +0100",
  "author_date_iso": "2010-07-22T12:53:18+01:00",
  "committer_name": "Linus Torvalds",
  "committer_email": "torvalds@linux-foundation.org",
  "committer_date": "Thu Jul 22 09:42:40 2010 -0700",
  "committer_date_iso": "2010-07-22T09:42:40-07:00",
  "files_changed": [
    "fs/cifs/cifsfs.c",
    "fs/cifs/dns_resolve.c",
    "fs/cifs/dns_resolve.h"
  ],
  "files_changed_count": 3,
  "stats": [
    {
      "file": "fs/cifs/cifsfs.c",
      "insertions": 3,
      "deletions": 3
    },
    {
      "file": "fs/cifs/dns_resolve.c",
      "insertions": 69,
      "deletions": 0
    },
    {
      "file": "fs/cifs/dns_resolve.h",
      "insertions": 2,
      "deletions": 2
    }
  ],
  "total_insertions": 74,
  "total_deletions": 5,
  "total_changes": 79,
  "parents": [
    "cd5b8f8755a89a57fc8c408d284b8b613f090345"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v2.6.35",
    "v2.6.35-rc6",
    "v2.6.36",
    "v2.6.36-rc1",
    "v2.6.36-rc2",
    "v2.6.36-rc3",
    "v2.6.36-rc4",
    "v2.6.36-rc5",
    "v2.6.36-rc6",
    "v2.6.36-rc7"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [
      "CVE-2010-2524"
    ],
    "security_keywords": []
  },
  "fix_type": "cve",
  "file_results": [
    {
      "file": "fs/cifs/cifsfs.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "fs/cifs/dns_resolve.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "fs/cifs/dns_resolve.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}