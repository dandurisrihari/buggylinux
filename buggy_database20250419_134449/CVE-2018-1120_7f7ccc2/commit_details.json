{
  "hash": "7f7ccc2ccc2e70c6054685f5e3522efa81556830",
  "hash_short": "7f7ccc2c",
  "subject": "proc: do not access cmdline nor environ from file-backed areas",
  "body": "proc_pid_cmdline_read() and environ_read() directly access the target\nprocess' VM to retrieve the command line and environment. If this\nprocess remaps these areas onto a file via mmap(), the requesting\nprocess may experience various issues such as extra delays if the\nunderlying device is slow to respond.\n\nLet's simply refuse to access file-backed areas in these functions.\nFor this we add a new FOLL_ANON gup flag that is passed to all calls\nto access_remote_vm(). The code already takes care of such failures\n(including unmapped areas). Accesses via /proc/pid/mem were not\nchanged though.\n\nThis was assigned CVE-2018-1120.\n\nNote for stable backports: the patch may apply to kernels prior to 4.11\nbut silently miss one location; it must be checked that no call to\naccess_remote_vm() keeps zero as the last argument.\n\nReported-by: Qualys Security Advisory <qsa@qualys.com>\nCc: Linus Torvalds <torvalds@linux-foundation.org>\nCc: Andy Lutomirski <luto@amacapital.net>\nCc: Oleg Nesterov <oleg@redhat.com>\nCc: stable@vger.kernel.org\nSigned-off-by: Willy Tarreau <w@1wt.eu>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
  "full_message": "proc: do not access cmdline nor environ from file-backed areas\n\nproc_pid_cmdline_read() and environ_read() directly access the target\nprocess' VM to retrieve the command line and environment. If this\nprocess remaps these areas onto a file via mmap(), the requesting\nprocess may experience various issues such as extra delays if the\nunderlying device is slow to respond.\n\nLet's simply refuse to access file-backed areas in these functions.\nFor this we add a new FOLL_ANON gup flag that is passed to all calls\nto access_remote_vm(). The code already takes care of such failures\n(including unmapped areas). Accesses via /proc/pid/mem were not\nchanged though.\n\nThis was assigned CVE-2018-1120.\n\nNote for stable backports: the patch may apply to kernels prior to 4.11\nbut silently miss one location; it must be checked that no call to\naccess_remote_vm() keeps zero as the last argument.\n\nReported-by: Qualys Security Advisory <qsa@qualys.com>\nCc: Linus Torvalds <torvalds@linux-foundation.org>\nCc: Andy Lutomirski <luto@amacapital.net>\nCc: Oleg Nesterov <oleg@redhat.com>\nCc: stable@vger.kernel.org\nSigned-off-by: Willy Tarreau <w@1wt.eu>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
  "author_name": "Willy Tarreau",
  "author_email": "w@1wt.eu",
  "author_date": "Fri May 11 08:11:44 2018 +0200",
  "author_date_iso": "2018-05-11T08:11:44+02:00",
  "committer_name": "Linus Torvalds",
  "committer_email": "torvalds@linux-foundation.org",
  "committer_date": "Thu May 17 09:27:47 2018 -0700",
  "committer_date_iso": "2018-05-17T09:27:47-07:00",
  "files_changed": [
    "fs/proc/base.c",
    "include/linux/mm.h",
    "mm/gup.c"
  ],
  "files_changed_count": 3,
  "stats": [
    {
      "file": "fs/proc/base.c",
      "insertions": 4,
      "deletions": 4
    },
    {
      "file": "include/linux/mm.h",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "mm/gup.c",
      "insertions": 3,
      "deletions": 0
    }
  ],
  "total_insertions": 8,
  "total_deletions": 4,
  "total_changes": 12,
  "parents": [
    "e6506eb241871d68647c53cb6d0a16299550ae97"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.17",
    "v4.17-rc6",
    "v4.17-rc7",
    "v4.18",
    "v4.18-rc1",
    "v4.18-rc2",
    "v4.18-rc3",
    "v4.18-rc4",
    "v4.18-rc5",
    "v4.18-rc6"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [
      "CVE-2018-1120"
    ],
    "security_keywords": []
  },
  "fix_type": "cve",
  "file_results": [
    {
      "file": "fs/proc/base.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/linux/mm.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "mm/gup.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}