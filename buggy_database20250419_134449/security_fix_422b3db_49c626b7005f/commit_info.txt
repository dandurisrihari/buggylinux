Commit Hash: 422b3db2a5036add39a82425b1dd9fb6c96481e8
Subject: firmware: Fix security issue with request_firmware_into_buf()


Security Keywords:
- security issue

Full commit message:
firmware: Fix security issue with request_firmware_into_buf()

When calling request_firmware_into_buf() with the FW_OPT_NOCACHE flag
it is expected that firmware is loaded into buffer from memory.
But inside alloc_lookup_fw_priv every new firmware that is loaded is
added to the firmware cache (fwc) list head. So if any driver requests
a firmware that is already loaded the code iterates over the above
mentioned list and it can end up giving a pointer to other device driver's
firmware buffer.
Also the existing copy may either be modified by drivers, remote processors
or even freed. This causes a potential security issue with batched requests
when using request_firmware_into_buf.

Fix alloc_lookup_fw_priv to not add to the fwc head list if FW_OPT_NOCACHE
is set, and also don't do the lookup in the list.

Fixes: 0e742e9275 ("firmware: provide infrastructure to make fw caching optional")
[mcgrof: broken since feature introduction on v4.8]

Cc: stable@vger.kernel.org # v4.8+
Signed-off-by: Vikram Mulukutla <markivx@codeaurora.org>
Signed-off-by: Rishabh Bhatnagar <rishabhb@codeaurora.org>
Signed-off-by: Luis Chamberlain <mcgrof@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

Metadata:
Author: Rishabh Bhatnagar <rishabhb@codeaurora.org>
Author Date: Fri Aug 31 08:43:31 2018 -0700
Committer: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Commit Date: Wed Sep 12 09:31:00 2018 +0200

Files Changed: 1
Lines Added: 18
Lines Removed: 12
Total Changes: 30
