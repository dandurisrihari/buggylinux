{
  "hash": "422b3db2a5036add39a82425b1dd9fb6c96481e8",
  "hash_short": "422b3db2",
  "subject": "firmware: Fix security issue with request_firmware_into_buf()",
  "body": "When calling request_firmware_into_buf() with the FW_OPT_NOCACHE flag\nit is expected that firmware is loaded into buffer from memory.\nBut inside alloc_lookup_fw_priv every new firmware that is loaded is\nadded to the firmware cache (fwc) list head. So if any driver requests\na firmware that is already loaded the code iterates over the above\nmentioned list and it can end up giving a pointer to other device driver's\nfirmware buffer.\nAlso the existing copy may either be modified by drivers, remote processors\nor even freed. This causes a potential security issue with batched requests\nwhen using request_firmware_into_buf.\n\nFix alloc_lookup_fw_priv to not add to the fwc head list if FW_OPT_NOCACHE\nis set, and also don't do the lookup in the list.\n\nFixes: 0e742e9275 (\"firmware: provide infrastructure to make fw caching optional\")\n[mcgrof: broken since feature introduction on v4.8]\n\nCc: stable@vger.kernel.org # v4.8+\nSigned-off-by: Vikram Mulukutla <markivx@codeaurora.org>\nSigned-off-by: Rishabh Bhatnagar <rishabhb@codeaurora.org>\nSigned-off-by: Luis Chamberlain <mcgrof@kernel.org>\nSigned-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>",
  "full_message": "firmware: Fix security issue with request_firmware_into_buf()\n\nWhen calling request_firmware_into_buf() with the FW_OPT_NOCACHE flag\nit is expected that firmware is loaded into buffer from memory.\nBut inside alloc_lookup_fw_priv every new firmware that is loaded is\nadded to the firmware cache (fwc) list head. So if any driver requests\na firmware that is already loaded the code iterates over the above\nmentioned list and it can end up giving a pointer to other device driver's\nfirmware buffer.\nAlso the existing copy may either be modified by drivers, remote processors\nor even freed. This causes a potential security issue with batched requests\nwhen using request_firmware_into_buf.\n\nFix alloc_lookup_fw_priv to not add to the fwc head list if FW_OPT_NOCACHE\nis set, and also don't do the lookup in the list.\n\nFixes: 0e742e9275 (\"firmware: provide infrastructure to make fw caching optional\")\n[mcgrof: broken since feature introduction on v4.8]\n\nCc: stable@vger.kernel.org # v4.8+\nSigned-off-by: Vikram Mulukutla <markivx@codeaurora.org>\nSigned-off-by: Rishabh Bhatnagar <rishabhb@codeaurora.org>\nSigned-off-by: Luis Chamberlain <mcgrof@kernel.org>\nSigned-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>",
  "author_name": "Rishabh Bhatnagar",
  "author_email": "rishabhb@codeaurora.org",
  "author_date": "Fri Aug 31 08:43:31 2018 -0700",
  "author_date_iso": "2018-08-31T08:43:31-07:00",
  "committer_name": "Greg Kroah-Hartman",
  "committer_email": "gregkh@linuxfoundation.org",
  "committer_date": "Wed Sep 12 09:31:00 2018 +0200",
  "committer_date_iso": "2018-09-12T09:31:00+02:00",
  "files_changed": [
    "drivers/base/firmware_loader/main.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/base/firmware_loader/main.c",
      "insertions": 18,
      "deletions": 12
    }
  ],
  "total_insertions": 18,
  "total_deletions": 12,
  "total_changes": 30,
  "parents": [
    "6712cc9c22117a8af9f3df272b4a44fd2e4201cd"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.19",
    "v4.19-rc4",
    "v4.19-rc5",
    "v4.19-rc6",
    "v4.19-rc7",
    "v4.19-rc8",
    "v4.20",
    "v4.20-rc1",
    "v4.20-rc2",
    "v4.20-rc3"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "security issue"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/base/firmware_loader/main.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}