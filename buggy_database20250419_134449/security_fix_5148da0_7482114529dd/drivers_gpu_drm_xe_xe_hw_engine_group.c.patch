commit 5148da09dcd3f00913ddfc5d03901c4de56b61e3
Author: Francois Dugast <francois.dugast@intel.com>
Date:   Wed Mar 5 16:06:59 2025 +0100

    drm/xe: Allow fault injection in exec queue IOCTLs
    
    Use fault injection infrastructure to allow specific functions to
    be configured over debugfs for failing during the execution of
    xe_exec_queue_create_ioctl(). xe_exec_queue_destroy_ioctl() and
    xe_exec_queue_get_property_ioctl() are not considered as there is
    no unwinding code to test with fault injection.
    
    This allows more thorough testing from user space by going through
    code paths for error handling and unwinding which cannot be reached
    by simply injecting errors in IOCTL arguments. This can help
    increase code robustness.
    
    The corresponding IGT series is:
    https://patchwork.freedesktop.org/series/144138/
    
    Reviewed-by: Sai Teja Pottumuttu <sai.teja.pottumuttu@intel.com>
    Link: https://patchwork.freedesktop.org/patch/msgid/20250305150659.46276-1-francois.dugast@intel.com
    Signed-off-by: Francois Dugast <francois.dugast@intel.com>

diff --git a/drivers/gpu/drm/xe/xe_hw_engine_group.c b/drivers/gpu/drm/xe/xe_hw_engine_group.c
index 82750520a90a..2d68c5b5262a 100644
--- a/drivers/gpu/drm/xe/xe_hw_engine_group.c
+++ b/drivers/gpu/drm/xe/xe_hw_engine_group.c
@@ -178,6 +178,7 @@ int xe_hw_engine_group_add_exec_queue(struct xe_hw_engine_group *group, struct x
 	up_write(&group->mode_sem);
 	return err;
 }
+ALLOW_ERROR_INJECTION(xe_hw_engine_group_add_exec_queue, ERRNO);
 
 /**
  * xe_hw_engine_group_del_exec_queue() - Delete an exec queue from a hw engine group