{
  "hash": "d549107305b4634c81223a853701c06bcf657bc3",
  "hash_short": "d5491073",
  "subject": "libertas_tf: Fix possible memory leak in probe and disconnect",
  "body": "I got memory leak as follows when doing fault injection test:\n\nunreferenced object 0xffff88810a2ddc00 (size 512):\n  comm \"kworker/6:1\", pid 176, jiffies 4295009893 (age 757.220s)\n  hex dump (first 32 bytes):\n    00 50 05 18 81 88 ff ff 00 00 00 00 00 00 00 00  .P..............\n    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................\n  backtrace:\n    [<ffffffff8167939c>] slab_post_alloc_hook+0x9c/0x490\n    [<ffffffff8167f627>] kmem_cache_alloc_trace+0x1f7/0x470\n    [<ffffffffa02a1530>] if_usb_probe+0x60/0x37c [libertas_tf_usb]\n    [<ffffffffa022668a>] usb_probe_interface+0x1aa/0x3c0 [usbcore]\n    [<ffffffff82b59630>] really_probe+0x190/0x480\n    [<ffffffff82b59a19>] __driver_probe_device+0xf9/0x180\n    [<ffffffff82b59af3>] driver_probe_device+0x53/0x130\n    [<ffffffff82b5a075>] __device_attach_driver+0x105/0x130\n    [<ffffffff82b55949>] bus_for_each_drv+0x129/0x190\n    [<ffffffff82b593c9>] __device_attach+0x1c9/0x270\n    [<ffffffff82b5a250>] device_initial_probe+0x20/0x30\n    [<ffffffff82b579c2>] bus_probe_device+0x142/0x160\n    [<ffffffff82b52e49>] device_add+0x829/0x1300\n    [<ffffffffa02229b1>] usb_set_configuration+0xb01/0xcc0 [usbcore]\n    [<ffffffffa0235c4e>] usb_generic_driver_probe+0x6e/0x90 [usbcore]\n    [<ffffffffa022641f>] usb_probe_device+0x6f/0x130 [usbcore]\n\ncardp is missing being freed in the error handling path of the probe\nand the path of the disconnect, which will cause memory leak.\n\nThis patch adds the missing kfree().\n\nFixes: c305a19a0d0a (\"libertas_tf: usb specific functions\")\nReported-by: Hulk Robot <hulkci@huawei.com>\nSigned-off-by: Wang Hai <wanghai38@huawei.com>\nSigned-off-by: Kalle Valo <kvalo@codeaurora.org>\nLink: https://lore.kernel.org/r/20211020120345.2016045-2-wanghai38@huawei.com",
  "full_message": "libertas_tf: Fix possible memory leak in probe and disconnect\n\nI got memory leak as follows when doing fault injection test:\n\nunreferenced object 0xffff88810a2ddc00 (size 512):\n  comm \"kworker/6:1\", pid 176, jiffies 4295009893 (age 757.220s)\n  hex dump (first 32 bytes):\n    00 50 05 18 81 88 ff ff 00 00 00 00 00 00 00 00  .P..............\n    00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................\n  backtrace:\n    [<ffffffff8167939c>] slab_post_alloc_hook+0x9c/0x490\n    [<ffffffff8167f627>] kmem_cache_alloc_trace+0x1f7/0x470\n    [<ffffffffa02a1530>] if_usb_probe+0x60/0x37c [libertas_tf_usb]\n    [<ffffffffa022668a>] usb_probe_interface+0x1aa/0x3c0 [usbcore]\n    [<ffffffff82b59630>] really_probe+0x190/0x480\n    [<ffffffff82b59a19>] __driver_probe_device+0xf9/0x180\n    [<ffffffff82b59af3>] driver_probe_device+0x53/0x130\n    [<ffffffff82b5a075>] __device_attach_driver+0x105/0x130\n    [<ffffffff82b55949>] bus_for_each_drv+0x129/0x190\n    [<ffffffff82b593c9>] __device_attach+0x1c9/0x270\n    [<ffffffff82b5a250>] device_initial_probe+0x20/0x30\n    [<ffffffff82b579c2>] bus_probe_device+0x142/0x160\n    [<ffffffff82b52e49>] device_add+0x829/0x1300\n    [<ffffffffa02229b1>] usb_set_configuration+0xb01/0xcc0 [usbcore]\n    [<ffffffffa0235c4e>] usb_generic_driver_probe+0x6e/0x90 [usbcore]\n    [<ffffffffa022641f>] usb_probe_device+0x6f/0x130 [usbcore]\n\ncardp is missing being freed in the error handling path of the probe\nand the path of the disconnect, which will cause memory leak.\n\nThis patch adds the missing kfree().\n\nFixes: c305a19a0d0a (\"libertas_tf: usb specific functions\")\nReported-by: Hulk Robot <hulkci@huawei.com>\nSigned-off-by: Wang Hai <wanghai38@huawei.com>\nSigned-off-by: Kalle Valo <kvalo@codeaurora.org>\nLink: https://lore.kernel.org/r/20211020120345.2016045-2-wanghai38@huawei.com",
  "author_name": "Wang Hai",
  "author_email": "wanghai38@huawei.com",
  "author_date": "Wed Oct 20 20:03:44 2021 +0800",
  "author_date_iso": "2021-10-20T20:03:44+08:00",
  "committer_name": "Kalle Valo",
  "committer_email": "kvalo@codeaurora.org",
  "committer_date": "Wed Oct 27 10:32:21 2021 +0300",
  "committer_date_iso": "2021-10-27T10:32:21+03:00",
  "files_changed": [
    "drivers/net/wireless/marvell/libertas_tf/if_usb.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/net/wireless/marvell/libertas_tf/if_usb.c",
      "insertions": 2,
      "deletions": 0
    }
  ],
  "total_insertions": 2,
  "total_deletions": 0,
  "total_changes": 2,
  "parents": [
    "1aa3367ca78ce6c1b06726587da1a6d8aa387797"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/net/wireless/marvell/libertas_tf/if_usb.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}