Commit Hash: 31d3d3484f9bd263925ecaa341500ac2df3a5d9b
Subject: HWPOISON: limit hwpoison injector to known page types


Security Keywords:
- inject

Full commit message:
HWPOISON: limit hwpoison injector to known page types

__memory_failure()'s workflow is

	set PG_hwpoison
	//...
	unset PG_hwpoison if didn't pass hwpoison filter

That could kill unrelated process if it happens to page fault on the
page with the (temporary) PG_hwpoison. The race should be big enough to
appear in stress tests.

Fix it by grabbing the page and checking filter at inject time.  This
also avoids the very noisy "Injecting memory failure..." messages.

- we don't touch madvise() based injection, because the filters are
  generally not necessary for it.
- if we want to apply the filters to h/w aided injection, we'd better to
  rearrange the logic in __memory_failure() instead of this patch.

AK: fix documentation, use drain all, cleanups

CC: Haicheng Li <haicheng.li@intel.com>
Signed-off-by: Wu Fengguang <fengguang.wu@intel.com>
Signed-off-by: Andi Kleen <ak@linux.intel.com>

Metadata:
Author: Wu Fengguang <fengguang.wu@intel.com>
Author Date: Wed Dec 16 12:19:59 2009 +0100
Committer: Andi Kleen <ak@linux.intel.com>
Commit Date: Wed Dec 16 12:19:59 2009 +0100

Files Changed: 3
Lines Added: 43
Lines Removed: 3
Total Changes: 46
