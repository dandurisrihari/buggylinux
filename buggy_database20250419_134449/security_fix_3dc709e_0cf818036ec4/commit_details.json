{
  "hash": "3dc709e518b47386e6af937eaec37bb36539edfd",
  "hash_short": "3dc709e5",
  "subject": "powerpc/85xx: Fix oops when CONFIG_FSL_PMC=n",
  "body": "When CONFIG_FSL_PMC is set to n, no value is assigned to cpu_up_prepare\nin the mpc85xx_pm_ops structure. As a result, oops is triggered in\nsmp_85xx_start_cpu().\n\n  smp: Bringing up secondary CPUs ...\n  kernel tried to execute user page (0) - exploit attempt? (uid: 0)\n  BUG: Unable to handle kernel instruction fetch (NULL pointer?)\n  Faulting instruction address: 0x00000000\n  Oops: Kernel access of bad area, sig: 11 [#1]\n  ...\n  NIP [00000000] 0x0\n  LR [c0021d2c] smp_85xx_kick_cpu+0xe8/0x568\n  Call Trace:\n  [c1051da8] [c0021cb8] smp_85xx_kick_cpu+0x74/0x568 (unreliable)\n  [c1051de8] [c0011460] __cpu_up+0xc0/0x228\n  [c1051e18] [c0031bbc] bringup_cpu+0x30/0x224\n  [c1051e48] [c0031f3c] cpu_up.constprop.0+0x180/0x33c\n  [c1051e88] [c00322e8] bringup_nonboot_cpus+0x88/0xc8\n  [c1051eb8] [c07e67bc] smp_init+0x30/0x78\n  [c1051ed8] [c07d9e28] kernel_init_freeable+0x118/0x2a8\n  [c1051f18] [c00032d8] kernel_init+0x14/0x124\n  [c1051f38] [c0010278] ret_from_kernel_thread+0x14/0x1c\n\nFixes: c45361abb918 (\"powerpc/85xx: fix timebase sync issue when CONFIG_HOTPLUG_CPU=n\")\nReported-by: Martin Kennedy <hurricos@gmail.com>\nSigned-off-by: Xiaoming Ni <nixiaoming@huawei.com>\nTested-by: Martin Kennedy <hurricos@gmail.com>\nSigned-off-by: Michael Ellerman <mpe@ellerman.id.au>\nLink: https://lore.kernel.org/r/20211126041153.16926-1-nixiaoming@huawei.com",
  "full_message": "powerpc/85xx: Fix oops when CONFIG_FSL_PMC=n\n\nWhen CONFIG_FSL_PMC is set to n, no value is assigned to cpu_up_prepare\nin the mpc85xx_pm_ops structure. As a result, oops is triggered in\nsmp_85xx_start_cpu().\n\n  smp: Bringing up secondary CPUs ...\n  kernel tried to execute user page (0) - exploit attempt? (uid: 0)\n  BUG: Unable to handle kernel instruction fetch (NULL pointer?)\n  Faulting instruction address: 0x00000000\n  Oops: Kernel access of bad area, sig: 11 [#1]\n  ...\n  NIP [00000000] 0x0\n  LR [c0021d2c] smp_85xx_kick_cpu+0xe8/0x568\n  Call Trace:\n  [c1051da8] [c0021cb8] smp_85xx_kick_cpu+0x74/0x568 (unreliable)\n  [c1051de8] [c0011460] __cpu_up+0xc0/0x228\n  [c1051e18] [c0031bbc] bringup_cpu+0x30/0x224\n  [c1051e48] [c0031f3c] cpu_up.constprop.0+0x180/0x33c\n  [c1051e88] [c00322e8] bringup_nonboot_cpus+0x88/0xc8\n  [c1051eb8] [c07e67bc] smp_init+0x30/0x78\n  [c1051ed8] [c07d9e28] kernel_init_freeable+0x118/0x2a8\n  [c1051f18] [c00032d8] kernel_init+0x14/0x124\n  [c1051f38] [c0010278] ret_from_kernel_thread+0x14/0x1c\n\nFixes: c45361abb918 (\"powerpc/85xx: fix timebase sync issue when CONFIG_HOTPLUG_CPU=n\")\nReported-by: Martin Kennedy <hurricos@gmail.com>\nSigned-off-by: Xiaoming Ni <nixiaoming@huawei.com>\nTested-by: Martin Kennedy <hurricos@gmail.com>\nSigned-off-by: Michael Ellerman <mpe@ellerman.id.au>\nLink: https://lore.kernel.org/r/20211126041153.16926-1-nixiaoming@huawei.com",
  "author_name": "Xiaoming Ni",
  "author_email": "nixiaoming@huawei.com",
  "author_date": "Fri Nov 26 12:11:53 2021 +0800",
  "author_date_iso": "2021-11-26T12:11:53+08:00",
  "committer_name": "Michael Ellerman",
  "committer_email": "mpe@ellerman.id.au",
  "committer_date": "Mon Nov 29 17:47:05 2021 +1100",
  "committer_date_iso": "2021-11-29T17:47:05+11:00",
  "files_changed": [
    "arch/powerpc/platforms/85xx/smp.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "arch/powerpc/platforms/85xx/smp.c",
      "insertions": 2,
      "deletions": 2
    }
  ],
  "total_insertions": 2,
  "total_deletions": 2,
  "total_changes": 4,
  "parents": [
    "5bb60ea611db1e04814426ed4bd1c95d1487678e"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "exploit"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/powerpc/platforms/85xx/smp.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}