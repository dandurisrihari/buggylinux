commit 2d61391270a3ceb95b3dd536ea13002e653323b6
Author: Sean Christopherson <seanjc@google.com>
Date:   Mon May 2 00:07:33 2022 +0200

    KVM: x86: Differentiate Soft vs. Hard IRQs vs. reinjected in tracepoint
    
    In the IRQ injection tracepoint, differentiate between Hard IRQs and Soft
    "IRQs", i.e. interrupts that are reinjected after incomplete delivery of
    a software interrupt from an INTn instruction.  Tag reinjected interrupts
    as such, even though the information is usually redundant since soft
    interrupts are only ever reinjected by KVM.  Though rare in practice, a
    hard IRQ can be reinjected.
    
    Signed-off-by: Sean Christopherson <seanjc@google.com>
    [MSS: change "kvm_inj_virq" event "reinjected" field type to bool]
    Signed-off-by: Maciej S. Szmigiero <maciej.szmigiero@oracle.com>
    Message-Id: <9664d49b3bd21e227caa501cff77b0569bebffe2.1651440202.git.maciej.szmigiero@oracle.com>
    Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

diff --git a/arch/x86/kvm/vmx/vmx.c b/arch/x86/kvm/vmx/vmx.c
index e1aa14743cdb..9714ae95589f 100644
--- a/arch/x86/kvm/vmx/vmx.c
+++ b/arch/x86/kvm/vmx/vmx.c
@@ -4573,13 +4573,13 @@ static void vmx_enable_nmi_window(struct kvm_vcpu *vcpu)
 	exec_controls_setbit(to_vmx(vcpu), CPU_BASED_NMI_WINDOW_EXITING);
 }
 
-static void vmx_inject_irq(struct kvm_vcpu *vcpu)
+static void vmx_inject_irq(struct kvm_vcpu *vcpu, bool reinjected)
 {
 	struct vcpu_vmx *vmx = to_vmx(vcpu);
 	uint32_t intr;
 	int irq = vcpu->arch.interrupt.nr;
 
-	trace_kvm_inj_virq(irq);
+	trace_kvm_inj_virq(irq, vcpu->arch.interrupt.soft, reinjected);
 
 	++vcpu->stat.irq_injections;
 	if (vmx->rmode.vm86_active) {