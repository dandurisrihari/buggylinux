commit be2b34fa9be31c60a95989f984c9a5d40cd781b6
Author: Kees Cook <kees@kernel.org>
Date:   Tue May 3 13:55:02 2022 -0700

    randstruct: Move seed generation into scripts/basic/
    
    To enable Clang randstruct support, move the structure layout
    randomization seed generation out of scripts/gcc-plugins/ into
    scripts/basic/ so it happens early enough that it can be used by either
    compiler implementation. The gcc-plugin still builds its own header file,
    but now does so from the common "randstruct.seed" file.
    
    Cc: linux-hardening@vger.kernel.org
    Signed-off-by: Kees Cook <keescook@chromium.org>
    Link: https://lore.kernel.org/r/20220503205503.3054173-6-keescook@chromium.org

diff --git a/scripts/basic/Makefile b/scripts/basic/Makefile
index eeb6a38c5551..dd289a6725ac 100644
--- a/scripts/basic/Makefile
+++ b/scripts/basic/Makefile
@@ -3,3 +3,14 @@
 # fixdep: used to generate dependency information during build process
 
 hostprogs-always-y	+= fixdep
+
+# randstruct: the seed is needed before building the gcc-plugin or
+# before running a Clang kernel build.
+gen-randstruct-seed	:= $(srctree)/scripts/gen-randstruct-seed.sh
+quiet_cmd_create_randstruct_seed = GENSEED $@
+cmd_create_randstruct_seed = \
+	$(CONFIG_SHELL) $(gen-randstruct-seed) \
+		$@ $(objtree)/include/generated/randstruct_hash.h
+$(obj)/randstruct.seed: $(gen-randstruct-seed) FORCE
+	$(call if_changed,create_randstruct_seed)
+always-$(CONFIG_RANDSTRUCT) += randstruct.seed