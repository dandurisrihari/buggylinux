Commit Hash: 26391e49d5b0f0c33eb4b28a312d2ecc094d7489
Subject: mmc: dw_mmc: Only inject fault before done/error


Security Keywords:
- inject

Full commit message:
mmc: dw_mmc: Only inject fault before done/error

The fault injection function can set EVENT_DATA_ERROR but skip the
setting of ->data_status to an error status if it hits just after a data
over interrupt.  This confuses the tasklet which can later end up
triggering the WARN_ON(host->cmd || ..) in dw_mci_request_end() since
dw_mci_data_complete() would return success.

Prevent the fault injection function from doing this since this is not a
real case, and ensure that the fault injection doesn't race with a real
error either.

Signed-off-by: Vincent Whitchurch <vincent.whitchurch@axis.com>
Reviewed-by: Jaehoon Chung <jh80.chung@samsung.com>
Fixes: 2b8ac062f337 ("mmc: dw_mmc: Add data CRC error injection")
Link: https://lore.kernel.org/r/20210825114213.7429-1-vincent.whitchurch@axis.com
Signed-off-by: Ulf Hansson <ulf.hansson@linaro.org>

Metadata:
Author: Vincent Whitchurch <vincent.whitchurch@axis.com>
Author Date: Wed Aug 25 13:42:13 2021 +0200
Committer: Ulf Hansson <ulf.hansson@linaro.org>
Commit Date: Mon Sep 6 18:02:16 2021 +0200

Files Changed: 1
Lines Added: 12
Lines Removed: 3
Total Changes: 15
