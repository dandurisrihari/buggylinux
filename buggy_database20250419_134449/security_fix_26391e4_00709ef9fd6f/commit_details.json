{
  "hash": "26391e49d5b0f0c33eb4b28a312d2ecc094d7489",
  "hash_short": "26391e49",
  "subject": "mmc: dw_mmc: Only inject fault before done/error",
  "body": "The fault injection function can set EVENT_DATA_ERROR but skip the\nsetting of ->data_status to an error status if it hits just after a data\nover interrupt.  This confuses the tasklet which can later end up\ntriggering the WARN_ON(host->cmd || ..) in dw_mci_request_end() since\ndw_mci_data_complete() would return success.\n\nPrevent the fault injection function from doing this since this is not a\nreal case, and ensure that the fault injection doesn't race with a real\nerror either.\n\nSigned-off-by: Vincent Whitchurch <vincent.whitchurch@axis.com>\nReviewed-by: Jaehoon Chung <jh80.chung@samsung.com>\nFixes: 2b8ac062f337 (\"mmc: dw_mmc: Add data CRC error injection\")\nLink: https://lore.kernel.org/r/20210825114213.7429-1-vincent.whitchurch@axis.com\nSigned-off-by: Ulf Hansson <ulf.hansson@linaro.org>",
  "full_message": "mmc: dw_mmc: Only inject fault before done/error\n\nThe fault injection function can set EVENT_DATA_ERROR but skip the\nsetting of ->data_status to an error status if it hits just after a data\nover interrupt.  This confuses the tasklet which can later end up\ntriggering the WARN_ON(host->cmd || ..) in dw_mci_request_end() since\ndw_mci_data_complete() would return success.\n\nPrevent the fault injection function from doing this since this is not a\nreal case, and ensure that the fault injection doesn't race with a real\nerror either.\n\nSigned-off-by: Vincent Whitchurch <vincent.whitchurch@axis.com>\nReviewed-by: Jaehoon Chung <jh80.chung@samsung.com>\nFixes: 2b8ac062f337 (\"mmc: dw_mmc: Add data CRC error injection\")\nLink: https://lore.kernel.org/r/20210825114213.7429-1-vincent.whitchurch@axis.com\nSigned-off-by: Ulf Hansson <ulf.hansson@linaro.org>",
  "author_name": "Vincent Whitchurch",
  "author_email": "vincent.whitchurch@axis.com",
  "author_date": "Wed Aug 25 13:42:13 2021 +0200",
  "author_date_iso": "2021-08-25T13:42:13+02:00",
  "committer_name": "Ulf Hansson",
  "committer_email": "ulf.hansson@linaro.org",
  "committer_date": "Mon Sep 6 18:02:16 2021 +0200",
  "committer_date_iso": "2021-09-06T18:02:16+02:00",
  "files_changed": [
    "drivers/mmc/host/dw_mmc.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/mmc/host/dw_mmc.c",
      "insertions": 12,
      "deletions": 3
    }
  ],
  "total_insertions": 12,
  "total_deletions": 3,
  "total_changes": 15,
  "parents": [
    "27151f177827d478508e756c7657273261aaf8a9"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "inject"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/mmc/host/dw_mmc.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}