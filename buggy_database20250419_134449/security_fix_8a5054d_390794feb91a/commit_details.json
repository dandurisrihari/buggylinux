{
  "hash": "8a5054d8cbbe03c68dcb0957c291c942132e4101",
  "hash_short": "8a5054d8",
  "subject": "powerpc/64s/exception: Fix machine check no-loss idle wakeup",
  "body": "The architecture allows for machine check exceptions to cause idle\nwakeups which resume at the 0x200 address which has to return via\nthe idle wakeup code, but the early machine check handler is run\nfirst.\n\nThe case of a no state-loss sleep is broken because the early\nhandler uses non-volatile register r1 , which is needed for the wakeup\nprotocol, but it is not restored.\n\nFix this by loading r1 from the MCE exception frame before returning\nto the idle wakeup code. Also update the comment which has become\nstale since the idle rewrite in C.\n\nThis crash was found and fix confirmed with a machine check injection\ntest in qemu powernv model (which is not upstream in qemu yet).\n\nFixes: 10d91611f426d (\"powerpc/64s: Reimplement book3s idle code in C\")\nSigned-off-by: Nicholas Piggin <npiggin@gmail.com>\nSigned-off-by: Michael Ellerman <mpe@ellerman.id.au>\nLink: https://lore.kernel.org/r/20200508043408.886394-2-npiggin@gmail.com",
  "full_message": "powerpc/64s/exception: Fix machine check no-loss idle wakeup\n\nThe architecture allows for machine check exceptions to cause idle\nwakeups which resume at the 0x200 address which has to return via\nthe idle wakeup code, but the early machine check handler is run\nfirst.\n\nThe case of a no state-loss sleep is broken because the early\nhandler uses non-volatile register r1 , which is needed for the wakeup\nprotocol, but it is not restored.\n\nFix this by loading r1 from the MCE exception frame before returning\nto the idle wakeup code. Also update the comment which has become\nstale since the idle rewrite in C.\n\nThis crash was found and fix confirmed with a machine check injection\ntest in qemu powernv model (which is not upstream in qemu yet).\n\nFixes: 10d91611f426d (\"powerpc/64s: Reimplement book3s idle code in C\")\nSigned-off-by: Nicholas Piggin <npiggin@gmail.com>\nSigned-off-by: Michael Ellerman <mpe@ellerman.id.au>\nLink: https://lore.kernel.org/r/20200508043408.886394-2-npiggin@gmail.com",
  "author_name": "Nicholas Piggin",
  "author_email": "npiggin@gmail.com",
  "author_date": "Fri May 8 14:33:53 2020 +1000",
  "author_date_iso": "2020-05-08T14:33:53+10:00",
  "committer_name": "Michael Ellerman",
  "committer_email": "mpe@ellerman.id.au",
  "committer_date": "Mon May 18 21:58:44 2020 +1000",
  "committer_date_iso": "2020-05-18T21:58:44+10:00",
  "files_changed": [
    "arch/powerpc/kernel/exceptions-64s.S"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "arch/powerpc/kernel/exceptions-64s.S",
      "insertions": 8,
      "deletions": 6
    }
  ],
  "total_insertions": 8,
  "total_deletions": 6,
  "total_changes": 14,
  "parents": [
    "466381ecdc741b1767d980e10b1ec49f6bde56f3"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/powerpc/kernel/exceptions-64s.S",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}