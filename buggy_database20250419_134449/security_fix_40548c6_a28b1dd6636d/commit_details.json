{
  "hash": "40548c6b6c134275c750eb372dc2cf8ee1bbc3d4",
  "hash_short": "40548c6b",
  "subject": "Merge branch 'x86-pti-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip",
  "body": "Pull x86 pti updates from Thomas Gleixner:\n \"This contains:\n\n   - a PTI bugfix to avoid setting reserved CR3 bits when PCID is\n     disabled. This seems to cause issues on a virtual machine at least\n     and is incorrect according to the AMD manual.\n\n   - a PTI bugfix which disables the perf BTS facility if PTI is\n     enabled. The BTS AUX buffer is not globally visible and causes the\n     CPU to fault when the mapping disappears on switching CR3 to user\n     space. A full fix which restores BTS on PTI is non trivial and will\n     be worked on.\n\n   - PTI bugfixes for EFI and trusted boot which make sure that the user\n     space visible page table entries have the NX bit cleared\n\n   - removal of dead code in the PTI pagetable setup functions\n\n   - add PTI documentation\n\n   - add a selftest for vsyscall to verify that the kernel actually\n     implements what it advertises.\n\n   - a sysfs interface to expose vulnerability and mitigation\n     information so there is a coherent way for users to retrieve the\n     status.\n\n   - the initial spectre_v2 mitigations, aka retpoline:\n\n      + The necessary ASM thunk and compiler support\n\n      + The ASM variants of retpoline and the conversion of affected ASM\n        code\n\n      + Make LFENCE serializing on AMD so it can be used as speculation\n        trap\n\n      + The RSB fill after vmexit\n\n   - initial objtool support for retpoline\n\n  As I said in the status mail this is the most of the set of patches\n  which should go into 4.15 except two straight forward patches still on\n  hold:\n\n   - the retpoline add on of LFENCE which waits for ACKs\n\n   - the RSB fill after context switch\n\n  Both should be ready to go early next week and with that we'll have\n  covered the major holes of spectre_v2 and go back to normality\"\n\n* 'x86-pti-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip: (28 commits)\n  x86,perf: Disable intel_bts when PTI\n  security/Kconfig: Correct the Documentation reference for PTI\n  x86/pti: Fix !PCID and sanitize defines\n  selftests/x86: Add test_vsyscall\n  x86/retpoline: Fill return stack buffer on vmexit\n  x86/retpoline/irq32: Convert assembler indirect jumps\n  x86/retpoline/checksum32: Convert assembler indirect jumps\n  x86/retpoline/xen: Convert Xen hypercall indirect jumps\n  x86/retpoline/hyperv: Convert assembler indirect jumps\n  x86/retpoline/ftrace: Convert ftrace assembler indirect jumps\n  x86/retpoline/entry: Convert entry assembler indirect jumps\n  x86/retpoline/crypto: Convert crypto assembler indirect jumps\n  x86/spectre: Add boot time option to select Spectre v2 mitigation\n  x86/retpoline: Add initial retpoline support\n  objtool: Allow alternatives to be ignored\n  objtool: Detect jumps to retpoline thunks\n  x86/pti: Make unpoison of pgd for trusted boot work for real\n  x86/alternatives: Fix optimize_nops() checking\n  sysfs/cpu: Fix typos in vulnerability documentation\n  x86/cpu/AMD: Use LFENCE_RDTSC in preference to MFENCE_RDTSC\n  ...",
  "full_message": "Merge branch 'x86-pti-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip\n\nPull x86 pti updates from Thomas Gleixner:\n \"This contains:\n\n   - a PTI bugfix to avoid setting reserved CR3 bits when PCID is\n     disabled. This seems to cause issues on a virtual machine at least\n     and is incorrect according to the AMD manual.\n\n   - a PTI bugfix which disables the perf BTS facility if PTI is\n     enabled. The BTS AUX buffer is not globally visible and causes the\n     CPU to fault when the mapping disappears on switching CR3 to user\n     space. A full fix which restores BTS on PTI is non trivial and will\n     be worked on.\n\n   - PTI bugfixes for EFI and trusted boot which make sure that the user\n     space visible page table entries have the NX bit cleared\n\n   - removal of dead code in the PTI pagetable setup functions\n\n   - add PTI documentation\n\n   - add a selftest for vsyscall to verify that the kernel actually\n     implements what it advertises.\n\n   - a sysfs interface to expose vulnerability and mitigation\n     information so there is a coherent way for users to retrieve the\n     status.\n\n   - the initial spectre_v2 mitigations, aka retpoline:\n\n      + The necessary ASM thunk and compiler support\n\n      + The ASM variants of retpoline and the conversion of affected ASM\n        code\n\n      + Make LFENCE serializing on AMD so it can be used as speculation\n        trap\n\n      + The RSB fill after vmexit\n\n   - initial objtool support for retpoline\n\n  As I said in the status mail this is the most of the set of patches\n  which should go into 4.15 except two straight forward patches still on\n  hold:\n\n   - the retpoline add on of LFENCE which waits for ACKs\n\n   - the RSB fill after context switch\n\n  Both should be ready to go early next week and with that we'll have\n  covered the major holes of spectre_v2 and go back to normality\"\n\n* 'x86-pti-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip: (28 commits)\n  x86,perf: Disable intel_bts when PTI\n  security/Kconfig: Correct the Documentation reference for PTI\n  x86/pti: Fix !PCID and sanitize defines\n  selftests/x86: Add test_vsyscall\n  x86/retpoline: Fill return stack buffer on vmexit\n  x86/retpoline/irq32: Convert assembler indirect jumps\n  x86/retpoline/checksum32: Convert assembler indirect jumps\n  x86/retpoline/xen: Convert Xen hypercall indirect jumps\n  x86/retpoline/hyperv: Convert assembler indirect jumps\n  x86/retpoline/ftrace: Convert ftrace assembler indirect jumps\n  x86/retpoline/entry: Convert entry assembler indirect jumps\n  x86/retpoline/crypto: Convert crypto assembler indirect jumps\n  x86/spectre: Add boot time option to select Spectre v2 mitigation\n  x86/retpoline: Add initial retpoline support\n  objtool: Allow alternatives to be ignored\n  objtool: Detect jumps to retpoline thunks\n  x86/pti: Make unpoison of pgd for trusted boot work for real\n  x86/alternatives: Fix optimize_nops() checking\n  sysfs/cpu: Fix typos in vulnerability documentation\n  x86/cpu/AMD: Use LFENCE_RDTSC in preference to MFENCE_RDTSC\n  ...",
  "author_name": "Linus Torvalds",
  "author_email": "torvalds@linux-foundation.org",
  "author_date": "Sun Jan 14 09:51:25 2018 -0800",
  "author_date_iso": "2018-01-14T09:51:25-08:00",
  "committer_name": "Linus Torvalds",
  "committer_email": "torvalds@linux-foundation.org",
  "committer_date": "Sun Jan 14 09:51:25 2018 -0800",
  "committer_date_iso": "2018-01-14T09:51:25-08:00",
  "files_changed": [
    "Documentation/ABI/testing/sysfs-devices-system-cpu",
    "Documentation/admin-guide/kernel-parameters.txt",
    "arch/x86/Kconfig",
    "arch/x86/Makefile",
    "arch/x86/entry/entry_64.S",
    "arch/x86/include/asm/mshyperv.h",
    "arch/x86/include/asm/msr-index.h",
    "arch/x86/include/asm/tlbflush.h",
    "arch/x86/kernel/alternative.c",
    "arch/x86/kernel/cpu/common.c",
    "arch/x86/kvm/svm.c",
    "arch/x86/kvm/vmx.c",
    "arch/x86/lib/Makefile",
    "arch/x86/platform/efi/efi_64.c",
    "drivers/base/Kconfig",
    "drivers/base/cpu.c",
    "include/linux/cpu.h",
    "tools/testing/selftests/x86/Makefile"
  ],
  "files_changed_count": 18,
  "stats": [
    {
      "file": "Documentation/ABI/testing/sysfs-devices-system-cpu",
      "insertions": 16,
      "deletions": 0
    },
    {
      "file": "Documentation/admin-guide/kernel-parameters.txt",
      "insertions": 42,
      "deletions": 7
    },
    {
      "file": "Documentation/x86/pti.txt",
      "insertions": 186,
      "deletions": 0
    },
    {
      "file": "arch/x86/Kconfig",
      "insertions": 14,
      "deletions": 0
    },
    {
      "file": "arch/x86/Makefile",
      "insertions": 10,
      "deletions": 0
    },
    {
      "file": "arch/x86/crypto/aesni-intel_asm.S",
      "insertions": 3,
      "deletions": 2
    },
    {
      "file": "arch/x86/crypto/camellia-aesni-avx-asm_64.S",
      "insertions": 2,
      "deletions": 1
    },
    {
      "file": "arch/x86/crypto/camellia-aesni-avx2-asm_64.S",
      "insertions": 2,
      "deletions": 1
    },
    {
      "file": "arch/x86/crypto/crc32c-pcl-intel-asm_64.S",
      "insertions": 2,
      "deletions": 1
    },
    {
      "file": "arch/x86/entry/calling.h",
      "insertions": 19,
      "deletions": 17
    },
    {
      "file": "arch/x86/entry/entry_32.S",
      "insertions": 3,
      "deletions": 2
    },
    {
      "file": "arch/x86/entry/entry_64.S",
      "insertions": 9,
      "deletions": 3
    },
    {
      "file": "arch/x86/events/intel/bts.c",
      "insertions": 18,
      "deletions": 0
    },
    {
      "file": "arch/x86/include/asm/asm-prototypes.h",
      "insertions": 25,
      "deletions": 0
    },
    {
      "file": "arch/x86/include/asm/cpufeatures.h",
      "insertions": 4,
      "deletions": 0
    },
    {
      "file": "arch/x86/include/asm/mshyperv.h",
      "insertions": 10,
      "deletions": 8
    },
    {
      "file": "arch/x86/include/asm/msr-index.h",
      "insertions": 3,
      "deletions": 0
    },
    {
      "file": "arch/x86/include/asm/nospec-branch.h",
      "insertions": 214,
      "deletions": 0
    },
    {
      "file": "arch/x86/include/asm/processor-flags.h",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "arch/x86/include/asm/tlbflush.h",
      "insertions": 3,
      "deletions": 3
    },
    {
      "file": "arch/x86/include/asm/xen/hypercall.h",
      "insertions": 3,
      "deletions": 2
    },
    {
      "file": "arch/x86/kernel/alternative.c",
      "insertions": 5,
      "deletions": 2
    },
    {
      "file": "arch/x86/kernel/cpu/amd.c",
      "insertions": 26,
      "deletions": 2
    },
    {
      "file": "arch/x86/kernel/cpu/bugs.c",
      "insertions": 185,
      "deletions": 0
    },
    {
      "file": "arch/x86/kernel/cpu/common.c",
      "insertions": 3,
      "deletions": 0
    },
    {
      "file": "arch/x86/kernel/ftrace_32.S",
      "insertions": 4,
      "deletions": 2
    },
    {
      "file": "arch/x86/kernel/ftrace_64.S",
      "insertions": 4,
      "deletions": 4
    },
    {
      "file": "arch/x86/kernel/irq_32.c",
      "insertions": 5,
      "deletions": 4
    },
    {
      "file": "arch/x86/kernel/tboot.c",
      "insertions": 11,
      "deletions": 0
    },
    {
      "file": "arch/x86/kvm/svm.c",
      "insertions": 4,
      "deletions": 0
    },
    {
      "file": "arch/x86/kvm/vmx.c",
      "insertions": 4,
      "deletions": 0
    },
    {
      "file": "arch/x86/lib/Makefile",
      "insertions": 1,
      "deletions": 0
    },
    {
      "file": "arch/x86/lib/checksum_32.S",
      "insertions": 4,
      "deletions": 3
    },
    {
      "file": "arch/x86/lib/retpoline.S",
      "insertions": 48,
      "deletions": 0
    },
    {
      "file": "arch/x86/mm/pti.c",
      "insertions": 6,
      "deletions": 26
    },
    {
      "file": "arch/x86/platform/efi/efi_64.c",
      "insertions": 2,
      "deletions": 0
    },
    {
      "file": "drivers/base/Kconfig",
      "insertions": 3,
      "deletions": 0
    },
    {
      "file": "drivers/base/cpu.c",
      "insertions": 48,
      "deletions": 0
    },
    {
      "file": "include/linux/cpu.h",
      "insertions": 7,
      "deletions": 0
    },
    {
      "file": "security/Kconfig",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "tools/objtool/check.c",
      "insertions": 63,
      "deletions": 6
    },
    {
      "file": "tools/objtool/check.h",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "tools/testing/selftests/x86/Makefile",
      "insertions": 1,
      "deletions": 1
    },
    {
      "file": "tools/testing/selftests/x86/test_vsyscall.c",
      "insertions": 500,
      "deletions": 0
    }
  ],
  "total_insertions": 1525,
  "total_deletions": 100,
  "total_changes": 1625,
  "parents": [
    "2c1cfa49901839136e578ca516a7e230182da024",
    "99a9dc98ba52267ce5e062b52de88ea1f1b2a7d8"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.15",
    "v4.15-rc8",
    "v4.15-rc9",
    "v4.16",
    "v4.16-rc1",
    "v4.16-rc2",
    "v4.16-rc3",
    "v4.16-rc4",
    "v4.16-rc5",
    "v4.16-rc6"
  ],
  "is_merge": true,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "vulnerability",
      "sanitize"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/x86/Kconfig",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/include/asm/mshyperv.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "Documentation/ABI/testing/sysfs-devices-system-cpu",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/Makefile",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/include/asm/tlbflush.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/entry/entry_64.S",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "Documentation/admin-guide/kernel-parameters.txt",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/include/asm/msr-index.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kernel/alternative.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/lib/Makefile",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/platform/efi/efi_64.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kvm/svm.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kernel/cpu/common.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/base/Kconfig",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "arch/x86/kvm/vmx.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/base/cpu.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "tools/testing/selftests/x86/Makefile",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "include/linux/cpu.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}