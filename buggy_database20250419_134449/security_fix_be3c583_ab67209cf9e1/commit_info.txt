Commit Hash: be3c5832d51174ef7f21cefd6ad612dabdcb62fd
Subject: kvm-s390: implement config_changed for virtio on s390


Security Keywords:
- exploit

Full commit message:
kvm-s390: implement config_changed for virtio on s390

This patch implements config_changed for the s390 virtio transport.

We use the least significant bit of the interrupt parameter field
to decide, if this interrupt should call the virtio virtqueue callback
or the config_changed callback.

This method is compatible with old host and guest code. Old 64 bit guests
will not check the bit and trigger a harmless additional vring_interrupt
call. Old host code will never set this bit, this is also safe.

This patch also takes care of a potential future 31 bit virtio transport
for s390. On 31 bit _LC_PFAULT_INTPARM and __LC_EXT_PARAMS are identical.
We exploit the alignment of the token and fold the change bit into the
lsb of the token itself.

Signed-off-by: Christian Borntraeger <borntraeger@de.ibm.com>
Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>

Metadata:
Author: Christian Borntraeger <borntraeger@de.ibm.com>
Author Date: Tue Nov 18 22:44:13 2008 +0100
Committer: Rusty Russell <rusty@rustcorp.com.au>
Commit Date: Tue Dec 30 09:26:11 2008 +1030

Files Changed: 1
Lines Added: 19
Lines Removed: 3
Total Changes: 22
