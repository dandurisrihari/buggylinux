{
  "hash": "43ba33b4f143965a451cfdc1e826b61f6933c887",
  "hash_short": "43ba33b4",
  "subject": "net: dsa: tag_ocelot_8021q: fix inability to inject STP BPDUs into BLOCKING ports",
  "body": "When setting up a bridge with stp_state 1, topology changes are not\ndetected and loops are not blocked. This is because the standard way of\ntransmitting a packet, based on VLAN IDs redirected by VCAP IS2 to the\nright egress port, does not override the port STP state (in the case of\nOcelot switches, that's really the PGID_SRC masks).\n\nTo force a packet to be injected into a port that's BLOCKING, we must\nsend it as a control packet, which means in the case of this tagger to\nsend it using the manual register injection method. We already do this\nfor PTP frames, extend the logic to apply to any link-local MAC DA.\n\nFixes: 7c83a7c539ab (\"net: dsa: add a second tagger for Ocelot switches based on tag_8021q\")\nSigned-off-by: Vladimir Oltean <vladimir.oltean@nxp.com>\nReviewed-by: Florian Fainelli <f.fainelli@gmail.com>\nSigned-off-by: Jakub Kicinski <kuba@kernel.org>",
  "full_message": "net: dsa: tag_ocelot_8021q: fix inability to inject STP BPDUs into BLOCKING ports\n\nWhen setting up a bridge with stp_state 1, topology changes are not\ndetected and loops are not blocked. This is because the standard way of\ntransmitting a packet, based on VLAN IDs redirected by VCAP IS2 to the\nright egress port, does not override the port STP state (in the case of\nOcelot switches, that's really the PGID_SRC masks).\n\nTo force a packet to be injected into a port that's BLOCKING, we must\nsend it as a control packet, which means in the case of this tagger to\nsend it using the manual register injection method. We already do this\nfor PTP frames, extend the logic to apply to any link-local MAC DA.\n\nFixes: 7c83a7c539ab (\"net: dsa: add a second tagger for Ocelot switches based on tag_8021q\")\nSigned-off-by: Vladimir Oltean <vladimir.oltean@nxp.com>\nReviewed-by: Florian Fainelli <f.fainelli@gmail.com>\nSigned-off-by: Jakub Kicinski <kuba@kernel.org>",
  "author_name": "Vladimir Oltean",
  "author_email": "vladimir.oltean@nxp.com",
  "author_date": "Tue Oct 12 14:40:43 2021 +0300",
  "author_date_iso": "2021-10-12T14:40:43+03:00",
  "committer_name": "Jakub Kicinski",
  "committer_email": "kuba@kernel.org",
  "committer_date": "Tue Oct 12 17:35:19 2021 -0700",
  "committer_date_iso": "2021-10-12T17:35:19-07:00",
  "files_changed": [
    "net/dsa/tag_ocelot_8021q.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "net/dsa/tag_ocelot_8021q.c",
      "insertions": 2,
      "deletions": 1
    }
  ],
  "total_insertions": 2,
  "total_deletions": 1,
  "total_changes": 3,
  "parents": [
    "1328a883258b4507909090ed0a9ad63771f9f780"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "inject"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "net/dsa/tag_ocelot_8021q.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}