{
  "hash": "99d074d6b135ae2927b6130d448f5b7159f8dbe1",
  "hash_short": "99d074d6",
  "subject": "SUNRPC: Check rq_auth_stat when preparing to wrap a response",
  "body": "Commit 5b304bc5bfcc (\"[PATCH] knfsd: svcrpc: gss: fix failure on\nSVC_DENIED in integrity case\") added a check to prevent wrapping an\nRPC response if reply_stat == MSG_DENIED, assuming that the only way\nto get to svcauth_gss_release() with that reply_stat value was if\nthe reject_stat was AUTH_ERROR (reject_stat == MISMATCH is handled\nearlier in svc_process_common()).\n\nThe code there is somewhat confusing. For one thing, rpc_success is\nan accept_stat value, not a reply_stat value. The correct reply_stat\nvalue to look for is RPC_MSG_DENIED. It happens to be the same value\nas rpc_success, so it all works out, but it's not terribly readable.\n\nSince commit 438623a06bac (\"SUNRPC: Add svc_rqst::rq_auth_stat\"),\nthe actual auth_stat value is stored in the svc_rqst, so that value\nis now available to svcauth_gss_prepare_to_wrap() to make its\ndecision to wrap, based on direct information about the\nauthentication status of the RPC caller.\n\nNo behavior change is intended, this simply replaces some old code\nwith something that should be more self-documenting.\n\nReviewed-by: Jeff Layton <jlayton@kernel.org>\nSigned-off-by: Chuck Lever <chuck.lever@oracle.com>",
  "full_message": "SUNRPC: Check rq_auth_stat when preparing to wrap a response\n\nCommit 5b304bc5bfcc (\"[PATCH] knfsd: svcrpc: gss: fix failure on\nSVC_DENIED in integrity case\") added a check to prevent wrapping an\nRPC response if reply_stat == MSG_DENIED, assuming that the only way\nto get to svcauth_gss_release() with that reply_stat value was if\nthe reject_stat was AUTH_ERROR (reject_stat == MISMATCH is handled\nearlier in svc_process_common()).\n\nThe code there is somewhat confusing. For one thing, rpc_success is\nan accept_stat value, not a reply_stat value. The correct reply_stat\nvalue to look for is RPC_MSG_DENIED. It happens to be the same value\nas rpc_success, so it all works out, but it's not terribly readable.\n\nSince commit 438623a06bac (\"SUNRPC: Add svc_rqst::rq_auth_stat\"),\nthe actual auth_stat value is stored in the svc_rqst, so that value\nis now available to svcauth_gss_prepare_to_wrap() to make its\ndecision to wrap, based on direct information about the\nauthentication status of the RPC caller.\n\nNo behavior change is intended, this simply replaces some old code\nwith something that should be more self-documenting.\n\nReviewed-by: Jeff Layton <jlayton@kernel.org>\nSigned-off-by: Chuck Lever <chuck.lever@oracle.com>",
  "author_name": "Chuck Lever",
  "author_email": "chuck.lever@oracle.com",
  "author_date": "Sun Jan 8 11:29:26 2023 -0500",
  "author_date_iso": "2023-01-08T11:29:26-05:00",
  "committer_name": "Chuck Lever",
  "committer_email": "chuck.lever@oracle.com",
  "committer_date": "Mon Feb 20 09:20:25 2023 -0500",
  "committer_date_iso": "2023-02-20T09:20:25-05:00",
  "files_changed": [
    "net/sunrpc/auth_gss/svcauth_gss.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "net/sunrpc/auth_gss/svcauth_gss.c",
      "insertions": 7,
      "deletions": 5
    }
  ],
  "total_insertions": 7,
  "total_deletions": 5,
  "total_changes": 12,
  "parents": [
    "eb1b780f2fad2abfcc4a32c6129a117effafff12"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "authentication"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "net/sunrpc/auth_gss/svcauth_gss.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    }
  ]
}