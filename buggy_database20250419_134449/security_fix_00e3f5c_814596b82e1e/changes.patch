diff --cc fs/ceph/file.c
index 10c5ae79696e,d37efdd8533d..86a9c383955e
--- a/fs/ceph/file.c
+++ b/fs/ceph/file.c
@@@ -1115,9 -1356,9 +1356,9 @@@ retry_snap
  		written = generic_perform_write(file, from, pos);
  		if (likely(written >= 0))
  			iocb->ki_pos = pos + written;
- 		if (inode->i_size > old_size)
+ 		if (i_size_read(inode) > old_size)
  			ceph_fscache_update_objectsize(inode);
 -		mutex_unlock(&inode->i_mutex);
 +		inode_unlock(inode);
  	}
  
  	if (written >= 0) {
@@@ -1160,9 -1401,10 +1401,10 @@@ out_unlocked
  static loff_t ceph_llseek(struct file *file, loff_t offset, int whence)
  {
  	struct inode *inode = file->f_mapping->host;
+ 	loff_t i_size;
  	int ret;
  
 -	mutex_lock(&inode->i_mutex);
 +	inode_lock(inode);
  
  	if (whence == SEEK_END || whence == SEEK_DATA || whence == SEEK_HOLE) {
  		ret = ceph_do_getattr(inode, CEPH_STAT_CAP_SIZE, false);