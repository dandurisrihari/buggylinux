{
  "hash": "434a964daa14b9db083ce20404a4a2add54d037a",
  "hash_short": "434a964d",
  "subject": "hfs: fix hfs_find_init() sb->ext_tree NULL ptr oops",
  "body": "Clement Lecigne reports a filesystem which causes a kernel oops in\nhfs_find_init() trying to dereference sb->ext_tree which is NULL.\n\nThis proves to be because the filesystem has a corrupted MDB extent\nrecord, where the extents file does not fit into the first three extents\nin the file record (the first blocks).\n\nIn hfs_get_block() when looking up the blocks for the extent file\n(HFS_EXT_CNID), it fails the first blocks special case, and falls\nthrough to the extent code (which ultimately calls hfs_find_init())\nwhich is in the process of being initialised.\n\nHfs avoids this scenario by always having the extents b-tree fitting\ninto the first blocks (the extents B-tree can't have overflow extents).\n\nThe fix is to check at mount time that the B-tree fits into first\nblocks, i.e.  fail if HFS_I(inode)->alloc_blocks >=\nHFS_I(inode)->first_blocks\n\nNote, the existing commit 47f365eb57573 (\"hfs: fix oops on mount with\ncorrupted btree extent records\") becomes subsumed into this as a special\ncase, but only for the extents B-tree (HFS_EXT_CNID), it is perfectly\nacceptable for the catalog B-Tree file to grow beyond three extents,\nwith the remaining extent descriptors in the extents overfow.\n\nThis fixes CVE-2011-2203\n\nReported-by: Clement LECIGNE <clement.lecigne@netasq.com>\nSigned-off-by: Phillip Lougher <plougher@redhat.com>\nCc: Jeff Mahoney <jeffm@suse.com>\nCc: Christoph Hellwig <hch@lst.de>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
  "full_message": "hfs: fix hfs_find_init() sb->ext_tree NULL ptr oops\n\nClement Lecigne reports a filesystem which causes a kernel oops in\nhfs_find_init() trying to dereference sb->ext_tree which is NULL.\n\nThis proves to be because the filesystem has a corrupted MDB extent\nrecord, where the extents file does not fit into the first three extents\nin the file record (the first blocks).\n\nIn hfs_get_block() when looking up the blocks for the extent file\n(HFS_EXT_CNID), it fails the first blocks special case, and falls\nthrough to the extent code (which ultimately calls hfs_find_init())\nwhich is in the process of being initialised.\n\nHfs avoids this scenario by always having the extents b-tree fitting\ninto the first blocks (the extents B-tree can't have overflow extents).\n\nThe fix is to check at mount time that the B-tree fits into first\nblocks, i.e.  fail if HFS_I(inode)->alloc_blocks >=\nHFS_I(inode)->first_blocks\n\nNote, the existing commit 47f365eb57573 (\"hfs: fix oops on mount with\ncorrupted btree extent records\") becomes subsumed into this as a special\ncase, but only for the extents B-tree (HFS_EXT_CNID), it is perfectly\nacceptable for the catalog B-Tree file to grow beyond three extents,\nwith the remaining extent descriptors in the extents overfow.\n\nThis fixes CVE-2011-2203\n\nReported-by: Clement LECIGNE <clement.lecigne@netasq.com>\nSigned-off-by: Phillip Lougher <plougher@redhat.com>\nCc: Jeff Mahoney <jeffm@suse.com>\nCc: Christoph Hellwig <hch@lst.de>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
  "author_name": "Phillip Lougher",
  "author_email": "plougher@redhat.com",
  "author_date": "Wed Nov 2 13:38:01 2011 -0700",
  "author_date_iso": "2011-11-02T13:38:01-07:00",
  "committer_name": "Linus Torvalds",
  "committer_email": "torvalds@linux-foundation.org",
  "committer_date": "Wed Nov 2 16:06:59 2011 -0700",
  "committer_date_iso": "2011-11-02T16:06:59-07:00",
  "files_changed": [
    "fs/hfs/btree.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "fs/hfs/btree.c",
      "insertions": 15,
      "deletions": 5
    }
  ],
  "total_insertions": 15,
  "total_deletions": 5,
  "total_changes": 20,
  "parents": [
    "3069083cc8def2ffad8520f0f24c6f95f140aac5"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v3.10",
    "v3.10-rc1",
    "v3.10-rc2",
    "v3.10-rc3",
    "v3.10-rc4",
    "v3.10-rc5",
    "v3.10-rc6",
    "v3.10-rc7",
    "v3.11",
    "v3.11-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [
      "CVE-2011-2203"
    ],
    "security_keywords": []
  },
  "fix_type": "cve",
  "file_results": [
    {
      "file": "fs/hfs/btree.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}