{
  "hash": "c69a48cdb301a18697bc8c9935baf4f32861cf9e",
  "hash_short": "c69a48cd",
  "subject": "powerpc: make feature-fixup tests fortify-safe",
  "body": "Testing the fortified string functions[1] would cause a kernel panic on\nboot in test_feature_fixups() due to a buffer overflow in memcmp.\n\nThis boils down to things like this:\n\n  extern unsigned int ftr_fixup_test1;\n  extern unsigned int ftr_fixup_test1_orig;\n\n  check(memcmp(&ftr_fixup_test1, &ftr_fixup_test1_orig, size) == 0);\n\nWe know that these are asm labels so it is safe to read up to 'size'\nbytes at those addresses.\n\nHowever, because we have passed the address of a single unsigned int to\nmemcmp, the compiler believes the underlying object is in fact a single\nunsigned int.  So if size > sizeof(unsigned int), there will be a panic\nat runtime.\n\nWe can fix this by changing the types: instead of calling the asm labels\nunsigned ints, call them unsigned int[]s.  Therefore the size isn't\nincorrectly determined at compile time and we get a regular unsafe\nmemcmp and no panic.\n\n[1] http://openwall.com/lists/kernel-hardening/2017/05/09/2\n\nLink: http://lkml.kernel.org/r/1497903987-21002-7-git-send-email-keescook@chromium.org\nSigned-off-by: Daniel Axtens <dja@axtens.net>\nSigned-off-by: Kees Cook <keescook@chromium.org>\nSuggested-by: Michael Ellerman <mpe@ellerman.id.au>\nTested-by: Andrew Donnellan <andrew.donnellan@au1.ibm.com>\nReviewed-by: Andrew Donnellan <andrew.donnellan@au1.ibm.com>\nCc: Kees Cook <keescook@chromium.org>\nCc: Daniel Micay <danielmicay@gmail.com>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
  "full_message": "powerpc: make feature-fixup tests fortify-safe\n\nTesting the fortified string functions[1] would cause a kernel panic on\nboot in test_feature_fixups() due to a buffer overflow in memcmp.\n\nThis boils down to things like this:\n\n  extern unsigned int ftr_fixup_test1;\n  extern unsigned int ftr_fixup_test1_orig;\n\n  check(memcmp(&ftr_fixup_test1, &ftr_fixup_test1_orig, size) == 0);\n\nWe know that these are asm labels so it is safe to read up to 'size'\nbytes at those addresses.\n\nHowever, because we have passed the address of a single unsigned int to\nmemcmp, the compiler believes the underlying object is in fact a single\nunsigned int.  So if size > sizeof(unsigned int), there will be a panic\nat runtime.\n\nWe can fix this by changing the types: instead of calling the asm labels\nunsigned ints, call them unsigned int[]s.  Therefore the size isn't\nincorrectly determined at compile time and we get a regular unsafe\nmemcmp and no panic.\n\n[1] http://openwall.com/lists/kernel-hardening/2017/05/09/2\n\nLink: http://lkml.kernel.org/r/1497903987-21002-7-git-send-email-keescook@chromium.org\nSigned-off-by: Daniel Axtens <dja@axtens.net>\nSigned-off-by: Kees Cook <keescook@chromium.org>\nSuggested-by: Michael Ellerman <mpe@ellerman.id.au>\nTested-by: Andrew Donnellan <andrew.donnellan@au1.ibm.com>\nReviewed-by: Andrew Donnellan <andrew.donnellan@au1.ibm.com>\nCc: Kees Cook <keescook@chromium.org>\nCc: Daniel Micay <danielmicay@gmail.com>\nSigned-off-by: Andrew Morton <akpm@linux-foundation.org>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>",
  "author_name": "Daniel Axtens",
  "author_email": "dja@axtens.net",
  "author_date": "Wed Jul 12 14:36:07 2017 -0700",
  "author_date_iso": "2017-07-12T14:36:07-07:00",
  "committer_name": "Linus Torvalds",
  "committer_email": "torvalds@linux-foundation.org",
  "committer_date": "Wed Jul 12 16:26:03 2017 -0700",
  "committer_date_iso": "2017-07-12T16:26:03-07:00",
  "files_changed": [
    "arch/powerpc/lib/feature-fixups.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "arch/powerpc/lib/feature-fixups.c",
      "insertions": 90,
      "deletions": 90
    }
  ],
  "total_insertions": 90,
  "total_deletions": 90,
  "total_changes": 180,
  "parents": [
    "054f367a32381b5640c5d150fe0b7ba285564998"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v4.13",
    "v4.13-rc1",
    "v4.13-rc2",
    "v4.13-rc3",
    "v4.13-rc4",
    "v4.13-rc5",
    "v4.13-rc6",
    "v4.13-rc7",
    "v4.14",
    "v4.14-rc1"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "hardening"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "arch/powerpc/lib/feature-fixups.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}