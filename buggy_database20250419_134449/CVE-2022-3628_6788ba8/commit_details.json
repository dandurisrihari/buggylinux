{
  "hash": "6788ba8aed4e28e90f72d68a9d794e34eac17295",
  "hash_short": "6788ba8a",
  "subject": "wifi: brcmfmac: Fix potential buffer overflow in brcmf_fweh_event_worker()",
  "body": "This patch fixes an intra-object buffer overflow in brcmfmac that occurs\nwhen the device provides a 'bsscfgidx' equal to or greater than the\nbuffer size. The patch adds a check that leads to a safe failure if that\nis the case.\n\nThis fixes CVE-2022-3628.\n\nUBSAN: array-index-out-of-bounds in drivers/net/wireless/broadcom/brcm80211/brcmfmac/fweh.c\nindex 52 is out of range for type 'brcmf_if *[16]'\nCPU: 0 PID: 1898 Comm: kworker/0:2 Tainted: G           O      5.14.0+ #132\nHardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.12.1-0-ga5cab58e9a3f-prebuilt.qemu.org 04/01/2014\nWorkqueue: events brcmf_fweh_event_worker\nCall Trace:\n dump_stack_lvl+0x57/0x7d\n ubsan_epilogue+0x5/0x40\n __ubsan_handle_out_of_bounds+0x69/0x80\n ? memcpy+0x39/0x60\n brcmf_fweh_event_worker+0xae1/0xc00\n ? brcmf_fweh_call_event_handler.isra.0+0x100/0x100\n ? rcu_read_lock_sched_held+0xa1/0xd0\n ? rcu_read_lock_bh_held+0xb0/0xb0\n ? lockdep_hardirqs_on_prepare+0x273/0x3e0\n process_one_work+0x873/0x13e0\n ? lock_release+0x640/0x640\n ? pwq_dec_nr_in_flight+0x320/0x320\n ? rwlock_bug.part.0+0x90/0x90\n worker_thread+0x8b/0xd10\n ? __kthread_parkme+0xd9/0x1d0\n ? process_one_work+0x13e0/0x13e0\n kthread+0x379/0x450\n ? _raw_spin_unlock_irq+0x24/0x30\n ? set_kthread_struct+0x100/0x100\n ret_from_fork+0x1f/0x30\n================================================================================\ngeneral protection fault, probably for non-canonical address 0xe5601c0020023fff: 0000 [#1] SMP KASAN\nKASAN: maybe wild-memory-access in range [0x2b0100010011fff8-0x2b0100010011ffff]\nCPU: 0 PID: 1898 Comm: kworker/0:2 Tainted: G           O      5.14.0+ #132\nHardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.12.1-0-ga5cab58e9a3f-prebuilt.qemu.org 04/01/2014\nWorkqueue: events brcmf_fweh_event_worker\nRIP: 0010:brcmf_fweh_call_event_handler.isra.0+0x42/0x100\nCode: 89 f5 53 48 89 fb 48 83 ec 08 e8 79 0b 38 fe 48 85 ed 74 7e e8 6f 0b 38 fe 48 89 ea 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 8b 00 00 00 4c 8b 7d 00 44 89 e0 48 ba 00 00 00\nRSP: 0018:ffffc9000259fbd8 EFLAGS: 00010207\nRAX: dffffc0000000000 RBX: ffff888115d8cd50 RCX: 0000000000000000\nRDX: 0560200020023fff RSI: ffffffff8304bc91 RDI: ffff888115d8cd50\nRBP: 2b0100010011ffff R08: ffff888112340050 R09: ffffed1023549809\nR10: ffff88811aa4c047 R11: ffffed1023549808 R12: 0000000000000045\nR13: ffffc9000259fca0 R14: ffff888112340050 R15: ffff888112340000\nFS:  0000000000000000(0000) GS:ffff88811aa00000(0000) knlGS:0000000000000000\nCS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\nCR2: 000000004053ccc0 CR3: 0000000112740000 CR4: 0000000000750ef0\nDR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\nDR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400\nPKRU: 55555554\nCall Trace:\n brcmf_fweh_event_worker+0x117/0xc00\n ? brcmf_fweh_call_event_handler.isra.0+0x100/0x100\n ? rcu_read_lock_sched_held+0xa1/0xd0\n ? rcu_read_lock_bh_held+0xb0/0xb0\n ? lockdep_hardirqs_on_prepare+0x273/0x3e0\n process_one_work+0x873/0x13e0\n ? lock_release+0x640/0x640\n ? pwq_dec_nr_in_flight+0x320/0x320\n ? rwlock_bug.part.0+0x90/0x90\n worker_thread+0x8b/0xd10\n ? __kthread_parkme+0xd9/0x1d0\n ? process_one_work+0x13e0/0x13e0\n kthread+0x379/0x450\n ? _raw_spin_unlock_irq+0x24/0x30\n ? set_kthread_struct+0x100/0x100\n ret_from_fork+0x1f/0x30\nModules linked in: 88XXau(O) 88x2bu(O)\n---[ end trace 41d302138f3ff55a ]---\nRIP: 0010:brcmf_fweh_call_event_handler.isra.0+0x42/0x100\nCode: 89 f5 53 48 89 fb 48 83 ec 08 e8 79 0b 38 fe 48 85 ed 74 7e e8 6f 0b 38 fe 48 89 ea 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 8b 00 00 00 4c 8b 7d 00 44 89 e0 48 ba 00 00 00\nRSP: 0018:ffffc9000259fbd8 EFLAGS: 00010207\nRAX: dffffc0000000000 RBX: ffff888115d8cd50 RCX: 0000000000000000\nRDX: 0560200020023fff RSI: ffffffff8304bc91 RDI: ffff888115d8cd50\nRBP: 2b0100010011ffff R08: ffff888112340050 R09: ffffed1023549809\nR10: ffff88811aa4c047 R11: ffffed1023549808 R12: 0000000000000045\nR13: ffffc9000259fca0 R14: ffff888112340050 R15: ffff888112340000\nFS:  0000000000000000(0000) GS:ffff88811aa00000(0000) knlGS:0000000000000000\nCS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\nCR2: 000000004053ccc0 CR3: 0000000112740000 CR4: 0000000000750ef0\nDR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\nDR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400\nPKRU: 55555554\nKernel panic - not syncing: Fatal exception\n\nReported-by: Dokyung Song <dokyungs@yonsei.ac.kr>\nReported-by: Jisoo Jang <jisoo.jang@yonsei.ac.kr>\nReported-by: Minsuk Kang <linuxlovemin@yonsei.ac.kr>\nReviewed-by: Arend van Spriel <aspriel@gmail.com>\nCc: <stable@vger.kernel.org>\nSigned-off-by: Dokyung Song <dokyung.song@gmail.com>\nSigned-off-by: Kalle Valo <kvalo@kernel.org>\nLink: https://lore.kernel.org/r/20221021061359.GA550858@laguna",
  "full_message": "wifi: brcmfmac: Fix potential buffer overflow in brcmf_fweh_event_worker()\n\nThis patch fixes an intra-object buffer overflow in brcmfmac that occurs\nwhen the device provides a 'bsscfgidx' equal to or greater than the\nbuffer size. The patch adds a check that leads to a safe failure if that\nis the case.\n\nThis fixes CVE-2022-3628.\n\nUBSAN: array-index-out-of-bounds in drivers/net/wireless/broadcom/brcm80211/brcmfmac/fweh.c\nindex 52 is out of range for type 'brcmf_if *[16]'\nCPU: 0 PID: 1898 Comm: kworker/0:2 Tainted: G           O      5.14.0+ #132\nHardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.12.1-0-ga5cab58e9a3f-prebuilt.qemu.org 04/01/2014\nWorkqueue: events brcmf_fweh_event_worker\nCall Trace:\n dump_stack_lvl+0x57/0x7d\n ubsan_epilogue+0x5/0x40\n __ubsan_handle_out_of_bounds+0x69/0x80\n ? memcpy+0x39/0x60\n brcmf_fweh_event_worker+0xae1/0xc00\n ? brcmf_fweh_call_event_handler.isra.0+0x100/0x100\n ? rcu_read_lock_sched_held+0xa1/0xd0\n ? rcu_read_lock_bh_held+0xb0/0xb0\n ? lockdep_hardirqs_on_prepare+0x273/0x3e0\n process_one_work+0x873/0x13e0\n ? lock_release+0x640/0x640\n ? pwq_dec_nr_in_flight+0x320/0x320\n ? rwlock_bug.part.0+0x90/0x90\n worker_thread+0x8b/0xd10\n ? __kthread_parkme+0xd9/0x1d0\n ? process_one_work+0x13e0/0x13e0\n kthread+0x379/0x450\n ? _raw_spin_unlock_irq+0x24/0x30\n ? set_kthread_struct+0x100/0x100\n ret_from_fork+0x1f/0x30\n================================================================================\ngeneral protection fault, probably for non-canonical address 0xe5601c0020023fff: 0000 [#1] SMP KASAN\nKASAN: maybe wild-memory-access in range [0x2b0100010011fff8-0x2b0100010011ffff]\nCPU: 0 PID: 1898 Comm: kworker/0:2 Tainted: G           O      5.14.0+ #132\nHardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.12.1-0-ga5cab58e9a3f-prebuilt.qemu.org 04/01/2014\nWorkqueue: events brcmf_fweh_event_worker\nRIP: 0010:brcmf_fweh_call_event_handler.isra.0+0x42/0x100\nCode: 89 f5 53 48 89 fb 48 83 ec 08 e8 79 0b 38 fe 48 85 ed 74 7e e8 6f 0b 38 fe 48 89 ea 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 8b 00 00 00 4c 8b 7d 00 44 89 e0 48 ba 00 00 00\nRSP: 0018:ffffc9000259fbd8 EFLAGS: 00010207\nRAX: dffffc0000000000 RBX: ffff888115d8cd50 RCX: 0000000000000000\nRDX: 0560200020023fff RSI: ffffffff8304bc91 RDI: ffff888115d8cd50\nRBP: 2b0100010011ffff R08: ffff888112340050 R09: ffffed1023549809\nR10: ffff88811aa4c047 R11: ffffed1023549808 R12: 0000000000000045\nR13: ffffc9000259fca0 R14: ffff888112340050 R15: ffff888112340000\nFS:  0000000000000000(0000) GS:ffff88811aa00000(0000) knlGS:0000000000000000\nCS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\nCR2: 000000004053ccc0 CR3: 0000000112740000 CR4: 0000000000750ef0\nDR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\nDR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400\nPKRU: 55555554\nCall Trace:\n brcmf_fweh_event_worker+0x117/0xc00\n ? brcmf_fweh_call_event_handler.isra.0+0x100/0x100\n ? rcu_read_lock_sched_held+0xa1/0xd0\n ? rcu_read_lock_bh_held+0xb0/0xb0\n ? lockdep_hardirqs_on_prepare+0x273/0x3e0\n process_one_work+0x873/0x13e0\n ? lock_release+0x640/0x640\n ? pwq_dec_nr_in_flight+0x320/0x320\n ? rwlock_bug.part.0+0x90/0x90\n worker_thread+0x8b/0xd10\n ? __kthread_parkme+0xd9/0x1d0\n ? process_one_work+0x13e0/0x13e0\n kthread+0x379/0x450\n ? _raw_spin_unlock_irq+0x24/0x30\n ? set_kthread_struct+0x100/0x100\n ret_from_fork+0x1f/0x30\nModules linked in: 88XXau(O) 88x2bu(O)\n---[ end trace 41d302138f3ff55a ]---\nRIP: 0010:brcmf_fweh_call_event_handler.isra.0+0x42/0x100\nCode: 89 f5 53 48 89 fb 48 83 ec 08 e8 79 0b 38 fe 48 85 ed 74 7e e8 6f 0b 38 fe 48 89 ea 48 b8 00 00 00 00 00 fc ff df 48 c1 ea 03 <80> 3c 02 00 0f 85 8b 00 00 00 4c 8b 7d 00 44 89 e0 48 ba 00 00 00\nRSP: 0018:ffffc9000259fbd8 EFLAGS: 00010207\nRAX: dffffc0000000000 RBX: ffff888115d8cd50 RCX: 0000000000000000\nRDX: 0560200020023fff RSI: ffffffff8304bc91 RDI: ffff888115d8cd50\nRBP: 2b0100010011ffff R08: ffff888112340050 R09: ffffed1023549809\nR10: ffff88811aa4c047 R11: ffffed1023549808 R12: 0000000000000045\nR13: ffffc9000259fca0 R14: ffff888112340050 R15: ffff888112340000\nFS:  0000000000000000(0000) GS:ffff88811aa00000(0000) knlGS:0000000000000000\nCS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\nCR2: 000000004053ccc0 CR3: 0000000112740000 CR4: 0000000000750ef0\nDR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\nDR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400\nPKRU: 55555554\nKernel panic - not syncing: Fatal exception\n\nReported-by: Dokyung Song <dokyungs@yonsei.ac.kr>\nReported-by: Jisoo Jang <jisoo.jang@yonsei.ac.kr>\nReported-by: Minsuk Kang <linuxlovemin@yonsei.ac.kr>\nReviewed-by: Arend van Spriel <aspriel@gmail.com>\nCc: <stable@vger.kernel.org>\nSigned-off-by: Dokyung Song <dokyung.song@gmail.com>\nSigned-off-by: Kalle Valo <kvalo@kernel.org>\nLink: https://lore.kernel.org/r/20221021061359.GA550858@laguna",
  "author_name": "Dokyung Song",
  "author_email": "dokyung.song@gmail.com",
  "author_date": "Fri Oct 21 15:13:59 2022 +0900",
  "author_date_iso": "2022-10-21T15:13:59+09:00",
  "committer_name": "Kalle Valo",
  "committer_email": "kvalo@kernel.org",
  "committer_date": "Tue Nov 1 13:14:20 2022 +0200",
  "committer_date_iso": "2022-11-01T13:14:20+02:00",
  "files_changed": [
    "drivers/net/wireless/broadcom/brcm80211/brcmfmac/fweh.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/net/wireless/broadcom/brcm80211/brcmfmac/fweh.c",
      "insertions": 4,
      "deletions": 0
    }
  ],
  "total_insertions": 4,
  "total_deletions": 0,
  "total_changes": 4,
  "parents": [
    "e6cb8769452e8236b52134e5cb4a18b8f5986932"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [
      "CVE-2022-3628"
    ],
    "security_keywords": []
  },
  "fix_type": "cve",
  "file_results": [
    {
      "file": "drivers/net/wireless/broadcom/brcm80211/brcmfmac/fweh.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}