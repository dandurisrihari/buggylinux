{
  "hash": "0d7336f8f06d4a1a1e2c62624d086561e8490bb7",
  "hash_short": "0d7336f8",
  "subject": "tcp: ulp: diag: more info without CAP_NET_ADMIN",
  "body": "When introduced in commit 61723b393292 (\"tcp: ulp: add functions to dump\nulp-specific information\"), the whole ULP diag info has been exported\nonly if the requester had CAP_NET_ADMIN.\n\nIt looks like not everything is sensitive, and some info can be exported\nto all users in order to ease the debugging from the userspace side\nwithout requiring additional capabilities. Each layer should then decide\nwhat can be exposed to everybody. The 'net_admin' boolean is then passed\nto the different layers.\n\nOn kTLS side, it looks like there is nothing sensitive there: version,\ncipher type, tx/rx user config type, plus some flags. So, only some\nmetadata about the configuration, no cryptographic info like keys, etc.\nThen, everything can be exported to all users.\n\nOn MPTCP side, that's different. The MPTCP-related sequence numbers per\nsubflow should certainly not be exposed to everybody. For example, the\nDSS mapping and ssn_offset would give all users on the system access to\nnarrow ranges of values for the subflow TCP sequence numbers and\nMPTCP-level DSNs, and then ease packet injection. The TCP diag interface\ndoesn't expose the TCP sequence numbers for TCP sockets, so best to do\nthe same here. The rest -- token, IDs, flags -- can be exported to\neverybody.\n\nAcked-by: Mat Martineau <martineau@kernel.org>\nSigned-off-by: Matthieu Baerts (NGI0) <matttbe@kernel.org>\nLink: https://patch.msgid.link/20250306-net-next-tcp-ulp-diag-net-admin-v1-2-06afdd860fc9@kernel.org\nSigned-off-by: Jakub Kicinski <kuba@kernel.org>",
  "full_message": "tcp: ulp: diag: more info without CAP_NET_ADMIN\n\nWhen introduced in commit 61723b393292 (\"tcp: ulp: add functions to dump\nulp-specific information\"), the whole ULP diag info has been exported\nonly if the requester had CAP_NET_ADMIN.\n\nIt looks like not everything is sensitive, and some info can be exported\nto all users in order to ease the debugging from the userspace side\nwithout requiring additional capabilities. Each layer should then decide\nwhat can be exposed to everybody. The 'net_admin' boolean is then passed\nto the different layers.\n\nOn kTLS side, it looks like there is nothing sensitive there: version,\ncipher type, tx/rx user config type, plus some flags. So, only some\nmetadata about the configuration, no cryptographic info like keys, etc.\nThen, everything can be exported to all users.\n\nOn MPTCP side, that's different. The MPTCP-related sequence numbers per\nsubflow should certainly not be exposed to everybody. For example, the\nDSS mapping and ssn_offset would give all users on the system access to\nnarrow ranges of values for the subflow TCP sequence numbers and\nMPTCP-level DSNs, and then ease packet injection. The TCP diag interface\ndoesn't expose the TCP sequence numbers for TCP sockets, so best to do\nthe same here. The rest -- token, IDs, flags -- can be exported to\neverybody.\n\nAcked-by: Mat Martineau <martineau@kernel.org>\nSigned-off-by: Matthieu Baerts (NGI0) <matttbe@kernel.org>\nLink: https://patch.msgid.link/20250306-net-next-tcp-ulp-diag-net-admin-v1-2-06afdd860fc9@kernel.org\nSigned-off-by: Jakub Kicinski <kuba@kernel.org>",
  "author_name": "Matthieu Baerts (NGI0)",
  "author_email": "matttbe@kernel.org",
  "author_date": "Thu Mar 6 12:29:28 2025 +0100",
  "author_date_iso": "2025-03-06T12:29:28+01:00",
  "committer_name": "Jakub Kicinski",
  "committer_email": "kuba@kernel.org",
  "committer_date": "Fri Mar 7 19:39:53 2025 -0800",
  "committer_date_iso": "2025-03-07T19:39:53-08:00",
  "files_changed": [
    "include/net/tcp.h",
    "net/ipv4/tcp_diag.c",
    "net/mptcp/diag.c",
    "net/tls/tls_main.c"
  ],
  "files_changed_count": 4,
  "stats": [
    {
      "file": "include/net/tcp.h",
      "insertions": 2,
      "deletions": 2
    },
    {
      "file": "net/ipv4/tcp_diag.c",
      "insertions": 4,
      "deletions": 4
    },
    {
      "file": "net/mptcp/diag.c",
      "insertions": 26,
      "deletions": 16
    },
    {
      "file": "net/tls/tls_main.c",
      "insertions": 2,
      "deletions": 2
    }
  ],
  "total_insertions": 34,
  "total_deletions": 24,
  "total_changes": 58,
  "parents": [
    "f5afcb9fbb3984137feb12cb2d2fc6986a8347ac"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "injection"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "include/net/tcp.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "net/ipv4/tcp_diag.c",
      "pre_version": true,
      "post_version": true,
      "patch": true
    },
    {
      "file": "net/mptcp/diag.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "net/tls/tls_main.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}