Commit Hash: 271351d255b09e39c7f6437738cba595f9b235be
Subject: tipc: only accept encrypted MSG_CRYPTO msgs

CVE Identifiers:
- CVE-2021-43267

Full commit message:
tipc: only accept encrypted MSG_CRYPTO msgs

The MSG_CRYPTO msgs are always encrypted and sent to other nodes
for keys' deployment. But when receiving in peers, if those nodes
do not validate it and make sure it's encrypted, one could craft
a malicious MSG_CRYPTO msg to deploy its key with no need to know
other nodes' keys.

This patch is to do that by checking TIPC_SKB_CB(skb)->decrypted
and discard it if this packet never got decrypted.

Note that this is also a supplementary fix to CVE-2021-43267 that
can be triggered by an unencrypted malicious MSG_CRYPTO msg.

Fixes: 1ef6f7c9390f ("tipc: add automatic session key exchange")
Acked-by: Ying Xue <ying.xue@windriver.com>
Acked-by: Jon Maloy <jmaloy@redhat.com>
Signed-off-by: Xin Long <lucien.xin@gmail.com>
Signed-off-by: David S. Miller <davem@davemloft.net>

Metadata:
Author: Xin Long <lucien.xin@gmail.com>
Author Date: Mon Nov 15 07:45:24 2021 -0500
Committer: David S. Miller <davem@davemloft.net>
Commit Date: Mon Nov 15 14:25:22 2021 +0000

Files Changed: 1
Lines Added: 5
Lines Removed: 2
Total Changes: 7
