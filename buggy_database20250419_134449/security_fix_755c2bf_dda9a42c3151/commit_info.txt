Commit Hash: 755c2bf878607dbddb1423df9abf16b82205896f
Subject: KVM: x86: lapic: don't touch irr_pending in kvm_apic_update_apicv when inhibiting it


Security Keywords:
- injection

Full commit message:
KVM: x86: lapic: don't touch irr_pending in kvm_apic_update_apicv when inhibiting it

kvm_apic_update_apicv is called when AVIC is still active, thus IRR bits
can be set by the CPU after it is called, and don't cause the irr_pending
to be set to true.

Also logic in avic_kick_target_vcpu doesn't expect a race with this
function so to make it simple, just keep irr_pending set to true and
let the next interrupt injection to the guest clear it.

Signed-off-by: Maxim Levitsky <mlevitsk@redhat.com>
Message-Id: <20220207155447.840194-9-mlevitsk@redhat.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>

Metadata:
Author: Maxim Levitsky <mlevitsk@redhat.com>
Author Date: Mon Feb 7 17:54:25 2022 +0200
Committer: Paolo Bonzini <pbonzini@redhat.com>
Commit Date: Tue Feb 8 13:30:49 2022 -0500

Files Changed: 1
Lines Added: 6
Lines Removed: 1
Total Changes: 7
