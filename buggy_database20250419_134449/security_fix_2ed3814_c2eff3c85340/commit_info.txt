Commit Hash: 2ed381439e89fa6d1a0839ef45ccd45d99d8e915
Subject: RDMA/i40iw: Address an mmap handler exploit in i40iw


Security Keywords:
- exploit

Full commit message:
RDMA/i40iw: Address an mmap handler exploit in i40iw

i40iw_mmap manipulates the vma->vm_pgoff to differentiate a push page mmap
vs a doorbell mmap, and uses it to compute the pfn in remap_pfn_range
without any validation. This is vulnerable to an mmap exploit as described
in: https://lore.kernel.org/r/20201119093523.7588-1-zhudi21@huawei.com

The push feature is disabled in the driver currently and therefore no push
mmaps are issued from user-space. The feature does not work as expected in
the x722 product.

Remove the push module parameter and all VMA attribute manipulations for
this feature in i40iw_mmap. Update i40iw_mmap to only allow DB user
mmapings at offset = 0. Check vm_pgoff for zero and if the mmaps are bound
to a single page.

Cc: <stable@kernel.org>
Fixes: d37498417947 ("i40iw: add files for iwarp interface")
Link: https://lore.kernel.org/r/20201125005616.1800-2-shiraz.saleem@intel.com
Reported-by: Di Zhu <zhudi21@huawei.com>
Signed-off-by: Shiraz Saleem <shiraz.saleem@intel.com>
Signed-off-by: Jason Gunthorpe <jgg@nvidia.com>

Metadata:
Author: Shiraz Saleem <shiraz.saleem@intel.com>
Author Date: Tue Nov 24 18:56:16 2020 -0600
Committer: Jason Gunthorpe <jgg@nvidia.com>
Commit Date: Wed Nov 25 10:38:11 2020 -0400

Files Changed: 2
Lines Added: 7
Lines Removed: 35
Total Changes: 42
