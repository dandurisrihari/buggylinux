{
  "hash": "2ed381439e89fa6d1a0839ef45ccd45d99d8e915",
  "hash_short": "2ed38143",
  "subject": "RDMA/i40iw: Address an mmap handler exploit in i40iw",
  "body": "i40iw_mmap manipulates the vma->vm_pgoff to differentiate a push page mmap\nvs a doorbell mmap, and uses it to compute the pfn in remap_pfn_range\nwithout any validation. This is vulnerable to an mmap exploit as described\nin: https://lore.kernel.org/r/20201119093523.7588-1-zhudi21@huawei.com\n\nThe push feature is disabled in the driver currently and therefore no push\nmmaps are issued from user-space. The feature does not work as expected in\nthe x722 product.\n\nRemove the push module parameter and all VMA attribute manipulations for\nthis feature in i40iw_mmap. Update i40iw_mmap to only allow DB user\nmmapings at offset = 0. Check vm_pgoff for zero and if the mmaps are bound\nto a single page.\n\nCc: <stable@kernel.org>\nFixes: d37498417947 (\"i40iw: add files for iwarp interface\")\nLink: https://lore.kernel.org/r/20201125005616.1800-2-shiraz.saleem@intel.com\nReported-by: Di Zhu <zhudi21@huawei.com>\nSigned-off-by: Shiraz Saleem <shiraz.saleem@intel.com>\nSigned-off-by: Jason Gunthorpe <jgg@nvidia.com>",
  "full_message": "RDMA/i40iw: Address an mmap handler exploit in i40iw\n\ni40iw_mmap manipulates the vma->vm_pgoff to differentiate a push page mmap\nvs a doorbell mmap, and uses it to compute the pfn in remap_pfn_range\nwithout any validation. This is vulnerable to an mmap exploit as described\nin: https://lore.kernel.org/r/20201119093523.7588-1-zhudi21@huawei.com\n\nThe push feature is disabled in the driver currently and therefore no push\nmmaps are issued from user-space. The feature does not work as expected in\nthe x722 product.\n\nRemove the push module parameter and all VMA attribute manipulations for\nthis feature in i40iw_mmap. Update i40iw_mmap to only allow DB user\nmmapings at offset = 0. Check vm_pgoff for zero and if the mmaps are bound\nto a single page.\n\nCc: <stable@kernel.org>\nFixes: d37498417947 (\"i40iw: add files for iwarp interface\")\nLink: https://lore.kernel.org/r/20201125005616.1800-2-shiraz.saleem@intel.com\nReported-by: Di Zhu <zhudi21@huawei.com>\nSigned-off-by: Shiraz Saleem <shiraz.saleem@intel.com>\nSigned-off-by: Jason Gunthorpe <jgg@nvidia.com>",
  "author_name": "Shiraz Saleem",
  "author_email": "shiraz.saleem@intel.com",
  "author_date": "Tue Nov 24 18:56:16 2020 -0600",
  "author_date_iso": "2020-11-24T18:56:16-06:00",
  "committer_name": "Jason Gunthorpe",
  "committer_email": "jgg@nvidia.com",
  "committer_date": "Wed Nov 25 10:38:11 2020 -0400",
  "committer_date_iso": "2020-11-25T10:38:11-04:00",
  "files_changed": [
    "drivers/infiniband/hw/i40iw/i40iw_main.c",
    "drivers/infiniband/hw/i40iw/i40iw_verbs.c"
  ],
  "files_changed_count": 2,
  "stats": [
    {
      "file": "drivers/infiniband/hw/i40iw/i40iw_main.c",
      "insertions": 0,
      "deletions": 5
    },
    {
      "file": "drivers/infiniband/hw/i40iw/i40iw_verbs.c",
      "insertions": 7,
      "deletions": 30
    }
  ],
  "total_insertions": 7,
  "total_deletions": 35,
  "total_changes": 42,
  "parents": [
    "6830ff853a5764c75e56750d59d0bbb6b26f1835"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "exploit"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/infiniband/hw/i40iw/i40iw_main.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "drivers/infiniband/hw/i40iw/i40iw_verbs.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}