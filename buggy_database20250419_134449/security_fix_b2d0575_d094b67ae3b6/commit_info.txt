Commit Hash: b2d057560b8107c633b39aabe517ff9d93f285e3
Subject: secure_seq: use the 64 bits of the siphash for port offset calculation


Security Keywords:
- exploit

Full commit message:
secure_seq: use the 64 bits of the siphash for port offset calculation

SipHash replaced MD5 in secure_ipv{4,6}_port_ephemeral() via commit
7cd23e5300c1 ("secure_seq: use SipHash in place of MD5"), but the output
remained truncated to 32-bit only. In order to exploit more bits from the
hash, let's make the functions return the full 64-bit of siphash_3u32().
We also make sure the port offset calculation in __inet_hash_connect()
remains done on 32-bit to avoid the need for div_u64_rem() and an extra
cost on 32-bit systems.

Cc: Jason A. Donenfeld <Jason@zx2c4.com>
Cc: Moshe Kol <moshe.kol@mail.huji.ac.il>
Cc: Yossi Gilad <yossi.gilad@mail.huji.ac.il>
Cc: Amit Klein <aksecurity@gmail.com>
Reviewed-by: Eric Dumazet <edumazet@google.com>
Signed-off-by: Willy Tarreau <w@1wt.eu>
Signed-off-by: Jakub Kicinski <kuba@kernel.org>

Metadata:
Author: Willy Tarreau <w@1wt.eu>
Author Date: Mon May 2 10:46:08 2022 +0200
Committer: Jakub Kicinski <kuba@kernel.org>
Commit Date: Wed May 4 19:22:20 2022 -0700

Files Changed: 5
Lines Added: 13
Lines Removed: 11
Total Changes: 24
