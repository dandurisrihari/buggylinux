{
  "hash": "f6fe0b2d35457c10ec37acc209d19726bdc16dbd",
  "hash_short": "f6fe0b2d",
  "subject": "nvme-pci: fix sleeping function called from interrupt context",
  "body": "the nvme_handle_cqe() interrupt handler calls nvme_complete_async_event()\nbut the latter may call nvme_auth_stop() which is a blocking function.\nSleeping functions can't be called in interrupt context\n\n BUG: sleeping function called from invalid context\n in_atomic(): 1, irqs_disabled(): 1, non_block: 0, pid: 0, name: swapper/15\n  Call Trace:\n     <IRQ>\n      __cancel_work_timer+0x31e/0x460\n      ? nvme_change_ctrl_state+0xcf/0x3c0 [nvme_core]\n      ? nvme_change_ctrl_state+0xcf/0x3c0 [nvme_core]\n      nvme_complete_async_event+0x365/0x480 [nvme_core]\n      nvme_poll_cq+0x262/0xe50 [nvme]\n\nFix the bug by moving nvme_auth_stop() to fw_act_work\n(executed by the nvme_wq workqueue)\n\nFixes: f50fff73d620 (\"nvme: implement In-Band authentication\")\nSigned-off-by: Maurizio Lombardi <mlombard@redhat.com>\nReviewed-by: Jens Axboe <axboe@kernel.dk>\nReviewed-by: Sagi Grimberg <sagi@grimberg.me>\nSigned-off-by: Keith Busch <kbusch@kernel.org>",
  "full_message": "nvme-pci: fix sleeping function called from interrupt context\n\nthe nvme_handle_cqe() interrupt handler calls nvme_complete_async_event()\nbut the latter may call nvme_auth_stop() which is a blocking function.\nSleeping functions can't be called in interrupt context\n\n BUG: sleeping function called from invalid context\n in_atomic(): 1, irqs_disabled(): 1, non_block: 0, pid: 0, name: swapper/15\n  Call Trace:\n     <IRQ>\n      __cancel_work_timer+0x31e/0x460\n      ? nvme_change_ctrl_state+0xcf/0x3c0 [nvme_core]\n      ? nvme_change_ctrl_state+0xcf/0x3c0 [nvme_core]\n      nvme_complete_async_event+0x365/0x480 [nvme_core]\n      nvme_poll_cq+0x262/0xe50 [nvme]\n\nFix the bug by moving nvme_auth_stop() to fw_act_work\n(executed by the nvme_wq workqueue)\n\nFixes: f50fff73d620 (\"nvme: implement In-Band authentication\")\nSigned-off-by: Maurizio Lombardi <mlombard@redhat.com>\nReviewed-by: Jens Axboe <axboe@kernel.dk>\nReviewed-by: Sagi Grimberg <sagi@grimberg.me>\nSigned-off-by: Keith Busch <kbusch@kernel.org>",
  "author_name": "Maurizio Lombardi",
  "author_email": "mlombard@redhat.com",
  "author_date": "Tue Dec 19 17:48:23 2023 +0100",
  "author_date_iso": "2023-12-19T17:48:23+01:00",
  "committer_name": "Keith Busch",
  "committer_email": "kbusch@kernel.org",
  "committer_date": "Tue Dec 19 12:41:05 2023 -0800",
  "committer_date_iso": "2023-12-19T12:41:05-08:00",
  "files_changed": [
    "drivers/nvme/host/core.c"
  ],
  "files_changed_count": 1,
  "stats": [
    {
      "file": "drivers/nvme/host/core.c",
      "insertions": 2,
      "deletions": 1
    }
  ],
  "total_insertions": 2,
  "total_deletions": 1,
  "total_changes": 3,
  "parents": [
    "d3e8b1858734bf46cda495be4165787b9a3981a6"
  ],
  "branches": [
    "* development",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "authentication"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "drivers/nvme/host/core.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}