Commit Hash: f260694e6463b63ae550aad25ddefe94cb1904da
Subject: scsi: qla2xxx: Fix erroneous mailbox timeout after PCI error injection


Security Keywords:
- injection

Full commit message:
scsi: qla2xxx: Fix erroneous mailbox timeout after PCI error injection

Clear wait for mailbox interrupt flag to prevent stale mailbox:

Feb 22 05:22:56 ltcden4-lp7 kernel: qla2xxx [0135:90:00.1]-500a:4: LOOP UP detected (16 Gbps).
Feb 22 05:22:59 ltcden4-lp7 kernel: qla2xxx [0135:90:00.1]-d04c:4: MBX Command timeout for cmd 69, ...

To fix the issue, driver needs to clear the MBX_INTR_WAIT flag on purging
the mailbox. When the stale mailbox completion does arrive, it will be
dropped.

Link: https://lore.kernel.org/r/20220616053508.27186-11-njavali@marvell.com
Fixes: b6faaaf796d7 ("scsi: qla2xxx: Serialize mailbox request")
Cc: Naresh Bannoth <nbannoth@in.ibm.com>
Cc: Kyle Mahlkuch <Kyle.Mahlkuch@ibm.com>
Cc: stable@vger.kernel.org
Reported-by: Naresh Bannoth <nbannoth@in.ibm.com>
Tested-by: Naresh Bannoth <nbannoth@in.ibm.com>
Signed-off-by: Quinn Tran <qutran@marvell.com>
Signed-off-by: Nilesh Javali <njavali@marvell.com>
Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>

Metadata:
Author: Quinn Tran <qutran@marvell.com>
Author Date: Wed Jun 15 22:35:07 2022 -0700
Committer: Martin K. Petersen <martin.petersen@oracle.com>
Commit Date: Thu Jun 16 21:59:54 2022 -0400

Files Changed: 1
Lines Added: 6
Lines Removed: 6
Total Changes: 12
