{
  "hash": "aba8269588301f7778bea811d6f7ec74c2e37279",
  "hash_short": "aba82695",
  "subject": "{ipv4,xfrm}: Introduce xfrm_tunnel_notifier for xfrm tunnel mode callback",
  "body": "Some thoughts on IPv4 VTI implementation:\n\nThe connection between VTI receiving part and xfrm tunnel mode input process\nis hardly a \"xfrm_tunnel\", xfrm_tunnel is used in places where, e.g ipip/sit\nand xfrm4_tunnel, acts like a true \"tunnel\" device.\n\nIn addition, IMHO, VTI doesn't need vti_err to do something meaningful, as all\nVTI needs is just a notifier to be called whenever xfrm_input ingress a packet\nto update statistics.\n\nA IPsec protected packet is first handled by protocol handlers, e.g AH/ESP,\nto check packet authentication or encryption rightness. PMTU update is taken\ncare of in this stage by protocol error handler.\n\nThen the packet is rearranged properly depending on whether it's transport\nmode or tunnel mode packed by mode \"input\" handler. The VTI handler code\ntakes effects in this stage in tunnel mode only. So it neither need propagate\nPMTU, as it has already been done if necessary, nor the VTI handler is\nqualified as a xfrm_tunnel.\n\nSo this patch introduces xfrm_tunnel_notifier and meanwhile wipe out vti_err\ncode.\n\nSigned-off-by: Fan Du <fan.du@windriver.com>\nCc: Steffen Klassert <steffen.klassert@secunet.com>\nCc: David S. Miller <davem@davemloft.net>\nReviewed-by: Saurabh Mohan <saurabh.mohan@vyatta.com>\nSigned-off-by: Steffen Klassert <steffen.klassert@secunet.com>",
  "full_message": "{ipv4,xfrm}: Introduce xfrm_tunnel_notifier for xfrm tunnel mode callback\n\nSome thoughts on IPv4 VTI implementation:\n\nThe connection between VTI receiving part and xfrm tunnel mode input process\nis hardly a \"xfrm_tunnel\", xfrm_tunnel is used in places where, e.g ipip/sit\nand xfrm4_tunnel, acts like a true \"tunnel\" device.\n\nIn addition, IMHO, VTI doesn't need vti_err to do something meaningful, as all\nVTI needs is just a notifier to be called whenever xfrm_input ingress a packet\nto update statistics.\n\nA IPsec protected packet is first handled by protocol handlers, e.g AH/ESP,\nto check packet authentication or encryption rightness. PMTU update is taken\ncare of in this stage by protocol error handler.\n\nThen the packet is rearranged properly depending on whether it's transport\nmode or tunnel mode packed by mode \"input\" handler. The VTI handler code\ntakes effects in this stage in tunnel mode only. So it neither need propagate\nPMTU, as it has already been done if necessary, nor the VTI handler is\nqualified as a xfrm_tunnel.\n\nSo this patch introduces xfrm_tunnel_notifier and meanwhile wipe out vti_err\ncode.\n\nSigned-off-by: Fan Du <fan.du@windriver.com>\nCc: Steffen Klassert <steffen.klassert@secunet.com>\nCc: David S. Miller <davem@davemloft.net>\nReviewed-by: Saurabh Mohan <saurabh.mohan@vyatta.com>\nSigned-off-by: Steffen Klassert <steffen.klassert@secunet.com>",
  "author_name": "Fan Du",
  "author_email": "fan.du@windriver.com",
  "author_date": "Wed Aug 28 15:09:40 2013 +0800",
  "author_date_iso": "2013-08-28T15:09:40+08:00",
  "committer_name": "Steffen Klassert",
  "committer_email": "steffen.klassert@secunet.com",
  "committer_date": "Wed Aug 28 09:22:17 2013 +0200",
  "committer_date_iso": "2013-08-28T09:22:17+02:00",
  "files_changed": [
    "include/net/xfrm.h",
    "net/ipv4/ip_vti.c",
    "net/ipv4/xfrm4_mode_tunnel.c"
  ],
  "files_changed_count": 3,
  "stats": [
    {
      "file": "include/net/xfrm.h",
      "insertions": 8,
      "deletions": 2
    },
    {
      "file": "net/ipv4/ip_vti.c",
      "insertions": 1,
      "deletions": 66
    },
    {
      "file": "net/ipv4/xfrm4_mode_tunnel.c",
      "insertions": 8,
      "deletions": 8
    }
  ],
  "total_insertions": 17,
  "total_deletions": 76,
  "total_changes": 93,
  "parents": [
    "0806ae4cc8722b2d2822fe3fa3f516f2da6b9459"
  ],
  "branches": [
    "* development",
    "master",
    "remotes/origin/HEAD -> origin/master",
    "remotes/origin/master"
  ],
  "tags": [
    "v3.13",
    "v3.13-rc1",
    "v3.13-rc2",
    "v3.13-rc3",
    "v3.13-rc4",
    "v3.13-rc5",
    "v3.13-rc6",
    "v3.13-rc7",
    "v3.13-rc8",
    "v3.14"
  ],
  "is_merge": false,
  "security_info": {
    "cve_ids": [],
    "security_keywords": [
      "authentication"
    ]
  },
  "fix_type": "security",
  "file_results": [
    {
      "file": "include/net/xfrm.h",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "net/ipv4/ip_vti.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    },
    {
      "file": "net/ipv4/xfrm4_mode_tunnel.c",
      "pre_version": false,
      "post_version": true,
      "patch": true
    }
  ]
}